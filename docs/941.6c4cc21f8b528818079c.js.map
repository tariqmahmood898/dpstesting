{"version":3,"file":"941.6c4cc21f8b528818079c.js","mappings":"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AAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,EAAM,IAAM,IAAM,GAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,EAAM,IAAM,GAAM,GAAM,GAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,GAAM,GAAM,IAAM,GAAM,IAAM,IAC//CC,EAAI,CAAC,GAAM,EAAM,IAAM,IAAM,GAAM,GAAM,IAAM,GAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,GAAM,IAAM,GAAM,IAAM,GAAM,GAAM,IAAM,IAAM,GAAM,EAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,GAAM,GAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,EAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,EAAM,IAAM,IAAM,GAAM,EAAM,IAAM,GAAM,GAAM,IAAM,IAAM,GAAM,GAAM,EAAM,IAAM,IAAM,IAAM,EAAM,EAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,GAAM,GAAM,IAAM,GAAM,IAAM,GAAM,IAAM,GAAM,GAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,EAAM,IAAM,GAAM,IAAM,GAAM,GAAM,GAAM,GAAM,IAAM,IAAM,GAAM,GAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,GAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,GAAM,GAAM,GAAM,EAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,GAAM,GAAM,GAAM,GAAM,KAG//ClsF,EAAK,CAAC,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,EAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAC1/FC,EAAK,CAAC,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,EAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,SAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAC1/FJ,EAAK,CAAC,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,SAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,SAAY,WAAY,UAAY,WAAY,UAAY,WAAY,SAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,EAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAC1/FssF,EAAK,CAAC,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,SAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,SAAY,WAAY,UAAY,WAAY,UAAY,WAAY,SAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,EAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAG1/FC,EAAK,CAAC,WAAY,WAAY,UAAY,UAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,SAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,EAAY,UAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,YAC1/FC,EAAK,CAAC,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,EAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,SAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,SAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,YAC1/FC,EAAK,CAAC,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,SAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,EAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,YAC1/FC,EAAK,CAAC,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,SAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,SAAY,WAAY,SAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,SAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,EAAY,WAAY,UAAY,UAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,YAG1/FC,EAAK,CAAC,EAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,SAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,SAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,SAAY,UAAY,UAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,SAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,SAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,YAC1/FC,EAAK,CAAC,EAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,UAAY,SAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,SAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,SAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,UAAY,SAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,YAC1/FC,EAAK,CAAC,EAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,UAAY,UAAY,UAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,SAAY,UAAY,UAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,SAAY,UAAY,UAAY,WAAY,UAAY,UAAY,UAAY,UAAY,SAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,YAC1/FC,EAAK,CAAC,EAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,UAAY,UAAY,UAAY,UAAY,SAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,UAAY,UAAY,SAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAA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","sources":["webpack://mytonwallet/webpack/runtime/chunk loaded","webpack://mytonwallet/webpack/runtime/startup chunk dependencies","webpack://mytonwallet/./src/util/environment.ts","webpack://mytonwallet/./src/api/chains/ton/util/dns.ts","webpack://mytonwallet/./src/util/handleError.ts","webpack://mytonwallet/./src/api/chains/ton/constants.ts","webpack://mytonwallet/./src/util/Deferred.ts","webpack://mytonwallet/./src/util/dateFormat.ts","webpack://mytonwallet/./src/api/types/misc.ts","webpack://mytonwallet/./src/util/withCache.ts","webpack://mytonwallet/./src/config.ts","webpack://mytonwallet/./src/util/schedulers.ts","webpack://mytonwallet/./src/api/errors.ts","webpack://mytonwallet/./src/util/fetch.ts","webpack://mytonwallet/./src/util/safeExec.ts","webpack://mytonwallet/./src/lib/noble-ed25519/index.js","webpack://mytonwallet/./src/util/logs.ts","webpack://mytonwallet/./src/api/types/errors.ts","webpack://mytonwallet/./src/util/assert.ts","webpack://mytonwallet/./src/api/chains/ton/contracts/JettonStaking/imports/constants.ts","webpack://mytonwallet/./src/lib/big.js/index.js","webpack://mytonwallet/./src/util/decimals.ts","webpack://mytonwallet/./src/util/random.ts","webpack://mytonwallet/./src/util/bigint.ts","webpack://mytonwallet/./src/util/extensionMessageSerializer.ts","webpack://mytonwallet/./src/util/createPostMessageInterface.ts","webpack://mytonwallet/./src/util/bigintPatch.ts","webpack://mytonwallet/./src/util/account.ts","webpack://mytonwallet/./src/util/isMnemonicPrivateKey.ts","webpack://mytonwallet/./src/util/shortenAddress.ts","webpack://mytonwallet/./src/lib/ed25519-hd-key/index.ts","webpack://mytonwallet/./src/util/iteratees.ts","webpack://mytonwallet/./src/util/dns.ts","webpack://mytonwallet/./src/api/common/utils.ts","webpack://mytonwallet/./src/api/environment.ts","webpack://mytonwallet/./src/api/chains/ton/util/index.ts","webpack://mytonwallet/./src/api/chains/ton/util/tonCore.ts","webpack://mytonwallet/./src/api/storages/types.ts","webpack://mytonwallet/./src/util/windowProvider/connector.ts","webpack://mytonwallet/./src/util/generateUniqueId.ts","webpack://mytonwallet/./src/util/PostMessageConnector.ts","webpack://mytonwallet/./src/api/storages/capacitorStorage.ts","webpack://mytonwallet/./src/api/storages/extension.ts","webpack://mytonwallet/./src/api/storages/idb.ts","webpack://mytonwallet/./src/api/storages/localStorage.ts","webpack://mytonwallet/./src/api/storages/index.ts","webpack://mytonwallet/./src/api/common/accounts.ts","webpack://mytonwallet/./src/api/common/mnemonic.ts","webpack://mytonwallet/./src/lib/confusables/util.ts","webpack://mytonwallet/./src/lib/confusables/characters.ts","webpack://mytonwallet/./src/lib/confusables/index.ts","webpack://mytonwallet/./src/api/common/backend.ts","webpack://mytonwallet/./src/api/common/addresses.ts","webpack://mytonwallet/./src/util/compareActivities.ts","webpack://mytonwallet/./src/util/activities/index.ts","webpack://mytonwallet/./src/util/datetime.ts","webpack://mytonwallet/./src/util/poisoningHash.ts","webpack://mytonwallet/./src/util/isEmptyObject.ts","webpack://mytonwallet/./src/api/db/repository.ts","webpack://mytonwallet/./src/api/db/index.ts","webpack://mytonwallet/./src/api/common/tokens.ts","webpack://mytonwallet/./src/api/chains/ton/toncenter/other.ts","webpack://mytonwallet/./src/api/chains/ton/util/tonapiio.ts","webpack://mytonwallet/./src/api/chains/ton/util/metadata.ts","webpack://mytonwallet/./src/util/areDeepEqual.ts","webpack://mytonwallet/./src/util/getDappConnectionUniqueId.ts","webpack://mytonwallet/./src/api/common/helpers.ts","webpack://mytonwallet/./src/api/chains/ton/toncenter/actions.ts","webpack://mytonwallet/./src/util/callbacks.ts","webpack://mytonwallet/./src/util/focusAwareDelay.ts","webpack://mytonwallet/./src/api/constants.ts","webpack://mytonwallet/./src/api/common/polling/utils.ts","webpack://mytonwallet/./src/api/common/polling/fallbackPollingScheduler.ts","webpack://mytonwallet/./src/util/reconnectingWebsocket.ts","webpack://mytonwallet/./src/api/chains/ton/toncenter/socket.ts","webpack://mytonwallet/./src/api/chains/ton/toncenter/throttleSocketActions.ts","webpack://mytonwallet/./src/api/chains/ton/toncenter/activityStream.ts","webpack://mytonwallet/./src/api/chains/ton/toncenter/transactions.ts","webpack://mytonwallet/./src/api/chains/ton/address.ts","webpack://mytonwallet/./src/api/chains/ton/wallet.ts","webpack://mytonwallet/./src/api/chains/ton/auth.ts","webpack://mytonwallet/./src/util/chain.ts","webpack://mytonwallet/./src/util/tokens.ts","webpack://mytonwallet/./src/util/fee/transferFee.ts","webpack://mytonwallet/./src/api/chains/ton/util/encryption.ts","webpack://mytonwallet/./src/api/chains/ton/util/diesel.ts","webpack://mytonwallet/./src/api/chains/ton/util/w5diesel.ts","webpack://mytonwallet/./src/api/chains/ton/util/sendExternal.ts","webpack://mytonwallet/./src/api/common/pendingTransfers.ts","webpack://mytonwallet/./src/api/chains/ton/traces.ts","webpack://mytonwallet/./src/api/chains/ton/toncenter/traces.ts","webpack://mytonwallet/./src/api/chains/ton/activities.ts","webpack://mytonwallet/./src/api/chains/ton/emulation.ts","webpack://mytonwallet/./src/api/chains/ton/toncenter/emulation.ts","webpack://mytonwallet/./src/api/chains/ton/tokens.ts","webpack://mytonwallet/./src/api/chains/ton/priceless.ts","webpack://mytonwallet/./src/api/chains/ton/transfer.ts","webpack://mytonwallet/./src/api/chains/ton/nfts.ts","webpack://mytonwallet/./src/util/ton/transfer.ts","webpack://mytonwallet/./src/api/chains/ton/domains.ts","webpack://mytonwallet/./src/util/devSettings.ts","webpack://mytonwallet/./src/api/chains/ton/contracts/NominatorPool.ts","webpack://mytonwallet/./src/api/common/cache.ts","webpack://mytonwallet/./src/api/common/other.ts","webpack://mytonwallet/./src/api/chains/ton/staking.ts","webpack://mytonwallet/./src/util/staking/index.ts","webpack://mytonwallet/./src/util/ton/calcJettonStakingApr.ts","webpack://mytonwallet/./src/api/chains/ton/other.ts","webpack://mytonwallet/./src/api/chains/ton/swap.ts","webpack://mytonwallet/./src/api/common/swap.ts","webpack://mytonwallet/./src/api/common/activities.ts","webpack://mytonwallet/./src/api/common/backendSocket.ts","webpack://mytonwallet/./src/api/common/polling/walletPolling.ts","webpack://mytonwallet/./src/api/common/txCallbacks.ts","webpack://mytonwallet/./src/util/orGate.ts","webpack://mytonwallet/./src/api/chains/ton/richActivityStream.ts","webpack://mytonwallet/./src/api/chains/ton/polling.ts","webpack://mytonwallet/./src/api/chains/ton/vesting.ts","webpack://mytonwallet/./src/api/chains/tron/util/tronweb.ts","webpack://mytonwallet/./src/api/chains/tron/util/tokens.ts","webpack://mytonwallet/./src/api/chains/tron/transactions.ts","webpack://mytonwallet/./src/api/chains/tron/wallet.ts","webpack://mytonwallet/./src/api/chains/tron/polling.ts","webpack://mytonwallet/./src/api/chains/tron/constants.ts","webpack://mytonwallet/./src/api/chains/tron/transfer.ts","webpack://mytonwallet/./src/util/stringFormat.ts","webpack://mytonwallet/./src/api/chains/tron/index.ts","webpack://mytonwallet/./src/api/chains/index.ts","webpack://mytonwallet/./src/api/hooks.ts","webpack://mytonwallet/./src/api/common/prices.ts","webpack://mytonwallet/./src/api/methods/preload.ts","webpack://mytonwallet/./src/api/methods/tokens.ts","webpack://mytonwallet/./src/api/methods/transactions.ts","webpack://mytonwallet/./src/api/methods/staking.ts","webpack://mytonwallet/./src/api/methods/other.ts","webpack://mytonwallet/./src/api/methods/swap.ts","webpack://mytonwallet/./src/api/methods/polling.ts","webpack://mytonwallet/./src/api/methods/accounts.ts","webpack://mytonwallet/./src/api/methods/dapps.ts","webpack://mytonwallet/./src/api/methods/auth.ts","webpack://mytonwallet/./src/api/common/dappPromises.ts","webpack://mytonwallet/./src/api/methods/wallet.ts","webpack://mytonwallet/./src/api/methods/nfts.ts","webpack://mytonwallet/./src/api/methods/domains.ts","webpack://mytonwallet/./src/api/tonConnect/types/index.ts","webpack://mytonwallet/./src/util/tonConnectEnvironment.ts","webpack://mytonwallet/./src/api/tonConnect/errors.ts","webpack://mytonwallet/./src/util/crcHash.ts","webpack://mytonwallet/./src/api/tonConnect/signing.ts","webpack://mytonwallet/./src/api/tonConnect/utils.ts","webpack://mytonwallet/./src/api/tonConnect/index.ts","webpack://mytonwallet/./src/api/tonConnect/sse.ts","webpack://mytonwallet/./src/api/methods/prices.ts","webpack://mytonwallet/./src/api/methods/notifications.ts","webpack://mytonwallet/./src/api/methods/init.ts","webpack://mytonwallet/./src/api/migrations/00016.ts","webpack://mytonwallet/./src/api/migrations/00017.ts","webpack://mytonwallet/./src/api/migrations/00018.ts","webpack://mytonwallet/./src/api/providers/worker/provider.ts","webpack://mytonwallet/./src/lib/aes-js/index.js","webpack://mytonwallet/webpack/bootstrap","webpack://mytonwallet/webpack/runtime/compat get default export","webpack://mytonwallet/webpack/runtime/define property getters","webpack://mytonwallet/webpack/runtime/ensure chunk","webpack://mytonwallet/webpack/runtime/get javascript chunk filename","webpack://mytonwallet/webpack/runtime/get mini-css chunk filename","webpack://mytonwallet/webpack/runtime/global","webpack://mytonwallet/webpack/runtime/hasOwnProperty shorthand","webpack://mytonwallet/webpack/runtime/make namespace object","webpack://mytonwallet/webpack/runtime/publicPath","webpack://mytonwallet/webpack/runtime/importScripts chunk loading","webpack://mytonwallet/webpack/startup"],"sourcesContent":["var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","var next = __webpack_require__.x;\n__webpack_require__.x = () => {\n\treturn Promise.all([973,508,115].map(__webpack_require__.e, __webpack_require__)).then(next);\n};","import { IS_EXTENSION } from '../config';\n\nexport const IS_EXTENSION_PAGE_SCRIPT = IS_EXTENSION\n  && !['chrome-extension:', 'moz-extension:'].includes(self.location.protocol);\n","/* Source https://github.com/toncenter/tonweb/blob/master/src/contract/dns/DnsUtils.js */\nimport type { Cell, Slice } from '@ton/core';\nimport { Address, Builder } from '@ton/core';\n\nimport type { TonClient } from './TonClient';\n\nimport { DnsCategory } from '../constants';\nimport { sha256BigInt } from './other';\n\nexport type DnsResult = Cell | Address | string | undefined;\n\nexport function dnsCategoryToBigInt(category?: string) {\n  if (!category) return 0n; // all categories\n  return sha256BigInt(category);\n}\n\nfunction parseSmartContractAddressImpl(cell: Cell, prefix0: number, prefix1: number): Address | undefined {\n  const slice = cell.asSlice();\n\n  const byte0 = slice.loadUint(8);\n  const byte1 = slice.loadUint(8);\n\n  if (byte0 !== prefix0 || byte1 !== prefix1) {\n    throw new Error('Invalid dns record value prefix');\n  }\n\n  return parseAddress(slice);\n}\n\nfunction parseSmartContractAddressRecord(cell: Cell): Address | undefined {\n  return parseSmartContractAddressImpl(cell, 0x9f, 0xd3);\n}\n\nfunction parseNextResolverRecord(cell: Cell): Address | undefined {\n  return parseSmartContractAddressImpl(cell, 0xba, 0x93);\n}\n\nfunction parseStorageBagIdRecord(cell: Cell): string {\n  const slice = cell.asSlice();\n  const byte0 = slice.loadUint(8);\n  const byte1 = slice.loadUint(8);\n\n  if (byte0 !== 0x74 || byte1 !== 0x73) {\n    throw new Error('Invalid dns record value prefix');\n  }\n\n  const buffer = slice.loadBuffer(4);\n  return buffer.toString('hex');\n}\n\nfunction parseSiteRecord(cell: Cell): string {\n  const slice = cell.asSlice();\n  const byte0 = slice.loadUint(8);\n  const byte1 = slice.loadUint(8);\n\n  if (byte0 === 0xad || byte1 === 0x01) {\n    return parseAdnlAddressRecord(cell);\n  } else {\n    return parseStorageBagIdRecord(cell);\n  }\n}\n\nfunction parseAdnlAddressRecord(cell: Cell): string {\n  const slice = cell.asSlice();\n  const byte0 = slice.loadUint(8);\n  const byte1 = slice.loadUint(8);\n\n  if (byte0 !== 0xad || byte1 !== 0x01) {\n    throw new Error('Invalid dns record value prefix');\n  }\n\n  const buffer = slice.loadBuffer(4);\n  return buffer.toString('hex');\n}\n\nasync function dnsResolveImpl(\n  client: TonClient,\n  dnsAddress: string,\n  rawDomainBytes: Buffer,\n  category?: DnsCategory,\n  oneStep?: boolean,\n): Promise<DnsResult> {\n  const len = rawDomainBytes.length * 8;\n\n  const domainCell = new Builder()\n    .storeBuffer(rawDomainBytes)\n    .asCell();\n\n  const categoryBigInt = dnsCategoryToBigInt(category);\n  const { stack } = await client.callGetMethod(Address.parse(dnsAddress), 'dnsresolve', [\n    { type: 'slice', cell: domainCell },\n    { type: 'int', value: categoryBigInt },\n  ]);\n\n  const resultLen = stack.readNumber();\n\n  let cell: Cell | undefined;\n\n  try {\n    cell = stack.readCell();\n  } catch (err) {\n    // Do nothing\n  }\n\n  if (resultLen === 0) {\n    return undefined; // domain cannot be resolved\n  }\n\n  if (resultLen % 8 !== 0) {\n    throw new Error('domain split not at a component boundary');\n  }\n  // if (rawDomainBytes[resultLen] !== 0) {\n  //     throw new Error('domain split not at a component boundary');\n  // }\n  if (resultLen > len) {\n    throw new Error(`invalid response ${resultLen}/${len}`);\n  } else if (resultLen === len) {\n    if (category === DnsCategory.DnsNextResolver) {\n      return cell ? parseNextResolverRecord(cell) : undefined;\n    } else if (category === DnsCategory.Wallet) {\n      return cell ? parseSmartContractAddressRecord(cell) : undefined;\n    } else if (category === DnsCategory.Site) {\n      return cell ? parseSiteRecord(cell) : undefined;\n    } else if (category === DnsCategory.BagId) {\n      return cell ? parseStorageBagIdRecord(cell) : undefined;\n    } else {\n      return cell;\n    }\n  } else if (!cell) {\n    return undefined; // domain cannot be resolved\n  } else {\n    const nextAddress = parseNextResolverRecord(cell)!;\n    if (oneStep) {\n      if (category === DnsCategory.DnsNextResolver) {\n        return nextAddress;\n      } else {\n        return undefined;\n      }\n    } else {\n      return dnsResolveImpl(client, nextAddress.toString(), rawDomainBytes.slice(resultLen / 8), category, false);\n    }\n  }\n}\n\n/** Encodes the domain in accordance with the TEP-81 standard */\nexport function encodeDomain(domain: string): string {\n  if (!domain || !domain.length) {\n    throw new Error('empty domain');\n  }\n  if (domain === '.') {\n    return '';\n  }\n\n  domain = domain.toLowerCase();\n\n  for (let i = 0; i < domain.length; i++) {\n    if (domain.charCodeAt(i) <= 32) {\n      throw new Error('bytes in range 0..32 are not allowed in domain names');\n    }\n  }\n\n  for (let i = 0; i < domain.length; i++) {\n    const s = domain.substring(i, i + 1);\n    for (let c = 127; c <= 159; c++) { // another control codes range\n      if (s === String.fromCharCode(c)) {\n        throw new Error('bytes in range 127..159 are not allowed in domain names');\n      }\n    }\n  }\n\n  const arr = domain.split('.');\n\n  arr.forEach((part) => {\n    if (!part.length) {\n      throw new Error('domain name cannot have an empty component');\n    }\n  });\n\n  return `${arr.reverse().join('\\0')}\\0`;\n}\n\nexport function dnsResolve(\n  client: TonClient,\n  rootDnsAddress: string,\n  domain: string,\n  category?: DnsCategory,\n  oneStep?: boolean,\n): Promise<DnsResult> {\n  let rawDomain = encodeDomain(domain);\n  if (rawDomain.length < 126) {\n    rawDomain = `\\0${rawDomain}`;\n  }\n\n  return dnsResolveImpl(client, rootDnsAddress, Buffer.from(rawDomain), category, oneStep);\n}\n\nfunction parseAddress(slice: Slice): Address | undefined {\n  slice.loadUint(3);\n  let n = slice.loadUintBig(8);\n  if (n > 127n) { // Maybe it's not necessary?\n    n -= 256n;\n  }\n\n  const hashPart = slice.loadUintBig(256);\n  if (`${n.toString(10)}:${hashPart.toString(16)}` === '0:0') {\n    return undefined;\n  }\n  const s = `${n.toString(10)}:${hashPart.toString(16).padStart(64, '0')}`;\n  return Address.parse(s);\n}\n","import { APP_ENV, DEBUG_ALERT_MSG } from '../config';\nimport { SECOND } from './dateFormat';\nimport { IS_EXTENSION_PAGE_SCRIPT } from './environment';\nimport { logDebugError } from './logs';\nimport { throttle } from './schedulers';\n\nconst shouldShowAlert = (APP_ENV === 'development' || APP_ENV === 'staging')\n  && typeof window === 'object'\n  && !IS_EXTENSION_PAGE_SCRIPT;\n\nconst throttledAlert = throttle((message) => window.alert(message), 10 * SECOND);\n\nself.addEventListener('error', handleErrorEvent);\nself.addEventListener('unhandledrejection', handleErrorEvent);\n\nfunction handleErrorEvent(e: ErrorEvent | PromiseRejectionEvent) {\n  // https://stackoverflow.com/questions/49384120/resizeobserver-loop-limit-exceeded\n  if (e instanceof ErrorEvent && e.message === 'ResizeObserver loop limit exceeded') {\n    return;\n  }\n\n  e.preventDefault();\n\n  handleError(e instanceof ErrorEvent ? (e.error || e.message) : e.reason);\n}\n\nexport function handleError(err: Error | string) {\n  logDebugError('handleError', err);\n\n  const message = typeof err === 'string' ? err : err.message;\n  const stack = typeof err === 'object' ? err.stack : undefined;\n\n  if (message.endsWith('Failed to import rlottie-wasm.js')) {\n    return;\n  }\n\n  if (shouldShowAlert) {\n    throttledAlert(`${DEBUG_ALERT_MSG}\\n\\n${(message) || err}\\n${stack}`);\n  }\n}\n","import type { ApiTonWalletVersion, ContractInfo, ContractName } from './types';\n\nimport { JettonStakingGas } from './contracts/JettonStaking/imports/constants';\n\nexport const TON_BIP39_PATH = 'm/44\\'/607\\'/0\\'';\n\nexport const ONE_TON = 1_000_000_000n;\nexport const TOKEN_TRANSFER_AMOUNT = 50000000n; // 0.05 TON\nexport const TINY_TOKEN_TRANSFER_AMOUNT = 18000000n; // 0.018 TON\nexport const TOKEN_TRANSFER_REAL_AMOUNT = 32100000n; // 0.0321 TON\nexport const TINY_TOKEN_TRANSFER_REAL_AMOUNT = 8000000n; // 0.008 TON\nexport const TINIEST_TOKEN_TRANSFER_REAL_AMOUNT = 3000000n; // 0.003 TON\nexport const TOKEN_TRANSFER_FORWARD_AMOUNT = 1n; // 0.000000001 TON\nexport const CLAIM_MINTLESS_AMOUNT = 20000000n; // 0.02 TON\n\n/** The amount that MyTonWallet attaches to NFT transfers */\nexport const NFT_TRANSFER_AMOUNT = 100000000n; // 0.1 TON\nexport const NFT_TRANSFER_REAL_AMOUNT = 5000000n; // 0.005 TON\nexport const NFT_TRANSFER_FORWARD_AMOUNT = 1n; // 0.000000001 TON\n/**\n * When the NFT contract handles the payload we send, it simply adds its data to the payload. If the resulting payload\n * size becomes greater than the cell capacity, the contract fails to send the NFT. To avoid that, we keep some free\n * space in the payload cell we send. This constant is the size of the free space in bits.\n */\nexport const NFT_PAYLOAD_SAFE_MARGIN = 14 * 8;\n\nexport const TON_GAS = {\n  stakeNominators: ONE_TON,\n  unstakeNominators: ONE_TON,\n  stakeLiquid: ONE_TON,\n  unstakeLiquid: ONE_TON,\n  stakeJettonsForward: JettonStakingGas.STAKE_JETTONS,\n  stakeJettons: JettonStakingGas.STAKE_JETTONS + TOKEN_TRANSFER_AMOUNT,\n  unstakeJettons: JettonStakingGas.UNSTAKE_JETTONS,\n  claimJettons: JettonStakingGas.JETTON_TRANSFER + JettonStakingGas.SIMPLE_UPDATE_REQUEST,\n  changeDns: 15_000_000n, // 0.015 TON\n  stakeEthena: TOKEN_TRANSFER_AMOUNT + 100_000_000n, // 0.15 TON\n  stakeEthenaForward: 100_000_000n, // 0.1 TON\n  unstakeEthena: TOKEN_TRANSFER_AMOUNT + 100_000_000n, // 0.15 TON\n  unstakeEthenaForward: 100_000_000n, // 0.1 TON\n  unstakeEthenaLocked: 150_000_000n, // 0.15 TON\n  unstakeEthenaLockedForward: 70_000_000n, // 0.07 TON\n} as const;\n\nexport const TON_GAS_REAL = {\n  stakeNominators: 1_000_052_853n,\n  unstakeNominators: 148_337_433n,\n  stakeLiquid: 20_251_387n,\n  unstakeLiquid: 18_625_604n,\n  stakeJettons: 74_879_996n,\n  unstakeJettons: 59_971_662n,\n  claimJettons: 57_053_859n,\n  stakeEthena: 116_690_790n,\n  unstakeEthena: 113_210_330n,\n  unstakeEthenaLocked: 37_612_000n,\n};\n\nexport const STAKE_COMMENT = 'd';\nexport const UNSTAKE_COMMENT = 'w';\n\nexport const ATTEMPTS = 5;\n\nexport const DEFAULT_DECIMALS = 9;\nexport const DEFAULT_IS_BOUNCEABLE = true;\nexport const WALLET_IS_BOUNCEABLE = false;\n\n// Fee may change, so we add 5% for more reliability. This is only safe for low-fee blockchains such as TON.\nexport const FEE_FACTOR = 1.05;\n\nexport const ALL_WALLET_VERSIONS: ApiTonWalletVersion[] = [\n  'simpleR1', 'simpleR2', 'simpleR3', 'v2R1', 'v2R2', 'v3R1', 'v3R2', 'v4R2', 'W5',\n];\n\nexport const OUR_FEE_PAYLOAD_BOC = 'te6cckEBAQEABgAACE0jhUPUcYAL';\n\nexport const RAW_ADDRESS_LENGTH = 66;\n\nexport enum Workchain {\n  MasterChain = -1,\n  BaseChain = 0,\n}\n\nexport const WORKCHAIN = Workchain.BaseChain;\nexport const TRANSFER_TIMEOUT_SEC = 600; // 10 min.\n\nexport const DEFAULT_MAX_MESSAGES = 4;\nexport const LEDGER_MAX_MESSAGES = 1;\nexport const W5_MAX_MESSAGES = 255;\n\nexport enum OpCode {\n  Comment = 0,\n  Encrypted = 0x2167da4b,\n  OurFee = 0x4d238543,\n  Bounced = 0xffffffff,\n}\n\nexport enum JettonOpCode {\n  Transfer = 0xf8a7ea5,\n  TransferNotification = 0x7362d09c,\n  InternalTransfer = 0x178d4519,\n  Excesses = 0xd53276db,\n  Burn = 0x595f07bc,\n  BurnNotification = 0x7bdd97de,\n}\n\nexport enum NftOpCode {\n  TransferOwnership = 0x5fcc3d14,\n  OwnershipAssigned = 0x05138d91,\n  Excesses = 0xd53276db,\n}\n\nexport enum LiquidStakingOpCode {\n  // Pool\n  RequestLoan = 0xe642c965,\n  LoanRepayment = 0xdfdca27b,\n  Deposit = 0x47d54391,\n  Withdraw = 0x319B0CDC,\n  Withdrawal = 0x0a77535c,\n  DeployController = 0xb27edcad,\n  Touch = 0x4bc7c2df,\n  Donate = 0x73affe21,\n  // NFT\n  DistributedAsset = 0xdb3b8abd,\n  // Jetton\n  Vote = 0x69fb306c,\n}\n\nexport enum JettonStakingOpCode {\n  UnstakeRequest = 0x499a9262,\n  ClaimRewards = 0x78d9f109,\n}\n\nexport enum VestingV1OpCode {\n  AddWhitelist = 0x7258a69b,\n}\n\nexport enum SingleNominatorOpCode {\n  Withdraw = 0x1000,\n  ChangeValidator = 0x1001,\n}\n\nexport enum DnsOpCode {\n  ChangeRecord = 0x4eb1f0f9,\n}\n\nexport enum TeleitemOpCode {\n  Ok = 0xa37a0983,\n}\n\nexport enum OtherOpCode {\n  TokenBridgePaySwap = 0x8,\n}\n\nexport enum ContractType {\n  Wallet = 'wallet',\n  Staking = 'staking',\n}\n\nexport enum DnsCategory {\n  DnsNextResolver = 'dns_next_resolver',\n  Wallet = 'wallet',\n  Site = 'site',\n  BagId = 'storage',\n  Unknown = 'unknown',\n}\n\nexport const EXCESS_OP_CODES = [\n  JettonOpCode.Excesses,\n  TeleitemOpCode.Ok,\n];\n\nexport const DNS_CATEGORY_HASH_MAP = {\n  dns_next_resolver: '19f02441ee588fdb26ee24b2568dd035c3c9206e11ab979be62e55558a1d17ff',\n  wallet: 'e8d44050873dba865aa7c170ab4cce64d90839a34dcfd6cf71d14e0205443b1b',\n  site: 'fbae041b02c41ed0fd8a4efb039bc780dd6af4a1f0c420f42561ae705dda43fe',\n  storage: '49a25f9feefaffecad0fcd30c50dc9331cff8b55ece53def6285c09e17e6f5d7',\n} as const;\n\nexport const KnownContracts: Record<ContractName, ContractInfo> = {\n  simpleR1: {\n    name: 'simpleR1',\n    hash: '3232dc55b02b3d2a9485adc151cf29c50b94c374d3571cb59390d761b87af8bd',\n    type: ContractType.Wallet,\n  },\n  simpleR2: {\n    name: 'simpleR2',\n    hash: '672ce2b01d2fd487a5e0528611e7e4fc11867148cc13ff772bd773b72fb368df',\n    type: ContractType.Wallet,\n  },\n  simpleR3: {\n    name: 'simpleR3',\n    hash: 'd95417233f66ae218317f533630cbbddc677d6d893d5722be6947c8fad8e9d52',\n    type: ContractType.Wallet,\n  },\n  v2R1: {\n    name: 'v2R1',\n    hash: 'fb3bd539b7e50166f1cfdc0bbd298b1c88f6b261fe5ee61343ea47ab4b256029',\n    type: ContractType.Wallet,\n  },\n  v2R2: {\n    name: 'v2R2',\n    hash: 'b584b6106753b7f34709df505be603e463a44ff6a85adf7fec4e26453c325983',\n    type: ContractType.Wallet,\n  },\n  v3R1: {\n    name: 'v3R1',\n    hash: '11d123ed5c2055128e75a9ef4cf1e837e6d14a9c079c39939885c78dc13626e6',\n    type: ContractType.Wallet,\n  },\n  v3R2: {\n    name: 'v3R2',\n    hash: 'df7bf014ee7ac0c38da19ef1b7fa054e2cc7a4513df1f1aa295109cf3606ac14',\n    type: ContractType.Wallet,\n  },\n  v4R1: {\n    name: 'v4R1',\n    hash: '1bc0dfa40956c911616f8a5db09ecc217601bae48d7d3f9311562c5afcb66dcf',\n    type: ContractType.Wallet,\n  },\n  v4R2: {\n    name: 'v4R2',\n    hash: '5659ce2300f4a09a37b0bdee41246ded52474f032c1d6ffce0d7d31b18b7b2b1',\n    type: ContractType.Wallet,\n  },\n  W5: {\n    name: 'W5',\n    hash: '7e94eaaeaaa423b9396e79747038c42edc4fe98dce65094071f0e0ad2df22fd5',\n    type: ContractType.Wallet,\n  },\n  highloadV2: {\n    name: 'highloadV2',\n    hash: 'fcd7d1f3b3847f0b9bd44bc64a2256c03450979dd1646a24fbc874b075392d6e',\n    type: ContractType.Wallet,\n  },\n  nominatorPool: {\n    name: 'nominatorPool',\n    hash: '26faa2d0fd2a8197ea36ded8dc50ad081cce5244207e9b05c08c1bb655527bff',\n    type: ContractType.Staking,\n  },\n  multisig: {\n    name: 'multisig',\n    hash: '45d890485cdd6b152bcbbe3fb2e16d2df82f6da840440a5b9f34ea13cb0b92d2',\n    type: ContractType.Wallet,\n  },\n  multisigV2: {\n    name: 'multisigV2',\n    hash: 'eb1323c5544d5bf26248dc427d108d722d5c2922dd97dd0bdf903c4cea73ca97',\n    type: ContractType.Wallet,\n  },\n  vesting: {\n    name: 'vesting',\n    hash: '69dc931958f7aa203c4a7bfcf263d25d2d828d573184b542a65dd55c8398ad83',\n    type: ContractType.Wallet,\n  },\n  multisigNew: {\n    name: 'multisigNew',\n    hash: '7cb3678880388acff45d74b2e7e7544caa8039d20b49f57c75b53c051b6fa30f',\n    type: ContractType.Wallet,\n  },\n  dedustPool: {\n    name: 'dedustPool',\n    hash: 'f216ded2b43d32e2d487db6fa6e4d2387f0ef1d7b53ec1ad85f0b4feb8e4ed62',\n    isSwapAllowed: true,\n  },\n  dedustVaultNative: {\n    name: 'dedustVaultNative',\n    hash: '64a42ad66688097422901ae6188670f0d6292ad3bdb4139289666f24187e86cb',\n    isSwapAllowed: true,\n  },\n  // Example: https://tonscan.org/address/EQAYqo4u7VF0fa4DPAebk4g9lBytj2VFny7pzXR0trjtXQaO\n  dedustVaultJetton: {\n    name: 'dedustVaultJetton',\n    hash: '5bc82f0c5972ccc6732e98cbe31ea4795da818f9e06c991331568182a8362307',\n    isSwapAllowed: true,\n  },\n  stonPtonWallet: {\n    name: 'stonPtonWallet',\n    hash: '6ccbf71a3ed9c7355f84a698a44a7406574bfb8aa34d4bbd86ab75ee9c994880',\n    isSwapAllowed: true,\n  },\n  stonRouter: {\n    name: 'stonRouter',\n    hash: '14ce618a0e9a94adc99fa6e975219ddd675425b30dfa9728f98714c8dc55f9da',\n    isSwapAllowed: true,\n  },\n  stonRouterV2_1: {\n    name: 'stonRouterV2_1',\n    hash: 'd61cb7fb7bee0cc414286a482fccdec53c3f8717e4aae4fc362d98ab6254e6cd',\n    isSwapAllowed: true,\n  },\n  stonPoolV2_1: {\n    name: 'stonPoolV2_1',\n    hash: '16cc513c380e329f45d54f294787e2030e289799eca138961c1cd7e26e882c7c',\n    isSwapAllowed: true,\n  },\n  // Example: https://tonscan.org/address/EQCS4UEa5UaJLzOyyKieqQOQ2P9M-7kXpkO5HnP3Bv250cN3\n  stonRouterV2_2: {\n    name: 'stonRouterV2_2',\n    hash: '094b5084111addda1b6fac7007c8a8f85ff4ccc63475815ab3dfa3b5b4c6b102',\n    isSwapAllowed: true,\n  },\n  // Example: https://tonscan.org/address/EQBSNX_5mSikBVttWhIaIb0f8jJU7fL6kvyyFVppd7dWRO6M\n  stonRouterV2_2_alt: {\n    name: 'stonRouterV2_2_alt',\n    hash: 'd41e7563afa05ee008655e190920d3f53de9cab4c2d4e10ee1d0f158e95e52e5',\n    isSwapAllowed: true,\n  },\n  stonPoolV2_2: {\n    name: 'stonPoolV2_2',\n    hash: '11eaf6db706e63adf9327897aaa845c77a631856abfc14375837f19b617cacb4',\n    isSwapAllowed: true,\n  },\n  // Example: https://tonscan.org/address/EQBiLHuQjDj4fNyCD7Ch5HwpNGldlb5g-LMwQ1kStQ4NM5kv\n  stonPtonWalletV2: {\n    name: 'stonPtonWalletV2',\n    hash: '2761042202032258de9eb1b672e1ec2e4f13b2af00700195801ada33f7ced1b6',\n    isSwapAllowed: true,\n  },\n};\n","export default class Deferred<T = void> {\n  promise: Promise<T>;\n\n  reject!: (reason?: any) => void;\n\n  resolve!: (value: T | PromiseLike<T>) => void;\n\n  constructor() {\n    this.promise = new Promise((resolve, reject) => {\n      this.reject = reject;\n      this.resolve = resolve;\n    });\n  }\n\n  static resolved(): Deferred<void>;\n  static resolved<T>(value: T): Deferred<T>;\n  static resolved<T>(value?: T): Deferred<T | void> {\n    const deferred = new Deferred<T | void>();\n    deferred.resolve(value);\n    return deferred;\n  }\n}\n","import type { LangCode } from '../global/types';\nimport type { LangFn } from './langProvider';\n\nimport withCache from './withCache';\n\nexport const SECOND = 1000;\nexport const MINUTE = SECOND * 60;\nexport const HOUR = MINUTE * 60;\nexport const DAY = HOUR * 24;\nexport const YEAR = 365 * DAY;\n\nconst formatDayToStringWithCache = withCache((\n  langCode: LangCode,\n  dayStartAt: number,\n  noYear?: boolean,\n  monthFormat: 'short' | 'long' | 'numeric' | false = 'short',\n  noDay?: boolean,\n  withTime = false,\n) => {\n  return new Date(dayStartAt).toLocaleString(\n    langCode,\n    {\n      year: noYear ? undefined : 'numeric',\n      month: monthFormat || undefined,\n      day: noDay ? undefined : 'numeric',\n      hour: withTime ? 'numeric' : undefined,\n      minute: withTime ? 'numeric' : undefined,\n      hourCycle: 'h23',\n    },\n  );\n});\n\nexport function formatRelativeHumanDateTime(\n  langCode: LangCode = 'en',\n  time: number,\n) {\n  const total = time - Date.now();\n  const minutes = Math.floor((total / 1000 / 60) % 60);\n  const hours = Math.floor((total / (1000 * 3600)) % 24);\n  const days = Math.floor(total / 1000 / 3600 / 24);\n\n  const rtf = new Intl.RelativeTimeFormat(langCode, {\n    localeMatcher: 'best fit',\n    numeric: 'always',\n    style: 'long',\n  });\n\n  const result: string[] = [];\n\n  if (days > 0) {\n    const [daysPlural, daysValue] = rtf.formatToParts(days, 'day').reverse();\n    result.push(`${daysValue.value}${daysPlural.value}`.replace(' ', '\\u00A0'));\n  }\n  if (hours > 0) {\n    const [hoursPlural, hoursValue] = rtf.formatToParts(hours, 'hour').reverse();\n    result.push(`${hoursValue.value}${hoursPlural.value}`.replace(' ', '\\u00A0'));\n  }\n  if (minutes > 0) {\n    const [minutesPlural, minutesValue] = rtf.formatToParts(minutes, 'minute').reverse();\n    result.push(`${minutesValue.value}${minutesPlural.value}`.replace(' ', '\\u00A0'));\n  }\n\n  return result.join(' ');\n}\n\nexport function formatHumanDay(lang: LangFn, datetime: string | number) {\n  if (isToday(datetime)) {\n    return lang('Today');\n  }\n\n  if (isYesterday(datetime)) {\n    return lang('Yesterday');\n  }\n\n  return formatFullDay(lang.code!, datetime);\n}\n\nexport function formatFullDay(langCode: LangCode, datetime: string | number | Date) {\n  const date = new Date(datetime);\n  const dayStartAt = getDayStartAt(date);\n  const today = getDayStart(new Date());\n  const noYear = date.getFullYear() === today.getFullYear();\n\n  return formatDayToStringWithCache(langCode, dayStartAt, noYear, 'long');\n}\n\nexport function formatShortDay(langCode: LangCode, datetime: string | number | Date, withTime = false, noYear = false) {\n  const date = new Date(datetime);\n  const dayStartAt = getDayStartAt(date);\n  const today = getDayStart(new Date());\n  const todayStartAt = getDayStartAt(today);\n  const noDate = withTime && dayStartAt === todayStartAt;\n  const targetAt = withTime ? getMinuteStart(date).getTime() : dayStartAt;\n\n  noYear ||= date.getFullYear() === today.getFullYear();\n\n  return formatDayToStringWithCache(langCode, targetAt, noYear, !noDate && 'short', noDate, withTime);\n}\n\nexport function formatTime(datetime: string | number) {\n  const date = new Date(datetime);\n\n  return `${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;\n}\n\nexport function getCountDaysToDate(datetime: string | number | Date) {\n  const today = new Date();\n  const date = datetime instanceof Date ? datetime\n    : new Date(datetime);\n\n  return Math.ceil((date.getTime() - today.getTime()) / DAY);\n}\n\nexport function getDayStart(datetime: number | Date) {\n  const date = new Date(datetime);\n  date.setHours(0, 0, 0, 0);\n  return date;\n}\n\nexport function getDayStartAt(datetime: number | Date) {\n  return getDayStart(datetime).getTime();\n}\n\nexport function getMinuteStart(datetime: number | Date) {\n  const date = new Date(datetime);\n  date.setSeconds(0, 0);\n  return date;\n}\n\nfunction isToday(datetime: string | number) {\n  return getDayStartAt(new Date()) === getDayStartAt(new Date(datetime));\n}\n\nfunction isYesterday(datetime: string | number) {\n  const yesterday = new Date();\n  yesterday.setDate(yesterday.getDate() - 1);\n\n  return getDayStartAt(yesterday) === getDayStartAt(new Date(datetime));\n}\n","import type { NftItem } from 'tonapi-sdk-js';\n\nimport type { ApiTonWalletVersion } from '../chains/ton/types';\nimport type { ApiTransactionActivity } from './activity';\nimport type { ApiParsedPayload } from './payload';\nimport type { ApiSseOptions } from './storage';\n\nexport type ApiChain = 'ton' | 'tron';\nexport type ApiNetwork = 'mainnet' | 'testnet';\nexport type ApiLedgerDriver = 'HID' | 'USB';\nexport type ApiTokenType = 'lp_token';\nexport type ApiDappConnectionType = 'connect' | 'sendTransaction' | 'signData';\n\nexport interface AccountIdParsed {\n  id: number;\n  network: ApiNetwork;\n}\n\nexport interface ApiInitArgs {\n  isElectron?: boolean;\n  isNativeBottomSheet?: boolean;\n  isIosApp?: boolean;\n  isAndroidApp?: boolean;\n  referrer?: string;\n  accountIds?: string[];\n}\n\nexport interface ApiToken {\n  name: string;\n  symbol: string;\n  slug: string;\n  decimals: number;\n  chain: ApiChain;\n  type?: ApiTokenType;\n  tokenAddress?: string;\n  image?: string;\n  isPopular?: boolean;\n  keywords?: string[];\n  cmcSlug?: string;\n  color?: string;\n  isGaslessEnabled?: boolean;\n  isStarsEnabled?: boolean;\n  isTiny?: boolean;\n  customPayloadApiUrl?: string;\n  codeHash?: string;\n  /* Means the token is fetched from the backend by default and already includes price\n  and other details (`ApiTokenDetails`), so no separate requests are needed. */\n  isFromBackend?: boolean;\n}\n\nexport type ApiTokenWithPrice = ApiToken & {\n  price: number;\n  priceUsd: number;\n  percentChange24h: number;\n};\n\nexport type ApiKnownAddresses = Record<string, ApiAddressInfo>;\n\nexport interface ApiAddressInfo {\n  name?: string;\n  isScam?: boolean;\n  isMemoRequired?: boolean;\n}\n\nexport interface ApiNftSuperCollection {\n  id: string;\n  name: string;\n  icon?: 'gift';\n}\n\nexport type ApiActivityTimestamps = Record<string, number | undefined>;\nexport type ApiTransactionType = 'stake' | 'unstake' | 'unstakeRequest'\n  | 'callContract' | 'excess' | 'contractDeploy' | 'bounced'\n  | 'mint' | 'burn' | 'auctionBid' | 'nftTrade'\n  | 'dnsChangeAddress' | 'dnsChangeSite' | 'dnsChangeSubdomains' | 'dnsChangeStorage' | 'dnsDelete' | 'dnsRenew'\n  | 'liquidityDeposit' | 'liquidityWithdraw'\n  | undefined;\n\nexport interface ApiTransaction {\n  txId: string;\n  timestamp: number;\n  /** The amount to show in the UI (may mismatch the actual attached TON amount) */\n  amount: bigint;\n  fromAddress: string;\n  toAddress: string;\n  comment?: string;\n  encryptedComment?: string;\n  /**\n   * The fee to show in the UI (not the same as the network fee). When not 0, should be shown even for incoming\n   * transactions. It means that there was a hidden outgoing transaction with the given fee.\n   */\n  fee: bigint;\n  slug: string;\n  isIncoming: boolean;\n  normalizedAddress: string; // Only for TON now\n  /** Trace external message hash normalized. Only for TON. */\n  externalMsgHashNorm?: string;\n  shouldHide?: boolean;\n  type?: ApiTransactionType;\n  metadata?: ApiTransactionMetadata;\n  nft?: ApiNft;\n  /** 'pending' if awaiting confirmation by the blockchain */\n  status: 'pending' | 'completed' | 'failed';\n}\n\nexport type ApiTransactionMetadata = ApiAddressInfo;\n\nexport type ApiMtwCardType = 'black' | 'platinum' | 'gold' | 'silver' | 'standard';\nexport type ApiMtwCardTextType = 'light' | 'dark';\nexport type ApiMtwCardBorderShineType = 'up' | 'down' | 'left' | 'right' | 'radioactive';\n\nexport interface ApiNftAttribute {\n  trait_type: string;\n  value: string;\n}\n\nexport interface ApiNftMetadata {\n  attributes?: ApiNftAttribute[];\n  lottie?: string;\n  imageUrl?: string;\n  fragmentUrl?: string;\n  mtwCardId?: number;\n  mtwCardType?: ApiMtwCardType;\n  mtwCardTextType?: ApiMtwCardTextType;\n  mtwCardBorderShineType?: ApiMtwCardBorderShineType;\n}\n\nexport interface ApiNft {\n  index: number;\n  ownerAddress?: string;\n  name?: string;\n  address: string;\n  thumbnail: string;\n  image: string;\n  description?: string;\n  collectionName?: string;\n  collectionAddress?: string;\n  isOnSale: boolean;\n  isHidden?: boolean;\n  isOnFragment?: boolean;\n  isTelegramGift?: boolean;\n  isScam?: boolean;\n  metadata: ApiNftMetadata;\n}\n\nexport interface ApiDomainData {\n  domain: string;\n  linkedAddress?: string;\n  lastFillUpTime: string;\n  nft: NftItem;\n}\n\nexport type ApiHistoryList = Array<[number, number]>;\n\nexport type ApiStakingType = ApiStakingState['type'];\nexport type ApiBackendStakingType = 'nominators' | 'liquid';\n\ntype BaseStakingState = {\n  id: string;\n  tokenSlug: string;\n  annualYield: number;\n  yieldType: ApiYieldType;\n  balance: bigint;\n  pool: string;\n  unstakeRequestAmount?: bigint;\n};\n\nexport type ApiNominatorsStakingState = BaseStakingState & {\n  type: 'nominators';\n  start: number;\n  end: number;\n  pendingDepositAmount: bigint;\n};\n\nexport type ApiLiquidStakingState = BaseStakingState & {\n  type: 'liquid';\n  tokenBalance: bigint;\n  instantAvailable: bigint;\n  start: number;\n  end: number;\n};\n\nexport type ApiJettonStakingState = BaseStakingState & {\n  type: 'jetton';\n  tokenAddress: string;\n  unclaimedRewards: bigint;\n  stakeWalletAddress: string;\n  tokenAmount: bigint;\n  period: number;\n  tvl: bigint;\n  dailyReward: bigint;\n  poolWallets?: string[];\n};\n\nexport type ApiEthenaStakingState = BaseStakingState & {\n  type: 'ethena';\n  tokenBalance: bigint;\n  tsUsdeWalletAddress: string;\n  unstakeRequestAmount: bigint;\n  unlockTime?: number;\n  annualYieldStandard?: number;\n  annualYieldVerified?: number;\n};\n\nexport type ApiYieldType = 'APY' | 'APR';\nexport type ApiStakingState = ApiNominatorsStakingState\n  | ApiLiquidStakingState\n  | ApiJettonStakingState\n  | ApiEthenaStakingState;\nexport type ApiToncoinStakingState = ApiNominatorsStakingState | ApiLiquidStakingState;\n\nexport interface ApiNominatorsPool {\n  address: string;\n  apy: number;\n  start: number;\n  end: number;\n}\n\nexport interface ApiBackendStakingState {\n  balance: bigint;\n  totalProfit: bigint;\n  type?: ApiBackendStakingType;\n  nominatorsPool: ApiNominatorsPool;\n  loyaltyType?: ApiLoyaltyType;\n  shouldUseNominators?: boolean;\n  stakedAt?: number;\n  ethena: {\n    /**\n     * - undefined  never passed the verification;\n     * - true  passed the verification and eligible for the boosted APY;\n     * - false  passed the verification and not eligible for the boosted APY;\n     */\n    isVerified?: boolean;\n  };\n  liquid?: {\n    unstakeRequestAmount?: string;\n  };\n}\n\nexport type ApiStakingHistory = {\n  timestamp: number;\n  profit: string;\n}[];\n\nexport interface ApiDappPermissions {\n  isAddressRequired?: boolean;\n  isPasswordRequired?: boolean;\n}\n\nexport type ApiDappRequest = {\n  url: string | undefined; // `undefined` is a special case for SSE connect request\n  isUrlEnsured?: boolean;\n  accountId?: string;\n  identifier?: string;\n  sseOptions?: ApiSseOptions;\n};\n\nexport interface ApiTransferToSign {\n  toAddress: string;\n  amount: bigint;\n  rawPayload?: string;\n  payload?: ApiParsedPayload;\n  stateInit?: string;\n}\n\nexport interface ApiDappTransfer extends ApiTransferToSign {\n  isScam?: boolean;\n  /** Whether the transfer should be treated with cautiousness, because its payload is unclear */\n  isDangerous: boolean;\n  normalizedAddress: string;\n  /** The transfer address to show in the UI */\n  displayedToAddress: string;\n  networkFee: bigint;\n}\n\nexport interface ApiSignedTransfer {\n  base64: string;\n  seqno: number;\n  /** Will be used to create a local activity in the global state after the transfer is sent */\n  localActivity: Omit<ApiLocalTransactionParams, 'externalMsgHashNorm' | 'txId'>;\n}\n\n/**\n * The `fee` field should contain the final (real) fee, because we want to show the real fee in local transactions\n */\nexport type ApiLocalTransactionParams = Omit<\n  ApiTransactionActivity,\n  'id' | 'timestamp' | 'isIncoming' | 'normalizedAddress' | 'kind' | 'shouldLoadDetails' | 'status'\n> & {\n  normalizedAddress?: string;\n  isIncoming?: boolean;\n  status?: ApiTransactionActivity['status'];\n};\n\nexport type ApiBaseCurrency = 'USD' | 'EUR' | 'RUB' | 'CNY' | 'BTC' | 'TON';\n\nexport enum ApiLiquidUnstakeMode {\n  Default,\n  Instant,\n  BestRate,\n}\n\nexport type ApiLoyaltyType = 'black' | 'platinum' | 'gold' | 'silver' | 'standard';\n\nexport type ApiBalanceBySlug = Record<string, bigint>;\n\nexport type ApiWalletInfo = {\n  /** The user-friendly address of this wallet (may differ from the requested address) */\n  address: string;\n  /** Undefined when the address is not initialized or not a wallet */\n  version?: ApiTonWalletVersion;\n  balance: bigint;\n  isInitialized: boolean;\n  seqno: number;\n  lastTxId?: string;\n  domain?: string;\n};\n\nexport type ApiWalletWithVersionInfo = ApiWalletInfo & Required<Pick<ApiWalletInfo, 'version'>>;\n\n// Country codes from ISO-3166-1 spec\nexport type ApiCountryCode = 'AF' | 'AX' | 'AL' | 'DZ' | 'AS' | 'AD' | 'AO' | 'AI' | 'AQ' | 'AG' | 'AR'\n  | 'AM' | 'AW' | 'AU' | 'AT' | 'AZ' | 'BS' | 'BH' | 'BD' | 'BB' | 'BY' | 'BE' | 'BZ' | 'BJ' | 'BM'\n  | 'BT' | 'BO' | 'BQ' | 'BA' | 'BW' | 'BV' | 'BR' | 'IO' | 'BN' | 'BG' | 'BF' | 'BI' | 'CV' | 'KH'\n  | 'CM' | 'CA' | 'KY' | 'CF' | 'TD' | 'CL' | 'CN' | 'CX' | 'CC' | 'CO' | 'KM' | 'CG' | 'CD' | 'CK'\n  | 'CR' | 'CI' | 'HR' | 'CU' | 'CW' | 'CY' | 'CZ' | 'DK' | 'DJ' | 'DM' | 'DO' | 'EC' | 'EG' | 'SV'\n  | 'GQ' | 'ER' | 'EE' | 'SZ' | 'ET' | 'FK' | 'FO' | 'FJ' | 'FI' | 'FR' | 'GF' | 'PF' | 'TF' | 'GA'\n  | 'GM' | 'GE' | 'DE' | 'GH' | 'GI' | 'GR' | 'GL' | 'GD' | 'GP' | 'GU' | 'GT' | 'GG' | 'GN' | 'GW'\n  | 'GY' | 'HT' | 'HM' | 'VA' | 'HN' | 'HK' | 'HU' | 'IS' | 'IN' | 'ID' | 'IR' | 'IQ' | 'IE' | 'IM'\n  | 'IL' | 'IT' | 'JM' | 'JP' | 'JE' | 'JO' | 'KZ' | 'KE' | 'KI' | 'KP' | 'KR' | 'KW' | 'KG' | 'LA'\n  | 'LV' | 'LB' | 'LS' | 'LR' | 'LY' | 'LI' | 'LT' | 'LU' | 'MO' | 'MG' | 'MW' | 'MY' | 'MV' | 'ML'\n  | 'MT' | 'MH' | 'MQ' | 'MR' | 'MU' | 'YT' | 'MX' | 'FM' | 'MD' | 'MC' | 'MN' | 'ME' | 'MS' | 'MA'\n  | 'MZ' | 'MM' | 'NA' | 'NR' | 'NP' | 'NL' | 'NC' | 'NZ' | 'NI' | 'NE' | 'NG' | 'NU' | 'NF' | 'MP'\n  | 'NO' | 'OM' | 'PK' | 'PW' | 'PS' | 'PA' | 'PG' | 'PY' | 'PE' | 'PH' | 'PN' | 'PL' | 'PT' | 'PR'\n  | 'QA' | 'MK' | 'RO' | 'RU' | 'RW' | 'RE' | 'BL' | 'SH' | 'KN' | 'LC' | 'MF' | 'PM' | 'VC' | 'WS'\n  | 'SM' | 'ST' | 'SA' | 'SN' | 'RS' | 'SC' | 'SL' | 'SG' | 'SX' | 'SK' | 'SI' | 'SB' | 'SO' | 'ZA'\n  | 'GS' | 'SS' | 'ES' | 'LK' | 'SD' | 'SR' | 'SJ' | 'SE' | 'CH' | 'SY' | 'TW' | 'TJ' | 'TZ' | 'TH'\n  | 'TL' | 'TG' | 'TK' | 'TO' | 'TT' | 'TN' | 'TR' | 'TM' | 'TC' | 'TV' | 'UG' | 'UA' | 'AE' | 'GB'\n  | 'US' | 'UM' | 'UY' | 'UZ' | 'VU' | 'VE' | 'VN' | 'VG' | 'VI' | 'WF' | 'EH' | 'YE' | 'ZM' | 'ZW';\n\n/** Each string value can be either an address or a domain name */\nexport type ApiImportAddressByChain = Partial<Record<ApiChain, string>>;\n\nexport type ApiNftMarketplace = 'fragment' | 'getgems';\n","const cache = new WeakMap<AnyFunction, Map<string, any>>();\n\nexport default function withCache<T extends AnyFunction>(fn: T) {\n  return (...args: Parameters<T>): ReturnType<T> => {\n    let fnCache = cache.get(fn);\n    const cacheKey = args.map(String).join('_');\n\n    if (fnCache) {\n      const cached = fnCache.get(cacheKey);\n      if (cached) {\n        return cached;\n      }\n    } else {\n      fnCache = new Map();\n      cache.set(fn, fnCache);\n    }\n\n    const newValue = fn(...args);\n\n    fnCache.set(cacheKey, newValue);\n\n    return newValue;\n  };\n}\n","import type { ApiTonWalletVersion } from './api/chains/ton/types';\nimport type {\n  ApiBaseCurrency,\n  ApiLiquidStakingState,\n  ApiNftMarketplace,\n  ApiNominatorsStakingState,\n  ApiSwapAsset,\n  ApiSwapDexLabel,\n  ApiTokenWithPrice,\n} from './api/types';\nimport type { AutolockValueType, LangCode, LangItem, TokenPeriod } from './global/types';\n\nexport const APP_ENV = process.env.APP_ENV;\n\nexport const IS_CORE_WALLET = process.env.IS_CORE_WALLET === '1';\nexport const APP_NAME = process.env.APP_NAME || (IS_CORE_WALLET ? 'TON Wallet' : 'MyTonWallet');\nexport const APP_VERSION = process.env.APP_VERSION!;\nexport const APP_COMMIT_HASH = process.env.APP_COMMIT_HASH!;\nexport const APP_ENV_MARKER = APP_ENV === 'staging' ? 'Beta' : APP_ENV === 'development' ? 'Dev' : undefined;\nexport const EXTENSION_NAME = IS_CORE_WALLET ? 'TON Wallet' : 'MyTonWallet  My TON Wallet';\nexport const EXTENSION_DESCRIPTION = IS_CORE_WALLET\n  ? 'Set up your own TON Wallet on The Open Network'\n  // eslint-disable-next-line @stylistic/max-len\n  : 'The most feature-rich TON+TRON wallet: multi-accounts, multi-send, Telegram Gifts and other collectibles, TON DNS+Proxy, and more.';\n\nexport const DEBUG = APP_ENV !== 'production' && APP_ENV !== 'perf' && APP_ENV !== 'test';\nexport const DEBUG_MORE = false;\nexport const DEBUG_API = false;\nexport const DEBUG_VIEW_ACCOUNTS = false;\n\nexport const IS_PRODUCTION = APP_ENV === 'production';\nexport const IS_TEST = APP_ENV === 'test';\nexport const IS_PERF = APP_ENV === 'perf';\nexport const IS_EXTENSION = process.env.IS_EXTENSION === '1';\nexport const IS_FIREFOX_EXTENSION = process.env.IS_FIREFOX_EXTENSION === '1';\nexport const IS_OPERA_EXTENSION = process.env.IS_OPERA_EXTENSION === '1';\nexport const IS_PACKAGED_ELECTRON = process.env.IS_PACKAGED_ELECTRON === '1';\nexport const IS_CAPACITOR = process.env.IS_CAPACITOR === '1';\nexport const IS_ANDROID_DIRECT = process.env.IS_ANDROID_DIRECT === '1';\nexport const IS_AIR_APP = process.env.IS_AIR_APP === '1';\nexport const IS_TELEGRAM_APP = process.env.IS_TELEGRAM_APP === '1';\n\nexport const ELECTRON_HOST_URL = 'https://dumb-host';\nexport const INACTIVE_MARKER = '[Inactive]';\nexport const PRODUCTION_URL = IS_CORE_WALLET ? 'https://wallet.ton.org' : 'https://mytonwallet.app';\nexport const BETA_URL = IS_CORE_WALLET ? 'https://beta.wallet.ton.org' : 'https://beta.mytonwallet.app';\nexport const APP_INSTALL_URL = 'https://get.mytonwallet.io/';\nexport const APP_REPO_URL = 'https://github.com/mytonwallet-org/mytonwallet';\nexport const BASE_URL = process.env.BASE_URL;\n\nexport const BOT_USERNAME = process.env.BOT_USERNAME || 'MyTonWalletBot';\n\nexport const SWAP_FEE_ADDRESS = process.env.SWAP_FEE_ADDRESS || 'UQDUkQbpTVIgt7v66-JTFR-3-eXRFz_4V66F-Ufn6vOg0GOp';\nexport const DIESEL_ADDRESS = process.env.DIESEL_ADDRESS || 'UQC9lQOaEHC6YASiJJ2NrKEOlITMMQmc8j0_iZEHy-4sl3tG';\n\nexport const STRICTERDOM_ENABLED = DEBUG && !IS_PACKAGED_ELECTRON;\n\nexport const DEBUG_ALERT_MSG = 'Shoot!\\nSomething went wrong, please see the error details in Dev Tools Console.';\n\nexport const PIN_LENGTH = 4;\nexport const NATIVE_BIOMETRICS_USERNAME = IS_CORE_WALLET ? 'TonWallet' : 'MyTonWallet';\nexport const NATIVE_BIOMETRICS_SERVER = IS_CORE_WALLET ? 'https://wallet.ton.org' : 'https://mytonwallet.app';\n\nexport const IS_BIP39_MNEMONIC_ENABLED = !IS_CORE_WALLET;\nexport const MNEMONIC_COUNT = 24;\nexport const MNEMONIC_COUNTS = IS_BIP39_MNEMONIC_ENABLED ? [12, 24] : [24];\n\nexport const PRIVATE_KEY_HEX_LENGTH = 64;\nexport const MNEMONIC_CHECK_COUNT = 3;\n\nexport const MOBILE_SCREEN_MAX_WIDTH = 700; // px\n\nexport const ANIMATION_END_DELAY = 50;\n\nexport const ANIMATED_STICKER_TINY_ICON_PX = 16;\nexport const ANIMATED_STICKER_ICON_PX = 30;\nexport const ANIMATED_STICKER_TINY_SIZE_PX = 70;\nexport const ANIMATED_STICKER_SMALL_SIZE_PX = 110;\nexport const ANIMATED_STICKER_MIDDLE_SIZE_PX = 120;\nexport const ANIMATED_STICKER_DEFAULT_PX = 150;\nexport const ANIMATED_STICKER_BIG_SIZE_PX = 156;\nexport const ANIMATED_STICKER_HUGE_SIZE_PX = 192;\n\nexport const DEFAULT_PORTRAIT_WINDOW_SIZE = { width: 368, height: 770 };\nexport const DEFAULT_LANDSCAPE_WINDOW_SIZE = { width: 980, height: 788 };\nexport const DEFAULT_LANDSCAPE_ACTION_TAB_ID = 0;\nexport const TRANSACTION_ADDRESS_SHIFT = 4;\n\nexport const WHOLE_PART_DELIMITER = ''; // https://www.compart.com/en/unicode/U+202F\n\nexport const DEFAULT_SLIPPAGE_VALUE = 5;\n\nexport const GLOBAL_STATE_CACHE_DISABLED = false;\nexport const GLOBAL_STATE_CACHE_KEY = IS_CORE_WALLET ? 'tonwallet-global-state' : 'mytonwallet-global-state';\n\nexport const ANIMATION_LEVEL_MIN = 0;\nexport const ANIMATION_LEVEL_MED = 1;\nexport const ANIMATION_LEVEL_MAX = 2;\nexport const ANIMATION_LEVEL_DEFAULT = ANIMATION_LEVEL_MAX;\nexport const THEME_DEFAULT = 'system';\n\nexport const MAIN_ACCOUNT_ID = '0-ton-mainnet';\n\nexport const TONCENTER_MAINNET_URL = process.env.TONCENTER_MAINNET_URL || 'https://toncenter.mytonwallet.org';\nexport const TONCENTER_MAINNET_KEY = process.env.TONCENTER_MAINNET_KEY;\nexport const ELECTRON_TONCENTER_MAINNET_KEY = process.env.ELECTRON_TONCENTER_MAINNET_KEY;\nexport const TONAPIIO_MAINNET_URL = process.env.TONAPIIO_MAINNET_URL || 'https://tonapiio.mytonwallet.org';\n\nexport const TONCENTER_TESTNET_URL = process.env.TONCENTER_TESTNET_URL || 'https://toncenter-testnet.mytonwallet.org';\nexport const TONCENTER_TESTNET_KEY = process.env.TONCENTER_TESTNET_KEY;\nexport const ELECTRON_TONCENTER_TESTNET_KEY = process.env.ELECTRON_TONCENTER_TESTNET_KEY;\nexport const TONAPIIO_TESTNET_URL = process.env.TONAPIIO_TESTNET_URL || 'https://tonapiio-testnet.mytonwallet.org';\n\nexport const BRILLIANT_API_BASE_URL = process.env.BRILLIANT_API_BASE_URL || 'https://api.mytonwallet.org';\nexport const PROXY_API_BASE_URL = process.env.PROXY_API_BASE_URL || 'https://api.mytonwallet.org/proxy';\nexport const IPFS_GATEWAY_BASE_URL = 'https://ipfs.io/ipfs/';\nexport const SSE_BRIDGE_URL = 'https://tonconnectbridge.mytonwallet.org/bridge/';\n\nexport const TRON_MAINNET_API_URL = process.env.TRON_MAINNET_API_URL || 'https://tronapi.mytonwallet.org';\nexport const TRON_TESTNET_API_URL = process.env.TRON_TESTNET_API_URL || 'https://api.shasta.trongrid.io';\n\nexport const FRACTION_DIGITS = 9;\nexport const SHORT_FRACTION_DIGITS = 2;\n\nexport const MAX_PUSH_NOTIFICATIONS_ACCOUNT_COUNT = 3;\n\nexport const SUPPORT_USERNAME = 'mysupport';\nexport const MTW_TIPS_CHANNEL_NAME: Partial<Record<LangCode, string>> = {\n  en: 'MyTonWalletTips',\n  ru: 'MyTonWalletTipsRu',\n};\nexport const NFT_MARKETPLACE_TITLES: Record<ApiNftMarketplace, string> = {\n  getgems: 'Getgems',\n  fragment: 'Fragment',\n};\nexport const MTW_STATIC_BASE_URL = 'https://static.mytonwallet.org';\nexport const MTW_CARDS_BASE_URL = `${MTW_STATIC_BASE_URL}/cards/`;\nexport const MTW_CARDS_MINT_BASE_URL = `${MTW_STATIC_BASE_URL}/mint-cards/`;\nexport const MYTONWALLET_PROMO_URL = 'https://mytonwallet.io/';\nexport const MYTONWALLET_MULTISEND_DAPP_URL = 'https://multisend.mytonwallet.io/';\nexport const TELEGRAM_WEB_URL = 'https://web.telegram.org/a/';\nexport const NFT_MARKETPLACE_URL = 'https://getgems.io/';\nexport const NFT_MARKETPLACE_TITLE = NFT_MARKETPLACE_TITLES.getgems;\nexport const GETGEMS_BASE_MAINNET_URL = 'https://getgems.io/';\nexport const GETGEMS_BASE_TESTNET_URL = 'https://testnet.getgems.io/';\nexport const EMPTY_HASH_VALUE = 'NOHASH';\n\nexport const IFRAME_WHITELIST = [\n  'http://localhost:*', 'https://tonscan.org',\n];\nexport const SUBPROJECT_URL_MASK = 'https://*.mytonwallet.io';\n\nexport const CHANGELLY_SUPPORT_EMAIL = 'support@changelly.com';\nexport const CHANGELLY_LIVE_CHAT_URL = 'https://changelly.com/';\nexport const CHANGELLY_SECURITY_EMAIL = 'security@changelly.com';\nexport const CHANGELLY_TERMS_OF_USE = 'https://changelly.com/terms-of-use';\nexport const CHANGELLY_PRIVACY_POLICY = 'https://changelly.com/privacy-policy';\nexport const CHANGELLY_AML_KYC = 'https://changelly.com/aml-kyc';\nexport const CHANGELLY_WAITING_DEADLINE = 3 * 60 * 60 * 1000; // 3 hours\n\nexport const PROXY_HOSTS = process.env.PROXY_HOSTS;\n\nexport const TINY_TRANSFER_MAX_COST = 0.01;\n\nexport const IMAGE_CACHE_NAME = 'mtw-image';\nexport const LANG_CACHE_NAME = 'mtw-lang-226';\n\nexport const LANG_LIST: LangItem[] = [{\n  langCode: 'en',\n  name: 'English',\n  nativeName: 'English',\n  rtl: false,\n}, {\n  langCode: 'es',\n  name: 'Spanish',\n  nativeName: 'Espaol',\n  rtl: false,\n}, {\n  langCode: 'ru',\n  name: 'Russian',\n  nativeName: '',\n  rtl: false,\n}, {\n  langCode: 'zh-Hans',\n  name: 'Chinese (Simplified)',\n  nativeName: '',\n  rtl: false,\n}, {\n  langCode: 'zh-Hant',\n  name: 'Chinese (Traditional)',\n  nativeName: '',\n  rtl: false,\n}, {\n  langCode: 'tr',\n  name: 'Turkish',\n  nativeName: 'Trke',\n  rtl: false,\n}, {\n  langCode: 'de',\n  name: 'German',\n  nativeName: 'Deutsch',\n  rtl: false,\n}, {\n  langCode: 'th',\n  name: 'Thai',\n  nativeName: '',\n  rtl: false,\n}, {\n  langCode: 'uk',\n  name: 'Ukrainian',\n  nativeName: '',\n  rtl: false,\n}, {\n  langCode: 'pl',\n  name: 'Polish',\n  nativeName: 'Polski',\n  rtl: false,\n}];\n\nexport const IS_STAKING_DISABLED = IS_CORE_WALLET;\nexport const VALIDATION_PERIOD_MS = 65_536_000; // 18.2 h.\nexport const ONE_TON = 1_000_000_000n;\nexport const DEFAULT_FEE = 15_000_000n; // 0.015 TON\nexport const UNSTAKE_TON_GRACE_PERIOD = 20 * 60 * 1000; // 20 m.\n\nexport const STAKING_POOLS = process.env.STAKING_POOLS ? process.env.STAKING_POOLS.split(' ') : [];\nexport const LIQUID_POOL = process.env.LIQUID_POOL || 'EQD2_4d91M4TVbEBVyBF8J1UwpMJc361LKVCz6bBlffMW05o';\nexport const LIQUID_JETTON = process.env.LIQUID_JETTON || 'EQCqC6EhRJ_tpWngKxL6dV0k6DSnRUrs9GSVkLbfdCqsj6TE';\nexport const STAKING_MIN_AMOUNT = ONE_TON;\nexport const NOMINATORS_STAKING_MIN_AMOUNT = 10_000n * ONE_TON;\nexport const MIN_ACTIVE_STAKING_REWARDS = 100_000_000n; // 0.1 MY\n\nexport const TONCONNECT_PROTOCOL_VERSION = 2;\nexport const TONCONNECT_WALLET_JSBRIDGE_KEY = IS_CORE_WALLET ? 'tonwallet' : 'mytonwallet';\nexport const EMBEDDED_DAPP_BRIDGE_CHANNEL = 'embedded-dapp-bridge';\n\nexport const NFT_FRAGMENT_COLLECTIONS = [\n  '0:0e41dc1dc3c9067ed24248580e12b3359818d83dee0304fabcf80845eafafdb2', // Anonymous Telegram Numbers\n  '0:80d78a35f955a14b679faa887ff4cd5bfc0f43b4a4eea2a7e6927f3701b273c2', // Telegram Usernames\n];\nexport const NFT_FRAGMENT_GIFT_IMAGE_TO_URL_REGEX = /^https?:\\/\\/nft\\.(fragment\\.com\\/gift\\/[\\w-]+-\\d+)\\.\\w+$/i;\nexport const TELEGRAM_GIFTS_SUPER_COLLECTION = 'super:telegram-gifts';\n\nexport const MTW_CARDS_WEBSITE = 'https://cards.mytonwallet.io';\nexport const MTW_CARDS_COLLECTION = 'EQCQE2L9hfwx1V8sgmF9keraHx1rNK9VmgR1ctVvINBGykyM';\nexport const TON_DNS_COLLECTION = 'EQC3dNlesgVD8YbAazcauIrXBPfiVhMMr5YYk2in0Mtsz0Bz';\nexport const TON_DNS_RENEWAL_WARNING_DAYS = 14;\nexport const TON_DNS_RENEWAL_NFT_WARNING_DAYS = 30;\n\nexport const TONCOIN = {\n  name: 'Toncoin',\n  symbol: 'TON',\n  slug: 'toncoin',\n  decimals: 9,\n  chain: 'ton',\n  cmcSlug: 'toncoin',\n} as const;\n\nexport const TRX = {\n  name: 'TRON',\n  symbol: 'TRX',\n  slug: 'trx',\n  decimals: 6,\n  chain: 'tron',\n  cmcSlug: 'tron',\n} as const;\n\nexport const MYCOIN = {\n  name: 'MyTonWallet Coin',\n  symbol: 'MY',\n  slug: 'ton-eqcfvnlrbn',\n  decimals: 9,\n  chain: 'ton',\n  minterAddress: 'EQCFVNlRb-NHHDQfv3Q9xvDXBLJlay855_xREsq5ZDX6KN-w',\n} as const;\n\nexport const MYCOIN_TESTNET = {\n  ...MYCOIN,\n  slug: 'ton-kqawlxpebw',\n  minterAddress: 'kQAWlxpEbwhCDFX9gp824ee2xVBhAh5VRSGWfbNFDddAbQoQ',\n} as const;\n\nexport const CHAIN_CONFIG = {\n  ton: {\n    isMemoSupported: true,\n    isDnsSupported: true,\n    addressRegex: /^([-\\w_]{48}|0:[\\da-h]{64})$/i,\n    addressPrefixRegex: /^([-\\w_]{1,48}|0:[\\da-h]{0,64})$/i,\n    nativeToken: TONCOIN,\n  },\n  tron: {\n    isMemoSupported: false,\n    isDnsSupported: false,\n    addressRegex: /^T[1-9A-HJ-NP-Za-km-z]{33}$/,\n    addressPrefixRegex: /^T[1-9A-HJ-NP-Za-km-z]{0,33}$/,\n    nativeToken: TRX,\n    mainnet: {\n      apiUrl: TRON_MAINNET_API_URL,\n      usdtAddress: 'TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t',\n    },\n    testnet: {\n      apiUrl: TRON_TESTNET_API_URL,\n      usdtAddress: 'TG3XXyExBkPp9nzdajDZsozEu4BkaSJozs',\n    },\n  },\n} as const;\n\nexport const TRC20_USDT_MAINNET_SLUG = 'tron-tr7nhqjekq';\nexport const TRC20_USDT_TESTNET_SLUG = 'tron-tg3xxyexbk';\nexport const TON_USDT_SLUG = 'ton-eqcxe6mutq';\nexport const STAKED_TON_SLUG = 'ton-eqcqc6ehrj';\nexport const STAKED_MYCOIN_SLUG = 'ton-eqcbzvsfwq';\nexport const TRX_SWAP_COUNT_FEE_ADDRESS = 'TW2LXSebZ7Br1zHaiA2W1zRojDkDwjGmpw';\nexport const MYCOIN_STAKING_POOL = 'EQC3roTiRRsoLzfYVK7yVVoIZjTEqAjQU3ju7aQ7HWTVL5o5';\n\nexport const ETHENA_STAKING_VAULT = 'EQChGuD1u0e7KUWHH5FaYh_ygcLXhsdG2nSHPXHW8qqnpZXW';\nexport const ETHENA_STAKING_MIN_AMOUNT = 1_000_000; // 1 USDe\n// eslint-disable-next-line @stylistic/max-len\nexport const ETHENA_ELIGIBILITY_CHECK_URL = 'https://t.me/id_app/start?startapp=cQeewNnc3pVphUcwY63WruKMQDpgePd1E7eMVoqphMZAdGoU9jwS4qRqrM1kSeaqrAiiDiC3EYAJPwZDGWqxZpw5vtGxmHma59XEt';\n\n// In cross-chain swaps, only a few TON/TRON tokens are available.\n// Its not optimal to request swap history for all the others.\nexport const SWAP_CROSSCHAIN_SLUGS = new Set([\n  TONCOIN.slug,\n  TON_USDT_SLUG,\n  TRX.slug,\n  TRC20_USDT_MAINNET_SLUG,\n]);\n\nexport const STON_PTON_ADDRESS = 'EQCM3B12QK1e4yZSf8GtBRT0aLMNyEsBc_DhVfRRtOEffLez';\nexport const STON_PTON_SLUG = 'ton-eqcm3b12qk';\n\nexport const DNS_IMAGE_GEN_URL = 'https://dns-image.mytonwallet.org/img?d=';\n\nconst TRC20_USDT = {\n  name: 'Tether USD',\n  symbol: 'USDT',\n  decimals: 6,\n  chain: 'tron',\n} as const;\n\nexport const TON_USDT = {\n  name: 'Tether USD',\n  symbol: 'USD',\n  chain: 'ton',\n  slug: TON_USDT_SLUG,\n  decimals: 6,\n  tokenAddress: 'EQCxE6mUtQJKFnGfaROTKOt1lZbDiiX1kCixRv7Nw2Id_sDs',\n} as const;\n\nexport const TON_USDE = {\n  name: 'Ethena USDe',\n  symbol: 'USDe',\n  chain: 'ton',\n  tokenAddress: 'EQAIb6KmdfdDR7CN1GBqVJuP25iCnLKCvBlJ07Evuu2dzP5f',\n  slug: 'ton-eqaib6kmdf',\n  decimals: 6,\n  // eslint-disable-next-line @stylistic/max-len\n  image: 'https://imgproxy.toncenter.com/binMwUmcnFtjvgjp4wSEbsECXwfXUwbPkhVvsvpubNw/pr:small/aHR0cHM6Ly9tZXRhZGF0YS5sYXllcnplcm8tYXBpLmNvbS9hc3NldHMvVVNEZS5wbmc',\n} as const;\n\nexport const TON_TSUSDE = {\n  name: 'Ethena tsUSDe',\n  symbol: 'tsUSDe',\n  chain: 'ton',\n  tokenAddress: 'EQDQ5UUyPHrLcQJlPAczd_fjxn8SLrlNQwolBznxCdSlfQwr',\n  slug: 'ton-eqdq5uuyph',\n  decimals: 6,\n  // eslint-disable-next-line @stylistic/max-len\n  image: 'https://cache.tonapi.io/imgproxy/vGZJ7erwsWPo7DpVG_V7ygNn7VGs0szZXcNLHB_l0ms/rs:fill:200:200:1/g:no/aHR0cHM6Ly9tZXRhZGF0YS5sYXllcnplcm8tYXBpLmNvbS9hc3NldHMvdHNVU0RlLnBuZw.webp',\n} as const;\n\nexport const ALL_STAKING_POOLS = [\n  LIQUID_POOL,\n  MYCOIN_STAKING_POOL,\n  ETHENA_STAKING_VAULT,\n  TON_TSUSDE.tokenAddress,\n];\n\nexport const DEFAULT_ENABLED_TOKEN_SLUGS = [\n  TONCOIN.slug, TON_USDT_SLUG, TRX.slug, TRC20_USDT_TESTNET_SLUG, TRC20_USDT_MAINNET_SLUG,\n] as string[];\n\n// Toncoin, USDT TON, TRX, USDT TRC20\nexport const DEFAULT_ENABLED_TOKEN_COUNT = 4;\n\nexport const PRIORITY_TOKEN_SLUGS = [\n  TONCOIN.slug, TON_USDT_SLUG, TRX.slug,\n] as string[];\n\nconst COMMON_TOKEN = {\n  isFromBackend: true,\n  price: 0,\n  priceUsd: 0,\n  percentChange24h: 0,\n};\n\nexport const TOKEN_INFO: Record<string, ApiTokenWithPrice> = {\n  toncoin: {\n    ...TONCOIN,\n    isFromBackend: true,\n    price: 3.1,\n    priceUsd: 3.1,\n    percentChange24h: 0,\n  },\n  trx: {\n    ...TRX,\n    ...COMMON_TOKEN,\n  },\n  [TRC20_USDT_MAINNET_SLUG]: { // mainnet\n    ...TRC20_USDT,\n    slug: TRC20_USDT_MAINNET_SLUG,\n    tokenAddress: 'TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t',\n    ...COMMON_TOKEN,\n  },\n  [TRC20_USDT_TESTNET_SLUG]: { // testnet\n    ...TRC20_USDT,\n    slug: TRC20_USDT_TESTNET_SLUG,\n    tokenAddress: 'TG3XXyExBkPp9nzdajDZsozEu4BkaSJozs',\n    ...COMMON_TOKEN,\n  },\n  [TON_USDT_SLUG]: {\n    ...TON_USDT,\n    // eslint-disable-next-line @stylistic/max-len\n    image: 'https://cache.tonapi.io/imgproxy/T3PB4s7oprNVaJkwqbGg54nexKE0zzKhcrPv8jcWYzU/rs:fill:200:200:1/g:no/aHR0cHM6Ly90ZXRoZXIudG8vaW1hZ2VzL2xvZ29DaXJjbGUucG5n.webp',\n    slug: TON_USDT_SLUG,\n    ...COMMON_TOKEN,\n  },\n  [MYCOIN.slug]: {\n    ...MYCOIN,\n    // eslint-disable-next-line @stylistic/max-len\n    image: 'https://cache.tonapi.io/imgproxy/Qy038wCBKISofJ0hYMlj6COWma330cx3Ju1ZSPM2LRU/rs:fill:200:200:1/g:no/aHR0cHM6Ly9teXRvbndhbGxldC5pby9sb2dvLTI1Ni1ibHVlLnBuZw.webp',\n    ...COMMON_TOKEN,\n  },\n  [TON_USDE.slug]: {\n    ...TON_USDE,\n    ...COMMON_TOKEN,\n  },\n  [TON_TSUSDE.slug]: {\n    ...TON_TSUSDE,\n    ...COMMON_TOKEN,\n  },\n};\n\nexport const TOKEN_WITH_LABEL: Record<string, string> = {\n  [TRC20_USDT_MAINNET_SLUG]: 'TRC-20',\n  [TRC20_USDT_TESTNET_SLUG]: 'TRC-20',\n  [TON_USDT_SLUG]: 'TON',\n};\n\nexport const INIT_SWAP_ASSETS: Record<string, ApiSwapAsset> = {\n  toncoin: {\n    name: 'Toncoin',\n    symbol: TONCOIN.symbol,\n    chain: TONCOIN.chain,\n    slug: TONCOIN.slug,\n    decimals: TONCOIN.decimals,\n    price: 0,\n    priceUsd: 0,\n    isPopular: true,\n  },\n  [TON_USDT_SLUG]: {\n    name: 'Tether USD',\n    symbol: 'USD',\n    chain: 'ton',\n    slug: TON_USDT_SLUG,\n    decimals: 9,\n    // eslint-disable-next-line @stylistic/max-len\n    image: 'https://cache.tonapi.io/imgproxy/T3PB4s7oprNVaJkwqbGg54nexKE0zzKhcrPv8jcWYzU/rs:fill:200:200:1/g:no/aHR0cHM6Ly90ZXRoZXIudG8vaW1hZ2VzL2xvZ29DaXJjbGUucG5n.webp',\n    tokenAddress: 'EQCxE6mUtQJKFnGfaROTKOt1lZbDiiX1kCixRv7Nw2Id_sDs',\n    price: 0,\n    priceUsd: 0,\n    isPopular: true,\n  },\n};\n\nexport const DEFAULT_TRX_SWAP_FIRST_TOKEN_SLUG = TONCOIN.slug;\nexport const DEFAULT_SWAP_FIRST_TOKEN_SLUG = TONCOIN.slug;\nexport const DEFAULT_SWAP_SECOND_TOKEN_SLUG = TON_USDT_SLUG;\nexport const DEFAULT_TRANSFER_TOKEN_SLUG = TONCOIN.slug;\nexport const DEFAULT_CEX_SWAP_SECOND_TOKEN_SLUG = TRC20_USDT_MAINNET_SLUG;\nexport const SWAP_DEX_LABELS: Record<ApiSwapDexLabel, string> = {\n  dedust: 'DeDust',\n  ston: 'STON.fi',\n};\n\nexport const MULTITAB_DATA_CHANNEL_NAME = IS_CORE_WALLET ? 'tw-multitab' : 'mtw-multitab';\nexport const ACTIVE_TAB_STORAGE_KEY = IS_CORE_WALLET ? 'tw-active-tab' : 'mtw-active-tab';\n\nexport const INDEXED_DB_NAME = 'keyval-store';\nexport const INDEXED_DB_STORE_NAME = 'keyval';\n\nexport const WINDOW_PROVIDER_CHANNEL = 'windowProvider';\nexport const WINDOW_PROVIDER_PORT = `${IS_CORE_WALLET ? 'TonWallet' : 'MyTonWallet'}_popup_reversed`;\n\nexport const SHOULD_SHOW_ALL_ASSETS_AND_ACTIVITY = IS_CORE_WALLET;\nexport const PORTRAIT_MIN_ASSETS_TAB_VIEW = 4;\nexport const LANDSCAPE_MIN_ASSETS_TAB_VIEW = 6;\n\nexport const DEFAULT_PRICE_CURRENCY = 'USD';\nexport const CURRENCIES: Record<ApiBaseCurrency, { name: string; decimals: number; shortSymbol?: string }> = {\n  USD: { name: 'US Dollar', decimals: 2, shortSymbol: '$' },\n  EUR: { name: 'Euro', decimals: 2, shortSymbol: '' },\n  RUB: { name: 'Ruble', decimals: 2, shortSymbol: '' },\n  CNY: { name: 'Yuan', decimals: 2, shortSymbol: '' },\n  BTC: { name: 'Bitcoin', decimals: 9 },\n  [TONCOIN.symbol]: { name: 'Toncoin', decimals: 9 },\n};\n\nexport const BURN_ADDRESS = 'UQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJKZ';\n\nexport const DEFAULT_WALLET_VERSION: ApiTonWalletVersion = 'W5';\nexport const POPULAR_WALLET_VERSIONS: ApiTonWalletVersion[] = ['v3R1', 'v3R2', 'v4R2', 'W5'];\nexport const LEDGER_WALLET_VERSIONS: ApiTonWalletVersion[] = ['v3R2', 'v4R2'];\n\nexport const DEFAULT_TIMEOUT = 10000;\nexport const DEFAULT_RETRIES = 3;\nexport const DEFAULT_ERROR_PAUSE = 500;\n\nexport const HISTORY_PERIODS: TokenPeriod[] = ['1D', '7D', '1M', '3M', '1Y', 'ALL'];\n\nexport const BROWSER_HISTORY_LIMIT = 10;\n\nexport const NFT_BATCH_SIZE = 4;\nexport const NOTCOIN_VOUCHERS_ADDRESS = 'EQDmkj65Ab_m0aZaW8IpKw4kYqIgITw_HRstYEkVQ6NIYCyW';\nexport const BURN_CHUNK_DURATION_APPROX_SEC = 30;\nexport const NOTCOIN_FORWARD_TON_AMOUNT = 30000000n; // 0.03 TON\nexport const NOTCOIN_EXCHANGERS = [\n  'EQAPZauWVPUcm2hUJT9n36pxznEhl46rEn1bzBXN0RY_yiy2',\n  'EQASgm0Qv3h2H2mF0W06ikPqYq2ctT3dyXMJH_svbEKKB3iZ',\n  'EQArlmP-RhVIG2yAFGZyPZfM3m0YccxmpvoRi6sgRzWnAA0s',\n  'EQA6pL-spYqZp1Ck6o3rpY45Cl-bvLMW_j3qdVejOkUWpLnm',\n  'EQBJ_ehYjumQKbXfWUue1KHKXdTm1GuYJB0Fj2ST_DwORvpd',\n  'EQBRmYSjxh9xlZpUqEmGjF5UjukI9v_Cm2kCTu4CoBn3XkOD',\n  'EQBkiqncd7AFT5_23H-RoA2Vynk-Nzq_dLoeMVRthAU9RF0p',\n  'EQB_OzTHXbztABe0QHgr4PtAV8T64LR6aDunXgaAoihOdxwO',\n  'EQCL-x5kLg6tKVNGryItTuj6tG3FH5mhUEu0xRqQc-kbEmbe',\n  'EQCZh2yJ46RaQH3AYmjEA8SMMXi77Oein4-3lvqkHseIAhD-',\n  'EQChKo5IK3iNqUHUGDB9gtzjCjMTPtmsFqekuCA2MdreVEyu',\n  'EQC6DNCBv076TIliRMfOt20RpbS7rNKDfSky3WrFEapFt8AH',\n  'EQDE_XFZOYae_rl3ZMsgBCtRSmYhl8B4y2BZEP7oiGBDhlgy',\n  'EQDddqpGA2ePXQF47A2DSL3GF6ZzIVmimfM2d16cdymy2noT',\n  'EQDv0hNNAamhYltCh3pTJrq3oRB9RW2ZhEYkTP6fhj5BtZNu',\n  'EQD2mP7zgO7-imUJhqYry3i07aJ_SR53DaokMupfAAobt0Xw',\n] as const;\n\nexport const CLAIM_ADDRESS = 'EQB3zOTvPi1PmwdcTpqSfFKZnhi1GNKEVJM-LdoAirdLtash';\nexport const CLAIM_AMOUNT = 30000000n; // 0.03 TON\nexport const CLAIM_COMMENT = 'claim';\n\nexport const MINT_CARD_ADDRESS = 'EQBpst3ZWJ9Dqq5gE2YH-yPsFK_BqMOmgi7Z_qK6v7WbrPWv';\nexport const MINT_CARD_COMMENT = 'Mint card';\nexport const MINT_CARD_REFUND_COMMENT = 'Refund';\n\n// eslint-disable-next-line @stylistic/max-len\nexport const RE_LINK_TEMPLATE = /((ftp|https?):\\/\\/)?(?<host>(www\\\\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z][-a-zA-Z0-9]{1,62})\\b([-a-zA-Z0-9()@:%_+.,~#?&/=]*)/g;\n// eslint-disable-next-line @stylistic/max-len\nexport const RE_TG_BOT_MENTION = /telegram[:\\s-]*((@[a-z0-9_]+)|(https:\\/\\/)?(t\\.me|telegram\\.me|telegram\\.dog)\\/[a-z0-9_]+)/mig;\n\nexport const STARS_SYMBOL = '';\n\nexport const GIVEAWAY_CHECKIN_URL = process.env.GIVEAWAY_CHECKIN_URL || 'https://giveaway.mytonwallet.io';\n\nexport const AUTOLOCK_OPTIONS_LIST = [\n  {\n    value: 'never',\n    name: 'Disabled',\n    selectedName: 'Disabled',\n    period: 0,\n  },\n  {\n    value: '1',\n    name: '30 seconds',\n    selectedName: 'If away for 30 sec',\n    period: 30_000,\n  },\n  {\n    value: '2',\n    name: '3 minutes',\n    selectedName: 'If away for 3 min',\n    period: 60_000 * 3,\n  },\n  {\n    value: '3',\n    name: '10 minutes',\n    selectedName: 'If away for 10 min',\n    period: 60_000 * 10,\n  },\n] as const;\n\nexport const AUTO_CONFIRM_DURATION_MINUTES = 5;\n\nexport const PRICELESS_TOKEN_HASHES = new Set([\n  '173e31eee054cb0c76f77edc7956bed766bf48a1f63bd062d87040dcd3df700f', // FIVA SY tsTON EQAxGi9Al7hamLAORroxGkvfap6knGyzI50ThkP3CLPLTtOZ\n  '5226dd4e6db9af26b24d5ca822bc4053b7e08152f923932abf25030c7e38bb42', // FIVA PT tsTON EQAkxIRGXgs2vD2zjt334MBjD3mXg2GsyEZHfzuYX_trQkFL\n  'fea2c08a704e5192b7f37434927170440d445b87aab865c3ea2a68abe7168204', // FIVA YT tsTON EQAcy60qg22RCq87A_qgYK8hooEgjCZ44yxhdnKYdlWIfKXL\n  'e691cf9081a8aeb22ed4d94829f6626c9d822752e035800b5543c43f83d134b5', // FIVA LP tsTON EQD3BjCjxuf8mu5kvxajVbe-Ila1ScZZlAi03oS7lMmAJjM3\n  '301ce25925830d713b326824e552e962925c4ff45b1e3ea21fc363a459a49b43', // FIVA SY eUSDT EQDi9blCcyT-k8iMpFMYY0t7mHVyiCB50ZsRgyUECJDuGvIl\n  '02250f83fbb8624d859c2c045ac70ee2b3b959688c3d843aec773be9b36dbfc3', // FIVA PT eUSDT EQBzVrYkYPHx8D_HPfQacm1xONa4XSRxl826vHkx_laP2HOe\n  'dba3adb2c917db80fd71a6a68c1fc9e12976491a8309d5910f9722efc084ce4d', // FIVA YT eUSDT EQCwUSc2qrY5rn9BfFBG9ARAHePTUvITDl97UD0zOreWzLru\n  '7da9223b90984d6a144e71611a8d7c65a6298cad734faed79438dc0f7a8e53d1', // FIVA LP eUSDT EQBNlIZxIbQGQ78cXgG3VRcyl8A0kLn_6BM9kabiHHhWC4qY\n  'ddf80de336d580ab3c11d194f189c362e2ca1225cae224ea921deeaba7eca818', // tsUSDe EQDQ5UUyPHrLcQJlPAczd_fjxn8SLrlNQwolBznxCdSlfQwr\n  'eb9d9891a32ec94425c09735f6ade73f4c171da0091f874d6e9d25247d583990', // Affluent TON Lending Vault EQADQ6JcK0NMuNM5uwCcS9bjcn2RTvcxYIZjNlhIhywUrfBN\n  'f66c149de251ffd031bdb34b79abe43a062ba16b815433691e3ec40a77f01d71', // Affluent Ethena Multiply Vault EQDXmtbt1-WSP00tSh6N6FH-4lX7LbnrjORClmtmuZqg4Ymm\n  'bca42dbdcbc0d885aaffb1eeeb027d9f338c2dd68701a05641c1d1c3171a7400', // Affluent TON Multiply Vault EQDtxQqkgIRQQR5hWlrQxiJMtLwjR3rEYNUBbEcvPDwCs1Ng\n]);\n\nexport const STAKED_TOKEN_SLUGS = new Set([\n  STAKED_TON_SLUG,\n  STAKED_MYCOIN_SLUG,\n  TON_TSUSDE.slug,\n]);\n\nexport const DEFAULT_OUR_SWAP_FEE = 0.875;\n\nexport const DEFAULT_STAKING_STATE: ApiLiquidStakingState = {\n  type: 'liquid',\n  id: 'liquid',\n  tokenSlug: TONCOIN.slug,\n  annualYield: 3.9,\n  yieldType: 'APY',\n  balance: 0n,\n  pool: LIQUID_POOL,\n  tokenBalance: 0n,\n  unstakeRequestAmount: 0n,\n  instantAvailable: 0n,\n  start: 0,\n  end: 0,\n};\n\nexport const DEFAULT_NOMINATORS_STAKING_STATE: ApiNominatorsStakingState = {\n  type: 'nominators',\n  id: 'nominators',\n  tokenSlug: TONCOIN.slug,\n  annualYield: 3.9,\n  yieldType: 'APY',\n  balance: 0n,\n  pool: 'Ef8dgIOIRyCLU0NEvF8TD6Me3wrbrkS1z3Gpjk3ppd8m8-s_',\n  start: 0,\n  end: 0,\n  pendingDepositAmount: 0n,\n};\n\nexport const SWAP_API_VERSION = 2;\nexport const TONCENTER_ACTIONS_VERSION = 'v1';\n\nexport const JVAULT_URL = 'https://jvault.xyz';\n\nexport const HELP_CENTER_URL = {\n  home: {\n    en: 'https://help.mytonwallet.io/',\n    ru: 'https://help.mytonwallet.io/ru',\n  },\n  domainScam: {\n    en: 'https://help.mytonwallet.io/intro/scams/.ton-domain-scams',\n    // eslint-disable-next-line @stylistic/max-len\n    ru: 'https://help.mytonwallet.io/ru/baza-znanii/moshennichestvo-i-skamy/moshennichestvo-s-ispolzovaniem-domenov-.ton',\n  },\n  seedScam: {\n    en: 'https://help.mytonwallet.io/intro/scams/leaked-seed-phrases',\n    ru: 'https://help.mytonwallet.io/ru/baza-znanii/moshennichestvo-i-skamy/slitye-sid-frazy',\n  },\n  ethenaStaking: {\n    en: 'https://help.mytonwallet.io/intro/staking/what-is-usde-how-does-usde-staking-work',\n    ru: 'https://help.mytonwallet.io/ru/baza-znanii/steiking/chto-takoe-usde-kak-rabotaet-steiking-usde',\n  },\n};\n\nconst ALL_TON_DNS_ZONES = [\n  {\n    suffixes: ['ton'],\n    baseFormat: /^([-\\da-z]+\\.){0,2}[-\\da-z]{4,126}$/i,\n    resolver: 'EQC3dNlesgVD8YbAazcauIrXBPfiVhMMr5YYk2in0Mtsz0Bz',\n    collectionName: 'TON DNS Domains',\n  },\n  {\n    suffixes: ['t.me'],\n    baseFormat: /^([-\\da-z]+\\.){0,2}[-_\\da-z]{4,32}$/i,\n    resolver: 'EQCA14o1-VWhS2efqoh_9M1b_A9DtKTuoqfmkn83AbJzwnPi',\n    isTelemint: true,\n    collectionName: 'Telegram Usernames',\n  },\n  {\n    suffixes: ['vip', 'ton.vip', 'vip.ton'],\n    baseFormat: /^([-\\da-z]+\\.){0,2}?[\\da-z]{1,24}$/i,\n    resolver: 'EQBWG4EBbPDv4Xj7xlPwzxd7hSyHMzwwLB5O6rY-0BBeaixS',\n    collectionName: 'VIP DNS Domains',\n    isUnofficial: true,\n  },\n  {\n    suffixes: ['gram'],\n    baseFormat: /^([-\\da-z]+\\.){0,2}[\\da-z]{1,127}$/i,\n    resolver: 'EQAic3zPce496ukFDhbco28FVsKKl2WUX_iJwaL87CBxSiLQ',\n    collectionName: 'GRAM DNS Domains',\n    isUnofficial: true,\n  },\n];\n\nexport const TON_DNS_ZONES = IS_CORE_WALLET\n  ? ALL_TON_DNS_ZONES.filter(({ isUnofficial }) => !isUnofficial)\n  : ALL_TON_DNS_ZONES;\n\nexport const DEFAULT_AUTOLOCK_OPTION: AutolockValueType = '3';\nexport const WRONG_ATTEMPTS_BEFORE_LOG_OUT_SUGGESTION = 2;\n\nexport const UNKNOWN_TOKEN = {\n  symbol: '[Unknown]',\n  decimals: 9,\n} as const;\n","import Deferred from './Deferred';\n\nexport type Scheduler = typeof requestAnimationFrame | typeof onTickEnd;\n\nexport const pause = (ms: number) => new Promise<void>((resolve) => {\n  setTimeout(() => resolve(), ms);\n});\n\nexport function debounce<F extends AnyToVoidFunction>(\n  fn: F,\n  ms: number,\n  shouldRunFirst = true,\n  shouldRunLast = true,\n) {\n  let waitingTimeout: number | undefined;\n\n  return (...args: Parameters<F>) => {\n    if (waitingTimeout) {\n      clearTimeout(waitingTimeout);\n      waitingTimeout = undefined;\n    } else if (shouldRunFirst) {\n      fn(...args);\n    }\n\n    waitingTimeout = self.setTimeout(() => {\n      if (shouldRunLast) {\n        fn(...args);\n      }\n\n      waitingTimeout = undefined;\n    }, ms);\n  };\n}\n\n/**\n * An important feature of this throttle implementation is that it waits for `fn` to finish before scheduling the new\n * execution. That is, `fn` never gets executed in parallel with itself.\n */\nexport function throttle<F extends AnyFunction>(\n  fn: F,\n  ms: number | (() => Promise<void>),\n  shouldRunFirst = true,\n) {\n  let args: Parameters<F> | undefined;\n  let isRunning = false;\n\n  async function scheduleFn() {\n    await (typeof ms === 'function' ? ms() : pause(ms));\n    void runFn();\n  }\n\n  async function runFn() {\n    if (!args) {\n      isRunning = false;\n      return;\n    }\n\n    try {\n      const localArgs = args;\n      args = undefined;\n      await fn(...localArgs);\n    } finally {\n      // Voiding the promise to let the error produced by `fn` be thrown immediately\n      void scheduleFn();\n    }\n  }\n\n  return (..._args: Parameters<F>) => {\n    args = _args;\n\n    if (!isRunning) {\n      isRunning = true;\n\n      if (shouldRunFirst) {\n        void runFn();\n      } else {\n        void scheduleFn();\n      }\n    }\n  };\n}\n\nexport function throttleWithTickEnd<F extends AnyToVoidFunction>(fn: F) {\n  return throttleWith(onTickEnd, fn);\n}\n\nexport function throttleWith<F extends AnyToVoidFunction>(schedulerFn: Scheduler, fn: F) {\n  let waiting = false;\n  let args: Parameters<F>;\n\n  return (..._args: Parameters<F>) => {\n    args = _args;\n\n    if (!waiting) {\n      waiting = true;\n\n      schedulerFn(() => {\n        waiting = false;\n        fn(...args);\n      });\n    }\n  };\n}\n\nexport function rafPromise() {\n  return new Promise<void>((resolve) => {\n    fastRaf(resolve);\n  });\n}\n\nconst FAST_RAF_TIMEOUT_FALLBACK_MS = 35; // < 30 FPS\n\nlet fastRafCallbacks: Set<NoneToVoidFunction> | undefined;\nlet fastRafFallbackCallbacks: Set<NoneToVoidFunction> | undefined;\nlet fastRafFallbackTimeout: number | undefined;\n\n// May result in an immediate execution if called from another RAF callback which was scheduled\n// (and therefore is executed) earlier than RAF callback scheduled by `fastRaf`\nexport function fastRaf(callback: NoneToVoidFunction, withTimeoutFallback = false) {\n  if (!fastRafCallbacks) {\n    fastRafCallbacks = new Set([callback]);\n\n    requestAnimationFrame(() => {\n      const currentCallbacks = fastRafCallbacks!;\n\n      fastRafCallbacks = undefined;\n      fastRafFallbackCallbacks = undefined;\n\n      if (fastRafFallbackTimeout) {\n        clearTimeout(fastRafFallbackTimeout);\n        fastRafFallbackTimeout = undefined;\n      }\n\n      currentCallbacks.forEach((cb) => cb());\n    });\n  } else {\n    fastRafCallbacks.add(callback);\n  }\n\n  if (withTimeoutFallback) {\n    if (!fastRafFallbackCallbacks) {\n      fastRafFallbackCallbacks = new Set([callback]);\n    } else {\n      fastRafFallbackCallbacks.add(callback);\n    }\n\n    if (!fastRafFallbackTimeout) {\n      fastRafFallbackTimeout = window.setTimeout(() => {\n        const currentTimeoutCallbacks = fastRafFallbackCallbacks!;\n\n        if (fastRafCallbacks) {\n          currentTimeoutCallbacks.forEach(fastRafCallbacks.delete, fastRafCallbacks);\n        }\n        fastRafFallbackCallbacks = undefined;\n\n        if (fastRafFallbackTimeout) {\n          clearTimeout(fastRafFallbackTimeout);\n          fastRafFallbackTimeout = undefined;\n        }\n\n        currentTimeoutCallbacks.forEach((cb) => cb());\n      }, FAST_RAF_TIMEOUT_FALLBACK_MS);\n    }\n  }\n}\n\nlet onTickEndCallbacks: NoneToVoidFunction[] | undefined;\n\nexport function onTickEnd(callback: NoneToVoidFunction) {\n  if (!onTickEndCallbacks) {\n    onTickEndCallbacks = [callback];\n\n    void Promise.resolve().then(() => {\n      const currentCallbacks = onTickEndCallbacks!;\n      onTickEndCallbacks = undefined;\n      currentCallbacks.forEach((cb) => cb());\n    });\n  } else {\n    onTickEndCallbacks.push(callback);\n  }\n}\n\nconst IDLE_TIMEOUT = 500;\n\nlet onIdleCallbacks: NoneToVoidFunction[] | undefined;\n\nexport function onIdle(callback: NoneToVoidFunction) {\n  if (!self.requestIdleCallback) {\n    onTickEnd(callback);\n    return;\n  }\n\n  if (!onIdleCallbacks) {\n    onIdleCallbacks = [callback];\n\n    requestIdleCallback((deadline) => {\n      const currentCallbacks = onIdleCallbacks!;\n      onIdleCallbacks = undefined;\n\n      while (currentCallbacks.length) {\n        const cb = currentCallbacks.shift()!;\n        cb();\n\n        if (!deadline.timeRemaining()) break;\n      }\n\n      if (currentCallbacks.length) {\n        if (onIdleCallbacks) {\n          // Prepend the remaining callbacks if the next pass is already planned\n          onIdleCallbacks = currentCallbacks.concat(onIdleCallbacks);\n        } else {\n          currentCallbacks.forEach(onIdle);\n        }\n      }\n    }, { timeout: IDLE_TIMEOUT });\n  } else {\n    onIdleCallbacks.push(callback);\n  }\n}\n\nlet beforeUnloadCallbacks: NoneToVoidFunction[] | undefined;\n\nexport function onBeforeUnload(callback: NoneToVoidFunction, isLast = false) {\n  if (!beforeUnloadCallbacks) {\n    beforeUnloadCallbacks = [];\n\n    self.addEventListener('beforeunload', () => {\n      beforeUnloadCallbacks!.forEach((cb) => cb());\n    });\n  }\n\n  if (isLast) {\n    beforeUnloadCallbacks.push(callback);\n  } else {\n    beforeUnloadCallbacks.unshift(callback);\n  }\n\n  return () => {\n    beforeUnloadCallbacks = beforeUnloadCallbacks!.filter((cb) => cb !== callback);\n  };\n}\n\nexport async function waitFor(cb: () => boolean, interval: number, attempts: number) {\n  let i = 0;\n  let result = cb();\n\n  while (!result && i < attempts) {\n    await pause(interval);\n\n    i++;\n    result = cb();\n  }\n\n  return result;\n}\n\nexport function setCancellableTimeout(ms: number, cb: NoneToVoidFunction) {\n  const timeoutId = setTimeout(cb, ms);\n  return () => clearTimeout(timeoutId);\n}\n\n/**\n * Returns a function that executes every given functions (tasks) with limited concurrency (not more than\n * `maxConcurrency` at a time). The tasks are executed in the same order that they are given. Unlike throttle, executes\n * every given task.\n */\nexport function createTaskQueue(maxConcurrency = 1) {\n  const queue: AnyAsyncFunction[] = [];\n  let concurrency = 0;\n\n  const runTasks = async () => {\n    concurrency++;\n    while (queue.length) {\n      const task = queue.shift()!;\n      await task(); // Expected never to throw, because the errors are caught below\n    }\n    concurrency--;\n  };\n\n  /** Schedules execution of the given function right now. The returned promise settles with the task result. */\n  const run = <T>(task: () => MaybePromise<T>): Promise<T> => {\n    const deferred = new Deferred<T>();\n    queue.push(async () => {\n      try {\n        deferred.resolve(await task());\n      } catch (err) {\n        deferred.reject(err);\n      }\n    });\n\n    if (concurrency < maxConcurrency) {\n      void runTasks();\n    }\n\n    return deferred.promise;\n  };\n\n  /** Returns the same task function, but with limited concurrency */\n  const wrap = <Args extends unknown[], Return>(\n    task: (...args: Args) => MaybePromise<Return>,\n  ): (...args: Args) => Promise<Return> => {\n    return (...args: Args) => run(() => task(...args));\n  };\n\n  return { run, wrap };\n}\n\n/**\n * Returns a function that prevents `actions` from running in parallel with itself. If the `action` is already running,\n * queues, the next call will be queued. Unlike `throttle`, never skips the calls.\n */\nexport function forbidConcurrency<Args extends unknown[], Return>(\n  action: (...args: Args) => MaybePromise<Return>,\n): (...args: Args) => Promise<Return> {\n  return createTaskQueue(1).wrap(action);\n}\n","import type { ApiAnyDisplayError } from './types';\nimport { ApiCommonError, ApiTransactionError } from './types';\n\nexport class ApiBaseError extends Error {\n  constructor(message?: string, public displayError?: ApiAnyDisplayError) {\n    super(message);\n    this.name = this.constructor.name;\n  }\n}\n\nexport class ApiUserRejectsError extends ApiBaseError {\n  constructor(message: string = 'Canceled by the user') {\n    super(message);\n  }\n}\n\nexport class ApiServerError extends ApiBaseError {\n  constructor(message: string, public statusCode?: number) {\n    super(message, ApiCommonError.ServerError);\n  }\n}\n\nexport class ApiUnsupportedVersionError extends ApiBaseError {\n  constructor(message: string) {\n    super(message, ApiCommonError.UnsupportedVersion);\n  }\n}\n\nexport class ApiHardwareBlindSigningNotEnabled extends ApiBaseError {\n  constructor(message: string = 'Blind signing not enabled') {\n    super(message, ApiTransactionError.HardwareBlindSigningNotEnabled);\n  }\n}\n\nexport class AbortOperationError extends ApiBaseError {\n  constructor(message: string = 'Abort operation') {\n    super(message);\n  }\n}\n\nexport class NotImplemented extends ApiBaseError {\n  constructor(message: string = 'Not implemented') {\n    super(message);\n  }\n}\n\nexport function maybeApiErrors(fn: AnyAsyncFunction) {\n  return async (...args: any) => {\n    try {\n      return await fn(...args);\n    } catch (err) {\n      return handleServerError(err);\n    }\n  };\n}\n\nexport function handleServerError(err: any) {\n  if (err instanceof ApiServerError) {\n    return { error: err.displayError! };\n  }\n  throw err;\n}\n","import {\n  DEFAULT_ERROR_PAUSE,\n  DEFAULT_RETRIES,\n  DEFAULT_TIMEOUT,\n  IPFS_GATEWAY_BASE_URL,\n  PROXY_API_BASE_URL,\n} from '../config';\nimport { ApiServerError } from '../api/errors';\nimport { logDebug } from './logs';\nimport { pause } from './schedulers';\n\ntype QueryParams = Record<string, string | number | boolean | string[]>;\n\nconst MAX_TIMEOUT = 30000; // 30 sec\n\nexport function fetchJsonWithProxy(url: string | URL, data?: QueryParams, init?: RequestInit) {\n  return fetchJson(getProxiedJsonUrl(url.toString()), data, init);\n}\n\nexport async function fetchJson(url: string | URL, data?: QueryParams, init?: RequestInit) {\n  const urlObject = new URL(url);\n  if (data) {\n    Object.entries(data).forEach(([key, value]) => {\n      if (value === undefined) {\n        return;\n      }\n\n      if (Array.isArray(value)) {\n        value.forEach((item) => {\n          urlObject.searchParams.append(key, item.toString());\n        });\n      } else {\n        urlObject.searchParams.set(key, value.toString());\n      }\n    });\n  }\n\n  const response = await fetchWithRetry(urlObject, init);\n\n  return response.json();\n}\n\nexport async function fetchWithRetry(url: string | URL, init?: RequestInit, options?: {\n  retries?: number;\n  timeouts?: number | number[];\n  shouldSkipRetryFn?: (message?: string, statusCode?: number) => boolean;\n}) {\n  const {\n    retries = DEFAULT_RETRIES,\n    timeouts = DEFAULT_TIMEOUT,\n    shouldSkipRetryFn = isNotTemporaryError,\n  } = options ?? {};\n\n  let message = 'Unknown error.';\n  let statusCode: number | undefined;\n\n  for (let i = 1; i <= retries; i++) {\n    try {\n      if (i > 1) {\n        logDebug(`Retry request #${i}:`, url.toString(), statusCode);\n      }\n\n      const timeout = Array.isArray(timeouts)\n        ? timeouts[i - 1] ?? timeouts[timeouts.length - 1]\n        : Math.min(timeouts * i, MAX_TIMEOUT);\n      const response = await fetchWithTimeout(url, init, timeout);\n      statusCode = response.status;\n\n      if (statusCode >= 400) {\n        const { error } = await response.json().catch(() => {});\n        throw new Error(error ?? `HTTP Error ${statusCode}`);\n      }\n\n      return response;\n    } catch (err: any) {\n      message = typeof err === 'string' ? err : err.message ?? message;\n\n      const shouldSkipRetry = shouldSkipRetryFn(message, statusCode);\n\n      if (shouldSkipRetry) {\n        throw new ApiServerError(message, statusCode);\n      }\n\n      if (i < retries) {\n        await pause(DEFAULT_ERROR_PAUSE * i);\n      }\n    }\n  }\n\n  throw new ApiServerError(message);\n}\n\nexport async function fetchWithTimeout(url: string | URL, init?: RequestInit, timeout = DEFAULT_TIMEOUT) {\n  const controller = new AbortController();\n  const id = setTimeout(() => {\n    controller.abort();\n  }, timeout);\n\n  try {\n    return await fetch(url, {\n      ...init,\n      signal: controller.signal,\n    });\n  } finally {\n    clearTimeout(id);\n  }\n}\n\nexport async function handleFetchErrors(response: Response, ignoreHttpCodes?: number[]) {\n  if (!response.ok && (!ignoreHttpCodes?.includes(response.status))) {\n    // eslint-disable-next-line prefer-const\n    let { error, errors } = await response.json().catch(() => undefined);\n    if (!error && errors && errors.length) {\n      error = errors[0]?.msg;\n    }\n\n    throw new ApiServerError(error ?? `HTTP Error ${response.status}`, response.status);\n  }\n  return response;\n}\n\nfunction isNotTemporaryError(message?: string, statusCode?: number) {\n  return statusCode && [400, 404].includes(statusCode);\n}\n\nexport function getProxiedJsonUrl(url: string) {\n  return `${PROXY_API_BASE_URL}/download-json?url=${encodeURIComponent(url)}`;\n}\n\nexport function getProxiedLottieUrl(url: string) {\n  return `${PROXY_API_BASE_URL}/download-lottie?url=${encodeURIComponent(url)}`;\n}\n\nexport function fixIpfsUrl(url: string) {\n  return url.replace('ipfs://', IPFS_GATEWAY_BASE_URL);\n}\n","import { DEBUG_MORE } from '../config';\nimport { handleError } from './handleError';\n\nconst SAFE_EXEC_ENABLED = !DEBUG_MORE;\n\ntype SafeExecOptions = {\n  rescue?: (err: Error) => void;\n  always?: NoneToVoidFunction;\n  shouldIgnoreError?: boolean;\n};\n\nexport async function safeExecAsync<T extends AnyAsyncFunction>(\n  cb: T,\n  options?: SafeExecOptions,\n): Promise<ReturnType<T> | undefined> {\n  if (!SAFE_EXEC_ENABLED) {\n    return cb();\n  }\n\n  const { rescue, always, shouldIgnoreError } = options ?? {};\n\n  try {\n    return await cb();\n  } catch (err: any) {\n    rescue?.(err);\n    if (!shouldIgnoreError) {\n      handleError(err);\n    }\n    return undefined;\n  } finally {\n    always?.();\n  }\n}\n\nexport default function safeExec<T extends AnyFunction>(cb: T, options?: SafeExecOptions): ReturnType<T> | undefined {\n  if (!SAFE_EXEC_ENABLED) {\n    return cb();\n  }\n\n  const { rescue, always, shouldIgnoreError } = options ?? {};\n\n  try {\n    return cb();\n  } catch (err: any) {\n    rescue?.(err);\n    if (!shouldIgnoreError) {\n      handleError(err);\n    }\n    return undefined;\n  } finally {\n    always?.();\n  }\n}\n","// Version 1.7.3\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n    typeof define === 'function' && define.amd ? define(['exports'], factory) :\n      (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.nobleEd25519 = {}));\n})(this, (function (exports) { 'use strict';\n\n  const _nodeResolve_empty = {};\n\n  const nodeCrypto = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    'default': _nodeResolve_empty\n  });\n\n  /*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */\n  const _0n = BigInt(0);\n  const _1n = BigInt(1);\n  const _2n = BigInt(2);\n  const _8n = BigInt(8);\n  const CU_O = BigInt('7237005577332262213973186563042994240857116359379907606001950938285454250989');\n  const CURVE = Object.freeze({\n    a: BigInt(-1),\n    d: BigInt('37095705934669439343138083508754565189542113879843219016388785533085940283555'),\n    P: BigInt('57896044618658097711785492504343953926634992332820282019728792003956564819949'),\n    l: CU_O,\n    n: CU_O,\n    h: BigInt(8),\n    Gx: BigInt('15112221349535400772501151409588531511454012693041857206046113283949847762202'),\n    Gy: BigInt('46316835694926478169428394003475163141307993866256225615783033603165251855960'),\n  });\n  const POW_2_256 = BigInt('0x10000000000000000000000000000000000000000000000000000000000000000');\n  const SQRT_M1 = BigInt('19681161376707505956807079304988542015446066515923890162744021073123829784752');\n  BigInt('6853475219497561581579357271197624642482790079785650197046958215289687604742');\n  const SQRT_AD_MINUS_ONE = BigInt('25063068953384623474111414158702152701244531502492656460079210482610430750235');\n  const INVSQRT_A_MINUS_D = BigInt('54469307008909316920995813868745141605393597292927456921205312896311721017578');\n  const ONE_MINUS_D_SQ = BigInt('1159843021668779879193775521855586647937357759715417654439879720876111806838');\n  const D_MINUS_ONE_SQ = BigInt('40440834346308536858101042469323190826248399146238708352240133220865137265952');\n  class ExtendedPoint {\n    constructor(x, y, z, t) {\n      this.x = x;\n      this.y = y;\n      this.z = z;\n      this.t = t;\n    }\n    static fromAffine(p) {\n      if (!(p instanceof Point)) {\n        throw new TypeError('ExtendedPoint#fromAffine: expected Point');\n      }\n      if (p.equals(Point.ZERO))\n        return ExtendedPoint.ZERO;\n      return new ExtendedPoint(p.x, p.y, _1n, mod(p.x * p.y));\n    }\n    static toAffineBatch(points) {\n      const toInv = invertBatch(points.map((p) => p.z));\n      return points.map((p, i) => p.toAffine(toInv[i]));\n    }\n    static normalizeZ(points) {\n      return this.toAffineBatch(points).map(this.fromAffine);\n    }\n    equals(other) {\n      assertExtPoint(other);\n      const { x: X1, y: Y1, z: Z1 } = this;\n      const { x: X2, y: Y2, z: Z2 } = other;\n      const X1Z2 = mod(X1 * Z2);\n      const X2Z1 = mod(X2 * Z1);\n      const Y1Z2 = mod(Y1 * Z2);\n      const Y2Z1 = mod(Y2 * Z1);\n      return X1Z2 === X2Z1 && Y1Z2 === Y2Z1;\n    }\n    negate() {\n      return new ExtendedPoint(mod(-this.x), this.y, this.z, mod(-this.t));\n    }\n    double() {\n      const { x: X1, y: Y1, z: Z1 } = this;\n      const { a } = CURVE;\n      const A = mod(X1 * X1);\n      const B = mod(Y1 * Y1);\n      const C = mod(_2n * mod(Z1 * Z1));\n      const D = mod(a * A);\n      const x1y1 = X1 + Y1;\n      const E = mod(mod(x1y1 * x1y1) - A - B);\n      const G = D + B;\n      const F = G - C;\n      const H = D - B;\n      const X3 = mod(E * F);\n      const Y3 = mod(G * H);\n      const T3 = mod(E * H);\n      const Z3 = mod(F * G);\n      return new ExtendedPoint(X3, Y3, Z3, T3);\n    }\n    add(other) {\n      assertExtPoint(other);\n      const { x: X1, y: Y1, z: Z1, t: T1 } = this;\n      const { x: X2, y: Y2, z: Z2, t: T2 } = other;\n      const A = mod((Y1 - X1) * (Y2 + X2));\n      const B = mod((Y1 + X1) * (Y2 - X2));\n      const F = mod(B - A);\n      if (F === _0n)\n        return this.double();\n      const C = mod(Z1 * _2n * T2);\n      const D = mod(T1 * _2n * Z2);\n      const E = D + C;\n      const G = B + A;\n      const H = D - C;\n      const X3 = mod(E * F);\n      const Y3 = mod(G * H);\n      const T3 = mod(E * H);\n      const Z3 = mod(F * G);\n      return new ExtendedPoint(X3, Y3, Z3, T3);\n    }\n    subtract(other) {\n      return this.add(other.negate());\n    }\n    precomputeWindow(W) {\n      const windows = 1 + 256 / W;\n      const points = [];\n      let p = this;\n      let base = p;\n      for (let window = 0; window < windows; window++) {\n        base = p;\n        points.push(base);\n        for (let i = 1; i < 2 ** (W - 1); i++) {\n          base = base.add(p);\n          points.push(base);\n        }\n        p = base.double();\n      }\n      return points;\n    }\n    wNAF(n, affinePoint) {\n      if (!affinePoint && this.equals(ExtendedPoint.BASE))\n        affinePoint = Point.BASE;\n      const W = (affinePoint && affinePoint._WINDOW_SIZE) || 1;\n      if (256 % W) {\n        throw new Error('Point#wNAF: Invalid precomputation window, must be power of 2');\n      }\n      let precomputes = affinePoint && pointPrecomputes.get(affinePoint);\n      if (!precomputes) {\n        precomputes = this.precomputeWindow(W);\n        if (affinePoint && W !== 1) {\n          precomputes = ExtendedPoint.normalizeZ(precomputes);\n          pointPrecomputes.set(affinePoint, precomputes);\n        }\n      }\n      let p = ExtendedPoint.ZERO;\n      let f = ExtendedPoint.BASE;\n      const windows = 1 + 256 / W;\n      const windowSize = 2 ** (W - 1);\n      const mask = BigInt(2 ** W - 1);\n      const maxNumber = 2 ** W;\n      const shiftBy = BigInt(W);\n      for (let window = 0; window < windows; window++) {\n        const offset = window * windowSize;\n        let wbits = Number(n & mask);\n        n >>= shiftBy;\n        if (wbits > windowSize) {\n          wbits -= maxNumber;\n          n += _1n;\n        }\n        const offset1 = offset;\n        const offset2 = offset + Math.abs(wbits) - 1;\n        const cond1 = window % 2 !== 0;\n        const cond2 = wbits < 0;\n        if (wbits === 0) {\n          f = f.add(constTimeNegate(cond1, precomputes[offset1]));\n        }\n        else {\n          p = p.add(constTimeNegate(cond2, precomputes[offset2]));\n        }\n      }\n      return ExtendedPoint.normalizeZ([p, f])[0];\n    }\n    multiply(scalar, affinePoint) {\n      return this.wNAF(normalizeScalar(scalar, CURVE.l), affinePoint);\n    }\n    multiplyUnsafe(scalar) {\n      let n = normalizeScalar(scalar, CURVE.l, false);\n      const G = ExtendedPoint.BASE;\n      const P0 = ExtendedPoint.ZERO;\n      if (n === _0n)\n        return P0;\n      if (this.equals(P0) || n === _1n)\n        return this;\n      if (this.equals(G))\n        return this.wNAF(n);\n      let p = P0;\n      let d = this;\n      while (n > _0n) {\n        if (n & _1n)\n          p = p.add(d);\n        d = d.double();\n        n >>= _1n;\n      }\n      return p;\n    }\n    isSmallOrder() {\n      return this.multiplyUnsafe(CURVE.h).equals(ExtendedPoint.ZERO);\n    }\n    isTorsionFree() {\n      let p = this.multiplyUnsafe(CURVE.l / _2n).double();\n      if (CURVE.l % _2n)\n        p = p.add(this);\n      return p.equals(ExtendedPoint.ZERO);\n    }\n    toAffine(invZ) {\n      const { x, y, z } = this;\n      const is0 = this.equals(ExtendedPoint.ZERO);\n      if (invZ == null)\n        invZ = is0 ? _8n : invert(z);\n      const ax = mod(x * invZ);\n      const ay = mod(y * invZ);\n      const zz = mod(z * invZ);\n      if (is0)\n        return Point.ZERO;\n      if (zz !== _1n)\n        throw new Error('invZ was invalid');\n      return new Point(ax, ay);\n    }\n    fromRistrettoBytes() {\n      legacyRist();\n    }\n    toRistrettoBytes() {\n      legacyRist();\n    }\n    fromRistrettoHash() {\n      legacyRist();\n    }\n  }\n  ExtendedPoint.BASE = new ExtendedPoint(CURVE.Gx, CURVE.Gy, _1n, mod(CURVE.Gx * CURVE.Gy));\n  ExtendedPoint.ZERO = new ExtendedPoint(_0n, _1n, _1n, _0n);\n  function constTimeNegate(condition, item) {\n    const neg = item.negate();\n    return condition ? neg : item;\n  }\n  function assertExtPoint(other) {\n    if (!(other instanceof ExtendedPoint))\n      throw new TypeError('ExtendedPoint expected');\n  }\n  function assertRstPoint(other) {\n    if (!(other instanceof RistrettoPoint))\n      throw new TypeError('RistrettoPoint expected');\n  }\n  function legacyRist() {\n    throw new Error('Legacy method: switch to RistrettoPoint');\n  }\n  class RistrettoPoint {\n    constructor(ep) {\n      this.ep = ep;\n    }\n    static calcElligatorRistrettoMap(r0) {\n      const { d } = CURVE;\n      const r = mod(SQRT_M1 * r0 * r0);\n      const Ns = mod((r + _1n) * ONE_MINUS_D_SQ);\n      let c = BigInt(-1);\n      const D = mod((c - d * r) * mod(r + d));\n      let { isValid: Ns_D_is_sq, value: s } = uvRatio(Ns, D);\n      let s_ = mod(s * r0);\n      if (!edIsNegative(s_))\n        s_ = mod(-s_);\n      if (!Ns_D_is_sq)\n        s = s_;\n      if (!Ns_D_is_sq)\n        c = r;\n      const Nt = mod(c * (r - _1n) * D_MINUS_ONE_SQ - D);\n      const s2 = s * s;\n      const W0 = mod((s + s) * D);\n      const W1 = mod(Nt * SQRT_AD_MINUS_ONE);\n      const W2 = mod(_1n - s2);\n      const W3 = mod(_1n + s2);\n      return new ExtendedPoint(mod(W0 * W3), mod(W2 * W1), mod(W1 * W3), mod(W0 * W2));\n    }\n    static hashToCurve(hex) {\n      hex = ensureBytes(hex, 64);\n      const r1 = bytes255ToNumberLE(hex.slice(0, 32));\n      const R1 = this.calcElligatorRistrettoMap(r1);\n      const r2 = bytes255ToNumberLE(hex.slice(32, 64));\n      const R2 = this.calcElligatorRistrettoMap(r2);\n      return new RistrettoPoint(R1.add(R2));\n    }\n    static fromHex(hex) {\n      hex = ensureBytes(hex, 32);\n      const { a, d } = CURVE;\n      const emsg = 'RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint';\n      const s = bytes255ToNumberLE(hex);\n      if (!equalBytes(numberTo32BytesLE(s), hex) || edIsNegative(s))\n        throw new Error(emsg);\n      const s2 = mod(s * s);\n      const u1 = mod(_1n + a * s2);\n      const u2 = mod(_1n - a * s2);\n      const u1_2 = mod(u1 * u1);\n      const u2_2 = mod(u2 * u2);\n      const v = mod(a * d * u1_2 - u2_2);\n      const { isValid, value: I } = invertSqrt(mod(v * u2_2));\n      const Dx = mod(I * u2);\n      const Dy = mod(I * Dx * v);\n      let x = mod((s + s) * Dx);\n      if (edIsNegative(x))\n        x = mod(-x);\n      const y = mod(u1 * Dy);\n      const t = mod(x * y);\n      if (!isValid || edIsNegative(t) || y === _0n)\n        throw new Error(emsg);\n      return new RistrettoPoint(new ExtendedPoint(x, y, _1n, t));\n    }\n    toRawBytes() {\n      let { x, y, z, t } = this.ep;\n      const u1 = mod(mod(z + y) * mod(z - y));\n      const u2 = mod(x * y);\n      const u2sq = mod(u2 * u2);\n      const { value: invsqrt } = invertSqrt(mod(u1 * u2sq));\n      const D1 = mod(invsqrt * u1);\n      const D2 = mod(invsqrt * u2);\n      const zInv = mod(D1 * D2 * t);\n      let D;\n      if (edIsNegative(t * zInv)) {\n        let _x = mod(y * SQRT_M1);\n        let _y = mod(x * SQRT_M1);\n        x = _x;\n        y = _y;\n        D = mod(D1 * INVSQRT_A_MINUS_D);\n      }\n      else {\n        D = D2;\n      }\n      if (edIsNegative(x * zInv))\n        y = mod(-y);\n      let s = mod((z - y) * D);\n      if (edIsNegative(s))\n        s = mod(-s);\n      return numberTo32BytesLE(s);\n    }\n    toHex() {\n      return bytesToHex(this.toRawBytes());\n    }\n    toString() {\n      return this.toHex();\n    }\n    equals(other) {\n      assertRstPoint(other);\n      const a = this.ep;\n      const b = other.ep;\n      const one = mod(a.x * b.y) === mod(a.y * b.x);\n      const two = mod(a.y * b.y) === mod(a.x * b.x);\n      return one || two;\n    }\n    add(other) {\n      assertRstPoint(other);\n      return new RistrettoPoint(this.ep.add(other.ep));\n    }\n    subtract(other) {\n      assertRstPoint(other);\n      return new RistrettoPoint(this.ep.subtract(other.ep));\n    }\n    multiply(scalar) {\n      return new RistrettoPoint(this.ep.multiply(scalar));\n    }\n    multiplyUnsafe(scalar) {\n      return new RistrettoPoint(this.ep.multiplyUnsafe(scalar));\n    }\n  }\n  RistrettoPoint.BASE = new RistrettoPoint(ExtendedPoint.BASE);\n  RistrettoPoint.ZERO = new RistrettoPoint(ExtendedPoint.ZERO);\n  const pointPrecomputes = new WeakMap();\n  class Point {\n    constructor(x, y) {\n      this.x = x;\n      this.y = y;\n    }\n    _setWindowSize(windowSize) {\n      this._WINDOW_SIZE = windowSize;\n      pointPrecomputes.delete(this);\n    }\n    static fromHex(hex, strict = true) {\n      const { d, P } = CURVE;\n      hex = ensureBytes(hex, 32);\n      const normed = hex.slice();\n      normed[31] = hex[31] & ~0x80;\n      const y = bytesToNumberLE(normed);\n      if (strict && y >= P)\n        throw new Error('Expected 0 < hex < P');\n      if (!strict && y >= POW_2_256)\n        throw new Error('Expected 0 < hex < 2**256');\n      const y2 = mod(y * y);\n      const u = mod(y2 - _1n);\n      const v = mod(d * y2 + _1n);\n      let { isValid, value: x } = uvRatio(u, v);\n      if (!isValid)\n        throw new Error('Point.fromHex: invalid y coordinate');\n      const isXOdd = (x & _1n) === _1n;\n      const isLastByteOdd = (hex[31] & 0x80) !== 0;\n      if (isLastByteOdd !== isXOdd) {\n        x = mod(-x);\n      }\n      return new Point(x, y);\n    }\n    static async fromPrivateKey(privateKey) {\n      return (await getExtendedPublicKey(privateKey)).point;\n    }\n    toRawBytes() {\n      const bytes = numberTo32BytesLE(this.y);\n      bytes[31] |= this.x & _1n ? 0x80 : 0;\n      return bytes;\n    }\n    toHex() {\n      return bytesToHex(this.toRawBytes());\n    }\n    toX25519() {\n      const { y } = this;\n      const u = mod((_1n + y) * invert(_1n - y));\n      return numberTo32BytesLE(u);\n    }\n    isTorsionFree() {\n      return ExtendedPoint.fromAffine(this).isTorsionFree();\n    }\n    equals(other) {\n      return this.x === other.x && this.y === other.y;\n    }\n    negate() {\n      return new Point(mod(-this.x), this.y);\n    }\n    add(other) {\n      return ExtendedPoint.fromAffine(this).add(ExtendedPoint.fromAffine(other)).toAffine();\n    }\n    subtract(other) {\n      return this.add(other.negate());\n    }\n    multiply(scalar) {\n      return ExtendedPoint.fromAffine(this).multiply(scalar, this).toAffine();\n    }\n  }\n  Point.BASE = new Point(CURVE.Gx, CURVE.Gy);\n  Point.ZERO = new Point(_0n, _1n);\n  class Signature {\n    constructor(r, s) {\n      this.r = r;\n      this.s = s;\n      this.assertValidity();\n    }\n    static fromHex(hex) {\n      const bytes = ensureBytes(hex, 64);\n      const r = Point.fromHex(bytes.slice(0, 32), false);\n      const s = bytesToNumberLE(bytes.slice(32, 64));\n      return new Signature(r, s);\n    }\n    assertValidity() {\n      const { r, s } = this;\n      if (!(r instanceof Point))\n        throw new Error('Expected Point instance');\n      normalizeScalar(s, CURVE.l, false);\n      return this;\n    }\n    toRawBytes() {\n      const u8 = new Uint8Array(64);\n      u8.set(this.r.toRawBytes());\n      u8.set(numberTo32BytesLE(this.s), 32);\n      return u8;\n    }\n    toHex() {\n      return bytesToHex(this.toRawBytes());\n    }\n  }\n  function concatBytes(...arrays) {\n    if (!arrays.every((a) => a instanceof Uint8Array))\n      throw new Error('Expected Uint8Array list');\n    if (arrays.length === 1)\n      return arrays[0];\n    const length = arrays.reduce((a, arr) => a + arr.length, 0);\n    const result = new Uint8Array(length);\n    for (let i = 0, pad = 0; i < arrays.length; i++) {\n      const arr = arrays[i];\n      result.set(arr, pad);\n      pad += arr.length;\n    }\n    return result;\n  }\n  const hexes = Array.from({ length: 256 }, (v, i) => i.toString(16).padStart(2, '0'));\n  function bytesToHex(uint8a) {\n    if (!(uint8a instanceof Uint8Array))\n      throw new Error('Uint8Array expected');\n    let hex = '';\n    for (let i = 0; i < uint8a.length; i++) {\n      hex += hexes[uint8a[i]];\n    }\n    return hex;\n  }\n  function hexToBytes(hex) {\n    if (typeof hex !== 'string') {\n      throw new TypeError('hexToBytes: expected string, got ' + typeof hex);\n    }\n    if (hex.length % 2)\n      throw new Error('hexToBytes: received invalid unpadded hex');\n    const array = new Uint8Array(hex.length / 2);\n    for (let i = 0; i < array.length; i++) {\n      const j = i * 2;\n      const hexByte = hex.slice(j, j + 2);\n      const byte = Number.parseInt(hexByte, 16);\n      if (Number.isNaN(byte) || byte < 0)\n        throw new Error('Invalid byte sequence');\n      array[i] = byte;\n    }\n    return array;\n  }\n  function numberTo32BytesBE(num) {\n    const length = 32;\n    const hex = num.toString(16).padStart(length * 2, '0');\n    return hexToBytes(hex);\n  }\n  function numberTo32BytesLE(num) {\n    return numberTo32BytesBE(num).reverse();\n  }\n  function edIsNegative(num) {\n    return (mod(num) & _1n) === _1n;\n  }\n  function bytesToNumberLE(uint8a) {\n    if (!(uint8a instanceof Uint8Array))\n      throw new Error('Expected Uint8Array');\n    return BigInt('0x' + bytesToHex(Uint8Array.from(uint8a).reverse()));\n  }\n  const MAX_255B = BigInt('0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff');\n  function bytes255ToNumberLE(bytes) {\n    return mod(bytesToNumberLE(bytes) & MAX_255B);\n  }\n  function mod(a, b = CURVE.P) {\n    const res = a % b;\n    return res >= _0n ? res : b + res;\n  }\n  function invert(number, modulo = CURVE.P) {\n    if (number === _0n || modulo <= _0n) {\n      throw new Error(`invert: expected positive integers, got n=${number} mod=${modulo}`);\n    }\n    let a = mod(number, modulo);\n    let b = modulo;\n    let x = _0n, u = _1n;\n    while (a !== _0n) {\n      const q = b / a;\n      const r = b % a;\n      const m = x - u * q;\n      b = a, a = r, x = u, u = m;\n    }\n    const gcd = b;\n    if (gcd !== _1n)\n      throw new Error('invert: does not exist');\n    return mod(x, modulo);\n  }\n  function invertBatch(nums, p = CURVE.P) {\n    const tmp = new Array(nums.length);\n    const lastMultiplied = nums.reduce((acc, num, i) => {\n      if (num === _0n)\n        return acc;\n      tmp[i] = acc;\n      return mod(acc * num, p);\n    }, _1n);\n    const inverted = invert(lastMultiplied, p);\n    nums.reduceRight((acc, num, i) => {\n      if (num === _0n)\n        return acc;\n      tmp[i] = mod(acc * tmp[i], p);\n      return mod(acc * num, p);\n    }, inverted);\n    return tmp;\n  }\n  function pow2(x, power) {\n    const { P } = CURVE;\n    let res = x;\n    while (power-- > _0n) {\n      res *= res;\n      res %= P;\n    }\n    return res;\n  }\n  function pow_2_252_3(x) {\n    const { P } = CURVE;\n    const _5n = BigInt(5);\n    const _10n = BigInt(10);\n    const _20n = BigInt(20);\n    const _40n = BigInt(40);\n    const _80n = BigInt(80);\n    const x2 = (x * x) % P;\n    const b2 = (x2 * x) % P;\n    const b4 = (pow2(b2, _2n) * b2) % P;\n    const b5 = (pow2(b4, _1n) * x) % P;\n    const b10 = (pow2(b5, _5n) * b5) % P;\n    const b20 = (pow2(b10, _10n) * b10) % P;\n    const b40 = (pow2(b20, _20n) * b20) % P;\n    const b80 = (pow2(b40, _40n) * b40) % P;\n    const b160 = (pow2(b80, _80n) * b80) % P;\n    const b240 = (pow2(b160, _80n) * b80) % P;\n    const b250 = (pow2(b240, _10n) * b10) % P;\n    const pow_p_5_8 = (pow2(b250, _2n) * x) % P;\n    return { pow_p_5_8, b2 };\n  }\n  function uvRatio(u, v) {\n    const v3 = mod(v * v * v);\n    const v7 = mod(v3 * v3 * v);\n    const pow = pow_2_252_3(u * v7).pow_p_5_8;\n    let x = mod(u * v3 * pow);\n    const vx2 = mod(v * x * x);\n    const root1 = x;\n    const root2 = mod(x * SQRT_M1);\n    const useRoot1 = vx2 === u;\n    const useRoot2 = vx2 === mod(-u);\n    const noRoot = vx2 === mod(-u * SQRT_M1);\n    if (useRoot1)\n      x = root1;\n    if (useRoot2 || noRoot)\n      x = root2;\n    if (edIsNegative(x))\n      x = mod(-x);\n    return { isValid: useRoot1 || useRoot2, value: x };\n  }\n  function invertSqrt(number) {\n    return uvRatio(_1n, number);\n  }\n  function modlLE(hash) {\n    return mod(bytesToNumberLE(hash), CURVE.l);\n  }\n  function equalBytes(b1, b2) {\n    if (b1.length !== b2.length) {\n      return false;\n    }\n    for (let i = 0; i < b1.length; i++) {\n      if (b1[i] !== b2[i]) {\n        return false;\n      }\n    }\n    return true;\n  }\n  function ensureBytes(hex, expectedLength) {\n    const bytes = hex instanceof Uint8Array ? Uint8Array.from(hex) : hexToBytes(hex);\n    if (typeof expectedLength === 'number' && bytes.length !== expectedLength)\n      throw new Error(`Expected ${expectedLength} bytes`);\n    return bytes;\n  }\n  function normalizeScalar(num, max, strict = true) {\n    if (!max)\n      throw new TypeError('Specify max value');\n    if (typeof num === 'number' && Number.isSafeInteger(num))\n      num = BigInt(num);\n    if (typeof num === 'bigint' && num < max) {\n      if (strict) {\n        if (_0n < num)\n          return num;\n      }\n      else {\n        if (_0n <= num)\n          return num;\n      }\n    }\n    throw new TypeError('Expected valid scalar: 0 < scalar < max');\n  }\n  function adjustBytes25519(bytes) {\n    bytes[0] &= 248;\n    bytes[31] &= 127;\n    bytes[31] |= 64;\n    return bytes;\n  }\n  function decodeScalar25519(n) {\n    return bytesToNumberLE(adjustBytes25519(ensureBytes(n, 32)));\n  }\n  function checkPrivateKey(key) {\n    key =\n      typeof key === 'bigint' || typeof key === 'number'\n        ? numberTo32BytesBE(normalizeScalar(key, POW_2_256))\n        : ensureBytes(key);\n    if (key.length !== 32)\n      throw new Error(`Expected 32 bytes`);\n    return key;\n  }\n  function getKeyFromHash(hashed) {\n    const head = adjustBytes25519(hashed.slice(0, 32));\n    const prefix = hashed.slice(32, 64);\n    const scalar = modlLE(head);\n    const point = Point.BASE.multiply(scalar);\n    const pointBytes = point.toRawBytes();\n    return { head, prefix, scalar, point, pointBytes };\n  }\n  let _sha512Sync;\n  function sha512s(...m) {\n    if (typeof _sha512Sync !== 'function')\n      throw new Error('utils.sha512Sync must be set to use sync methods');\n    return _sha512Sync(...m);\n  }\n  async function getExtendedPublicKey(key) {\n    return getKeyFromHash(await utils.sha512(checkPrivateKey(key)));\n  }\n  function getExtendedPublicKeySync(key) {\n    return getKeyFromHash(sha512s(checkPrivateKey(key)));\n  }\n  async function getPublicKey(privateKey) {\n    return (await getExtendedPublicKey(privateKey)).pointBytes;\n  }\n  function getPublicKeySync(privateKey) {\n    return getExtendedPublicKeySync(privateKey).pointBytes;\n  }\n  async function sign(message, privateKey) {\n    message = ensureBytes(message);\n    const { prefix, scalar, pointBytes } = await getExtendedPublicKey(privateKey);\n    const r = modlLE(await utils.sha512(prefix, message));\n    const R = Point.BASE.multiply(r);\n    const k = modlLE(await utils.sha512(R.toRawBytes(), pointBytes, message));\n    const s = mod(r + k * scalar, CURVE.l);\n    return new Signature(R, s).toRawBytes();\n  }\n  function signSync(message, privateKey) {\n    message = ensureBytes(message);\n    const { prefix, scalar, pointBytes } = getExtendedPublicKeySync(privateKey);\n    const r = modlLE(sha512s(prefix, message));\n    const R = Point.BASE.multiply(r);\n    const k = modlLE(sha512s(R.toRawBytes(), pointBytes, message));\n    const s = mod(r + k * scalar, CURVE.l);\n    return new Signature(R, s).toRawBytes();\n  }\n  function prepareVerification(sig, message, publicKey) {\n    message = ensureBytes(message);\n    if (!(publicKey instanceof Point))\n      publicKey = Point.fromHex(publicKey, false);\n    const { r, s } = sig instanceof Signature ? sig.assertValidity() : Signature.fromHex(sig);\n    const SB = ExtendedPoint.BASE.multiplyUnsafe(s);\n    return { r, s, SB, pub: publicKey, msg: message };\n  }\n  function finishVerification(publicKey, r, SB, hashed) {\n    const k = modlLE(hashed);\n    const kA = ExtendedPoint.fromAffine(publicKey).multiplyUnsafe(k);\n    const RkA = ExtendedPoint.fromAffine(r).add(kA);\n    return RkA.subtract(SB).multiplyUnsafe(CURVE.h).equals(ExtendedPoint.ZERO);\n  }\n  async function verify(sig, message, publicKey) {\n    const { r, SB, msg, pub } = prepareVerification(sig, message, publicKey);\n    const hashed = await utils.sha512(r.toRawBytes(), pub.toRawBytes(), msg);\n    return finishVerification(pub, r, SB, hashed);\n  }\n  function verifySync(sig, message, publicKey) {\n    const { r, SB, msg, pub } = prepareVerification(sig, message, publicKey);\n    const hashed = sha512s(r.toRawBytes(), pub.toRawBytes(), msg);\n    return finishVerification(pub, r, SB, hashed);\n  }\n  const sync = {\n    getExtendedPublicKey: getExtendedPublicKeySync,\n    getPublicKey: getPublicKeySync,\n    sign: signSync,\n    verify: verifySync,\n  };\n  async function getSharedSecret(privateKey, publicKey) {\n    const { head } = await getExtendedPublicKey(privateKey);\n    const u = Point.fromHex(publicKey).toX25519();\n    return curve25519.scalarMult(head, u);\n  }\n  Point.BASE._setWindowSize(8);\n  function cswap(swap, x_2, x_3) {\n    const dummy = mod(swap * (x_2 - x_3));\n    x_2 = mod(x_2 - dummy);\n    x_3 = mod(x_3 + dummy);\n    return [x_2, x_3];\n  }\n  function montgomeryLadder(pointU, scalar) {\n    const { P } = CURVE;\n    const u = normalizeScalar(pointU, P);\n    const k = normalizeScalar(scalar, P);\n    const a24 = BigInt(121665);\n    const x_1 = u;\n    let x_2 = _1n;\n    let z_2 = _0n;\n    let x_3 = u;\n    let z_3 = _1n;\n    let swap = _0n;\n    let sw;\n    for (let t = BigInt(255 - 1); t >= _0n; t--) {\n      const k_t = (k >> t) & _1n;\n      swap ^= k_t;\n      sw = cswap(swap, x_2, x_3);\n      x_2 = sw[0];\n      x_3 = sw[1];\n      sw = cswap(swap, z_2, z_3);\n      z_2 = sw[0];\n      z_3 = sw[1];\n      swap = k_t;\n      const A = x_2 + z_2;\n      const AA = mod(A * A);\n      const B = x_2 - z_2;\n      const BB = mod(B * B);\n      const E = AA - BB;\n      const C = x_3 + z_3;\n      const D = x_3 - z_3;\n      const DA = mod(D * A);\n      const CB = mod(C * B);\n      const dacb = DA + CB;\n      const da_cb = DA - CB;\n      x_3 = mod(dacb * dacb);\n      z_3 = mod(x_1 * mod(da_cb * da_cb));\n      x_2 = mod(AA * BB);\n      z_2 = mod(E * (AA + mod(a24 * E)));\n    }\n    sw = cswap(swap, x_2, x_3);\n    x_2 = sw[0];\n    x_3 = sw[1];\n    sw = cswap(swap, z_2, z_3);\n    z_2 = sw[0];\n    z_3 = sw[1];\n    const { pow_p_5_8, b2 } = pow_2_252_3(z_2);\n    const xp2 = mod(pow2(pow_p_5_8, BigInt(3)) * b2);\n    return mod(x_2 * xp2);\n  }\n  function encodeUCoordinate(u) {\n    return numberTo32BytesLE(mod(u, CURVE.P));\n  }\n  function decodeUCoordinate(uEnc) {\n    const u = ensureBytes(uEnc, 32);\n    u[31] &= 127;\n    return bytesToNumberLE(u);\n  }\n  const curve25519 = {\n    BASE_POINT_U: '0900000000000000000000000000000000000000000000000000000000000000',\n    scalarMult(privateKey, publicKey) {\n      const u = decodeUCoordinate(publicKey);\n      const p = decodeScalar25519(privateKey);\n      const pu = montgomeryLadder(u, p);\n      if (pu === _0n)\n        throw new Error('Invalid private or public key received');\n      return encodeUCoordinate(pu);\n    },\n    scalarMultBase(privateKey) {\n      return curve25519.scalarMult(privateKey, curve25519.BASE_POINT_U);\n    },\n  };\n  const crypto = {\n    node: nodeCrypto,\n    web: typeof self === 'object' && 'crypto' in self ? self.crypto : undefined,\n  };\n  const utils = {\n    bytesToHex,\n    hexToBytes,\n    concatBytes,\n    getExtendedPublicKey,\n    mod,\n    invert,\n    TORSION_SUBGROUP: [\n      '0100000000000000000000000000000000000000000000000000000000000000',\n      'c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a',\n      '0000000000000000000000000000000000000000000000000000000000000080',\n      '26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05',\n      'ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f',\n      '26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85',\n      '0000000000000000000000000000000000000000000000000000000000000000',\n      'c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa',\n    ],\n    hashToPrivateScalar: (hash) => {\n      hash = ensureBytes(hash);\n      if (hash.length < 40 || hash.length > 1024)\n        throw new Error('Expected 40-1024 bytes of private key as per FIPS 186');\n      return mod(bytesToNumberLE(hash), CURVE.l - _1n) + _1n;\n    },\n    randomBytes: (bytesLength = 32) => {\n      if (crypto.web) {\n        return crypto.web.getRandomValues(new Uint8Array(bytesLength));\n      }\n      else if (crypto.node) {\n        const { randomBytes } = crypto.node;\n        return new Uint8Array(randomBytes(bytesLength).buffer);\n      }\n      else {\n        throw new Error(\"The environment doesn't have randomBytes function\");\n      }\n    },\n    randomPrivateKey: () => {\n      return utils.randomBytes(32);\n    },\n    sha512: async (...messages) => {\n      const message = concatBytes(...messages);\n      if (crypto.web) {\n        const buffer = await crypto.web.subtle.digest('SHA-512', message.buffer);\n        return new Uint8Array(buffer);\n      }\n      else if (crypto.node) {\n        return Uint8Array.from(crypto.node.createHash('sha512').update(message).digest());\n      }\n      else {\n        throw new Error(\"The environment doesn't have sha512 function\");\n      }\n    },\n    precompute(windowSize = 8, point = Point.BASE) {\n      const cached = point.equals(Point.BASE) ? point : new Point(point.x, point.y);\n      cached._setWindowSize(windowSize);\n      cached.multiply(_2n);\n      return cached;\n    },\n    sha512Sync: undefined,\n  };\n  Object.defineProperties(utils, {\n    sha512Sync: {\n      configurable: false,\n      get() {\n        return _sha512Sync;\n      },\n      set(val) {\n        if (!_sha512Sync)\n          _sha512Sync = val;\n      },\n    },\n  });\n\n  exports.CURVE = CURVE;\n  exports.ExtendedPoint = ExtendedPoint;\n  exports.Point = Point;\n  exports.RistrettoPoint = RistrettoPoint;\n  exports.Signature = Signature;\n  exports.curve25519 = curve25519;\n  exports.getPublicKey = getPublicKey;\n  exports.getSharedSecret = getSharedSecret;\n  exports.sign = sign;\n  exports.sync = sync;\n  exports.utils = utils;\n  exports.verify = verify;\n\n  Object.defineProperty(exports, '__esModule', { value: true });\n\n}));\n","import { DEBUG, DEBUG_API } from '../config';\nimport { AssertionError } from './assert';\n\nexport interface Log {\n  message: string;\n  args: any[];\n  time: number; // Passing data from the worker to the application as a date object is not supported\n  level: 'debug' | 'debugError';\n}\n\nconst MAX_LOG_LENGTH = 999;\nconst logs: Log[] = [];\n\nexport function errorReplacer(_: string, value: any) {\n  if (value instanceof Error) {\n    return {\n      name: value.name,\n      message: value.message,\n      stack: value.stack,\n      metadata: value instanceof AssertionError ? value.metadata : undefined,\n    };\n  }\n  return value;\n}\n\nexport function addLog(log: Omit<Log, 'time'>) {\n  if (logs.length > MAX_LOG_LENGTH) {\n    logs.shift();\n  }\n\n  logs.push({\n    ...log,\n    args: log.args.map((arg) => JSON.stringify(arg, errorReplacer)),\n    time: Date.now(),\n  });\n}\n\nexport function getLogs() {\n  return logs;\n}\n\nexport function logDebugError(message: string, ...args: any[]) {\n  addLog({ message, level: 'debugError', args });\n  if (DEBUG) {\n    // eslint-disable-next-line no-console\n    console.error(`[DEBUG][${message}]`, ...args);\n  }\n}\n\nexport function logDebug(message: any, ...args: any[]) {\n  addLog({ message, level: 'debug', args });\n  if (DEBUG) {\n    // eslint-disable-next-line no-console\n    console.log(`[DEBUG] ${message}`, ...args);\n  }\n}\n\nexport function logDebugApi(message: any, obj1: any, obj2?: any) {\n  if (DEBUG_API) {\n    // eslint-disable-next-line no-console\n    console.debug(`[DEBUG] ${message}`);\n    // eslint-disable-next-line no-console\n    if (obj1) console.dir(obj1);\n    // eslint-disable-next-line no-console\n    if (obj2) console.dir(obj2);\n  }\n}\n\nexport function logSelfXssWarnings() {\n  const selfXssWarnings: AnyLiteral = {\n    en: 'WARNING! This console can be a way for bad people to take over your crypto wallet through something called '\n      + 'a Self-XSS attack. So, don\\'t put in or paste code you don\\'t understand. Stay safe!',\n    ru: '!             '\n      + '  Self-XSS.       ,    .  !',\n    es: 'ADVERTENCIA! Esta consola puede ser una forma en que las personas malintencionadas se apoderen de su '\n      + 'billetera de criptomonedas mediante un ataque llamado Self-XSS. Por lo tanto, '\n      + 'no introduzca ni pegue cdigo que no comprenda. Cudese!',\n    zh: 'Self-XSS',\n  };\n\n  const langCode = navigator.language.split('-')[0];\n  const text = selfXssWarnings[langCode] || selfXssWarnings.en;\n\n  // eslint-disable-next-line no-console\n  console.log('%c%s', 'color: red; background: yellow; font-size: 18px;', text);\n}\n","export enum ApiCommonError {\n  Unexpected = 'Unexpected',\n  ServerError = 'ServerError',\n  DebugError = 'DebugError',\n  UnsupportedVersion = 'UnsupportedVersion',\n}\n\nexport enum ApiAuthError {\n  InvalidMnemonic = 'InvalidMnemonic',\n  InvalidAddress = 'InvalidAddress',\n  DomainNotResolved = 'DomainNotResolved',\n}\n\nexport enum ApiTransactionDraftError {\n  InvalidAmount = 'InvalidAmount',\n  InvalidToAddress = 'InvalidToAddress',\n  InsufficientBalance = 'InsufficientBalance',\n  InvalidStateInit = 'InvalidStateInit',\n  StateInitWithoutBin = 'StateInitWithoutBin',\n  DomainNotResolved = 'DomainNotResolved',\n  WalletNotInitialized = 'WalletNotInitialized',\n  InvalidAddressFormat = 'InvalidAddressFormat',\n  InactiveContract = 'InactiveContract',\n}\n\nexport enum ApiTransactionError {\n  PartialTransactionFailure = 'PartialTransactionFailure',\n  IncorrectDeviceTime = 'IncorrectDeviceTime',\n  InsufficientBalance = 'InsufficientBalance',\n  UnsuccesfulTransfer = 'UnsuccesfulTransfer',\n  NotSupportedHardwareOperation = 'NotSupportedHardwareOperation',\n  HardwareBlindSigningNotEnabled = 'HardwareBlindSigningNotEnabled',\n  WrongAddress = 'WrongAddress',\n  WrongNetwork = 'WrongNetwork',\n}\n\nexport type ApiAnyDisplayError = ApiCommonError | ApiAuthError | ApiTransactionDraftError | ApiTransactionError;\n","export class AssertionError extends Error {\n  constructor(\n    message: string,\n    // Any additional information for the error to help debug it. Don't put sensitive information here.\n    public metadata?: unknown,\n  ) {\n    super(message);\n  }\n}\n\nexport function assert(condition: boolean, message: string, metadata?: unknown) {\n  if (!condition) {\n    throw new AssertionError(message, metadata);\n  }\n}\n","import type { Address, Dictionary } from '@ton/core';\n\nexport type AddrList = Dictionary<Address, boolean>;\n\nexport const JettonStakingOpCodes = {\n  GET_STATIC_DATA: 0X2FCB26A2,\n  REPORT_STATIC_DATA: 0X8B771735,\n  GET_STORAGE_DATA: 0X5B88E5CC,\n  REPORT_STORAGE_DATA: 0XAAB4A8EF,\n  EXCESSES: 0XD53276DB,\n\n  // Jettons,\n  TRANSFER_JETTON: 0X0F8A7EA5,\n  INTERNAL_TRANSFER: 0X178D4519,\n  TRANSFER_NOTIFICATION: 0X7362D09C,\n  PROVIDE_WALLET_ADDRESS: 0X2C76B973,\n  TAKE_WALLET_ADDRESS: 0XD1735400,\n  BURN_JETTON: 0X595F07BC,\n\n  // Staking pool,\n  STAKE_JETTONS: 0XE3A06989,\n  ADD_REWARDS: 0XDB16AC95,\n  SEND_CLAIMED_REWARDS: 0X44BC1FE3,\n  SEND_UNSTAKED_JETTONS: 0XFB232BC3,\n  APPROVE_STAKE: 0X919DE781,\n  CANCEL_STAKE: 0X9EADA1D9,\n  ADD_REWARD_JETTONS: 0X10676AE7,\n  CLAIM_COMMISSIONS: 0XBCA8F067,\n  REQUEST_UPDATE_REWARDS: 0XF5C5BAA3,\n\n  // Staked jetton wallet,\n  CLAIM_REWARDS: 0X78D9F109,\n  RECEIVE_JETTONS: 0XD68A4AC1,\n  UNSTAKE_JETTONS: 0X499A9262,\n  UNSTAKE_REQUEST: 0X0168D4B7,\n  CANCEL_UNSTAKE_REQUEST: 0XA4910F1A,\n  UPDATE_REWARDS: 0XAE9307CE,\n  CONFIRM_TRANSFER: 0XBC85EB11,\n\n  // Pools admin,\n  DEPLOY_NEW_POOL: 0XDA861F17,\n  SEND_COMMISSIONS: 0XB96ADAEA,\n  SET_CODE: 0xe2d2d211,\n  CHANGE_CREATION_FEE: 0x66D5528B,\n  CHANGE_CONTENT: 0x0ec29200,\n  UPDATE_CODES: 0x85c923cf,\n};\n\nexport const JettonStakingGas = {\n  MIN_RESERVE: 20_000_000n,\n  DEPLOY_POOL: 340_000_000n,\n  NOTIFICATION: 340_000_000n,\n  JETTON_TRANSFER: 55_000_000n,\n  BURN_JETTONS: 340_000_000n,\n  STAKE_JETTONS: 300_000_000n, // It was 340000000n\n  UNSTAKE_JETTONS: 340_000_000n,\n  CANCEL_UNSTAKE: 340_000_000n,\n  SEND_COMMISSIONS: 340_000_000n,\n  SIMPLE_UPDATE_REQUEST: 340_000_000n,\n  ADD_REWARDS: 340_000_000n,\n  APPROVE_TRANSFER: 340_000_000n,\n  SAVE_UPDATED_REWARDS: 340_000_000n,\n  MIN_EXCESS: 10_000_000n,\n  SEND_STAKED_JETTONS: 630_000_000n,\n};\n\nexport const Dividers = {\n  COMMISSION_DIVIDER: 10000n,\n  REWARDS_DIVIDER: 1000,\n  DISTRIBUTION_SPEED_DIVIDER: BigInt(24 * 60 * 60),\n  DISTRIBUTED_REWARDS_DIVIDER: 100000000000000000000000000000000000000n,\n};\n","/*\n *  big.js v6.2.1\n *  A small, fast, easy-to-use library for arbitrary-precision decimal arithmetic.\n *  Copyright (c) 2022 Michael Mclaughlin\n *  https://github.com/MikeMcl/big.js/LICENCE.md\n */\n\n\n/************************************** EDITABLE DEFAULTS *****************************************/\n\n\n  // The default values below must be integers within the stated ranges.\n\n  /*\n   * The maximum number of decimal places (DP) of the results of operations involving division:\n   * div and sqrt, and pow with negative exponents.\n   */\nvar DP = 20,          // 0 to MAX_DP\n\n  /*\n   * The rounding mode (RM) used when rounding to the above decimal places.\n   *\n   *  0  Towards zero (i.e. truncate, no rounding).       (ROUND_DOWN)\n   *  1  To nearest neighbour. If equidistant, round up.  (ROUND_HALF_UP)\n   *  2  To nearest neighbour. If equidistant, to even.   (ROUND_HALF_EVEN)\n   *  3  Away from zero.                                  (ROUND_UP)\n   */\n  RM = 1,             // 0, 1, 2 or 3\n\n  // The maximum value of DP and Big.DP.\n  MAX_DP = 1E6,       // 0 to 1000000\n\n  // The maximum magnitude of the exponent argument to the pow method.\n  MAX_POWER = 1E6,    // 1 to 1000000\n\n  /*\n   * The negative exponent (NE) at and beneath which toString returns exponential notation.\n   * (JavaScript numbers: -7)\n   * -1000000 is the minimum recommended exponent value of a Big.\n   */\n  NE = -7,            // 0 to -1000000\n\n  /*\n   * The positive exponent (PE) at and above which toString returns exponential notation.\n   * (JavaScript numbers: 21)\n   * 1000000 is the maximum recommended exponent value of a Big, but this limit is not enforced.\n   */\n  PE = 21,            // 0 to 1000000\n\n  /*\n   * When true, an error will be thrown if a primitive number is passed to the Big constructor,\n   * or if valueOf is called, or if toNumber is called on a Big which cannot be converted to a\n   * primitive number without a loss of precision.\n   */\n  STRICT = false,     // true or false\n\n\n/**************************************************************************************************/\n\n\n  // Error messages.\n  NAME = '[big.js] ',\n  INVALID = NAME + 'Invalid ',\n  INVALID_DP = INVALID + 'decimal places',\n  INVALID_RM = INVALID + 'rounding mode',\n  DIV_BY_ZERO = NAME + 'Division by zero',\n\n  // The shared prototype object.\n  P = {},\n  UNDEFINED = void 0,\n  NUMERIC = /^-?(\\d+(\\.\\d*)?|\\.\\d+)(e[+-]?\\d+)?$/i;\n\n\n/*\n * Create and return a Big constructor.\n */\nfunction _Big_() {\n\n  /*\n   * The Big constructor and exported function.\n   * Create and return a new instance of a Big number object.\n   *\n   * n {number|string|Big} A numeric value.\n   */\n  function Big(n) {\n    var x = this;\n\n    // Enable constructor usage without new.\n    if (!(x instanceof Big)) return n === UNDEFINED ? _Big_() : new Big(n);\n\n    // Duplicate.\n    if (n instanceof Big) {\n      x.s = n.s;\n      x.e = n.e;\n      x.c = n.c.slice();\n    } else {\n      if (typeof n !== 'string') {\n        if (Big.strict === true && typeof n !== 'bigint') {\n          throw TypeError(INVALID + 'value');\n        }\n\n        // Minus zero?\n        n = n === 0 && 1 / n < 0 ? '-0' : String(n);\n      }\n\n      parse(x, n);\n    }\n\n    // Retain a reference to this Big constructor.\n    // Shadow Big.prototype.constructor which points to Object.\n    x.constructor = Big;\n  }\n\n  Big.prototype = P;\n  Big.DP = DP;\n  Big.RM = RM;\n  Big.NE = NE;\n  Big.PE = PE;\n  Big.strict = STRICT;\n  Big.roundDown = 0;\n  Big.roundHalfUp = 1;\n  Big.roundHalfEven = 2;\n  Big.roundUp = 3;\n\n  return Big;\n}\n\n\n/*\n * Parse the number or string value passed to a Big constructor.\n *\n * x {Big} A Big number instance.\n * n {number|string} A numeric value.\n */\nfunction parse(x, n) {\n  var e, i, nl;\n\n  if (!NUMERIC.test(n)) {\n    throw Error(INVALID + 'number');\n  }\n\n  // Determine sign.\n  x.s = n.charAt(0) == '-' ? (n = n.slice(1), -1) : 1;\n\n  // Decimal point?\n  if ((e = n.indexOf('.')) > -1) n = n.replace('.', '');\n\n  // Exponential form?\n  if ((i = n.search(/e/i)) > 0) {\n\n    // Determine exponent.\n    if (e < 0) e = i;\n    e += +n.slice(i + 1);\n    n = n.substring(0, i);\n  } else if (e < 0) {\n\n    // Integer.\n    e = n.length;\n  }\n\n  nl = n.length;\n\n  // Determine leading zeros.\n  for (i = 0; i < nl && n.charAt(i) == '0';) ++i;\n\n  if (i == nl) {\n\n    // Zero.\n    x.c = [x.e = 0];\n  } else {\n\n    // Determine trailing zeros.\n    for (; nl > 0 && n.charAt(--nl) == '0';);\n    x.e = e - i - 1;\n    x.c = [];\n\n    // Convert string to array of digits without leading/trailing zeros.\n    for (e = 0; i <= nl;) x.c[e++] = +n.charAt(i++);\n  }\n\n  return x;\n}\n\n\n/*\n * Round Big x to a maximum of sd significant digits using rounding mode rm.\n *\n * x {Big} The Big to round.\n * sd {number} Significant digits: integer, 0 to MAX_DP inclusive.\n * rm {number} Rounding mode: 0 (down), 1 (half-up), 2 (half-even) or 3 (up).\n * [more] {boolean} Whether the result of division was truncated.\n */\nfunction round(x, sd, rm, more) {\n  var xc = x.c;\n\n  if (rm === UNDEFINED) rm = x.constructor.RM;\n  if (rm !== 0 && rm !== 1 && rm !== 2 && rm !== 3) {\n    throw Error(INVALID_RM);\n  }\n\n  if (sd < 1) {\n    more =\n      rm === 3 && (more || !!xc[0]) || sd === 0 && (\n      rm === 1 && xc[0] >= 5 ||\n      rm === 2 && (xc[0] > 5 || xc[0] === 5 && (more || xc[1] !== UNDEFINED))\n    );\n\n    xc.length = 1;\n\n    if (more) {\n\n      // 1, 0.1, 0.01, 0.001, 0.0001 etc.\n      x.e = x.e - sd + 1;\n      xc[0] = 1;\n    } else {\n\n      // Zero.\n      xc[0] = x.e = 0;\n    }\n  } else if (sd < xc.length) {\n\n    // xc[sd] is the digit after the digit that may be rounded up.\n    more =\n      rm === 1 && xc[sd] >= 5 ||\n      rm === 2 && (xc[sd] > 5 || xc[sd] === 5 &&\n        (more || xc[sd + 1] !== UNDEFINED || xc[sd - 1] & 1)) ||\n      rm === 3 && (more || !!xc[0]);\n\n    // Remove any digits after the required precision.\n    xc.length = sd;\n\n    // Round up?\n    if (more) {\n\n      // Rounding up may mean the previous digit has to be rounded up.\n      for (; ++xc[--sd] > 9;) {\n        xc[sd] = 0;\n        if (sd === 0) {\n          ++x.e;\n          xc.unshift(1);\n          break;\n        }\n      }\n    }\n\n    // Remove trailing zeros.\n    for (sd = xc.length; !xc[--sd];) xc.pop();\n  }\n\n  return x;\n}\n\n\n/*\n * Return a string representing the value of Big x in normal or exponential notation.\n * Handles P.toExponential, P.toFixed, P.toJSON, P.toPrecision, P.toString and P.valueOf.\n */\nfunction stringify(x, doExponential, isNonzero) {\n  var e = x.e,\n    s = x.c.join(''),\n    n = s.length;\n\n  // Exponential notation?\n  if (doExponential) {\n    s = s.charAt(0) + (n > 1 ? '.' + s.slice(1) : '') + (e < 0 ? 'e' : 'e+') + e;\n\n  // Normal notation.\n  } else if (e < 0) {\n    for (; ++e;) s = '0' + s;\n    s = '0.' + s;\n  } else if (e > 0) {\n    if (++e > n) {\n      for (e -= n; e--;) s += '0';\n    } else if (e < n) {\n      s = s.slice(0, e) + '.' + s.slice(e);\n    }\n  } else if (n > 1) {\n    s = s.charAt(0) + '.' + s.slice(1);\n  }\n\n  return x.s < 0 && isNonzero ? '-' + s : s;\n}\n\n\n// Prototype/instance methods\n\n\n/*\n * Return a new Big whose value is the absolute value of this Big.\n */\nP.abs = function () {\n  var x = new this.constructor(this);\n  x.s = 1;\n  return x;\n};\n\n\n/*\n * Return 1 if the value of this Big is greater than the value of Big y,\n *       -1 if the value of this Big is less than the value of Big y, or\n *        0 if they have the same value.\n */\nP.cmp = function (y) {\n  var isneg,\n    x = this,\n    xc = x.c,\n    yc = (y = new x.constructor(y)).c,\n    i = x.s,\n    j = y.s,\n    k = x.e,\n    l = y.e;\n\n  // Either zero?\n  if (!xc[0] || !yc[0]) return !xc[0] ? !yc[0] ? 0 : -j : i;\n\n  // Signs differ?\n  if (i != j) return i;\n\n  isneg = i < 0;\n\n  // Compare exponents.\n  if (k != l) return k > l ^ isneg ? 1 : -1;\n\n  j = (k = xc.length) < (l = yc.length) ? k : l;\n\n  // Compare digit by digit.\n  for (i = -1; ++i < j;) {\n    if (xc[i] != yc[i]) return xc[i] > yc[i] ^ isneg ? 1 : -1;\n  }\n\n  // Compare lengths.\n  return k == l ? 0 : k > l ^ isneg ? 1 : -1;\n};\n\n\n/*\n * Return a new Big whose value is the value of this Big divided by the value of Big y, rounded,\n * if necessary, to a maximum of Big.DP decimal places using rounding mode Big.RM.\n */\nP.div = function (y) {\n  var x = this,\n    Big = x.constructor,\n    a = x.c,                  // dividend\n    b = (y = new Big(y)).c,   // divisor\n    k = x.s == y.s ? 1 : -1,\n    dp = Big.DP;\n\n  if (dp !== ~~dp || dp < 0 || dp > MAX_DP) {\n    throw Error(INVALID_DP);\n  }\n\n  // Divisor is zero?\n  if (!b[0]) {\n    throw Error(DIV_BY_ZERO);\n  }\n\n  // Dividend is 0? Return +-0.\n  if (!a[0]) {\n    y.s = k;\n    y.c = [y.e = 0];\n    return y;\n  }\n\n  var bl, bt, n, cmp, ri,\n    bz = b.slice(),\n    ai = bl = b.length,\n    al = a.length,\n    r = a.slice(0, bl),   // remainder\n    rl = r.length,\n    q = y,                // quotient\n    qc = q.c = [],\n    qi = 0,\n    p = dp + (q.e = x.e - y.e) + 1;    // precision of the result\n\n  q.s = k;\n  k = p < 0 ? 0 : p;\n\n  // Create version of divisor with leading zero.\n  bz.unshift(0);\n\n  // Add zeros to make remainder as long as divisor.\n  for (; rl++ < bl;) r.push(0);\n\n  do {\n\n    // n is how many times the divisor goes into current remainder.\n    for (n = 0; n < 10; n++) {\n\n      // Compare divisor and remainder.\n      if (bl != (rl = r.length)) {\n        cmp = bl > rl ? 1 : -1;\n      } else {\n        for (ri = -1, cmp = 0; ++ri < bl;) {\n          if (b[ri] != r[ri]) {\n            cmp = b[ri] > r[ri] ? 1 : -1;\n            break;\n          }\n        }\n      }\n\n      // If divisor < remainder, subtract divisor from remainder.\n      if (cmp < 0) {\n\n        // Remainder can't be more than 1 digit longer than divisor.\n        // Equalise lengths using divisor with extra leading zero?\n        for (bt = rl == bl ? b : bz; rl;) {\n          if (r[--rl] < bt[rl]) {\n            ri = rl;\n            for (; ri && !r[--ri];) r[ri] = 9;\n            --r[ri];\n            r[rl] += 10;\n          }\n          r[rl] -= bt[rl];\n        }\n\n        for (; !r[0];) r.shift();\n      } else {\n        break;\n      }\n    }\n\n    // Add the digit n to the result array.\n    qc[qi++] = cmp ? n : ++n;\n\n    // Update the remainder.\n    if (r[0] && cmp) r[rl] = a[ai] || 0;\n    else r = [a[ai]];\n\n  } while ((ai++ < al || r[0] !== UNDEFINED) && k--);\n\n  // Leading zero? Do not remove if result is simply zero (qi == 1).\n  if (!qc[0] && qi != 1) {\n\n    // There can't be more than one zero.\n    qc.shift();\n    q.e--;\n    p--;\n  }\n\n  // Round?\n  if (qi > p) round(q, p, Big.RM, r[0] !== UNDEFINED);\n\n  return q;\n};\n\n\n/*\n * Return true if the value of this Big is equal to the value of Big y, otherwise return false.\n */\nP.eq = function (y) {\n  return this.cmp(y) === 0;\n};\n\n\n/*\n * Return true if the value of this Big is greater than the value of Big y, otherwise return\n * false.\n */\nP.gt = function (y) {\n  return this.cmp(y) > 0;\n};\n\n\n/*\n * Return true if the value of this Big is greater than or equal to the value of Big y, otherwise\n * return false.\n */\nP.gte = function (y) {\n  return this.cmp(y) > -1;\n};\n\n\n/*\n * Return true if the value of this Big is less than the value of Big y, otherwise return false.\n */\nP.lt = function (y) {\n  return this.cmp(y) < 0;\n};\n\n\n/*\n * Return true if the value of this Big is less than or equal to the value of Big y, otherwise\n * return false.\n */\nP.lte = function (y) {\n  return this.cmp(y) < 1;\n};\n\n\n/*\n * Return a new Big whose value is the value of this Big minus the value of Big y.\n */\nP.minus = P.sub = function (y) {\n  var i, j, t, xlty,\n    x = this,\n    Big = x.constructor,\n    a = x.s,\n    b = (y = new Big(y)).s;\n\n  // Signs differ?\n  if (a != b) {\n    y.s = -b;\n    return x.plus(y);\n  }\n\n  var xc = x.c.slice(),\n    xe = x.e,\n    yc = y.c,\n    ye = y.e;\n\n  // Either zero?\n  if (!xc[0] || !yc[0]) {\n    if (yc[0]) {\n      y.s = -b;\n    } else if (xc[0]) {\n      y = new Big(x);\n    } else {\n      y.s = 1;\n    }\n    return y;\n  }\n\n  // Determine which is the bigger number. Prepend zeros to equalise exponents.\n  if (a = xe - ye) {\n\n    if (xlty = a < 0) {\n      a = -a;\n      t = xc;\n    } else {\n      ye = xe;\n      t = yc;\n    }\n\n    t.reverse();\n    for (b = a; b--;) t.push(0);\n    t.reverse();\n  } else {\n\n    // Exponents equal. Check digit by digit.\n    j = ((xlty = xc.length < yc.length) ? xc : yc).length;\n\n    for (a = b = 0; b < j; b++) {\n      if (xc[b] != yc[b]) {\n        xlty = xc[b] < yc[b];\n        break;\n      }\n    }\n  }\n\n  // x < y? Point xc to the array of the bigger number.\n  if (xlty) {\n    t = xc;\n    xc = yc;\n    yc = t;\n    y.s = -y.s;\n  }\n\n  /*\n   * Append zeros to xc if shorter. No need to add zeros to yc if shorter as subtraction only\n   * needs to start at yc.length.\n   */\n  if ((b = (j = yc.length) - (i = xc.length)) > 0) for (; b--;) xc[i++] = 0;\n\n  // Subtract yc from xc.\n  for (b = i; j > a;) {\n    if (xc[--j] < yc[j]) {\n      for (i = j; i && !xc[--i];) xc[i] = 9;\n      --xc[i];\n      xc[j] += 10;\n    }\n\n    xc[j] -= yc[j];\n  }\n\n  // Remove trailing zeros.\n  for (; xc[--b] === 0;) xc.pop();\n\n  // Remove leading zeros and adjust exponent accordingly.\n  for (; xc[0] === 0;) {\n    xc.shift();\n    --ye;\n  }\n\n  if (!xc[0]) {\n\n    // n - n = +0\n    y.s = 1;\n\n    // Result must be zero.\n    xc = [ye = 0];\n  }\n\n  y.c = xc;\n  y.e = ye;\n\n  return y;\n};\n\n\n/*\n * Return a new Big whose value is the value of this Big modulo the value of Big y.\n */\nP.mod = function (y) {\n  var ygtx,\n    x = this,\n    Big = x.constructor,\n    a = x.s,\n    b = (y = new Big(y)).s;\n\n  if (!y.c[0]) {\n    throw Error(DIV_BY_ZERO);\n  }\n\n  x.s = y.s = 1;\n  ygtx = y.cmp(x) == 1;\n  x.s = a;\n  y.s = b;\n\n  if (ygtx) return new Big(x);\n\n  a = Big.DP;\n  b = Big.RM;\n  Big.DP = Big.RM = 0;\n  x = x.div(y);\n  Big.DP = a;\n  Big.RM = b;\n\n  return this.minus(x.times(y));\n};\n\n\n/*\n * Return a new Big whose value is the value of this Big negated.\n */\nP.neg = function () {\n  var x = new this.constructor(this);\n  x.s = -x.s;\n  return x;\n};\n\n\n/*\n * Return a new Big whose value is the value of this Big plus the value of Big y.\n */\nP.plus = P.add = function (y) {\n  var e, k, t,\n    x = this,\n    Big = x.constructor;\n\n  y = new Big(y);\n\n  // Signs differ?\n  if (x.s != y.s) {\n    y.s = -y.s;\n    return x.minus(y);\n  }\n\n  var xe = x.e,\n    xc = x.c,\n    ye = y.e,\n    yc = y.c;\n\n  // Either zero?\n  if (!xc[0] || !yc[0]) {\n    if (!yc[0]) {\n      if (xc[0]) {\n        y = new Big(x);\n      } else {\n        y.s = x.s;\n      }\n    }\n    return y;\n  }\n\n  xc = xc.slice();\n\n  // Prepend zeros to equalise exponents.\n  // Note: reverse faster than unshifts.\n  if (e = xe - ye) {\n    if (e > 0) {\n      ye = xe;\n      t = yc;\n    } else {\n      e = -e;\n      t = xc;\n    }\n\n    t.reverse();\n    for (; e--;) t.push(0);\n    t.reverse();\n  }\n\n  // Point xc to the longer array.\n  if (xc.length - yc.length < 0) {\n    t = yc;\n    yc = xc;\n    xc = t;\n  }\n\n  e = yc.length;\n\n  // Only start adding at yc.length - 1 as the further digits of xc can be left as they are.\n  for (k = 0; e; xc[e] %= 10) k = (xc[--e] = xc[e] + yc[e] + k) / 10 | 0;\n\n  // No need to check for zero, as +x + +y != 0 && -x + -y != 0\n\n  if (k) {\n    xc.unshift(k);\n    ++ye;\n  }\n\n  // Remove trailing zeros.\n  for (e = xc.length; xc[--e] === 0;) xc.pop();\n\n  y.c = xc;\n  y.e = ye;\n\n  return y;\n};\n\n\n/*\n * Return a Big whose value is the value of this Big raised to the power n.\n * If n is negative, round to a maximum of Big.DP decimal places using rounding\n * mode Big.RM.\n *\n * n {number} Integer, -MAX_POWER to MAX_POWER inclusive.\n */\nP.pow = function (n) {\n  var x = this,\n    one = new x.constructor('1'),\n    y = one,\n    isneg = n < 0;\n\n  if (n !== ~~n || n < -MAX_POWER || n > MAX_POWER) {\n    throw Error(INVALID + 'exponent');\n  }\n\n  if (isneg) n = -n;\n\n  for (;;) {\n    if (n & 1) y = y.times(x);\n    n >>= 1;\n    if (!n) break;\n    x = x.times(x);\n  }\n\n  return isneg ? one.div(y) : y;\n};\n\n\n/*\n * Return a new Big whose value is the value of this Big rounded to a maximum precision of sd\n * significant digits using rounding mode rm, or Big.RM if rm is not specified.\n *\n * sd {number} Significant digits: integer, 1 to MAX_DP inclusive.\n * rm? {number} Rounding mode: 0 (down), 1 (half-up), 2 (half-even) or 3 (up).\n */\nP.prec = function (sd, rm) {\n  if (sd !== ~~sd || sd < 1 || sd > MAX_DP) {\n    throw Error(INVALID + 'precision');\n  }\n  return round(new this.constructor(this), sd, rm);\n};\n\n\n/*\n * Return a new Big whose value is the value of this Big rounded to a maximum of dp decimal places\n * using rounding mode rm, or Big.RM if rm is not specified.\n * If dp is negative, round to an integer which is a multiple of 10**-dp.\n * If dp is not specified, round to 0 decimal places.\n *\n * dp? {number} Integer, -MAX_DP to MAX_DP inclusive.\n * rm? {number} Rounding mode: 0 (down), 1 (half-up), 2 (half-even) or 3 (up).\n */\nP.round = function (dp, rm) {\n  if (dp === UNDEFINED) dp = 0;\n  else if (dp !== ~~dp || dp < -MAX_DP || dp > MAX_DP) {\n    throw Error(INVALID_DP);\n  }\n  return round(new this.constructor(this), dp + this.e + 1, rm);\n};\n\n\n/*\n * Return a new Big whose value is the square root of the value of this Big, rounded, if\n * necessary, to a maximum of Big.DP decimal places using rounding mode Big.RM.\n */\nP.sqrt = function () {\n  var r, c, t,\n    x = this,\n    Big = x.constructor,\n    s = x.s,\n    e = x.e,\n    half = new Big('0.5');\n\n  // Zero?\n  if (!x.c[0]) return new Big(x);\n\n  // Negative?\n  if (s < 0) {\n    throw Error(NAME + 'No square root');\n  }\n\n  // Estimate.\n  s = Math.sqrt(x + '');\n\n  // Math.sqrt underflow/overflow?\n  // Re-estimate: pass x coefficient to Math.sqrt as integer, then adjust the result exponent.\n  if (s === 0 || s === 1 / 0) {\n    c = x.c.join('');\n    if (!(c.length + e & 1)) c += '0';\n    s = Math.sqrt(c);\n    e = ((e + 1) / 2 | 0) - (e < 0 || e & 1);\n    r = new Big((s == 1 / 0 ? '5e' : (s = s.toExponential()).slice(0, s.indexOf('e') + 1)) + e);\n  } else {\n    r = new Big(s + '');\n  }\n\n  e = r.e + (Big.DP += 4);\n\n  // Newton-Raphson iteration.\n  do {\n    t = r;\n    r = half.times(t.plus(x.div(t)));\n  } while (t.c.slice(0, e).join('') !== r.c.slice(0, e).join(''));\n\n  return round(r, (Big.DP -= 4) + r.e + 1, Big.RM);\n};\n\n\n/*\n * Return a new Big whose value is the value of this Big times the value of Big y.\n */\nP.times = P.mul = function (y) {\n  var c,\n    x = this,\n    Big = x.constructor,\n    xc = x.c,\n    yc = (y = new Big(y)).c,\n    a = xc.length,\n    b = yc.length,\n    i = x.e,\n    j = y.e;\n\n  // Determine sign of result.\n  y.s = x.s == y.s ? 1 : -1;\n\n  // Return signed 0 if either 0.\n  if (!xc[0] || !yc[0]) {\n    y.c = [y.e = 0];\n    return y;\n  }\n\n  // Initialise exponent of result as x.e + y.e.\n  y.e = i + j;\n\n  // If array xc has fewer digits than yc, swap xc and yc, and lengths.\n  if (a < b) {\n    c = xc;\n    xc = yc;\n    yc = c;\n    j = a;\n    a = b;\n    b = j;\n  }\n\n  // Initialise coefficient array of result with zeros.\n  for (c = new Array(j = a + b); j--;) c[j] = 0;\n\n  // Multiply.\n\n  // i is initially xc.length.\n  for (i = b; i--;) {\n    b = 0;\n\n    // a is yc.length.\n    for (j = a + i; j > i;) {\n\n      // Current sum of products at this digit position, plus carry.\n      b = c[j] + yc[i] * xc[j - i - 1] + b;\n      c[j--] = b % 10;\n\n      // carry\n      b = b / 10 | 0;\n    }\n\n    c[j] = b;\n  }\n\n  // Increment result exponent if there is a final carry, otherwise remove leading zero.\n  if (b) ++y.e;\n  else c.shift();\n\n  // Remove trailing zeros.\n  for (i = c.length; !c[--i];) c.pop();\n  y.c = c;\n\n  return y;\n};\n\n\n/*\n * Return a string representing the value of this Big in exponential notation rounded to dp fixed\n * decimal places using rounding mode rm, or Big.RM if rm is not specified.\n *\n * dp? {number} Decimal places: integer, 0 to MAX_DP inclusive.\n * rm? {number} Rounding mode: 0 (down), 1 (half-up), 2 (half-even) or 3 (up).\n */\nP.toExponential = function (dp, rm) {\n  var x = this,\n    n = x.c[0];\n\n  if (dp !== UNDEFINED) {\n    if (dp !== ~~dp || dp < 0 || dp > MAX_DP) {\n      throw Error(INVALID_DP);\n    }\n    x = round(new x.constructor(x), ++dp, rm);\n    for (; x.c.length < dp;) x.c.push(0);\n  }\n\n  return stringify(x, true, !!n);\n};\n\n\n/*\n * Return a string representing the value of this Big in normal notation rounded to dp fixed\n * decimal places using rounding mode rm, or Big.RM if rm is not specified.\n *\n * dp? {number} Decimal places: integer, 0 to MAX_DP inclusive.\n * rm? {number} Rounding mode: 0 (down), 1 (half-up), 2 (half-even) or 3 (up).\n *\n * (-0).toFixed(0) is '0', but (-0.1).toFixed(0) is '-0'.\n * (-0).toFixed(1) is '0.0', but (-0.01).toFixed(1) is '-0.0'.\n */\nP.toFixed = function (dp, rm) {\n  var x = this,\n    n = x.c[0];\n\n  if (dp !== UNDEFINED) {\n    if (dp !== ~~dp || dp < 0 || dp > MAX_DP) {\n      throw Error(INVALID_DP);\n    }\n    x = round(new x.constructor(x), dp + x.e + 1, rm);\n\n    // x.e may have changed if the value is rounded up.\n    for (dp = dp + x.e + 1; x.c.length < dp;) x.c.push(0);\n  }\n\n  return stringify(x, false, !!n);\n};\n\n\n/*\n * Return a string representing the value of this Big.\n * Return exponential notation if this Big has a positive exponent equal to or greater than\n * Big.PE, or a negative exponent equal to or less than Big.NE.\n * Omit the sign for negative zero.\n */\nP[Symbol.for('nodejs.util.inspect.custom')] = P.toJSON = P.toString = function () {\n  var x = this,\n    Big = x.constructor;\n  return stringify(x, x.e <= Big.NE || x.e >= Big.PE, !!x.c[0]);\n};\n\n\n/*\n * Return the value of this Big as a primitve number.\n */\nP.toNumber = function () {\n  var n = Number(stringify(this, true, true));\n  if (this.constructor.strict === true && !this.eq(n.toString())) {\n    throw Error(NAME + 'Imprecise conversion');\n  }\n  return n;\n};\n\n\n/*\n * Return a string representing the value of this Big rounded to sd significant digits using\n * rounding mode rm, or Big.RM if rm is not specified.\n * Use exponential notation if sd is less than the number of digits necessary to represent\n * the integer part of the value in normal notation.\n *\n * sd {number} Significant digits: integer, 1 to MAX_DP inclusive.\n * rm? {number} Rounding mode: 0 (down), 1 (half-up), 2 (half-even) or 3 (up).\n */\nP.toPrecision = function (sd, rm) {\n  var x = this,\n    Big = x.constructor,\n    n = x.c[0];\n\n  if (sd !== UNDEFINED) {\n    if (sd !== ~~sd || sd < 1 || sd > MAX_DP) {\n      throw Error(INVALID + 'precision');\n    }\n    x = round(new Big(x), sd, rm);\n    for (; x.c.length < sd;) x.c.push(0);\n  }\n\n  return stringify(x, sd <= x.e || x.e <= Big.NE || x.e >= Big.PE, !!n);\n};\n\n\n/*\n * Return a string representing the value of this Big.\n * Return exponential notation if this Big has a positive exponent equal to or greater than\n * Big.PE, or a negative exponent equal to or less than Big.NE.\n * Include the sign for negative zero.\n */\nP.valueOf = function () {\n  var x = this,\n    Big = x.constructor;\n  if (Big.strict === true) {\n    throw Error(NAME + 'valueOf disallowed');\n  }\n  return stringify(x, x.e <= Big.NE || x.e >= Big.PE, true);\n};\n\n\n// Export\n\n\nexport var Big = _Big_();\n\n/// <reference types=\"https://raw.githubusercontent.com/DefinitelyTyped/DefinitelyTyped/master/types/big.js/index.d.ts\" />\nexport default Big;\n","import { TONCOIN } from '../config';\nimport { Big } from '../lib/big.js';\n\nBig.RM = 0; // RoundDown\nBig.NE = -100000; // Disable exponential form\nBig.PE = 100000; // Disable exponential form\n\nconst ten = Big(10);\n\nexport function fromDecimal(value: string | number, decimals?: number) {\n  return BigInt(Big(value).mul(ten.pow(decimals ?? TONCOIN.decimals)).round().toString());\n}\n\nexport function toDecimal(value: bigint | number, decimals?: number, noFloor = false) {\n  return toBig(value, decimals ?? TONCOIN.decimals, noFloor).toString();\n}\n\nexport function toBig(value: bigint | number, decimals: number = TONCOIN.decimals, noFloor = false) {\n  return Big(value.toString()).div(ten.pow(decimals)).round(decimals, noFloor ? Big.roundHalfUp : undefined);\n}\n\nexport function roundDecimal(value: string, decimals: number) {\n  return Big(value).round(decimals).toString();\n}\n","export function random(min: number, max: number) {\n  return Math.floor(Math.random() * (max - min + 1) + min);\n}\n\nexport function sample<T>(arr: T[]) {\n  return arr[random(0, arr.length - 1)];\n}\n\nexport function randomBytes(size: number) {\n  return self.crypto.getRandomValues(new Uint8Array(size));\n}\n\nexport function randomBase64(byteSize: number) {\n  return Buffer.from(randomBytes(byteSize)).toString('base64');\n}\n","import { ONE_TON } from '../config';\nimport { fromDecimal } from './decimals';\nimport { randomBytes } from './random';\n\nexport const BIGINT_PREFIX = 'bigint:';\n\nexport function bigintReviver(this: any, key: string, value: any) {\n  if (typeof value === 'string' && value.startsWith(BIGINT_PREFIX)) {\n    return BigInt(value.slice(7));\n  }\n  return value;\n}\n\nexport function bigintAbs(value: bigint) {\n  return value === -0n || value < 0n ? -value : value;\n}\n\nexport function bigintSum(values: bigint[]) {\n  let result = 0n;\n  for (const value of values) result += value;\n  return result;\n}\n\nexport function bigintDivideToNumber(value: bigint, num: number) {\n  return (value * ONE_TON) / fromDecimal(num);\n}\n\nexport function bigintMultiplyToNumber(value: bigint, num: number) {\n  return (value * fromDecimal(num)) / ONE_TON;\n}\n\nexport function bigintRandom(bytes: number) {\n  let value = BigInt(0);\n  for (const randomNumber of randomBytes(bytes)) {\n    const randomBigInt = BigInt(randomNumber);\n    value = (value << BigInt(8)) + randomBigInt;\n  }\n  return value;\n}\n\nexport function bigintCountBits(value: bigint) {\n  const binaryString = value.toString(2);\n  return binaryString.length;\n}\n\nexport function bigintMax(value0: bigint, value1: bigint) {\n  return value0 > value1 ? value0 : value1;\n}\n\nexport function bigintMin(value0: bigint, value1: bigint) {\n  return value0 < value1 ? value0 : value1;\n}\n\nexport function bigintMultiplePercent(value: bigint, percent: number) {\n  return (value * fromDecimal(percent / 100)) / ONE_TON;\n}\n","import type { OriginMessageData, WorkerMessageData } from './PostMessageConnector';\n\nimport { BIGINT_PREFIX } from './bigint';\n\nexport const UNDEFINED_PREFIX = 'undefined:';\n\nfunction extensionMessageReplacer(this: any, key: string, value: any) {\n  if (value === undefined) {\n    return `${UNDEFINED_PREFIX}marker`;\n  }\n\n  // Bigint is replaced by patching `toJSON` method\n\n  return value;\n}\n\nfunction extensionMessageReviver(this: any, key: string, value: any) {\n  // Handle bigint values\n  if (typeof value === 'string' && value.startsWith(BIGINT_PREFIX)) {\n    return BigInt(value.slice(BIGINT_PREFIX.length));\n  }\n\n  // Handle undefined values\n  if (typeof value === 'string' && value.startsWith(UNDEFINED_PREFIX)) {\n    return undefined;\n  }\n\n  return value;\n}\n\nexport function encodeExtensionMessage(data: OriginMessageData | WorkerMessageData) {\n  return JSON.stringify(data, extensionMessageReplacer);\n}\n\nexport function decodeExtensionMessage<T extends OriginMessageData | WorkerMessageData>(data: string | T): T {\n  if (typeof data === 'string') {\n    return JSON.parse(data, extensionMessageReviver);\n  }\n  return data;\n}\n","import type InAppBrowserPostMessageAdapter from './embeddedDappBridge/provider/InAppBrowserPostMessageAdapter';\nimport type {\n  ApiUpdate,\n  CancellableCallback,\n  OriginMessageData,\n  OriginMessageEvent,\n  WorkerMessageData,\n} from './PostMessageConnector';\n\nimport { decodeExtensionMessage, encodeExtensionMessage } from './extensionMessageSerializer';\nimport { logDebugError } from './logs';\n\ndeclare const self: WorkerGlobalScope;\n\nconst callbackState = new Map<string, CancellableCallback>();\n\ntype ApiConfig =\n// eslint-disable-next-line @typescript-eslint/no-redundant-type-constituents\n  ((name: string, ...args: any[]) => any | [any, ArrayBuffer[]])\n  | Record<string, AnyFunction>;\ntype SendToOrigin = (data: WorkerMessageData, transferables?: Transferable[]) => void;\n\n/**\n * Provides functions, defined in this messenger (a window, a worker), to another messenger.\n * The other messenger can call the functions using `createConnector`.\n */\nexport function createPostMessageInterface(\n  api: ApiConfig,\n  channel?: string,\n  target: DedicatedWorkerGlobalScope | Worker | InAppBrowserPostMessageAdapter = self as DedicatedWorkerGlobalScope,\n  shouldIgnoreErrors?: boolean,\n) {\n  function sendToOrigin(data: WorkerMessageData, transferables?: Transferable[]) {\n    data.channel = channel;\n\n    if (transferables) {\n      target.postMessage(data, transferables);\n    } else {\n      target.postMessage(data);\n    }\n  }\n\n  if (!shouldIgnoreErrors) {\n    handleErrors(sendToOrigin);\n  }\n\n  function handleMessage(e: OriginMessageEvent) {\n    if (e.data?.channel === channel) {\n      void onMessage(api, e.data, sendToOrigin);\n    }\n  }\n\n  // Correct for any target, but TypeScript weirdly complains\n  (target as DedicatedWorkerGlobalScope).addEventListener('message', handleMessage);\n\n  return () => {\n    (target as DedicatedWorkerGlobalScope).removeEventListener('message', handleMessage);\n  };\n}\n\n/**\n * Provides functions, defined in the main window, to an IFrame.\n */\nexport function createReverseIFrameInterface(\n  api: ApiConfig,\n  targetOrigin: string,\n  target: Window,\n  channel?: string,\n) {\n  function sendToOrigin(data: WorkerMessageData, transferables?: Transferable[]) {\n    data.channel = channel;\n\n    if (transferables) {\n      throw new Error('Cannot send `Transferable` to `Window`');\n    } else {\n      target.postMessage(data, targetOrigin);\n    }\n  }\n\n  function handleMessage(e: OriginMessageEvent) {\n    if (targetOrigin && e.origin !== targetOrigin) return;\n\n    if (e.data?.channel === channel) {\n      void onMessage(api, e.data, sendToOrigin);\n    }\n  }\n\n  window.addEventListener('message', handleMessage);\n\n  return () => {\n    window.removeEventListener('message', handleMessage);\n  };\n}\n\n/**\n * Provides functions, defined in this extension service worker, to a window.\n * The window can call the functions using `createExtensionConnector`.\n */\nexport function createExtensionInterface(\n  portName: string,\n  api: ApiConfig,\n  channel?: string,\n  cleanUpdater?: (onUpdate: (update: ApiUpdate) => void) => void,\n  withAutoInit = false,\n) {\n  chrome.runtime.onConnect.addListener((port) => {\n    if (port.name !== portName) {\n      return;\n    }\n\n    const url = port.sender?.url;\n    const origin = url ? new URL(url).origin : undefined;\n\n    const dAppUpdater = (update: ApiUpdate) => {\n      sendToOrigin({\n        type: 'update',\n        update,\n      });\n    };\n\n    function sendToOrigin(data: WorkerMessageData) {\n      data.channel = channel;\n      port.postMessage(encodeExtensionMessage(data));\n    }\n\n    handleErrors(sendToOrigin);\n\n    port.onMessage.addListener((data: OriginMessageData | string) => {\n      data = decodeExtensionMessage(data);\n      if (data.channel === channel) {\n        void onMessage(api, data, sendToOrigin, dAppUpdater, origin);\n      }\n    });\n\n    port.onDisconnect.addListener(() => {\n      cleanUpdater?.(dAppUpdater);\n    });\n\n    if (withAutoInit) {\n      void onMessage(api, { type: 'init', args: [] }, sendToOrigin, dAppUpdater);\n    }\n  });\n}\n\n/**\n * Provides functions, defined in this window, to the extension service worker.\n * The service worker can call the functions using `createReverseExtensionConnector`.\n */\nexport function createReverseExtensionInterface(\n  portName: string,\n  api: ApiConfig,\n) {\n  let port: chrome.runtime.Port;\n\n  function sendToServiceWorker(data: WorkerMessageData) {\n    port.postMessage(encodeExtensionMessage(data));\n  }\n\n  function connect() {\n    port = chrome.runtime.connect({ name: portName });\n\n    port.onMessage.addListener((data: OriginMessageData | string) => {\n      data = decodeExtensionMessage(data);\n      void onMessage(api, data, sendToServiceWorker);\n    });\n\n    // For some reason port can suddenly get disconnected\n    port.onDisconnect.addListener(() => {\n      connect();\n    });\n  }\n\n  connect();\n}\n\nasync function onMessage(\n  api: ApiConfig,\n  data: OriginMessageData,\n  sendToOrigin: SendToOrigin,\n  onUpdate?: (update: ApiUpdate) => void,\n  origin?: string,\n) {\n  if (!onUpdate) {\n    onUpdate = (update: ApiUpdate) => {\n      sendToOrigin({\n        type: 'update',\n        update,\n      });\n    };\n  }\n\n  switch (data.type) {\n    case 'init': {\n      const { args } = data;\n      const promise = typeof api === 'function'\n        ? api('init', origin, onUpdate, ...args)\n        : api.init?.(onUpdate, ...args);\n      await promise;\n\n      break;\n    }\n    case 'callMethod': {\n      const {\n        messageId, name, args, withCallback,\n      } = data;\n      try {\n        // This method is probably from another worker\n        if (typeof api !== 'function' && !api[name]) return;\n\n        if (messageId && withCallback) {\n          const callback = (...callbackArgs: any[]) => {\n            const lastArg = callbackArgs[callbackArgs.length - 1];\n\n            sendToOrigin({\n              type: 'methodCallback',\n              messageId,\n              callbackArgs,\n            }, isTransferable(lastArg) ? [lastArg] : undefined);\n          };\n\n          callbackState.set(messageId, callback);\n\n          args.push(callback as never);\n        }\n\n        const response = typeof api === 'function'\n          ? await api(name, origin, ...args)\n          : await api[name](...args);\n        const { arrayBuffer } = (typeof response === 'object' && response && 'arrayBuffer' in response) || {};\n\n        if (messageId) {\n          sendToOrigin(\n            {\n              type: 'methodResponse',\n              messageId,\n              response,\n            },\n            arrayBuffer ? [arrayBuffer] : undefined,\n          );\n        }\n      } catch (err: any) {\n        logDebugError(name, err);\n\n        if (messageId) {\n          sendToOrigin({\n            type: 'methodResponse',\n            messageId,\n            error: { message: err.message },\n          });\n        }\n      }\n\n      if (messageId) {\n        callbackState.delete(messageId);\n      }\n\n      break;\n    }\n    case 'cancelProgress': {\n      const callback = callbackState.get(data.messageId);\n      if (callback) {\n        callback.isCanceled = true;\n      }\n\n      break;\n    }\n  }\n}\n\nfunction isTransferable(obj: any) {\n  return obj instanceof ArrayBuffer || obj instanceof ImageBitmap;\n}\n\nfunction handleErrors(sendToOrigin: SendToOrigin) {\n  self.onerror = (e) => {\n    const message = e.error?.message || 'Uncaught exception in worker';\n    logDebugError(message, e.error);\n\n    sendToOrigin({\n      type: 'unhandledError',\n      error: {\n        message,\n        stack: e.error?.stack,\n      },\n    });\n  };\n\n  self.addEventListener('unhandledrejection', (e) => {\n    const message = e.reason?.message || 'Unhandled rejection in worker';\n    logDebugError(message, e.reason);\n\n    sendToOrigin({\n      type: 'unhandledError',\n      error: {\n        message,\n        stack: e.reason?.stack,\n      },\n    });\n  });\n}\n","import { BIGINT_PREFIX } from './bigint';\n\n// Fixes serialization of objects containing `bigint` values.\n// Extracted to a separate file to avoid leaking into Extension Page Script.\n// @ts-ignore\nBigInt.prototype.toJSON = function toJSON() {\n  return `${BIGINT_PREFIX}${this.toString()}`;\n};\n","import type { AccountIdParsed, ApiNetwork } from '../api/types';\nimport type { Account } from '../global/types';\n\nimport { shortenAddress } from './shortenAddress';\n\nexport function parseAccountId(accountId: string): AccountIdParsed {\n  const parts = accountId.split('-');\n  const [id, network = 'mainnet'] = (parts.length === 3 ? [parts[0], parts[2]] : parts) as [string, ApiNetwork];\n  return { id: Number(id), network };\n}\n\nexport function buildAccountId(account: AccountIdParsed) {\n  const { id, network } = account;\n  return `${id}-${network}`;\n}\n\nexport function getMainAccountAddress(addressByChain: Account['addressByChain']) {\n  return addressByChain.ton ?? Object.values(addressByChain).find(Boolean);\n}\n\nexport function getAccountTitle(account: Account) {\n  return account.title || shortenAddress(getMainAccountAddress(account.addressByChain) ?? '');\n}\n","import { PRIVATE_KEY_HEX_LENGTH } from '../config';\n\nexport default function isMnemonicPrivateKey(mnemonic: string[]) {\n  return mnemonic.length === 1 && mnemonic[0].length === PRIVATE_KEY_HEX_LENGTH;\n}\n","import withCache from './withCache';\n\nexport const MEANINGFUL_CHAR_LENGTH = 6;\nconst FILLER = '';\nconst FILLER_LENGTH = FILLER.length;\n\nexport const shortenAddress = withCache((address: string, shift = MEANINGFUL_CHAR_LENGTH, fromRight = shift) => {\n  if (!address) return undefined;\n\n  if (address.length <= shift + fromRight + FILLER_LENGTH) return address;\n\n  return `${address.slice(0, shift)}${FILLER}${address.slice(-fromRight)}`;\n});\n","import createHmac from 'create-hmac';\nimport * as nacl from 'tweetnacl';\n\ntype Hex = string;\ntype Path = string;\n\ntype Keys = {\n  key: Buffer;\n  chainCode: Buffer;\n};\n\nconst ED25519_CURVE = 'ed25519 seed';\nconst HARDENED_OFFSET = 0x80000000;\n\nconst pathRegex = /^m(\\/[0-9]+')+$/;\nfunction replaceDerive(val: string) {\n  return val.replace('\\'', '');\n}\n\nexport const getMasterKeyFromSeed = (seed: Hex): Keys => {\n  const hmac = createHmac('sha512', ED25519_CURVE);\n  const I = hmac.update(Buffer.from(seed, 'hex')).digest();\n  const IL = I.slice(0, 32);\n  const IR = I.slice(32);\n  return {\n    key: IL,\n    chainCode: IR,\n  };\n};\n\nexport const CKDPriv = ({ key, chainCode }: Keys, index: number): Keys => {\n  const indexBuffer = Buffer.allocUnsafe(4);\n  indexBuffer.writeUInt32BE(index, 0);\n\n  const data = Buffer.concat([Buffer.alloc(1, 0), key, indexBuffer]);\n\n  const I = createHmac('sha512', chainCode)\n    .update(data)\n    .digest();\n  const IL = I.slice(0, 32);\n  const IR = I.slice(32);\n  return {\n    key: IL,\n    chainCode: IR,\n  };\n};\n\nexport const getPublicKey = (privateKey: Buffer, withZeroByte = true): Buffer => {\n  const keyPair = nacl.sign.keyPair.fromSeed(privateKey);\n  const signPk = keyPair.secretKey.subarray(32);\n  const zero = Buffer.alloc(1, 0);\n  return withZeroByte\n    ? Buffer.concat([zero, Buffer.from(signPk)])\n    : Buffer.from(signPk);\n};\n\nexport const isValidPath = (path: string): boolean => {\n  if (!pathRegex.test(path)) {\n    return false;\n  }\n  return !path\n    .split('/')\n    .slice(1)\n    .map(replaceDerive)\n\n    .some(isNaN as any);\n};\n\nexport const derivePath = (path: Path, seed: Hex, offset = HARDENED_OFFSET): Keys => {\n  if (!isValidPath(path)) {\n    throw new Error('Invalid derivation path');\n  }\n\n  const { key, chainCode } = getMasterKeyFromSeed(seed);\n  const segments = path\n    .split('/')\n    .slice(1)\n    .map(replaceDerive)\n    .map((el) => parseInt(el, 10));\n\n  return segments.reduce(\n    (parentKeys, segment) => CKDPriv(parentKeys, segment + offset),\n    { key, chainCode },\n  );\n};\n","type CollectionByKey<Member> = Record<number | string, Member>;\ntype GroupedByKey<Member> = Record<number | string, Member[]>;\n\ntype OrderDirection =\n  'asc'\n  | 'desc';\n\ntype OrderCallback<T> = (member: T) => unknown;\n\nexport function buildCollectionByKey<T extends AnyLiteral>(collection: readonly T[], key: keyof T): CollectionByKey<T> {\n  return collection.reduce((byKey: CollectionByKey<T>, member: T) => {\n    byKey[member[key]] = member;\n\n    return byKey;\n  }, {});\n}\n\nexport function groupBy<T extends AnyLiteral>(collection: readonly T[], key: keyof T): GroupedByKey<T> {\n  return collection.reduce((byKey: GroupedByKey<T>, member: T) => {\n    const groupKey = member[key];\n\n    if (!byKey[groupKey]) {\n      byKey[groupKey] = [member];\n    } else {\n      byKey[groupKey].push(member);\n    }\n\n    return byKey;\n  }, {});\n}\n\nexport function mapValues<R, M>(\n  byKey: CollectionByKey<M>,\n  callback: (member: M, key: string, index: number, originalByKey: CollectionByKey<M>) => R,\n): CollectionByKey<R> {\n  return Object.keys(byKey).reduce((newByKey: CollectionByKey<R>, key, index) => {\n    newByKey[key] = callback(byKey[key], key, index, byKey);\n    return newByKey;\n  }, {});\n}\n\nexport function pick<T, K extends keyof T>(object: T, keys: K[]) {\n  return keys.reduce((result, key) => {\n    result[key] = object[key];\n    return result;\n  }, {} as Pick<T, K>);\n}\n\nexport function pickTruthy<T, K extends keyof T>(object: T, keys: K[]) {\n  return keys.reduce((result, key) => {\n    if (object[key]) {\n      result[key] = object[key];\n    }\n\n    return result;\n  }, {} as Pick<T, K>);\n}\n\nexport function omit<T extends object, K extends keyof T>(object: T, keys: K[]): Omit<T, K> {\n  const stringKeys = new Set(keys.map(String));\n  const savedKeys = Object.keys(object)\n    .filter((key) => !stringKeys.has(key)) as Array<Exclude<keyof T, K>>;\n\n  return pick(object, savedKeys);\n}\n\nexport function omitUndefined<T extends object>(object: T): T {\n  return Object.keys(object).reduce((result, stringKey) => {\n    const key = stringKey as keyof T;\n    if (object[key] !== undefined) {\n      result[key] = object[key];\n    }\n    return result;\n  }, {} as T);\n}\n\nexport function orderBy<T>(\n  collection: T[],\n  orderRule: (keyof T) | OrderCallback<T> | ((keyof T) | OrderCallback<T>)[],\n  mode: OrderDirection | [OrderDirection, OrderDirection] = 'asc',\n): T[] {\n  function compareValues(a: T, b: T, currentOrderRule: (keyof T) | OrderCallback<T>, isAsc: boolean) {\n    const aValue = (typeof currentOrderRule === 'function' ? currentOrderRule(a) : a[currentOrderRule]) || 0;\n    const bValue = (typeof currentOrderRule === 'function' ? currentOrderRule(b) : b[currentOrderRule]) || 0;\n\n    if (aValue === bValue) return 0;\n\n    const condition = isAsc ? aValue > bValue : aValue < bValue;\n    return condition ? 1 : -1;\n  }\n\n  if (Array.isArray(orderRule)) {\n    const [mode1, mode2] = Array.isArray(mode) ? mode : [mode, mode];\n    const [orderRule1, orderRule2] = orderRule;\n    const isAsc1 = mode1 === 'asc';\n    const isAsc2 = mode2 === 'asc';\n\n    return collection.sort((a, b) => {\n      return compareValues(a, b, orderRule1, isAsc1) || compareValues(a, b, orderRule2, isAsc2);\n    });\n  }\n\n  const isAsc = mode === 'asc';\n  return collection.sort((a, b) => {\n    return compareValues(a, b, orderRule, isAsc);\n  });\n}\n\nexport function unique<T>(array: T[]): T[] {\n  return Array.from(new Set(array));\n}\n\nexport function compact<T>(array: T[]) {\n  return array.filter(Boolean);\n}\n\nexport function areSortedArraysEqual<T>(array1: readonly T[], array2: readonly T[]) {\n  if (array1.length !== array2.length) {\n    return false;\n  }\n\n  return array1.every((item, i) => item === array2[i]);\n}\n\nexport function split<T>(array: T[], chunkSize: number) {\n  const result: T[][] = [];\n  for (let i = 0; i < array.length; i += chunkSize) {\n    result.push(array.slice(i, i + chunkSize));\n  }\n\n  return result;\n}\n\nexport function cloneDeep<T>(value: T): T {\n  if (!isObject(value)) {\n    return value;\n  }\n\n  if (Array.isArray(value)) {\n    return value.map(cloneDeep) as typeof value;\n  }\n\n  return Object.keys(value).reduce((acc, key) => {\n    acc[key as keyof T] = cloneDeep(value[key as keyof T]);\n    return acc;\n  }, {} as T);\n}\n\nexport function isLiteralObject(value: any): value is AnyLiteral {\n  return isObject(value) && !Array.isArray(value);\n}\n\nfunction isObject(value: any): value is object {\n  // eslint-disable-next-line no-null/no-null\n  return typeof value === 'object' && value !== null;\n}\n\nexport function findLast<T>(array: Array<T>, predicate: (value: T, index: number, obj: T[]) => boolean): T | undefined {\n  let cursor = array.length;\n\n  while (cursor--) {\n    if (predicate(array[cursor], cursor, array)) {\n      return array[cursor];\n    }\n  }\n\n  return undefined;\n}\n\nexport function range(start: number, end: number) {\n  const arr: number[] = [];\n  for (let i = start; i < end;) {\n    arr.push(i++);\n  }\n  return arr;\n}\n\nexport function fromKeyValueArrays<T>(keys: string[], values: T[] | T) {\n  return keys.reduce((acc, key, index) => {\n    acc[key] = Array.isArray(values) ? values[index] : values;\n    return acc;\n  }, {} as Record<string, T>);\n}\n\nexport function extractKey<T, K extends keyof T>(array: readonly T[], key: K): T[K][] {\n  return array.map((value) => value[key]);\n}\n\nexport function findDifference<T>(array1: Iterable<T>, array2: Iterable<T>): T[] {\n  const set2 = new Set(array2);\n  const diff: T[] = [];\n\n  for (const element of array1) {\n    if (!set2.has(element)) {\n      diff.push(element);\n    }\n  }\n\n  return diff;\n}\n\nexport function filterValues<M>(\n  byKey: CollectionByKey<M>,\n  callback: (member: M, key: string, index: number, originalByKey: CollectionByKey<M>) => boolean,\n): CollectionByKey<M> {\n  return Object.keys(byKey).reduce((newByKey: CollectionByKey<M>, key, index) => {\n    if (callback(byKey[key], key, index, byKey)) {\n      newByKey[key] = byKey[key];\n    }\n\n    return newByKey;\n  }, {});\n}\n\nexport function uniqueByKey<T>(array: T[], key: keyof T, shouldKeepFirst?: boolean) {\n  if (shouldKeepFirst) {\n    array = Array.from(array);\n    array.reverse();\n  }\n\n  const result = [...new Map(array.map((item) => [item[key], item])).values()];\n\n  if (shouldKeepFirst) {\n    result.reverse();\n  }\n\n  return result;\n}\n\nexport function intersection<T>(x: Set<T>, y: Set<T>): Set<T> {\n  const result = new Set<T>();\n  for (const elem of y) {\n    if (x.has(elem)) {\n      result.add(elem);\n    }\n  }\n  return result;\n}\n\nexport function swapKeysAndValues<\n  K extends string | number,\n  V extends keyof any,\n>(object: Record<K, V>): Record<V, `${K}`> {\n  const result = {} as any;\n  for (const [key, value] of Object.entries(object)) {\n    result[value as any] = key;\n  }\n  return result;\n}\n","import type { ApiNft } from '../api/types';\n\nimport { TON_DNS_COLLECTION, TON_DNS_RENEWAL_WARNING_DAYS, TON_DNS_ZONES } from '../config';\nimport { getCountDaysToDate } from './dateFormat';\n\nexport function isDnsDomain(value: string) {\n  return getDnsDomainZone(value) !== undefined;\n}\n\nexport function getDnsDomainZone(domain: string) {\n  for (const zone of TON_DNS_ZONES) {\n    const { suffixes, baseFormat } = zone;\n\n    // Iterating the zones in reverse to prioritize longer zones when multiple zones match (assuming the zones go from\n    // the shortest to the longest). For example, `test.ton.vip` matches both `vip` and `ton.vip`, and `ton.vip` must be\n    // used.\n    for (let i = suffixes.length - 1; i >= 0; i--) {\n      const suffix = suffixes[i];\n      if (!domain.endsWith(`.${suffix}`)) {\n        continue;\n      }\n\n      const base = domain.slice(0, -suffix.length - 1);\n      if (!baseFormat.test(base)) {\n        continue;\n      }\n\n      return { base, zone };\n    }\n  }\n\n  return undefined;\n}\n\nexport function getDnsZoneByCollection(collectionAddress: string) {\n  return TON_DNS_ZONES.find((zone) => zone.resolver === collectionAddress);\n}\n\nexport function isTonDnsNft(nft: ApiNft | undefined): nft is ApiNft {\n  return nft?.collectionAddress === TON_DNS_COLLECTION;\n}\n\nexport function getTonDnsExpirationDate(nft: ApiNft | undefined, dnsExpiration: Record<string, number> | undefined) {\n  return isTonDnsNft(nft) ? dnsExpiration?.[nft.address] : undefined;\n}\n\nexport function filterExpiringDomains(\n  nftAddresses: string[],\n  nftByAddress?: Record<string, ApiNft>,\n  dnsExpiration?: Record<string, number>,\n) {\n  const expiringDomains: ApiNft[] = [];\n\n  if (nftByAddress && dnsExpiration) {\n    for (const address of nftAddresses) {\n      const nft = nftByAddress[address];\n      if (getCountDaysToDate(getTonDnsExpirationDate(nft, dnsExpiration) ?? Infinity) <= TON_DNS_RENEWAL_WARNING_DAYS) {\n        expiringDomains.push(nft);\n      }\n    }\n  }\n\n  return expiringDomains;\n}\n\nexport function getDomainsExpirationDate(\n  nfts: (string | ApiNft)[],\n  nftByAddress?: Record<string, ApiNft>,\n  dnsExpiration?: Record<string, number>,\n) {\n  if (!dnsExpiration) {\n    return undefined;\n  }\n\n  return nfts.reduce<number | undefined>(\n    (minDate, nftOrAddress) => {\n      const nft = typeof nftOrAddress === 'string' ? nftByAddress?.[nftOrAddress] : nftOrAddress;\n      const expirationDate = getTonDnsExpirationDate(nft, dnsExpiration);\n      return expirationDate\n        ? Math.min(expirationDate, minDate ?? Infinity)\n        : minDate;\n    },\n    undefined,\n  );\n}\n","import { STAKING_POOLS } from '../../config';\n\nexport function sha256(bytes: Uint8Array) {\n  return crypto.subtle.digest('SHA-256', bytes);\n}\n\nexport function bytesToHex(bytes: Uint8Array) {\n  return Buffer.from(bytes).toString('hex');\n}\n\nexport function hexToBytes(hex: string) {\n  return Uint8Array.from(Buffer.from(hex, 'hex'));\n}\n\nexport function bytesToBase64(bytes: Uint8Array) {\n  return Buffer.from(bytes).toString('base64');\n}\n\nexport function base64ToBytes(base64: string) {\n  return Uint8Array.from(Buffer.from(base64, 'base64'));\n}\n\nexport function base64ToString(base64: string) {\n  return Buffer.from(base64, 'base64').toString('utf-8');\n}\n\nexport function isKnownStakingPool(address: string) {\n  return STAKING_POOLS.some((poolPart) => address.endsWith(poolPart));\n}\n","/*\n * This module is to be used instead of /src/util/environment.ts\n * when `window` is not available (e.g. in a web worker).\n */\nimport type { ApiInitArgs } from './types';\n\nimport {\n  ELECTRON_TONCENTER_MAINNET_KEY,\n  ELECTRON_TONCENTER_TESTNET_KEY,\n  IS_CAPACITOR,\n  TONCENTER_MAINNET_KEY,\n  TONCENTER_TESTNET_KEY,\n} from '../config';\n\nconst ELECTRON_ORIGIN = 'file://';\n\nlet environment: ApiInitArgs & {\n  isDappSupported?: boolean;\n  isSseSupported?: boolean;\n  apiHeaders?: AnyLiteral;\n  toncenterMainnetKey?: string;\n  toncenterTestnetKey?: string;\n};\n\nexport function setEnvironment(args: ApiInitArgs) {\n  environment = {\n    ...args,\n    isDappSupported: true,\n    isSseSupported: args.isElectron || (IS_CAPACITOR && !args.isNativeBottomSheet),\n\n    apiHeaders: { 'X-App-Origin': args.isElectron ? ELECTRON_ORIGIN : self?.origin },\n    toncenterMainnetKey: args.isElectron ? ELECTRON_TONCENTER_MAINNET_KEY : TONCENTER_MAINNET_KEY,\n    toncenterTestnetKey: args.isElectron ? ELECTRON_TONCENTER_TESTNET_KEY : TONCENTER_TESTNET_KEY,\n  };\n  return environment;\n}\n\nexport function getEnvironment() {\n  return environment;\n}\n","import { bigintRandom, bigintReviver } from '../../../../util/bigint';\n\nexport function cloneDeep<T>(value: T): T {\n  return JSON.parse(JSON.stringify(value), bigintReviver);\n}\n\nexport function generateQueryId() {\n  return bigintRandom(8);\n}\n","import type { OpenedContract } from '@ton/core';\nimport {\n  Address, beginCell, Builder, Cell, Dictionary,\n} from '@ton/core';\nimport { WalletContractV1R1 } from '@ton/ton/dist/wallets/WalletContractV1R1';\nimport { WalletContractV1R2 } from '@ton/ton/dist/wallets/WalletContractV1R2';\nimport { WalletContractV1R3 } from '@ton/ton/dist/wallets/WalletContractV1R3';\nimport { WalletContractV2R1 } from '@ton/ton/dist/wallets/WalletContractV2R1';\nimport { WalletContractV2R2 } from '@ton/ton/dist/wallets/WalletContractV2R2';\nimport { WalletContractV3R1 } from '@ton/ton/dist/wallets/WalletContractV3R1';\nimport { WalletContractV3R2 } from '@ton/ton/dist/wallets/WalletContractV3R2';\nimport { WalletContractV4 } from '@ton/ton/dist/wallets/WalletContractV4';\nimport { WalletContractV5R1 } from '@ton/ton/dist/wallets/WalletContractV5R1';\n\nimport type { ApiNetwork } from '../../../types';\nimport type { ApiTonWalletVersion, TokenTransferBodyParams } from '../types';\n\nimport { DEFAULT_TIMEOUT, TONCENTER_MAINNET_URL, TONCENTER_TESTNET_URL } from '../../../../config';\nimport { getDnsZoneByCollection } from '../../../../util/dns';\nimport { fromKeyValueArrays, mapValues } from '../../../../util/iteratees';\nimport { logDebugError } from '../../../../util/logs';\nimport withCacheAsync from '../../../../util/withCacheAsync';\nimport { DnsItem } from '../contracts/DnsItem';\nimport { JettonMinter } from '../contracts/JettonMaster';\nimport { JettonStakingOpCodes } from '../contracts/JettonStaking/imports/constants';\nimport { StakeWallet } from '../contracts/JettonStaking/StakeWallet';\nimport { StakingPool } from '../contracts/JettonStaking/StakingPool';\nimport { JettonWallet } from '../contracts/JettonWallet';\nimport { hexToBytes } from '../../../common/utils';\nimport { getEnvironment } from '../../../environment';\nimport { DEFAULT_IS_BOUNCEABLE, JettonOpCode, LiquidStakingOpCode, OpCode } from '../constants';\nimport { generateQueryId } from './index';\n\nimport { TonClient } from './TonClient';\n\ntype TonWalletType = typeof WalletContractV1R1\n  | typeof WalletContractV1R2\n  | typeof WalletContractV1R3\n  | typeof WalletContractV2R1\n  | typeof WalletContractV2R2\n  | typeof WalletContractV3R1\n  | typeof WalletContractV3R2\n  | typeof WalletContractV4\n  | typeof WalletContractV5R1;\n\nexport type TonWallet = WalletContractV1R1\n  | WalletContractV1R2\n  | WalletContractV1R3\n  | WalletContractV2R1\n  | WalletContractV2R2\n  | WalletContractV3R1\n  | WalletContractV3R2\n  | WalletContractV4\n  | WalletContractV5R1;\n\nconst TON_MAX_COMMENT_BYTES = 127;\n\nlet clientByNetwork: Record<ApiNetwork, TonClient> | undefined;\n\nexport const walletClassMap: Record<ApiTonWalletVersion, TonWalletType> = {\n  simpleR1: WalletContractV1R1,\n  simpleR2: WalletContractV1R2,\n  simpleR3: WalletContractV1R3,\n  v2R1: WalletContractV2R1,\n  v2R2: WalletContractV2R2,\n  v3R1: WalletContractV3R1,\n  v3R2: WalletContractV3R2,\n  v4R2: WalletContractV4,\n  W5: WalletContractV5R1,\n};\n\nexport function getTonClient(network: ApiNetwork = 'mainnet') {\n  if (!clientByNetwork) {\n    const { apiHeaders, toncenterMainnetKey, toncenterTestnetKey } = getEnvironment();\n\n    clientByNetwork = {\n      mainnet: new TonClient({\n        endpoint: `${TONCENTER_MAINNET_URL}/api/v2/jsonRPC`,\n        timeout: DEFAULT_TIMEOUT,\n        apiKey: toncenterMainnetKey,\n        headers: apiHeaders,\n      }),\n      testnet: new TonClient({\n        endpoint: `${TONCENTER_TESTNET_URL}/api/v2/jsonRPC`,\n        timeout: DEFAULT_TIMEOUT,\n        apiKey: toncenterTestnetKey,\n        headers: apiHeaders,\n      }),\n    };\n  }\n\n  return clientByNetwork[network];\n}\n\nexport const resolveTokenWalletAddress = withCacheAsync(\n  async (network: ApiNetwork, address: string, tokenAddress: string) => {\n    const minter = getTonClient(network).open(new JettonMinter(Address.parse(tokenAddress)));\n    const walletAddress = await minter.getWalletAddress(Address.parse(address));\n    return toBase64Address(walletAddress, true, network);\n  },\n);\n\nexport const resolveTokenAddress = withCacheAsync(async (network: ApiNetwork, tokenWalletAddress: string) => {\n  const tokenWallet = getTonClient(network).open(new JettonWallet(Address.parse(tokenWalletAddress)));\n  const data = await tokenWallet.getWalletData();\n  return toBase64Address(data.minter, true, network);\n});\n\nexport const getWalletPublicKey = withCacheAsync(async (network: ApiNetwork, address: string) => {\n  const res = await getTonClient(network).runMethodWithError(Address.parse(address), 'get_public_key');\n  if (res.exit_code !== 0) {\n    return undefined;\n  }\n\n  const bigintKey = res.stack.readBigNumber();\n  const hex = bigintKey.toString(16).padStart(64, '0');\n  return hexToBytes(hex);\n});\n\nexport const getJettonPoolStakeWallet = withCacheAsync(async (\n  network: ApiNetwork,\n  poolAddress: string,\n  period: number,\n  address: string,\n): Promise<OpenedContract<StakeWallet>> => {\n  const tonClient = getTonClient(network);\n  const pool = tonClient.open(StakingPool.createFromAddress(Address.parse(poolAddress)));\n  const walletAddress = (await pool.getWalletAddress(Address.parse(address), period))!;\n  return tonClient.open(StakeWallet.createFromAddress(walletAddress));\n});\n\nexport function getJettonMinterData(network: ApiNetwork, address: string) {\n  const contract = getTonClient(network).open(new JettonMinter(Address.parse(address)));\n  return contract.getJettonData();\n}\n\nexport function oneCellFromBoc(bytes: Uint8Array) {\n  return Cell.fromBoc(Buffer.from(bytes));\n}\n\nexport function toBase64Address(address: Address | string, isBounceable = DEFAULT_IS_BOUNCEABLE, network?: ApiNetwork) {\n  if (typeof address === 'string') {\n    address = Address.parse(address);\n  }\n  return address.toString({\n    urlSafe: true,\n    bounceable: isBounceable,\n    testOnly: network === 'testnet',\n  });\n}\n\nexport function toRawAddress(address: Address | string) {\n  if (typeof address === 'string') {\n    address = Address.parse(address);\n  }\n  return address.toRawString();\n}\n\nexport function buildTokenTransferBody(params: TokenTransferBodyParams) {\n  const {\n    queryId,\n    tokenAmount,\n    toAddress,\n    responseAddress,\n    forwardAmount,\n    customPayload,\n  } = params;\n  let forwardPayload = params.forwardPayload;\n\n  let builder = new Builder()\n    .storeUint(JettonOpCode.Transfer, 32)\n    .storeUint(queryId || generateQueryId(), 64)\n    .storeCoins(tokenAmount)\n    .storeAddress(Address.parse(toAddress))\n    .storeAddress(Address.parse(responseAddress))\n    .storeMaybeRef(customPayload)\n    .storeCoins(forwardAmount ?? 0n);\n\n  if (forwardPayload instanceof Uint8Array) {\n    const freeBytes = Math.round(builder.availableBits / 8);\n    forwardPayload = packBytesAsSnake(forwardPayload, freeBytes);\n  }\n\n  if (!forwardPayload) {\n    builder.storeBit(false);\n  } else if (typeof forwardPayload === 'string') {\n    builder = builder.storeBit(false)\n      .storeUint(0, 32)\n      .storeBuffer(Buffer.from(forwardPayload));\n  } else if (forwardPayload instanceof Uint8Array) {\n    builder = builder.storeBit(false)\n      .storeBuffer(Buffer.from(forwardPayload));\n  } else {\n    builder = builder.storeBit(true)\n      .storeRef(forwardPayload);\n  }\n\n  return builder.endCell();\n}\n\nexport function parseBase64(base64: string) {\n  try {\n    return Cell.fromBase64(base64);\n  } catch (err) {\n    logDebugError('parseBase64', err);\n    return Uint8Array.from(Buffer.from(base64, 'base64'));\n  }\n}\n\nexport function commentToBytes(comment: string): Uint8Array {\n  const buffer = Buffer.from(comment);\n  const bytes = new Uint8Array(buffer.length + 4);\n\n  const startBuffer = Buffer.alloc(4);\n  startBuffer.writeUInt32BE(OpCode.Comment);\n  bytes.set(startBuffer, 0);\n  bytes.set(buffer, 4);\n\n  return bytes;\n}\n\nexport function packBytesAsSnake(bytes: Uint8Array, maxBytes = TON_MAX_COMMENT_BYTES): Uint8Array | Cell {\n  const buffer = Buffer.from(bytes);\n  if (buffer.length <= maxBytes) {\n    return bytes;\n  }\n\n  return packBytesAsSnakeCell(bytes);\n}\n\nexport function packBytesAsSnakeCell(bytes: Uint8Array): Cell {\n  const bytesPerCell = TON_MAX_COMMENT_BYTES;\n  const cellCount = Math.ceil(bytes.length / bytesPerCell);\n  let headCell: Cell | undefined;\n\n  for (let i = cellCount - 1; i >= 0; i--) {\n    const cellOffset = i * bytesPerCell;\n    const cellLength = Math.min(bytesPerCell, bytes.length - cellOffset);\n    const cellBuffer = Buffer.from(bytes.buffer, bytes.byteOffset + cellOffset, cellLength); // This creates a buffer that references the input bytes instead of copying them\n\n    const nextHeadCell = new Builder().storeBuffer(cellBuffer);\n    if (headCell) {\n      nextHeadCell.storeRef(headCell);\n    }\n    headCell = nextHeadCell.endCell();\n  }\n\n  return headCell ?? Cell.EMPTY;\n}\n\nexport function packBytesAsSnakeForEncryptedData(data: Uint8Array): Uint8Array | Cell {\n  const ROOT_BUILDER_BYTES = 39;\n  const MAX_CELLS_AMOUNT = 16;\n\n  if (data.length > ROOT_BUILDER_BYTES + MAX_CELLS_AMOUNT * TON_MAX_COMMENT_BYTES) {\n    throw new Error('Input text is too long');\n  }\n\n  return new Builder()\n    .storeBuffer(Buffer.from(data.subarray(0, ROOT_BUILDER_BYTES)))\n    .storeRef(packBytesAsSnakeCell(data.subarray(ROOT_BUILDER_BYTES)))\n    .endCell();\n}\n\nexport function buildLiquidStakingDepositBody(queryId?: number) {\n  return new Builder()\n    .storeUint(LiquidStakingOpCode.Deposit, 32)\n    .storeUint(queryId || 0, 64)\n    .asCell();\n}\n\nexport function buildLiquidStakingWithdrawBody(options: {\n  queryId?: number;\n  amount: bigint;\n  responseAddress: string;\n  waitTillRoundEnd?: boolean; // opposite of request_immediate_withdrawal\n  fillOrKill?: boolean;\n}) {\n  const {\n    queryId, amount, responseAddress, waitTillRoundEnd, fillOrKill,\n  } = options;\n\n  const customPayload = buildLiquidStakingWithdrawCustomPayload(waitTillRoundEnd, fillOrKill);\n\n  return new Builder()\n    .storeUint(JettonOpCode.Burn, 32)\n    .storeUint(queryId ?? 0, 64)\n    .storeCoins(amount)\n    .storeAddress(Address.parse(responseAddress))\n    .storeBit(1)\n    .storeRef(customPayload)\n    .asCell();\n}\n\nexport function buildLiquidStakingWithdrawCustomPayload(waitTillRoundEnd?: boolean, fillOrKill?: boolean) {\n  return new Builder()\n    .storeUint(Number(waitTillRoundEnd), 1)\n    .storeUint(Number(fillOrKill), 1)\n    .asCell();\n}\n\nexport function getTokenBalance(network: ApiNetwork, walletAddress: string) {\n  const tokenWallet = getTonClient(network).open(new JettonWallet(Address.parse(walletAddress)));\n  return tokenWallet.getJettonBalance();\n}\n\nexport function parseAddress(address: string): {\n  isValid: boolean;\n  isRaw?: boolean;\n  isUserFriendly?: boolean;\n  isBounceable?: boolean;\n  isTestOnly?: boolean;\n  address?: Address;\n} {\n  try {\n    if (Address.isRaw(address)) {\n      return {\n        address: Address.parseRaw(address),\n        isRaw: true,\n        isValid: true,\n      };\n    } else if (Address.isFriendly(address)) {\n      return {\n        ...Address.parseFriendly(address),\n        isUserFriendly: true,\n        isValid: true,\n      };\n    }\n  } catch (err) {\n    // Do nothing\n  }\n\n  return { isValid: false };\n}\n\nexport function getIsRawAddress(address: string) {\n  return Boolean(parseAddress(address).isRaw);\n}\n\nexport async function getDnsItemDomain(network: ApiNetwork, address: Address | string) {\n  if (typeof address === 'string') address = Address.parse(address);\n\n  const contract = getTonClient(network)\n    .open(new DnsItem(address));\n  const nftData = await contract.getNftData();\n  const collectionAddress = toBase64Address(nftData.collectionAddress, true);\n\n  const zone = getDnsZoneByCollection(collectionAddress);\n\n  const base = zone?.isTelemint\n    ? await contract.getTelemintDomain()\n    : await contract.getDomain();\n\n  return `${base}.${zone?.suffixes[0]}`;\n}\n\nexport function buildJettonUnstakePayload(jettonsToUnstake: bigint, forceUnstake?: boolean, queryId?: bigint) {\n  return beginCell()\n    .storeUint(JettonStakingOpCodes.UNSTAKE_JETTONS, 32)\n    .storeUint(queryId ?? 0, 64)\n    .storeCoins(jettonsToUnstake)\n    .storeBit(forceUnstake ?? false)\n    .endCell();\n}\n\nexport function buildJettonClaimPayload(poolWallets: string[], queryId?: bigint) {\n  const rewardsToClaim = Dictionary.empty(Dictionary.Keys.Address(), Dictionary.Values.Bool());\n\n  for (const poolWallet of poolWallets) {\n    rewardsToClaim.set(Address.parse(poolWallet), true);\n  }\n\n  return beginCell()\n    .storeUint(JettonStakingOpCodes.CLAIM_REWARDS, 32)\n    .storeUint(queryId ?? 0, 64)\n    .storeDict(rewardsToClaim, Dictionary.Keys.Address(), Dictionary.Values.Bool())\n    .endCell();\n}\n\n// eslint-disable-next-line @typescript-eslint/no-redundant-type-constituents\nexport function unpackDicts(obj: Record<string, any | Dictionary<any, any>>): AnyLiteral {\n  if (!isSimpleObject(obj)) {\n    return obj;\n  }\n\n  return mapValues(obj, (value) => {\n    if (value instanceof Dictionary) {\n      return unpackDicts(fromKeyValueArrays(value.keys(), value.values()));\n    }\n    if (isSimpleObject(value)) {\n      return unpackDicts(value);\n    }\n    return value;\n  });\n}\n\nfunction isSimpleObject(obj: any) {\n  // eslint-disable-next-line no-null/no-null\n  return obj !== null\n    && typeof obj === 'object'\n    && Object.getPrototypeOf(obj) === Object.prototype;\n}\n\nexport function getOurFeePayload() {\n  return new Builder()\n    .storeUint(OpCode.OurFee, 32)\n    .endCell();\n}\n","export enum StorageType {\n  IndexedDb,\n  LocalStorage,\n  ExtensionLocal,\n  CapacitorStorage,\n}\n\nexport interface Storage {\n  getItem(name: StorageKey, force?: boolean): Promise<any>;\n\n  setItem(name: StorageKey, value: any): Promise<void>;\n\n  removeItem(name: StorageKey): Promise<void>;\n\n  clear(): Promise<void>;\n\n  getAll?(): Promise<AnyLiteral>;\n\n  setMany?(items: AnyLiteral): Promise<void>;\n\n  getMany?(keys: string[]): Promise<AnyLiteral>;\n}\n\nexport type StorageKey = 'accounts'\n  | 'stateVersion'\n  | 'currentAccountId'\n  | 'clientId'\n  | 'baseCurrency'\n  | 'referrer'\n  // For extension\n  | 'dapps'\n  | 'dappMethods:lastAccountId'\n  | 'windowId'\n  | 'windowState'\n  | 'isTonMagicEnabled'\n  | 'isTonProxyEnabled'\n  | 'isDeeplinkHookEnabled'\n  // For TonConnect SSE\n  | 'sseLastEventId';\n","import type { Connector } from '../PostMessageConnector';\nimport type { WindowMethodArgs, WindowMethodResponse, WindowMethods } from './types';\n\nimport { WINDOW_PROVIDER_CHANNEL, WINDOW_PROVIDER_PORT } from '../../config';\n\nimport { createReverseExtensionConnector } from '../PostMessageConnector';\nimport { createConnector } from '../PostMessageConnector';\n\nlet connector: Connector;\n\nexport function initWindowConnector() {\n  if (!connector) {\n    // We use process.env.IS_EXTENSION instead of IS_EXTENSION in order to remove the irrelevant code during bundling\n    if (process.env.IS_EXTENSION) {\n      connector = createReverseExtensionConnector(WINDOW_PROVIDER_PORT);\n      // connector.init() is not called here because the extension connector is available only when the popup is open\n    } else {\n      connector = createConnector(self as DedicatedWorkerGlobalScope, undefined, WINDOW_PROVIDER_CHANNEL);\n      connector.init();\n    }\n  }\n}\n\nexport function callWindow<T extends keyof WindowMethods>(methodName: T, ...args: WindowMethodArgs<T>) {\n  if (!connector) {\n    throw new Error('API is not initialized');\n  }\n\n  return connector.request({ name: methodName, args }) as EnsurePromise<WindowMethodResponse<T>>;\n}\n","export default function generateUniqueId() {\n  return Date.now().toString(36) + Math.random().toString(36).slice(2);\n}\n","import { decodeExtensionMessage, encodeExtensionMessage } from './extensionMessageSerializer';\nimport generateUniqueId from './generateUniqueId';\nimport { logDebugError } from './logs';\n\nexport interface CancellableCallback {\n  (\n    ...args: any[]\n  ): void;\n\n  isCanceled?: boolean;\n  acceptsBuffer?: boolean;\n}\n\ntype InitData = {\n  channel?: string;\n  type: 'init';\n  args: any[];\n};\n\ntype CallMethodData = {\n  channel?: string;\n  type: 'callMethod';\n  messageId?: string;\n  name: string;\n  args: any;\n  withCallback?: boolean;\n};\n\nexport type OriginMessageData = InitData | CallMethodData | {\n  channel?: string;\n  type: 'cancelProgress';\n  messageId: string;\n};\n\nexport interface OriginMessageEvent extends MessageEvent {\n  data: OriginMessageData;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-redundant-type-constituents\nexport type ApiUpdate = { type: string } & any;\n\nexport type WorkerMessageData = {\n  channel?: string;\n  type: 'update';\n  update: ApiUpdate;\n} | {\n  channel?: string;\n  type: 'methodResponse';\n  messageId: string;\n  response?: any;\n  error?: { message: string };\n} | {\n  channel?: string;\n  type: 'methodCallback';\n  messageId: string;\n  callbackArgs: any[];\n} | {\n  channel?: string;\n  type: 'unhandledError';\n  error?: { message: string; stack?: string };\n};\n\nexport interface WorkerMessageEvent {\n  data: WorkerMessageData;\n}\n\ninterface RequestStates {\n  messageId: string;\n  resolve: AnyToVoidFunction;\n  reject: AnyToVoidFunction;\n  callback: AnyToVoidFunction;\n}\n\ntype InputRequestTypes = Record<string, AnyFunction>;\n\ntype Values<T> = T[keyof T];\nexport type RequestTypes<T extends InputRequestTypes> = Values<{\n  [Name in keyof (T)]: {\n    name: Name & string;\n    args: Parameters<T[Name]>;\n  }\n}>;\n\nclass ConnectorClass<T extends InputRequestTypes> {\n  private requestStates = new Map<string, RequestStates>();\n\n  private requestStatesByCallback = new Map<AnyToVoidFunction, RequestStates>();\n\n  constructor(\n    public target: Worker | Window | chrome.runtime.Port | DedicatedWorkerGlobalScope,\n    private onUpdate?: (update: ApiUpdate) => void,\n    private channel?: string,\n    private shouldUseJson?: boolean,\n    private targetOrigin = '*',\n  ) {\n  }\n\n  public destroy() {\n  }\n\n  init(...args: any[]) {\n    this.postMessage({\n      type: 'init',\n      args,\n    });\n  }\n\n  request(messageData: RequestTypes<T>) {\n    const { requestStates, requestStatesByCallback } = this;\n\n    const messageId = generateUniqueId();\n    const payload: CallMethodData = {\n      type: 'callMethod',\n      messageId,\n      ...messageData,\n    };\n\n    const requestState = { messageId } as RequestStates;\n\n    // Re-wrap type because of `postMessage`\n    const promise = new Promise<any>((resolve, reject) => {\n      Object.assign(requestState, { resolve, reject });\n    });\n\n    if (typeof payload.args[payload.args.length - 1] === 'function') {\n      payload.withCallback = true;\n\n      const callback = payload.args.pop() as AnyToVoidFunction;\n      requestState.callback = callback;\n      requestStatesByCallback.set(callback, requestState);\n    }\n\n    requestStates.set(messageId, requestState);\n    promise\n      .catch(() => undefined)\n      .finally(() => {\n        requestStates.delete(messageId);\n\n        if (requestState.callback) {\n          requestStatesByCallback.delete(requestState.callback);\n        }\n      });\n\n    this.postMessage(payload);\n\n    return promise;\n  }\n\n  cancelCallback(progressCallback: CancellableCallback) {\n    progressCallback.isCanceled = true;\n\n    const { messageId } = this.requestStatesByCallback.get(progressCallback) || {};\n    if (!messageId) {\n      return;\n    }\n\n    this.postMessage({\n      type: 'cancelProgress',\n      messageId,\n    });\n  }\n\n  onMessage(data: WorkerMessageData | string) {\n    try {\n      data = decodeExtensionMessage(data);\n    } catch (err: any) {\n      logDebugError('PostMessageConnector: Failed to parse message', err);\n      return;\n    }\n\n    const { requestStates, channel } = this;\n    if (data.channel !== channel) {\n      return;\n    }\n\n    if (data.type === 'update' && this.onUpdate) {\n      this.onUpdate(data.update);\n    }\n    if (data.type === 'methodResponse') {\n      const requestState = requestStates.get(data.messageId);\n      if (requestState) {\n        if (data.error) {\n          requestState.reject(data.error);\n        } else {\n          requestState.resolve(data.response);\n        }\n      }\n    } else if (data.type === 'methodCallback') {\n      const requestState = requestStates.get(data.messageId);\n      requestState?.callback?.(...data.callbackArgs);\n    } else if (data.type === 'unhandledError') {\n      const error = new Error(data.error?.message);\n      if (data.error?.stack) {\n        error.stack = data.error.stack;\n      }\n      throw error;\n    }\n  }\n\n  private postMessage(data: OriginMessageData) {\n    data.channel = this.channel;\n\n    let rawData: OriginMessageData | string = data;\n    if (this.shouldUseJson) {\n      rawData = encodeExtensionMessage(data);\n    }\n\n    if ('open' in this.target) { // Is Window\n      this.target.postMessage(rawData, this.targetOrigin);\n    } else {\n      this.target.postMessage(rawData);\n    }\n  }\n}\n\n/**\n * Allows to call functions, provided by another messenger (a window, a worker), in this messenger.\n * The other messenger must provide the functions using `createPostMessageInterface`.\n */\nexport function createConnector<T extends InputRequestTypes>(\n  worker: Worker | Window | DedicatedWorkerGlobalScope,\n  onUpdate?: (update: ApiUpdate) => void,\n  channel?: string,\n  targetOrigin?: string,\n) {\n  const connector = new ConnectorClass<T>(worker, onUpdate, channel, undefined, targetOrigin);\n\n  function handleMessage({ data }: WorkerMessageEvent | MessageEvent) {\n    connector.onMessage(data);\n  }\n\n  worker.addEventListener('message', handleMessage as any); // TS weirdly complains here\n\n  connector.destroy = () => {\n    worker.removeEventListener('message', handleMessage as any);\n  };\n\n  return connector;\n}\n\n/**\n * Allows to call functions, provided by the extension service worker, in this window.\n * The service worker must provide the functions using `createExtensionInterface`.\n */\nexport function createExtensionConnector(\n  name: string,\n  onUpdate?: (update: ApiUpdate) => void,\n  getInitArgs?: () => any,\n  channel?: string,\n) {\n  const connector = new ConnectorClass(connect(), onUpdate, channel, true);\n\n  function connect() {\n    const port = self.chrome.runtime.connect({ name });\n\n    port.onMessage.addListener((data: string | WorkerMessageData) => {\n      connector.onMessage(data);\n    });\n\n    // For some reason port can suddenly get disconnected\n    port.onDisconnect.addListener(() => {\n      connector.target = connect();\n      connector.init(getInitArgs?.());\n    });\n\n    return port;\n  }\n\n  connector.init(getInitArgs?.());\n\n  return connector;\n}\n\n/**\n * Allows to call functions, provided by a window, in this service worker.\n * The window must provide the functions using `createReverseExtensionInterface`.\n *\n * Warning: the connector is able to send messages only when the popup window is open.\n */\nexport function createReverseExtensionConnector(portName: string) {\n  const nullWorker = {\n    postMessage() {\n      throw new Error('The popup window is not connected');\n    },\n  } as Pick<Worker, 'postMessage'> as Worker;\n\n  const connector = new ConnectorClass(nullWorker, undefined, undefined, true);\n\n  chrome.runtime.onConnect.addListener((port) => {\n    if (port.name !== portName) {\n      return;\n    }\n\n    connector.target = port;\n\n    port.onMessage.addListener((data: string | WorkerMessageData) => {\n      connector.onMessage(data);\n    });\n\n    port.onDisconnect.addListener(() => {\n      connector.target = nullWorker;\n    });\n  });\n\n  return connector;\n}\n\nexport type Connector<T extends InputRequestTypes = InputRequestTypes> = ReturnType<typeof createConnector<T>>;\n","import type { Storage, StorageKey } from './types';\n\nimport { bigintReviver } from '../../util/bigint';\nimport { callWindow } from '../../util/windowProvider/connector';\nimport { getEnvironment } from '../environment';\n\nlet cache: AnyLiteral = {};\n\nconst storage: Storage & {\n  getKeys: () => Promise<string[] | undefined>;\n} = {\n  async getItem(key: StorageKey, force?: boolean) {\n    if (getEnvironment().isAndroidApp && key in cache && !force) {\n      return cache[key];\n    }\n\n    const result = await callWindow('capacitorStorageGetItem', key);\n    const value = result ? JSON.parse(result, bigintReviver) : undefined;\n\n    if (getEnvironment().isAndroidApp) {\n      if (value === undefined) {\n        delete cache[key];\n      } else {\n        cache[key] = value;\n      }\n    }\n\n    return value;\n  },\n\n  async setItem(key: StorageKey, value: any) {\n    await callWindow('capacitorStorageSetItem', key, JSON.stringify(value));\n\n    if (getEnvironment().isAndroidApp) {\n      cache[key] = value;\n    }\n  },\n\n  async removeItem(key: StorageKey) {\n    await callWindow('capacitorStorageRemoveItem', key);\n\n    if (getEnvironment().isAndroidApp) {\n      delete cache[key];\n    }\n  },\n\n  async clear() {\n    await callWindow('capacitorStorageClear');\n\n    if (getEnvironment().isAndroidApp) {\n      cache = {};\n    }\n  },\n\n  async getKeys() {\n    const result = await callWindow('capacitorStorageKeys');\n\n    return result?.value;\n  },\n};\n\nexport default storage;\n","import type { Storage } from './types';\n\nimport { IS_EXTENSION } from '../../config';\n\nconst storage = IS_EXTENSION ? self.chrome.storage.local : undefined;\n\nexport default ((storage && {\n  getItem: async (key) => (await storage.get(key))?.[key],\n  setItem: (key, value) => storage.set({ [key]: value }),\n  removeItem: storage.remove.bind(storage),\n  clear: storage.clear.bind(storage),\n  getAll: storage.get.bind(storage),\n  setMany: storage.set.bind(storage),\n  getMany: storage.get.bind(storage),\n}) || {}) as Storage;\n","import * as idb from 'idb-keyval';\n\nimport type { Storage, StorageKey } from './types';\n\nimport { INDEXED_DB_NAME, INDEXED_DB_STORE_NAME } from '../../config';\nimport { fromKeyValueArrays } from '../../util/iteratees';\n\nconst store = idb.createStore(INDEXED_DB_NAME, INDEXED_DB_STORE_NAME);\n\nexport default {\n  getItem: (name: StorageKey) => idb.get(name, store),\n  setItem: (name: StorageKey, value: any) => idb.set(name, value, store),\n  removeItem: (name: StorageKey) => idb.del(name, store),\n  clear: () => idb.clear(store),\n  getAll: async () => {\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n    const keys = (await idb.keys(store)) as string[];\n    const values = await idb.getMany(keys, store);\n    return fromKeyValueArrays(keys, values);\n  },\n  getMany: async (keys) => {\n    const values = await idb.getMany(keys, store);\n    return fromKeyValueArrays(keys, values);\n  },\n  setMany: (items) => {\n    return idb.setMany(Object.entries(items), store);\n  },\n} as Storage;\n","import type { Storage, StorageKey } from './types';\n\nimport { pick } from '../../util/iteratees';\nimport { callWindow } from '../../util/windowProvider/connector';\n\nfunction withPromise(fn: AnyFunction) {\n  return (...args: any) => Promise.resolve(fn(...args));\n}\n\nconst storage: Storage = (typeof localStorage === 'object' ? {\n  getItem: withPromise(localStorage.getItem),\n  setItem: withPromise(localStorage.setItem),\n  removeItem: withPromise(localStorage.removeItem),\n  clear: withPromise(localStorage.clear),\n  getAll: withPromise(() => ({ ...localStorage })),\n  getMany: withPromise((keys: string[]) => pick(localStorage, keys)),\n  setMany: withPromise((items: AnyLiteral) => {\n    Object.assign(localStorage, items);\n  }),\n} : {\n  getItem(key: StorageKey) {\n    return callWindow('localStorageGetItem', key);\n  },\n  setItem(key: StorageKey, value: any) {\n    return callWindow('localStorageSetItem', key, value);\n  },\n  removeItem(key: StorageKey) {\n    return callWindow('localStorageRemoveItem', key);\n  },\n  clear() {\n    return callWindow('localStorageClear');\n  },\n  getAll() {\n    return callWindow('localStorageGetAll');\n  },\n  getMany(keys: StorageKey[]) {\n    return callWindow('localStorageGetMany', keys);\n  },\n  setMany(items: AnyLiteral) {\n    return callWindow('localStorageSetMany', items);\n  },\n});\n\nexport default storage;\n","import { StorageType } from './types';\n\nimport { IS_CAPACITOR, IS_EXTENSION } from '../../config';\nimport capacitorStorage from './capacitorStorage';\nimport extensionStorage from './extension';\nimport idb from './idb';\nimport localStorage from './localStorage';\n\nexport const storage = IS_EXTENSION ? extensionStorage : IS_CAPACITOR ? capacitorStorage : idb;\n\nexport default {\n  [StorageType.IndexedDb]: idb,\n  [StorageType.LocalStorage]: localStorage,\n  [StorageType.ExtensionLocal]: extensionStorage,\n  [StorageType.CapacitorStorage]: capacitorStorage,\n};\n","import type { StorageKey } from '../storages/types';\nimport type {\n  ApiAccountAny,\n  ApiAccountWithMnemonic,\n  ApiAccountWithTon,\n  ApiAccountWithTron,\n  ApiBip39Account,\n  ApiChain,\n  ApiNetwork,\n  ApiTonWallet,\n  ApiTronWallet,\n} from '../types';\n\nimport { buildAccountId, parseAccountId } from '../../util/account';\nimport { storage } from '../storages';\n\nconst MIN_ACCOUNT_NUMBER = 0;\n\nexport let loginResolve: AnyFunction;\nconst loginPromise = new Promise<void>((resolve) => {\n  loginResolve = resolve;\n});\n\nexport async function getAccountIds(): Promise<string[]> {\n  return Object.keys(await storage.getItem('accounts') || {});\n}\n\nexport async function getAccountWithMnemonic() {\n  const byId = await fetchStoredAccounts();\n\n  return Object.entries(byId)\n    .find(([, { type }]) => type !== 'ledger' && type !== 'view') as [string, ApiAccountWithMnemonic] | undefined;\n}\n\nexport async function getNewAccountId(network: ApiNetwork, preferredId?: number) {\n  const ids = (await getAccountIds()).map((accountId) => parseAccountId(accountId).id);\n  const id = preferredId !== undefined && !ids.includes(preferredId)\n    ? preferredId\n    : ids.length === 0 ? MIN_ACCOUNT_NUMBER : Math.max(...ids) + 1;\n  return buildAccountId({ id, network });\n}\n\nexport async function fetchStoredAddress(accountId: string, chain: ApiChain): Promise<string> {\n  return (await fetchStoredAccount<ApiBip39Account>(accountId))[chain].address;\n}\n\nexport async function fetchStoredTonWallet(accountId: string): Promise<ApiTonWallet> {\n  return (await fetchStoredTonAccount(accountId)).ton;\n}\n\nexport async function fetchStoredTronWallet(accountId: string): Promise<ApiTronWallet> {\n  return (await fetchStoredTronAccount(accountId)).tron;\n}\n\nexport function fetchMaybeStoredAccount<T extends ApiAccountAny>(accountId: string): Promise<T | undefined> {\n  return getAccountValue(accountId, 'accounts');\n}\n\nexport async function fetchStoredAccount<T extends ApiAccountAny>(accountId: string): Promise<T> {\n  const account = await fetchMaybeStoredAccount<T>(accountId);\n  if (account) return account;\n  throw new Error(`Account ${accountId} doesn't exist`);\n}\n\nexport async function fetchStoredTonAccount<T extends ApiAccountWithTon>(accountId: string): Promise<T> {\n  const account = await fetchStoredAccount(accountId);\n  if (account.ton) return account as T;\n  throw new Error('TON wallet missing');\n}\n\nexport async function fetchStoredTronAccount<T extends ApiAccountWithTron>(accountId: string): Promise<T> {\n  const account = await fetchStoredAccount(accountId);\n  if ((account as ApiAccountWithTron).tron) return account as T;\n  throw new Error('TRON wallet missing');\n}\n\nexport function fetchStoredAccounts(): Promise<Record<string, ApiAccountAny>> {\n  return storage.getItem('accounts');\n}\n\nexport async function updateStoredAccount<T extends ApiAccountAny>(\n  accountId: string,\n  partial: Partial<T>,\n): Promise<void> {\n  const account = await fetchStoredAccount<T>(accountId);\n  return setAccountValue(accountId, 'accounts', {\n    ...account,\n    ...partial,\n  });\n}\n\nexport async function updateStoredTonWallet(accountId: string, partial: Partial<ApiTonWallet>): Promise<void> {\n  const tonWallet = await fetchStoredTonWallet(accountId);\n  return updateStoredAccount(accountId, {\n    ton: {\n      ...tonWallet,\n      ...partial,\n    },\n  });\n}\n\nexport async function getAccountValue(accountId: string, key: StorageKey) {\n  return (await storage.getItem(key))?.[accountId];\n}\n\nexport async function removeAccountValue(accountId: string, key: StorageKey) {\n  const data = await storage.getItem(key);\n  if (!data) return;\n\n  const { [accountId]: removedValue, ...restData } = data;\n  await storage.setItem(key, restData);\n}\n\nexport async function setAccountValue(accountId: string, key: StorageKey, value: any) {\n  const data = await storage.getItem(key);\n  await storage.setItem(key, { ...data, [accountId]: value });\n}\n\nexport async function removeNetworkAccountsValue(network: string, key: StorageKey) {\n  const data = await storage.getItem(key);\n  if (!data) return;\n\n  for (const accountId of Object.keys(data)) {\n    if (parseAccountId(accountId).network === network) {\n      delete data[accountId];\n    }\n  }\n\n  await storage.setItem(key, data);\n}\n\nexport async function getCurrentNetwork() {\n  const accountId = await getCurrentAccountId();\n  if (!accountId) return undefined;\n  return parseAccountId(accountId).network;\n}\n\nexport async function getCurrentAccountIdOrFail() {\n  const accountId = await getCurrentAccountId();\n  if (!accountId) {\n    throw new Error('The user is not authorized in the wallet');\n  }\n  return accountId;\n}\n\nexport function getCurrentAccountId(): Promise<string | undefined> {\n  return storage.getItem('currentAccountId');\n}\n\nexport function waitLogin() {\n  return loginPromise;\n}\n\nexport function getAddressesFromAccount(account: ApiAccountAny) {\n  const addressByChain: Partial<Record<ApiChain, string>> = {};\n\n  if ('ton' in account && account.ton) addressByChain.ton = account.ton.address;\n  if ('tron' in account && account.tron) addressByChain.tron = account.tron.address;\n\n  return addressByChain;\n}\n","import * as bip39 from 'bip39';\n\nimport { type ApiAccountWithMnemonic, ApiCommonError } from '../types';\n\nimport { logDebugError } from '../../util/logs';\nimport { updateStoredAccount } from './accounts';\n\nconst PBKDF2_IMPORT_KEY_ARGS = [\n  { name: 'PBKDF2' },\n  false,\n  ['deriveBits', 'deriveKey'],\n] as const;\n\nconst PBKDF2_DERIVE_KEY_ARGS = {\n  name: 'PBKDF2',\n  iterations: 100000, // Higher is more secure but slower\n  hash: 'SHA-256',\n};\n\nconst PBKDF2_DERIVE_KEY_TYPE = { name: 'AES-GCM', length: 256 };\n\nexport function generateBip39Mnemonic() {\n  return bip39.generateMnemonic(256).split(' ');\n}\n\nexport function validateBip39Mnemonic(mnemonic: string[]) {\n  return bip39.validateMnemonic(mnemonic.join(' '));\n}\n\nexport async function tryMigratingMnemonicEncryption(accountId: string, mnemonic: string[], password: string) {\n  const sensitiveData = [password, ...mnemonic];\n\n  try {\n    const mnemonicEncrypted = await encryptMnemonic(mnemonic, password);\n    sensitiveData.push(mnemonicEncrypted);\n\n    // This is a defensive approach against potential corrupted encryption reported by some users\n    const decryptedMnemonic = await decryptMnemonic(mnemonicEncrypted, password)\n      .catch(() => undefined);\n\n    if (!password || !decryptedMnemonic) {\n      return { error: ApiCommonError.DebugError };\n    }\n\n    await updateStoredAccount<ApiAccountWithMnemonic>(accountId, { mnemonicEncrypted });\n  } catch (err) {\n    logDebugError('tryMigratingMnemonicEncryption', removeSensitiveDataFromError(err, sensitiveData));\n  }\n\n  return undefined;\n}\n\nexport async function encryptMnemonic(mnemonic: string[], password: string) {\n  const plaintext = mnemonic.join(',');\n  const salt = crypto.getRandomValues(new Uint8Array(16)); // generate a 128-bit salt\n  const keyMaterial = await crypto.subtle.importKey(\n    'raw',\n    new TextEncoder().encode(password),\n    ...PBKDF2_IMPORT_KEY_ARGS,\n  );\n  const key = await crypto.subtle.deriveKey(\n    {\n      salt,\n      ...PBKDF2_DERIVE_KEY_ARGS,\n    },\n    keyMaterial,\n    PBKDF2_DERIVE_KEY_TYPE,\n    false,\n    ['encrypt'],\n  );\n  const iv = crypto.getRandomValues(new Uint8Array(12)); // get 96-bit random iv\n  const ptUint8 = new TextEncoder().encode(plaintext); // encode plaintext as UTF-8\n  const ctBuffer = await crypto.subtle.encrypt({ name: 'AES-GCM', iv }, key, ptUint8); // encrypt plaintext using key\n  const ctArray = Array.from(new Uint8Array(ctBuffer)); // ciphertext as byte array\n  const ctBase64 = btoa(String.fromCharCode(...ctArray)); // encode ciphertext as base64\n  const ivHex = Array.from(iv).map((b) => (`00${b.toString(16)}`).slice(-2)).join(''); // iv as hex string\n  const saltHex = Array.from(salt).map((b) => (`00${b.toString(16)}`).slice(-2)).join(''); // salt as hex string\n\n  return `${saltHex}:${ivHex}:${ctBase64}`;\n}\n\nexport async function decryptMnemonic(encrypted: string, password: string) {\n  if (!encrypted.includes(':')) {\n    return decryptMnemonicLegacy(encrypted, password);\n  }\n\n  const [saltHex, ivHex, encryptedData] = encrypted.split(':');\n  const salt = new Uint8Array(saltHex.match(/.{2}/g)!.map((b) => parseInt(b, 16)));\n  const iv = new Uint8Array(ivHex.match(/.{2}/g)!.map((b) => parseInt(b, 16)));\n  const keyMaterial = await crypto.subtle.importKey(\n    'raw',\n    new TextEncoder().encode(password),\n    ...PBKDF2_IMPORT_KEY_ARGS,\n  );\n  const key = await crypto.subtle.deriveKey(\n    { salt, ...PBKDF2_DERIVE_KEY_ARGS },\n    keyMaterial,\n    PBKDF2_DERIVE_KEY_TYPE,\n    false,\n    ['decrypt'],\n  );\n  const ctStr = atob(encryptedData); // decode base64 ciphertext\n  const ctUint8 = new Uint8Array(ctStr.match(/[\\s\\S]/g)!.map((ch) => ch.charCodeAt(0))); // ciphertext as Uint8Array\n  const plainBuffer = await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ctUint8); // decrypt ciphertext using key\n  const plaintext = new TextDecoder().decode(plainBuffer); // decode password from UTF-8\n\n  return plaintext.split(',');\n}\n\nasync function decryptMnemonicLegacy(encrypted: string, password: string) {\n  const pwUtf8 = new TextEncoder().encode(password); // encode password as UTF-8\n  const pwHash = await crypto.subtle.digest('SHA-256', pwUtf8); // hash the password\n  const iv = encrypted.slice(0, 24).match(/.{2}/g)!.map((byte) => parseInt(byte, 16)); // get iv from ciphertext\n  const alg = { name: 'AES-GCM', iv: new Uint8Array(iv) }; // specify algorithm to use\n  const key = await crypto.subtle.importKey('raw', pwHash, alg, false, ['decrypt']); // use pw to generate key\n  const ctStr = atob(encrypted.slice(24)); // decode base64 ciphertext\n  const ctUint8 = new Uint8Array(ctStr.match(/[\\s\\S]/g)!.map((ch) => ch.charCodeAt(0))); // ciphertext as Uint8Array\n  const plainBuffer = await crypto.subtle.decrypt(alg, key, ctUint8); // decrypt ciphertext using key\n  const plaintext = new TextDecoder().decode(plainBuffer); // decode password from UTF-8\n\n  return plaintext.split(',');\n}\n\nexport async function getMnemonic(accountId: string, password: string, account: ApiAccountWithMnemonic) {\n  const sensitiveData = [password];\n\n  try {\n    const { mnemonicEncrypted } = account;\n    sensitiveData.push(mnemonicEncrypted);\n\n    const mnemonic = await decryptMnemonic(mnemonicEncrypted, password);\n    sensitiveData.push(...mnemonic);\n\n    if (!mnemonicEncrypted.includes(':')) {\n      await tryMigratingMnemonicEncryption(accountId, mnemonic, password);\n    }\n\n    return mnemonic;\n  } catch (err) {\n    logDebugError('getMnemonic', removeSensitiveDataFromError(err, sensitiveData));\n\n    return undefined;\n  }\n}\n\nfunction removeSensitiveDataFromError(error: unknown, sensitiveData: string[]) {\n  const removeFromString = (text: string) => {\n    for (const toRemove of sensitiveData) {\n      text = text.replaceAll(toRemove, '(hidden)');\n    }\n    return text;\n  };\n\n  if (typeof error === 'string') {\n    return removeFromString(error);\n  }\n\n  if (error instanceof Error) {\n    const message = removeFromString(error.message);\n    return {\n      name: error.name,\n      message,\n      stack: error.stack?.replaceAll(error.message, message),\n    };\n  }\n\n  return error;\n}\n","/* eslint-disable @stylistic/max-len, no-misleading-character-class, no-control-regex, @stylistic/operator-linebreak */\n/** @copyright Mathias Bynens <https://mathiasbynens.be/>. MIT license. */\nconst RE_SYMBOL_WITH_COMBINING_MARKS =\n  /([\\0-\\u02FF\\u0370-\\u1AAF\\u1B00-\\u1DBF\\u1E00-\\u20CF\\u2100-\\uD7FF\\uE000-\\uFE1F\\uFE30-\\uFFFF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF])([\\u0300-\\u036F\\u1AB0-\\u1AFF\\u1DC0-\\u1DFF\\u20D0-\\u20FF\\uFE20-\\uFE2F]+)/g;\n/** @copyright Mathias Bynens <https://mathiasbynens.be/>. MIT license. */\nconst RE_LINEBREAK_COMBINING_MARKS =\n  /[\\0-\\x08\\x0E-\\x1F\\x7F-\\x84\\x86-\\x9F\\u0300-\\u034E\\u0350-\\u035B\\u0363-\\u036F\\u0483-\\u0489\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u0610-\\u061A\\u061C\\u064B-\\u065F\\u0670\\u06D6-\\u06DC\\u06DF-\\u06E4\\u06E7\\u06E8\\u06EA-\\u06ED\\u0711\\u0730-\\u074A\\u07A6-\\u07B0\\u07EB-\\u07F3\\u0816-\\u0819\\u081B-\\u0823\\u0825-\\u0827\\u0829-\\u082D\\u0859-\\u085B\\u08D4-\\u08E1\\u08E3-\\u0903\\u093A-\\u093C\\u093E-\\u094F\\u0951-\\u0957\\u0962\\u0963\\u0981-\\u0983\\u09BC\\u09BE-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CD\\u09D7\\u09E2\\u09E3\\u0A01-\\u0A03\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A70\\u0A71\\u0A75\\u0A81-\\u0A83\\u0ABC\\u0ABE-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AE2\\u0AE3\\u0B01-\\u0B03\\u0B3C\\u0B3E-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B62\\u0B63\\u0B82\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD7\\u0C00-\\u0C03\\u0C3E-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C62\\u0C63\\u0C81-\\u0C83\\u0CBC\\u0CBE-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CE2\\u0CE3\\u0D01-\\u0D03\\u0D3E-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4D\\u0D57\\u0D62\\u0D63\\u0D82\\u0D83\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DF2\\u0DF3\\u0F18\\u0F19\\u0F35\\u0F37\\u0F39\\u0F3E\\u0F3F\\u0F71-\\u0F7E\\u0F80-\\u0F84\\u0F86\\u0F87\\u0F8D-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u135D-\\u135F\\u1712-\\u1714\\u1732-\\u1734\\u1752\\u1753\\u1772\\u1773\\u180B-\\u180D\\u1885\\u1886\\u18A9\\u1920-\\u192B\\u1930-\\u193B\\u1A17-\\u1A1B\\u1A7F\\u1AB0-\\u1ABE\\u1B00-\\u1B04\\u1B34-\\u1B44\\u1B6B-\\u1B73\\u1B80-\\u1B82\\u1BA1-\\u1BAD\\u1BE6-\\u1BF3\\u1C24-\\u1C37\\u1CD0-\\u1CD2\\u1CD4-\\u1CE8\\u1CED\\u1CF2-\\u1CF4\\u1CF8\\u1CF9\\u1DC0-\\u1DF5\\u1DFB-\\u1DFF\\u200C\\u200E\\u200F\\u202A-\\u202E\\u2066-\\u206F\\u20D0-\\u20F0\\u2CEF-\\u2CF1\\u2D7F\\u2DE0-\\u2DFF\\u302A-\\u302F\\u3035\\u3099\\u309A\\uA66F-\\uA672\\uA674-\\uA67D\\uA69E\\uA69F\\uA6F0\\uA6F1\\uA802\\uA806\\uA80B\\uA823-\\uA827\\uA880\\uA881\\uA8B4-\\uA8C5\\uA8E0-\\uA8F1\\uA926-\\uA92D\\uA947-\\uA953\\uA980-\\uA983\\uA9B3-\\uA9C0\\uAA29-\\uAA36\\uAA43\\uAA4C\\uAA4D\\uAAEB-\\uAAEF\\uAAF5\\uAAF6\\uABE3-\\uABEA\\uABEC\\uABED\\uFB1E\\uFE00-\\uFE0F\\uFE20-\\uFE2F\\uFFF9-\\uFFFB]|\\uD800[\\uDDFD\\uDEE0\\uDF76-\\uDF7A]|\\uD802[\\uDE01-\\uDE03\\uDE05\\uDE06\\uDE0C-\\uDE0F\\uDE38-\\uDE3A\\uDE3F\\uDEE5\\uDEE6]|\\uD804[\\uDC00-\\uDC02\\uDC38-\\uDC46\\uDC7F-\\uDC82\\uDCB0-\\uDCBA\\uDD00-\\uDD02\\uDD27-\\uDD34\\uDD73\\uDD80-\\uDD82\\uDDB3-\\uDDC0\\uDDCA-\\uDDCC\\uDE2C-\\uDE37\\uDE3E\\uDEDF-\\uDEEA\\uDF00-\\uDF03\\uDF3C\\uDF3E-\\uDF44\\uDF47\\uDF48\\uDF4B-\\uDF4D\\uDF57\\uDF62\\uDF63\\uDF66-\\uDF6C\\uDF70-\\uDF74]|\\uD805[\\uDC35-\\uDC46\\uDCB0-\\uDCC3\\uDDAF-\\uDDB5\\uDDB8-\\uDDC0\\uDDDC\\uDDDD\\uDE30-\\uDE40\\uDEAB-\\uDEB7]|\\uD807[\\uDC2F-\\uDC36\\uDC38-\\uDC3F\\uDC92-\\uDCA7\\uDCA9-\\uDCB6]|\\uD81A[\\uDEF0-\\uDEF4\\uDF30-\\uDF36]|\\uD81B[\\uDF51-\\uDF7E\\uDF8F-\\uDF92]|\\uD82F[\\uDC9D\\uDC9E\\uDCA0-\\uDCA3]|\\uD834[\\uDD65-\\uDD69\\uDD6D-\\uDD82\\uDD85-\\uDD8B\\uDDAA-\\uDDAD\\uDE42-\\uDE44]|\\uD836[\\uDE00-\\uDE36\\uDE3B-\\uDE6C\\uDE75\\uDE84\\uDE9B-\\uDE9F\\uDEA1-\\uDEAF]|\\uD838[\\uDC00-\\uDC06\\uDC08-\\uDC18\\uDC1B-\\uDC21\\uDC23\\uDC24\\uDC26-\\uDC2A]|\\uD83A[\\uDCD0-\\uDCD6\\uDD44-\\uDD4A]|\\uDB40[\\uDC01\\uDC20-\\uDC7F\\uDD00-\\uDDEF]/g;\nconst RE_SPACE_CHARS = /[\\n\\r]/g;\nconst RE_FAKE_DOTS = /[\\u0702\\u0701\\u2024\\u00B7\\u02D9\\u0971\\u1427\\u18DF\\u22C5\\u2027]/g;\nconst RE_EMPTY_CHARS = /[\\u200B-\\u200D\\uFEFF\\u2063]/g;\n/* eslint-enable @stylistic/max-len, no-misleading-character-class, no-control-regex, @stylistic/operator-linebreak */\n\n/** Skippable characters that are not confusables */\nexport const checkLNPRegex = /^(?:[~`!@#%^&*(){}[\\];:\"'<,.>?/\\\\|_+=-]|[a-zA-Z0-9\\s])+$/;\n\nexport function checkLNP(str: string) {\n  return checkLNPRegex.test(str);\n}\n\n/**\n * Utility function to call 2 other functions which remove Combining Marks/Invisible characters\n * @param str The text to clean.\n */\nexport function clean(str: string) {\n  return str\n    .replace(RE_LINEBREAK_COMBINING_MARKS, '')\n    .replace(RE_SYMBOL_WITH_COMBINING_MARKS, '$1')\n    .replace(RE_SPACE_CHARS, ' ')\n    .replace(RE_FAKE_DOTS, '.')\n    .replace(RE_EMPTY_CHARS, '');\n}\n","export const characters = new Map<string, string>([\n  [' ', ' '],\n  ['0', ''],\n  ['1', '111'],\n  ['2', ''],\n  ['3', ''],\n  ['4', ''],\n  ['5', ''],\n  ['6', ''],\n  ['7', ''],\n  ['8', ''],\n  ['9', ''],\n  ['10', ''],\n  ['11', ''],\n  ['12', ''],\n  ['13', ''],\n  ['14', ''],\n  ['15', ''],\n  ['16', ''],\n  ['17', ''],\n  ['18', ''],\n  ['19', ''],\n  ['20', ''],\n  ['ae', ''],\n  ['OE', ''],\n  ['oe', ''],\n  ['pi', ''],\n  ['Nj', ''],\n  ['AE', ''],\n  ['A', ''],\n  ['a', ''],\n  ['B', ''],\n  ['b', ''],\n  ['C', ''],\n  ['c', ''],\n  ['D', ''],\n  ['d', ''],\n  ['E', ''],\n  ['e', ''],\n  ['F', ''],\n  ['f', ''],\n  ['G', ''],\n  ['g', ''],\n  ['H', ''],\n  ['h', ''],\n  ['I', ''],\n  ['i', ''],\n  ['J', ''],\n  ['j', ''],\n  ['K', ''],\n  ['k', ''],\n  ['L', ''],\n  ['l', '|'],\n  ['M', ''],\n  ['m', ''],\n  ['N', ''],\n  ['n', ''],\n  [\n    'O',\n    // eslint-disable-next-line @stylistic/max-len\n    '',\n  ],\n  [\n    'o',\n    // eslint-disable-next-line @stylistic/max-len\n    '',\n  ],\n  ['P', ''],\n  ['p', ''],\n  ['Q', ''],\n  ['q', ''],\n  ['R', ''],\n  ['r', ''],\n  ['S', ''],\n  ['s', ''],\n  ['T', ''],\n  ['t', ''],\n  ['U', ''],\n  ['u', ''],\n  ['V', ''],\n  ['v', ''],\n  ['W', ''],\n  ['w', ''],\n  ['X', ''],\n  ['x', ''],\n  ['Y', ''],\n  ['y', ''],\n  ['Z', ''],\n  ['z', ''],\n]);\n","// Original repo: https://github.com/gc/confusables\n\nimport { checkLNP, clean } from './util';\nimport { characters } from './characters';\n\nconst alphabetMap = new Map<string, string[]>();\nconst confusablesMap = new Map<string, string>();\n\nfor (const [base, alts] of characters.entries()) {\n  alphabetMap.set(base, [...alts]);\n\n  for (const char of alts) {\n    confusablesMap.set(char, base);\n  }\n}\n\nexport function cleanText(str: string) {\n  if (checkLNP(str)) return str;\n\n  let newStr = '';\n\n  for (const char of clean(str)) {\n    newStr += confusablesMap.get(char) || char;\n  }\n\n  return newStr;\n}\n","import { APP_ENV, APP_VERSION, BRILLIANT_API_BASE_URL } from '../../config';\nimport { fetchJson, fetchWithRetry, handleFetchErrors } from '../../util/fetch';\nimport { getEnvironment } from '../environment';\n\nconst BAD_REQUEST_CODE = 400;\n\nexport async function callBackendPost<T>(path: string, data: AnyLiteral, options?: {\n  authToken?: string;\n  isAllowBadRequest?: boolean;\n  method?: string;\n  shouldRetry?: boolean;\n  retries?: number;\n  timeouts?: number | number[];\n}): Promise<T> {\n  const {\n    authToken, isAllowBadRequest, method, shouldRetry, retries, timeouts,\n  } = options ?? {};\n\n  const url = new URL(`${BRILLIANT_API_BASE_URL}${path}`);\n\n  const init: RequestInit = {\n    method: method ?? 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      ...getBackendHeaders(),\n      ...(authToken && { 'X-Auth-Token': authToken }),\n    },\n    body: JSON.stringify(data),\n  };\n\n  const response = shouldRetry\n    ? await fetchWithRetry(url, init, {\n      retries,\n      timeouts,\n      shouldSkipRetryFn: (message) => !message?.includes('signal is aborted'),\n    })\n    : await fetch(url.toString(), init);\n\n  await handleFetchErrors(response, isAllowBadRequest ? [BAD_REQUEST_CODE] : undefined);\n\n  return response.json();\n}\n\nexport function callBackendGet<T = any>(path: string, data?: AnyLiteral, headers?: HeadersInit): Promise<T> {\n  const url = new URL(`${BRILLIANT_API_BASE_URL}${path}`);\n\n  return fetchJson(url, data, {\n    headers: {\n      ...headers,\n      ...getBackendHeaders(),\n    },\n  });\n}\n\nexport function getBackendHeaders() {\n  return {\n    ...getEnvironment().apiHeaders,\n    'X-App-Version': APP_VERSION,\n    'X-App-Env': APP_ENV,\n  } as Record<string, string>;\n}\n\nexport function addBackendHeadersToSocketUrl(url: URL) {\n  for (const [name, value] of Object.entries(getBackendHeaders())) {\n    const match = /^X-App-(.+)$/i.exec(name);\n    if (match) {\n      url.searchParams.append(match[1].toLowerCase(), value);\n    }\n  }\n}\n","import type { ApiAddressInfo, ApiKnownAddresses, ApiNftSuperCollection } from '../types';\n\nimport { RE_LINK_TEMPLATE, RE_TG_BOT_MENTION } from '../../config';\nimport { cleanText } from '../../lib/confusables';\nimport Deferred from '../../util/Deferred';\nimport { logDebugError } from '../../util/logs';\nimport { callBackendGet } from './backend';\n\nlet knownAddresses: ApiKnownAddresses = {};\nlet scamMarkers: RegExp[] = [];\nlet trustedSites = new Set<string>();\nlet trustedCollections = new Set<string>();\nlet tonNftSuperCollectionsByCollectionAddress: Record<string, ApiNftSuperCollection> = {};\nconst nftSuperCollectionsDeferred = new Deferred();\n\nexport async function tryUpdateKnownAddresses() {\n  try {\n    const data = await callBackendGet<{\n      knownAddresses: Record<string, ApiKnownAddresses>;\n      scamMarkers: string[];\n      trustedSites: string[];\n      trustedCollections: string[];\n      tonNftSuperCollections: (ApiNftSuperCollection & { collections: string[] })[];\n    }>('/known-addresses');\n\n    knownAddresses = data.knownAddresses;\n    scamMarkers = data.scamMarkers.map((x) => new RegExp(x, 'i'));\n    trustedSites = new Set(data.trustedSites);\n    trustedCollections = new Set(data.trustedCollections);\n    tonNftSuperCollectionsByCollectionAddress = data.tonNftSuperCollections.reduce((acc, superCollection) => {\n      const { collections, ...rest } = superCollection;\n\n      collections.forEach((address) => {\n        acc[address] = rest;\n      });\n\n      return acc;\n    }, {} as Record<string, ApiNftSuperCollection>);\n    nftSuperCollectionsDeferred.resolve();\n  } catch (err) {\n    logDebugError('tryUpdateKnownAddresses', err);\n  }\n}\n\nexport function getKnownAddresses() {\n  return knownAddresses;\n}\n\nexport async function getNftSuperCollectionsByCollectionAddress() {\n  await nftSuperCollectionsDeferred.promise;\n\n  return tonNftSuperCollectionsByCollectionAddress;\n}\n\nexport function getScamMarkers() {\n  return scamMarkers;\n}\n\nexport function getKnownAddressInfo(address: string): ApiAddressInfo | undefined {\n  return knownAddresses[address];\n}\n\nexport function checkIsTrustedSite(domain: string) {\n  return trustedSites.has(domain.toLowerCase());\n}\n\nexport function checkIsTrustedCollection(address: string) {\n  return trustedCollections.has(address);\n}\n\nexport function checkHasScamLink(text: string) {\n  const matches = cleanText(text).matchAll(RE_LINK_TEMPLATE);\n\n  for (const match of matches) {\n    const host = match.groups?.host;\n    if (host && !checkIsTrustedSite(host)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nexport function checkHasTelegramBotMention(text: string) {\n  return RE_TG_BOT_MENTION.test(cleanText(text));\n}\n","import type { ApiActivity } from '../api/types';\n\nimport { getIsActivityPending } from './activities';\n\nexport function compareActivities(a: ApiActivity, b: ApiActivity, isAsc = false) {\n  // The activity sorting is tuned to match the Toncenter API sorting as close as possible.\n  // Putting the pending activities first, because when they get confirmed, their timestamp gets bigger than any current\n  // confirmed activity timestamp. This reduces the movement in the activity list.\n  let value = (getIsActivityPending(a) ? 1 : 0) - (getIsActivityPending(b) ? 1 : 0);\n  if (value === 0) {\n    value = a.timestamp - b.timestamp;\n    if (value === 0) {\n      value = a.id > b.id ? 1 : a.id < b.id ? -1 : 0;\n    }\n  }\n  return isAsc ? value : -value;\n}\n","import type { ApiActivity, ApiTransaction, ApiTransactionActivity, ApiTransactionType } from '../../api/types';\nimport type { LangFn } from '../langProvider';\n\nimport { ALL_STAKING_POOLS, BURN_ADDRESS } from '../../config';\nimport { compareActivities } from '../compareActivities';\nimport { extractKey, groupBy, unique } from '../iteratees';\nimport { getIsTransactionWithPoisoning } from '../poisoningHash';\n\ntype UnusualTxType = 'backend-swap' | 'local' | 'additional';\n\ntype TranslationTenses = [past: string, present: string, future: string];\n\nconst TRANSACTION_TYPE_TITLES: Partial<Record<ApiTransactionType & keyof any, TranslationTenses>> = {\n  stake: ['Staked', 'Staking', '$stake_action'],\n  unstake: ['Unstaked', 'Unstaking', '$unstake_action'],\n  unstakeRequest: ['Unstake Requested', 'Requesting Unstake', '$request_unstake_action'],\n  callContract: ['Contract Called', 'Calling Contract', '$call_contract_action'],\n  excess: ['Excess', 'Excess', 'Excess'],\n  contractDeploy: ['Contract Deployed', 'Deploying Contract', '$deploy_contract_action'],\n  bounced: ['Bounced', 'Bouncing', '$bounce_action'],\n  mint: ['Minted', 'Minting', '$mint_action'],\n  burn: ['Burned', 'Burning', '$burn_action'],\n  auctionBid: ['NFT Auction Bid', 'Bidding at NFT Auction', 'NFT Auction Bid'],\n  dnsChangeAddress: ['Address Updated', 'Updating Address', '$update_address_action'],\n  dnsChangeSite: ['Site Updated', 'Updating Site', '$update_site_action'],\n  dnsChangeSubdomains: ['Subdomains Updated', 'Updating Subdomains', '$update_subdomains_action'],\n  dnsChangeStorage: ['Storage Updated', 'Updating Storage', '$update_storage_action'],\n  dnsDelete: ['Domain Record Deleted', 'Deleting Domain Record', '$delete_domain_record_action'],\n  dnsRenew: ['Domain Renewed', 'Renewing Domain', '$renew_domain_action'],\n  liquidityDeposit: ['Liquidity Provided', 'Providing Liquidity', '$provide_liquidity_action'],\n  liquidityWithdraw: ['Liquidity Withdrawn', 'Withdrawing Liquidity', '$withdraw_liquidity_action'],\n};\n\nexport const STAKING_TRANSACTION_TYPES = new Set<ApiTransactionType | undefined>([\n  'stake', 'unstake', 'unstakeRequest',\n]);\n\nexport const DNS_TRANSACTION_TYPES = new Set<ApiTransactionType | undefined>([\n  'dnsChangeAddress', 'dnsChangeSite', 'dnsChangeStorage', 'dnsChangeSubdomains', 'dnsDelete', 'dnsRenew',\n]);\n\nexport function parseTxId(txId: string): {\n  hash: string;\n  subId?: string;\n  type?: UnusualTxType;\n} {\n  const [hash, subId, type] = txId.split(':') as [string, string | undefined, UnusualTxType | undefined];\n  return { hash, type, subId };\n}\n\nexport function getIsTxIdLocal(txId: string) {\n  return txId.endsWith(':local');\n}\n\nexport function getIsBackendSwapId(id: string) {\n  return id.endsWith(':backend-swap');\n}\n\nexport function buildBackendSwapId(backendId: string) {\n  return buildTxId(backendId, undefined, 'backend-swap');\n}\n\nexport function buildLocalTxId(hash: string, subId?: number) {\n  return buildTxId(hash, subId, 'local');\n}\n\nexport function buildTxId(hash: string, subId?: number | string, type?: UnusualTxType) {\n  if (!type && subId === undefined) return hash;\n  if (type === undefined) return `${hash}:${subId}`;\n  return `${hash}:${subId ?? ''}:${type}`;\n}\n\nexport function getActivityTokenSlugs(activity: ApiActivity): string[] {\n  switch (activity.kind) {\n    case 'transaction': {\n      if (activity.nft) return []; // We don't want NFT activities to get into any token activity list\n      return [activity.slug];\n    }\n    case 'swap': {\n      return [activity.from, activity.to];\n    }\n  }\n}\n\nexport function getIsActivitySuitableForFetchingTimestamp(activity: ApiActivity | undefined) {\n  return !!activity\n    && !getIsTxIdLocal(activity.id)\n    && !getIsBackendSwapId(activity.id)\n    && !getIsActivityPending(activity);\n}\n\nexport function getTransactionTitle(\n  { type, isIncoming, nft }: ApiTransaction,\n  tense: 'past' | 'present' | 'future',\n  translate: LangFn,\n) {\n  const tenseIndex = tense === 'past' ? 0 : tense === 'present' ? 1 : 2;\n  let titles: TranslationTenses;\n\n  if (type === 'nftTrade') {\n    titles = isIncoming\n      ? ['NFT Sold', 'Selling NFT', '$sell_nft_action']\n      : ['NFT Bought', 'Buying NFT', '$buy_nft_action'];\n  } else if (type && TRANSACTION_TYPE_TITLES[type]) {\n    titles = TRANSACTION_TYPE_TITLES[type];\n  } else {\n    titles = isIncoming\n      ? ['Received', 'Receiving', '$receive_action']\n      : ['Sent', 'Sending', '$send_action'];\n  }\n\n  let title = translate(titles[tenseIndex]);\n\n  if (nft && (!type || type === 'mint' || type === 'burn')) {\n    title += ' NFT';\n  }\n\n  return title;\n}\n\nexport function isScamTransaction(transaction: ApiTransaction) {\n  return Boolean(transaction.metadata?.isScam)\n    || (transaction.isIncoming && getIsTransactionWithPoisoning(transaction));\n}\n\nexport function shouldShowTransactionComment(transaction: ApiTransaction) {\n  return Boolean(transaction.comment || transaction.encryptedComment)\n    && !STAKING_TRANSACTION_TYPES.has(transaction.type)\n    && !isScamTransaction(transaction);\n}\n\nexport function getTransactionAmountDisplayMode({ type, amount, nft }: ApiTransaction) {\n  const isPlainTransfer = type === undefined && !nft;\n  if (!amount && !isPlainTransfer) {\n    return 'hide';\n  }\n  return type === 'stake' || type === 'unstake'\n    ? 'noSign'\n    : 'normal';\n}\n\n/** Returns the UI sections where the address should be shown */\nexport function shouldShowTransactionAddress(transaction: ApiTransactionActivity): ('list' | 'modal')[] {\n  const { type, isIncoming, nft, toAddress, fromAddress, extra } = transaction;\n\n  if (type === 'nftTrade') {\n    return extra?.marketplace ? ['list'] : [];\n  }\n\n  const shouldHide = isOurStakingTransaction(transaction)\n    || type === 'burn'\n    || (!isIncoming && nft && toAddress === nft.address)\n    || (isIncoming && type === 'excess' && fromAddress === BURN_ADDRESS);\n\n  return shouldHide ? [] : ['list', 'modal'];\n}\n\n/** \"Our\" is staking that can be controlled with MyTonWallet app */\nexport function isOurStakingTransaction({ type, isIncoming, toAddress, fromAddress }: ApiTransaction) {\n  return STAKING_TRANSACTION_TYPES.has(type) && ALL_STAKING_POOLS.includes(isIncoming ? fromAddress : toAddress);\n}\n\nexport function shouldShowTransactionAnnualYield(transaction: ApiTransaction) {\n  return transaction.type === 'stake' && isOurStakingTransaction(transaction);\n}\n\nexport function mergeActivitiesToMaxTime(array1: ApiActivity[], array2: ApiActivity[]) {\n  if (!array1.length && !array2.length) {\n    return [];\n  } else if (!array1.length && array2.length) {\n    return array2;\n  } else if (!array2.length && array1.length) {\n    return array1;\n  }\n\n  const fromTimestamp = Math.max(\n    array1[array1.length - 1].timestamp,\n    array2[array2.length - 1].timestamp,\n  );\n\n  return [...array1, ...array2]\n    .filter(({ timestamp }) => timestamp >= fromTimestamp)\n    .sort(compareActivities);\n}\n\nexport function mergeActivityIdsToMaxTime(array1: string[], array2: string[], byId: Record<string, ApiActivity>) {\n  if (!array1.length && !array2.length) {\n    return [];\n  } else if (!array1.length && array2.length) {\n    return array2;\n  } else if (!array2.length && array1.length) {\n    return array1;\n  }\n\n  const fromTimestamp = Math.max(\n    byId[array1[array1.length - 1]].timestamp,\n    byId[array2[array2.length - 1]].timestamp,\n  );\n\n  return unique([...array1, ...array2])\n    .filter((id) => byId[id].timestamp >= fromTimestamp)\n    .sort((a, b) => compareActivities(byId[a], byId[b]));\n}\n\nexport function getIsActivityWithHash(activity: ApiTransactionActivity) {\n  return !getIsTxIdLocal(activity.id) || !activity.extra?.withW5Gasless;\n}\n\nexport function getIsActivityPending(activity: ApiActivity) {\n  // \"Pending\" is a blockchain term. The activities originated by our backend are never considered pending in this sense.\n  return activity.status === 'pending' && !getIsBackendSwapId(activity.id);\n}\n\n/**\n * Sometimes activity ids change. This function finds the new id withing `nextActivities` for each activity in\n * `prevActivities`. Currently only local and pending activity ids change, so it's enough to provide only such\n * activities in `prevActivities`.\n *\n * The ids should be unique within each input array. The returned map has previous activity ids as keys and next\n * activity ids as values. If the map has no value for a previous id, it means that there is no matching next activity.\n * The values may be not unique.\n */\nexport function getActivityIdReplacements(prevActivities: ApiActivity[], nextActivities: ApiActivity[]) {\n  // Each previous activity must fall into either of the groups, otherwise the resulting map will falsely miss previous ids\n  const prevLocalActivities: ApiActivity[] = [];\n  const prevChainActivities: ApiActivity[] = [];\n\n  for (const activity of prevActivities) {\n    const group = getIsTxIdLocal(activity.id) ? prevLocalActivities : prevChainActivities;\n    group.push(activity);\n  }\n\n  return {\n    ...getLocalActivityIdReplacements(prevLocalActivities, nextActivities),\n    ...getChainActivityIdReplacements(prevChainActivities, nextActivities),\n  };\n}\n\n/** Replaces local activity ids. See `getActivityIdReplacements` for more details. */\nfunction getLocalActivityIdReplacements(prevLocalActivities: ApiActivity[], nextActivities: ApiActivity[]) {\n  const idReplacements: Record<string, string> = {};\n\n  if (!prevLocalActivities.length) {\n    return idReplacements;\n  }\n\n  const nextActivityIds = new Set(extractKey(nextActivities, 'id'));\n  const nextChainActivities = nextActivities.filter((activity) => !getIsTxIdLocal(activity.id));\n\n  for (const localActivity of prevLocalActivities) {\n    const { id: prevId } = localActivity;\n\n    // Try a direct id match\n    if (nextActivityIds.has(prevId)) {\n      idReplacements[prevId] = prevId;\n      continue;\n    }\n\n    // Otherwise, try to find a match by a heuristic\n    const chainActivity = nextChainActivities.find((chainActivity) => {\n      return doesLocalActivityMatch(localActivity, chainActivity);\n    });\n    if (chainActivity) {\n      idReplacements[prevId] = chainActivity.id;\n    }\n\n    // Otherwise, there is no match\n  }\n\n  return idReplacements;\n}\n\n/** Replaces chain (i.e. not local) activity ids. See `getActivityIdReplacements` for more details. */\nfunction getChainActivityIdReplacements(prevActivities: ApiActivity[], nextActivities: ApiActivity[]) {\n  const idReplacements: Record<string, string> = {};\n\n  if (!prevActivities.length) {\n    return idReplacements;\n  }\n\n  const nextActivityIds = new Set(extractKey(nextActivities, 'id'));\n  const nextActivitiesByMessageHash = groupBy(nextActivities, 'externalMsgHashNorm');\n\n  for (const { id: prevId, externalMsgHashNorm } of prevActivities) {\n    // Try a direct id match\n    if (nextActivityIds.has(prevId)) {\n      idReplacements[prevId] = prevId;\n      continue;\n    }\n\n    // Otherwise, match by the message hash\n    if (externalMsgHashNorm) {\n      const nextSubActivities = nextActivitiesByMessageHash[externalMsgHashNorm];\n      if (nextSubActivities?.length) {\n        idReplacements[prevId] = nextSubActivities[0].id;\n\n        // Leaving 1 activity in each group to ensure there is a match for the further prev activities with the same hash\n        if (nextSubActivities.length > 1) {\n          nextSubActivities.shift();\n        }\n      }\n    }\n\n    // Otherwise, there is no match\n  }\n\n  return idReplacements;\n}\n\n/** Decides whether the local activity matches the activity from the blockchain */\nexport function doesLocalActivityMatch(localActivity: ApiActivity, chainActivity: ApiActivity) {\n  if (localActivity.extra?.withW5Gasless) {\n    if (localActivity.kind === 'transaction' && chainActivity.kind === 'transaction') {\n      return !chainActivity.isIncoming && localActivity.normalizedAddress === chainActivity.normalizedAddress\n        && localActivity.amount === chainActivity.amount\n        && localActivity.slug === chainActivity.slug;\n    } else if (localActivity.kind === 'swap' && chainActivity.kind === 'swap') {\n      return localActivity.from === chainActivity.from\n        && localActivity.to === chainActivity.to\n        && localActivity.fromAmount === chainActivity.fromAmount;\n    }\n  }\n\n  if (localActivity.externalMsgHashNorm) {\n    return localActivity.externalMsgHashNorm === chainActivity.externalMsgHashNorm && !chainActivity.shouldHide;\n  }\n\n  return parseTxId(localActivity.id).hash === parseTxId(chainActivity.id).hash;\n}\n","export function toMilliseconds(seconds: number) {\n  return seconds * 1000;\n}\n\nexport function toSeconds(ms: number) {\n  return Math.floor(ms / 1000);\n}\n","import type { ApiTransaction } from '../api/types';\n\nimport { TRANSACTION_ADDRESS_SHIFT } from '../config';\nimport { shortenAddress } from './shortenAddress';\n\nconst cache = new Map<string, {\n  timestamp: number;\n  amount: bigint;\n  address: string;\n}>();\n\nfunction getKey(address: string) {\n  return shortenAddress(address, TRANSACTION_ADDRESS_SHIFT)!;\n}\n\nfunction addToCache(address: string, amount: bigint, timestamp: number) {\n  const key = getKey(address);\n\n  cache.set(key, {\n    address,\n    amount,\n    timestamp,\n  });\n}\n\nfunction getFromCache(address: string) {\n  const key = getKey(address);\n\n  return cache.get(key);\n}\n\nexport function updatePoisoningCache(tx: ApiTransaction) {\n  const { fromAddress: address, amount, timestamp } = tx;\n\n  const cached = getFromCache(address);\n\n  if (!cached || cached.timestamp < timestamp || (cached.timestamp === timestamp && cached.amount > amount)) {\n    addToCache(address, amount, timestamp);\n  }\n}\n\nexport function getIsTransactionWithPoisoning(tx: ApiTransaction) {\n  const { fromAddress: address } = tx;\n\n  const cached = getFromCache(address);\n\n  return cached && cached.address !== address;\n}\n\nexport function clearPoisoningCache() {\n  cache.clear();\n}\n","export default function isEmptyObject(obj: object) {\n  return !isKeyCountGreater(obj, 0);\n}\n\nexport function isKeyCountGreater(obj: object, countToOutnumber: number) {\n  if (countToOutnumber < 0) return true;\n  let keyCount = 0;\n\n  for (const key in obj) {\n    if (obj.hasOwnProperty(key)) {\n      keyCount++;\n      if (keyCount > countToOutnumber) {\n        return true;\n      }\n    }\n  }\n\n  return false;\n}\n","import type { Table, UpdateSpec } from 'dexie';\n\nconst IGNORED_DEXIE_ERRORS = new Set(['AbortError', 'BulkError', 'UnknownError']);\n\nasync function tryDbQuery<T>(cb: () => Promise<T>) {\n  try {\n    return await cb();\n  } catch (error: any) {\n    if (IGNORED_DEXIE_ERRORS.has(error?.name)) return undefined;\n    else throw error;\n  }\n}\n\nexport class DbRepository<T> {\n  table: Table<T>;\n\n  constructor(table: Table<T>) {\n    this.table = table;\n  }\n\n  all() {\n    return this.table.toArray();\n  }\n\n  find(where: Record<string, any>) {\n    return tryDbQuery(() => {\n      return this.table.where(where).toArray();\n    });\n  }\n\n  put(item: T) {\n    return tryDbQuery(() => {\n      return this.table.put(item);\n    });\n  }\n\n  bulkPut(items: T[]) {\n    return tryDbQuery(() => {\n      return this.table.bulkPut(items);\n    });\n  }\n\n  update(key: string[], update: UpdateSpec<T>) {\n    return tryDbQuery(() => {\n      return this.table.update(key, update);\n    });\n  }\n\n  delete(key: string[]) {\n    return tryDbQuery(() => {\n      return this.table.delete(key);\n    });\n  }\n\n  deleteWhere(where: Record<string, any>) {\n    return tryDbQuery(() => {\n      return this.table.where(where).delete();\n    });\n  }\n\n  clear() {\n    return tryDbQuery(() => {\n      return this.table.clear();\n    });\n  }\n}\n","import type { Table } from 'dexie';\nimport Dexie from 'dexie';\n\nimport type { ApiNft, ApiTokenWithPrice } from '../types';\n\nimport { DbRepository } from './repository';\n\nexport type ApiDbNft = ApiNft & {\n  accountId: string;\n  collectionAddress: string;\n};\n\nexport type ApiDbSseConnection = {\n  clientId: string;\n};\n\nconst DB_NANE = 'tables';\n\nexport class ApiDb extends Dexie {\n  nfts!: Table<ApiDbNft>;\n\n  tokens!: Table<ApiTokenWithPrice>;\n\n  constructor() {\n    super(DB_NANE);\n    this.version(1).stores({\n      nfts: '[accountId+address], accountId, address, collectionAddress',\n    });\n    this.version(2).stores({\n      sseConnections: '&clientId',\n    });\n    this.version(3).stores({\n      tokens: 'tokenAddress, chain, &slug',\n    });\n    this.version(4).upgrade((tx) => {\n      return tx.table('tokens').clear();\n    });\n    this.version(5).stores({\n      // eslint-disable-next-line no-null/no-null\n      nfts: null,\n      // eslint-disable-next-line no-null/no-null\n      sseConnections: null,\n    });\n  }\n}\n\nexport const apiDb = new ApiDb();\n\nexport const tokenRepository = new DbRepository(apiDb.tokens);\n","import type { ApiBaseCurrency, ApiChain, ApiTokenDetails, ApiTokenWithPrice, OnApiUpdate } from '../types';\n\nimport { DEFAULT_PRICE_CURRENCY, TOKEN_INFO } from '../../config';\nimport Deferred from '../../util/Deferred';\nimport { buildCollectionByKey, omitUndefined } from '../../util/iteratees';\nimport { tokenRepository } from '../db';\n\nexport const tokensPreload = new Deferred();\nconst tokensCache: {\n  baseCurrency: ApiBaseCurrency;\n  bySlug: Record<string, ApiTokenWithPrice>;\n} = {\n  baseCurrency: DEFAULT_PRICE_CURRENCY,\n  bySlug: { ...TOKEN_INFO },\n};\n\nexport async function loadTokensCache() {\n  try {\n    const tokens = await tokenRepository.all();\n    await updateTokens(tokens);\n  } finally {\n    tokensPreload.resolve();\n  }\n}\n\nexport async function updateTokens(\n  tokens: ApiTokenWithPrice[],\n  onUpdate?: OnApiUpdate,\n  tokenDetails?: ApiTokenDetails[],\n  baseCurrency?: ApiBaseCurrency,\n  shouldSendUpdate?: boolean,\n) {\n  const tokensForDb: ApiTokenWithPrice[] = [];\n  const detailsBySlug = buildCollectionByKey(tokenDetails ?? [], 'slug');\n\n  for (const { slug, ...details } of tokenDetails ?? []) {\n    const cachedToken = tokensCache.bySlug[slug] as ApiTokenWithPrice | undefined;\n    if (cachedToken) {\n      const token = { ...cachedToken, ...details };\n      tokensCache.bySlug[slug] = token;\n      tokensForDb.push(token);\n    }\n  }\n\n  for (const token of tokens) {\n    const { slug } = token;\n    const cachedToken = tokensCache.bySlug[slug] as ApiTokenWithPrice | undefined;\n    const mergedToken = mergeTokenWithCache(token, detailsBySlug, cachedToken);\n\n    if (!(token.slug in tokensCache)) {\n      shouldSendUpdate = true;\n    }\n\n    tokensCache.bySlug[token.slug] = mergedToken;\n    if (token.tokenAddress) {\n      tokensForDb.push(mergedToken);\n    }\n  }\n\n  if (baseCurrency) {\n    tokensCache.baseCurrency = baseCurrency;\n  }\n\n  await tokenRepository.bulkPut(tokensForDb);\n\n  if (shouldSendUpdate && onUpdate) {\n    sendUpdateTokens(onUpdate);\n  }\n}\n\nfunction mergeTokenWithCache(\n  token: ApiTokenWithPrice,\n  detailsBySlug: Record<string, ApiTokenDetails>,\n  cachedToken?: ApiTokenWithPrice,\n): ApiTokenWithPrice {\n  if (cachedToken) {\n    // Metadata from backend takes priority (e.g., image)\n    return {\n      ...omitUndefined(token.isFromBackend ? cachedToken : token),\n      ...omitUndefined(token.isFromBackend ? token : cachedToken),\n      price: token.price || cachedToken.price,\n      priceUsd: token.priceUsd || cachedToken.priceUsd,\n      percentChange24h: token.percentChange24h || cachedToken.percentChange24h,\n    };\n  } else if (token.slug in detailsBySlug) {\n    return {\n      ...token,\n      ...detailsBySlug[token.slug],\n    };\n  } else {\n    return token;\n  }\n}\n\nexport function getTokensCache() {\n  return tokensCache;\n}\n\nexport function getTokenBySlug(slug: string) {\n  return tokensCache.bySlug[slug];\n}\n\nexport function getTokenByAddress(tokenAddress: string) {\n  return getTokenBySlug(buildTokenSlug('ton', tokenAddress));\n}\n\nexport function sendUpdateTokens(onUpdate: OnApiUpdate) {\n  onUpdate({\n    type: 'updateTokens',\n    tokens: tokensCache.bySlug,\n    baseCurrency: tokensCache.baseCurrency,\n  });\n}\n\nexport function buildTokenSlug(chain: ApiChain, address: string) {\n  const addressPart = address.replace(/[^a-z\\d]/gi, '').slice(0, 10);\n  return `${chain}-${addressPart}`.toLowerCase();\n}\n","import type { ApiNetwork, ApiWalletInfo } from '../../../types';\nimport type { ApiTonWalletVersion } from '../types';\nimport type { AccountState, AddressBook, MetadataMap, WalletState, WalletVersion } from './types';\n\nimport { TONCENTER_ACTIONS_VERSION, TONCENTER_MAINNET_URL, TONCENTER_TESTNET_URL } from '../../../../config';\nimport { buildTxId } from '../../../../util/activities';\nimport { fetchJson } from '../../../../util/fetch';\nimport { buildCollectionByKey, split } from '../../../../util/iteratees';\nimport { toRawAddress } from '../util/tonCore';\nimport { getEnvironment } from '../../../environment';\n\nconst ADDRESS_BOOK_CHUNK_SIZE = 128;\nconst VERSION_MAP: Record<WalletVersion, ApiTonWalletVersion> = {\n  'wallet v1 r1': 'simpleR1',\n  'wallet v1 r2': 'simpleR2',\n  'wallet v1 r3': 'simpleR3',\n  'wallet v2 r1': 'v2R1',\n  'wallet v2 r2': 'v2R2',\n  'wallet v3 r1': 'v3R1',\n  'wallet v3 r2': 'v3R2',\n  // 'wallet v4 r1': '', // Not used in production, wrapper is missing\n  'wallet v4 r2': 'v4R2',\n  // 'wallet v5 beta': '', // Not used in production, wrapper is missing\n  'wallet v5 r1': 'W5',\n};\n\nexport async function fetchAddressBook(network: ApiNetwork, addresses: string[]): Promise<AddressBook> {\n  const chunks = split(addresses, ADDRESS_BOOK_CHUNK_SIZE);\n\n  const results = await Promise.all(chunks.map((chunk) => {\n    return callToncenterV3(network, '/addressBook', {\n      address: chunk,\n    });\n  }));\n\n  return results.reduce((acc, value) => {\n    return Object.assign(acc, value);\n  }, {} as AddressBook);\n}\n\nexport async function fixAddressFormat(network: ApiNetwork, address: string): Promise<string> {\n  const result: { address_book: Record<string, string> } = await callToncenterV3(network, '/addressBook', { address });\n  return result.address_book[address];\n}\n\n/**\n * The output dictionary is indexed by the input addresses.\n * Every input address is guaranteed to be a key of the dictionary.\n */\nexport async function getWalletInfos(network: ApiNetwork, addresses: string[]): Promise<Record<string, ApiWalletInfo>> {\n  const { wallets: states, address_book: addressBook } = await callToncenterV3<{\n    address_book: AddressBook;\n    wallets: WalletState[];\n  }>(network, '/walletStates', { address: addresses.join(',') });\n\n  const walletInfoByRawAddress = Object.fromEntries(states.map((state) => [\n    state.address.toLowerCase(),\n    buildWalletInfo(state, addressBook),\n  ]));\n\n  return Object.fromEntries(addresses.map((inputAddress) => {\n    const rawAddress = toRawAddress(inputAddress).toLowerCase();\n    return [\n      inputAddress,\n      walletInfoByRawAddress[rawAddress] ?? {\n        address: inputAddress,\n        balance: 0n,\n        isInitialized: false,\n        seqno: 0,\n      } satisfies ApiWalletInfo,\n    ];\n  }));\n}\n\nfunction buildWalletInfo(state: WalletState, addressBook: AddressBook): ApiWalletInfo {\n  return {\n    address: addressBook[state.address].user_friendly,\n    version: 'wallet_type' in state ? VERSION_MAP[state.wallet_type] : undefined,\n    balance: BigInt(state.balance),\n    isInitialized: state.status === 'active',\n    seqno: 'seqno' in state ? state.seqno : 0,\n    lastTxId: state.last_transaction_hash ? buildTxId(state.last_transaction_hash) : undefined,\n    domain: addressBook[state.address].domain ?? undefined,\n  };\n}\n\nexport async function getAccountStates(network: ApiNetwork, addresses: string[]) {\n  const { accounts: states } = await callToncenterV3<{\n    addressBook: AddressBook;\n    accounts: AccountState[];\n  }>(network, '/accountStates', { address: addresses.join(',') });\n\n  const addressByRaw = Object.fromEntries(addresses.map((address) => [toRawAddress(address), address]));\n  for (const state of states) {\n    state.address = addressByRaw[state.address.toLowerCase()];\n  }\n  return buildCollectionByKey(states, 'address');\n}\n\nexport function fetchMetadata(network: ApiNetwork, addresses: string[]): Promise<MetadataMap> {\n  return callToncenterV3<MetadataMap>(network, '/metadata', { address: addresses.join(',') });\n}\n\nexport function callToncenterV3<T = any>(network: ApiNetwork, path: string, data?: AnyLiteral) {\n  const baseUrl = network === 'testnet' ? TONCENTER_TESTNET_URL : TONCENTER_MAINNET_URL;\n  const url = `${baseUrl}/api/v3${path}`;\n\n  return fetchJson(url, data, {\n    headers: getToncenterHeaders(network),\n  }) as Promise<T>;\n}\n\nexport function getToncenterHeaders(network: ApiNetwork) {\n  const { apiHeaders, toncenterMainnetKey, toncenterTestnetKey } = getEnvironment();\n  const apiKey = network === 'testnet' ? toncenterTestnetKey : toncenterMainnetKey;\n\n  return {\n    ...apiHeaders,\n    ...(apiKey && { 'X-Api-Key': apiKey }),\n    'X-Actions-Version': TONCENTER_ACTIONS_VERSION,\n  };\n}\n","import { Api, HttpClient } from 'tonapi-sdk-js';\n\nimport type { ApiNetwork } from '../../../types';\n\nimport { TONAPIIO_MAINNET_URL, TONAPIIO_TESTNET_URL } from '../../../../config';\nimport { fetchWithRetry } from '../../../../util/fetch';\nimport { getEnvironment } from '../../../environment';\n\nconst MAX_LIMIT = 500;\nconst EVENTS_LIMIT = 100;\n\nlet apiByNetwork: Record<ApiNetwork, Api<unknown>> | undefined;\n\nfunction getApi(network: ApiNetwork) {\n  if (!apiByNetwork) {\n    const headers = {\n      ...getEnvironment().apiHeaders,\n      'Content-Type': 'application/json',\n    };\n\n    apiByNetwork = {\n      mainnet: new Api(new HttpClient({\n        baseUrl: TONAPIIO_MAINNET_URL,\n        baseApiParams: { headers },\n        customFetch: fetchWithRetry as typeof fetch,\n      })),\n      testnet: new Api(new HttpClient({\n        baseUrl: TONAPIIO_TESTNET_URL,\n        baseApiParams: { headers },\n        customFetch: fetchWithRetry as typeof fetch,\n      })),\n    };\n  }\n\n  return apiByNetwork[network];\n}\n\nexport async function fetchJettonBalances(network: ApiNetwork, account: string) {\n  return (await getApi(network).accounts.getAccountJettonsBalances(account, {\n    supported_extensions: ['custom_payload'],\n  })).balances;\n}\n\nexport async function fetchNftItems(network: ApiNetwork, addresses: string[]) {\n  return (await getApi(network).nft.getNftItemsByAddresses({\n    account_ids: addresses,\n  })).nft_items;\n}\n\nexport async function fetchAccountNfts(network: ApiNetwork, address: string, options?: {\n  collectionAddress?: string;\n  offset?: number;\n  limit?: number;\n}) {\n  const { collectionAddress, offset, limit } = options ?? {};\n\n  return (await getApi(network).accounts.getAccountNftItems(\n    address,\n    {\n      offset: offset ?? 0,\n      limit: limit ?? MAX_LIMIT,\n      indirect_ownership: true,\n      collection: collectionAddress,\n    },\n  )).nft_items;\n}\n\nexport function fetchNftByAddress(network: ApiNetwork, nftAddress: string) {\n  return getApi(network).nft.getNftItemByAddress(nftAddress);\n}\n\nexport async function fetchAccountEvents(network: ApiNetwork, address: string, fromSec: number, limit?: number) {\n  return (await getApi(network).accounts.getAccountEvents(address, {\n    limit: limit ?? EVENTS_LIMIT,\n    start_date: fromSec,\n  })).events;\n}\n","import type { NftItem } from 'tonapi-sdk-js';\nimport type { DictionaryValue } from '@ton/core';\nimport { BitReader } from '@ton/core/dist/boc/BitReader';\nimport { BitString } from '@ton/core/dist/boc/BitString';\nimport { Builder } from '@ton/core/dist/boc/Builder';\nimport { Cell } from '@ton/core/dist/boc/Cell';\nimport { Slice } from '@ton/core/dist/boc/Slice';\nimport { Dictionary } from '@ton/core/dist/dict/Dictionary';\n\nimport type {\n  ApiMtwCardBorderShineType,\n  ApiMtwCardTextType,\n  ApiMtwCardType,\n  ApiNetwork,\n  ApiNft,\n  ApiNftAttribute,\n  ApiNftMetadata,\n  ApiNftSuperCollection,\n  ApiParsedPayload,\n  ApiTransaction,\n} from '../../../types';\nimport type { JettonMetadata } from '../types';\n\nimport {\n  DEBUG,\n  LIQUID_JETTON,\n  MTW_CARDS_COLLECTION,\n  NFT_FRAGMENT_COLLECTIONS,\n  NFT_FRAGMENT_GIFT_IMAGE_TO_URL_REGEX,\n  TELEGRAM_GIFTS_SUPER_COLLECTION,\n} from '../../../../config';\nimport { fetchJsonWithProxy, fixIpfsUrl, getProxiedLottieUrl } from '../../../../util/fetch';\nimport isEmptyObject from '../../../../util/isEmptyObject';\nimport { omitUndefined, pick, range } from '../../../../util/iteratees';\nimport { logDebugError } from '../../../../util/logs';\nimport {\n  checkHasScamLink,\n  checkIsTrustedCollection,\n  getNftSuperCollectionsByCollectionAddress,\n} from '../../../common/addresses';\nimport { buildTokenSlug } from '../../../common/tokens';\nimport { base64ToString, sha256 } from '../../../common/utils';\nimport { DnsCategory, JettonStakingOpCode } from '../constants';\nimport {\n  DNS_CATEGORY_HASH_MAP,\n  DnsOpCode,\n  JettonOpCode,\n  LiquidStakingOpCode,\n  NftOpCode,\n  OpCode,\n  OtherOpCode,\n  SingleNominatorOpCode,\n  VestingV1OpCode,\n} from '../constants';\nimport { fixAddressFormat } from '../toncenter/other';\nimport { fetchNftItems } from './tonapiio';\nimport {\n  getDnsItemDomain, getJettonMinterData, resolveTokenAddress, toBase64Address,\n} from './tonCore';\n\ntype OpCodes = OpCode | JettonOpCode | NftOpCode | LiquidStakingOpCode | VestingV1OpCode | SingleNominatorOpCode\n  | DnsOpCode | OtherOpCode | JettonStakingOpCode;\n\nconst OFFCHAIN_CONTENT_PREFIX = 0x01;\nconst SNAKE_PREFIX = 0x00;\n\nexport function fixBase64ImageData(data: string) {\n  const decodedData = base64ToString(data);\n  if (decodedData.includes('<svg')) {\n    return `data:image/svg+xml;base64,${data}`;\n  }\n  return `data:image/png;base64,${data}`;\n}\n\nconst dictSnakeBufferValue: DictionaryValue<Buffer> = {\n  parse: (slice) => {\n    const buffer = Buffer.from('');\n\n    const sliceToVal = (s: Slice, v: Buffer, isFirst: boolean) => {\n      if (isFirst && s.loadUint(8) !== SNAKE_PREFIX) {\n        throw new Error('Only snake format is supported');\n      }\n\n      v = Buffer.concat([v, s.loadBuffer(s.remainingBits / 8)]);\n      if (s.remainingRefs === 1) {\n        v = sliceToVal(s.loadRef().beginParse(), v, false);\n      }\n\n      return v;\n    };\n\n    return sliceToVal(slice.loadRef().beginParse() as any, buffer, true);\n  },\n  serialize: () => {\n    // pass\n  },\n};\n\nconst jettonOnChainMetadataSpec: {\n  [key in keyof JettonMetadata]: 'utf8' | 'ascii' | undefined;\n} = {\n  uri: 'ascii',\n  name: 'utf8',\n  description: 'utf8',\n  image: 'ascii',\n  symbol: 'utf8',\n  decimals: 'utf8',\n  custom_payload_api_uri: 'ascii',\n};\n\nexport async function fetchJettonMetadata(network: ApiNetwork, address: string) {\n  const { content } = await getJettonMinterData(network, address);\n\n  let metadata: JettonMetadata;\n\n  const slice = content.asSlice();\n  const prefix = slice.loadUint(8);\n\n  if (prefix === OFFCHAIN_CONTENT_PREFIX) {\n    const bytes = readSnakeBytes(slice);\n    const contentUri = bytes.toString('utf-8');\n    metadata = await fetchJettonOffchainMetadata(contentUri);\n  } else {\n    // On-chain content\n    metadata = await parseJettonOnchainMetadata(slice);\n    if (metadata.uri) {\n      // Semi-chain content\n      const offchainMetadata = await fetchJettonOffchainMetadata(metadata.uri);\n      metadata = { ...offchainMetadata, ...metadata };\n    }\n  }\n\n  return metadata;\n}\n\nexport async function parseJettonOnchainMetadata(slice: Slice): Promise<JettonMetadata> {\n  const dict = slice.loadDict(Dictionary.Keys.Buffer(32), dictSnakeBufferValue);\n\n  const res: { [s in keyof JettonMetadata]?: string } = {};\n\n  for (const [key, value] of Object.entries(jettonOnChainMetadataSpec)) {\n    const sha256Key = Buffer.from(await sha256(Buffer.from(key, 'ascii')));\n    const val = dict.get(sha256Key)?.toString(value);\n\n    if (val) {\n      res[key as keyof JettonMetadata] = val;\n    }\n  }\n\n  return res as JettonMetadata;\n}\n\nexport async function fetchJettonOffchainMetadata(uri: string): Promise<JettonMetadata> {\n  const metadata = await fetchJsonWithProxy(uri);\n  return pick(metadata, [\n    'name',\n    'description',\n    'symbol',\n    'decimals',\n    'image',\n    'image_data',\n    'custom_payload_api_uri',\n  ]);\n}\n\nexport async function parsePayloadBase64(\n  network: ApiNetwork,\n  address: string,\n  base64: string,\n): Promise<ApiParsedPayload> {\n  const slice = dataToSlice(base64);\n  const result: ApiParsedPayload = { type: 'unknown', base64 };\n\n  if (!slice) return result;\n\n  return await parsePayloadSlice(network, address, slice, true) ?? result;\n}\n\nexport async function parsePayloadSlice(\n  network: ApiNetwork,\n  address: string,\n  slice: Slice,\n  shouldLoadItems?: boolean,\n  transactionDebug?: ApiTransaction,\n): Promise<ApiParsedPayload | undefined> {\n  let opCode: OpCodes | undefined;\n  try {\n    opCode = slice.loadUint(32);\n\n    if (opCode === OpCode.Comment) {\n      const buffer = readSnakeBytes(slice);\n      const comment = buffer.toString('utf-8');\n      return { type: 'comment', comment };\n    } else if (opCode === OpCode.Encrypted) {\n      const buffer = readSnakeBytes(slice);\n      const encryptedComment = buffer.toString('base64');\n      return { type: 'encrypted-comment', encryptedComment };\n    } else if (slice.remainingBits < 64) {\n      return undefined;\n    }\n\n    const queryId = slice.loadUintBig(64);\n\n    switch (opCode) {\n      case JettonOpCode.Transfer: {\n        const tokenAddress = await resolveTokenAddress(network, address).catch(() => '');\n        const slug = buildTokenSlug('ton', tokenAddress);\n\n        const amount = slice.loadCoins();\n        const destination = slice.loadAddress();\n        const responseDestination = slice.loadMaybeAddress();\n\n        if (!responseDestination) {\n          return {\n            type: 'tokens:transfer-non-standard',\n            queryId,\n            destination: toBase64Address(destination, undefined, network),\n            amount,\n            slug,\n          };\n        }\n\n        const customPayload = slice.loadMaybeRef();\n        const forwardAmount = slice.loadCoins();\n        let forwardPayload = slice.loadMaybeRef();\n        let forwardPayloadOpCode: number | undefined;\n\n        if (!forwardPayload && slice.remainingBits) {\n          const builder = new Builder().storeBits(slice.loadBits(slice.remainingBits));\n          range(0, slice.remainingRefs).forEach(() => {\n            builder.storeRef(slice.loadRef());\n          });\n          forwardPayload = builder.endCell();\n        }\n\n        if (forwardPayload) {\n          const forwardPayloadSlice = forwardPayload.beginParse();\n          if (forwardPayloadSlice.remainingBits > 32) {\n            forwardPayloadOpCode = forwardPayloadSlice.loadUint(32);\n          }\n        }\n\n        return {\n          type: 'tokens:transfer',\n          queryId,\n          amount,\n          destination: toBase64Address(destination, undefined, network),\n          responseDestination: toBase64Address(responseDestination, undefined, network),\n          customPayload: customPayload?.toBoc().toString('base64'),\n          forwardAmount,\n          forwardPayload: forwardPayload?.toBoc().toString('base64'),\n          forwardPayloadOpCode,\n          slug,\n          tokenAddress,\n        };\n      }\n      case NftOpCode.TransferOwnership: {\n        const newOwner = slice.loadAddress();\n        const responseDestination = slice.loadAddress();\n        const customPayload = slice.loadMaybeRef();\n        const forwardAmount = slice.loadCoins();\n        const forwardPayload = readForwardPayloadCell(slice);\n        const comment = forwardPayload ? readComment(forwardPayload.asSlice()) : undefined;\n\n        let nft: ApiNft | undefined;\n        if (shouldLoadItems) {\n          const nftSuperCollectionsByCollectionAddress = await getNftSuperCollectionsByCollectionAddress();\n          const [rawNft] = await fetchNftItems(network, [address]);\n          if (rawNft) {\n            nft = parseTonapiioNft(network, rawNft, nftSuperCollectionsByCollectionAddress);\n          }\n        }\n\n        return {\n          type: 'nft:transfer',\n          queryId,\n          newOwner: toBase64Address(newOwner, undefined, network),\n          responseDestination: toBase64Address(responseDestination, undefined, network),\n          customPayload: customPayload?.toBoc().toString('base64'),\n          forwardAmount,\n          forwardPayload: forwardPayload?.toBoc().toString('base64'),\n          nftAddress: address,\n          nftName: nft?.name,\n          nft,\n          comment,\n        };\n      }\n      case NftOpCode.OwnershipAssigned: {\n        const prevOwner = slice.loadAddress();\n        const forwardPayload = readForwardPayloadCell(slice);\n        const comment = forwardPayload ? readComment(forwardPayload.asSlice()) : undefined;\n\n        let nft: ApiNft | undefined;\n        if (shouldLoadItems) {\n          const nftSuperCollectionsByCollectionAddress = await getNftSuperCollectionsByCollectionAddress();\n          const [rawNft] = await fetchNftItems(network, [address]);\n          if (rawNft) {\n            nft = parseTonapiioNft(network, rawNft, nftSuperCollectionsByCollectionAddress);\n          }\n        }\n\n        return {\n          type: 'nft:ownership-assigned',\n          queryId,\n          prevOwner: toBase64Address(prevOwner, undefined, network),\n          comment,\n          nftAddress: address,\n          nft,\n        };\n      }\n      case JettonOpCode.Burn: {\n        const tokenAddress = await resolveTokenAddress(network, address);\n        const slug = buildTokenSlug('ton', tokenAddress);\n\n        const amount = slice.loadCoins();\n        const addressObj = slice.loadAddress();\n        const customPayload = slice.loadMaybeRef();\n        const isLiquidUnstakeRequest = tokenAddress === LIQUID_JETTON;\n\n        return {\n          type: 'tokens:burn',\n          queryId,\n          amount,\n          address: toBase64Address(addressObj, undefined, network),\n          customPayload: customPayload?.toBoc().toString('base64'),\n          slug,\n          isLiquidUnstakeRequest,\n        };\n      }\n      case LiquidStakingOpCode.DistributedAsset: {\n        return {\n          type: 'liquid-staking:withdrawal-nft',\n          queryId,\n        };\n      }\n      case LiquidStakingOpCode.Withdrawal: {\n        return {\n          type: 'liquid-staking:withdrawal',\n          queryId,\n        };\n      }\n      case LiquidStakingOpCode.Deposit: {\n        let appId: bigint | undefined;\n        if (slice.remainingBits > 0) {\n          appId = slice.loadUintBig(64);\n        }\n        return {\n          type: 'liquid-staking:deposit',\n          queryId,\n          appId,\n        };\n      }\n      case VestingV1OpCode.AddWhitelist: {\n        const toAddress = slice.loadAddress();\n        const addressString = shouldLoadItems\n          ? await fixAddressFormat(network, toAddress.toRawString())\n          : '';\n\n        return {\n          type: 'vesting:add-whitelist',\n          queryId,\n          address: addressString,\n        };\n      }\n      case SingleNominatorOpCode.Withdraw: {\n        const amount = slice.loadCoins();\n        return {\n          type: 'single-nominator:withdraw',\n          queryId,\n          amount,\n        };\n      }\n      case SingleNominatorOpCode.ChangeValidator: {\n        const toAddress = slice.loadAddress();\n        const addressString = shouldLoadItems\n          ? await fixAddressFormat(network, toAddress.toRawString())\n          : '';\n\n        return {\n          type: 'single-nominator:change-validator',\n          queryId,\n          address: addressString,\n        };\n      }\n      case LiquidStakingOpCode.Vote: {\n        const votingAddress = slice.loadAddress();\n        const expirationDate = slice.loadUint(48);\n        const vote = slice.loadBit();\n        const needConfirmation = slice.loadBit();\n\n        return {\n          type: 'liquid-staking:vote',\n          queryId,\n          votingAddress: toBase64Address(votingAddress, true),\n          expirationDate,\n          vote,\n          needConfirmation,\n        };\n      }\n      case DnsOpCode.ChangeRecord: {\n        const hash = slice.loadBuffer(32).toString('hex');\n        const category = Object.entries(DNS_CATEGORY_HASH_MAP)\n          .find(([, value]) => hash === value)?.[0] as DnsCategory ?? 'unknown';\n        const toAddress = slice.loadAddress();\n        const domain = shouldLoadItems\n          ? await getDnsItemDomain(network, toAddress)\n          : '';\n\n        if (category === DnsCategory.Wallet) {\n          if (slice.remainingRefs > 0) {\n            const dataSlice = slice.loadRef().beginParse();\n            slice.endParse();\n\n            const dataAddress = dataSlice.loadAddress();\n            const flags = dataSlice.loadUint(8);\n\n            const addressString = shouldLoadItems\n              ? await fixAddressFormat(network, dataAddress.toRawString())\n              : '';\n\n            return {\n              type: 'dns:change-record',\n              queryId,\n              record: {\n                type: 'wallet',\n                value: addressString,\n                flags,\n              },\n              domain,\n            };\n          } else {\n            return {\n              type: 'dns:change-record',\n              queryId,\n              record: {\n                type: 'wallet',\n                value: undefined,\n              },\n              domain,\n            };\n          }\n        } else if (slice.remainingRefs > 0) {\n          const value = slice.loadRef();\n          return {\n            type: 'dns:change-record',\n            queryId,\n            record: category === DnsCategory.Unknown ? {\n              type: 'unknown',\n              key: hash,\n              value: value.toBoc().toString('base64'),\n            } : {\n              type: category,\n              value: value.toBoc().toString('base64'),\n            },\n            domain,\n          };\n        } else {\n          return {\n            type: 'dns:change-record',\n            queryId,\n            record: category === DnsCategory.Unknown ? {\n              type: 'unknown',\n              key: hash,\n            } : {\n              type: category,\n            },\n            domain,\n          };\n        }\n      }\n      case OtherOpCode.TokenBridgePaySwap: {\n        const swapId = slice.loadBuffer(32).toString('hex');\n        return {\n          type: 'token-bridge:pay-swap',\n          queryId,\n          swapId,\n        };\n      }\n      case JettonStakingOpCode.UnstakeRequest: {\n        const amount = slice.loadCoins();\n        const isForce = slice.loadBoolean();\n        return {\n          type: 'jetton-staking:unstake',\n          queryId,\n          amount,\n          isForce,\n        };\n      }\n    }\n  } catch (err) {\n    if (DEBUG) {\n      const debugTxString = transactionDebug\n        && `${transactionDebug.txId} ${new Date(transactionDebug.timestamp).toISOString()}`;\n      const opCodeHex = `0x${opCode?.toString(16).padStart(8, '0')}`;\n      logDebugError('parsePayload', opCodeHex, debugTxString, '\\n', err);\n    }\n  }\n\n  return undefined;\n}\n\nfunction dataToSlice(data: string | Buffer | Uint8Array): Slice {\n  let buffer: Buffer;\n  if (typeof data === 'string') {\n    buffer = Buffer.from(data, 'base64');\n  } else if (data instanceof Buffer) {\n    buffer = data;\n  } else {\n    buffer = Buffer.from(data);\n  }\n\n  try {\n    return Cell.fromBoc(buffer)[0].beginParse();\n  } catch (err: any) {\n    if (err?.message !== 'Invalid magic') {\n      throw err;\n    }\n  }\n\n  return new Slice(new BitReader(new BitString(buffer, 0, buffer.length * 8)), []);\n}\n\nexport function readComment(slice: Slice) {\n  if (slice.remainingBits < 32) {\n    return undefined;\n  }\n\n  const opCode = slice.loadUint(32) as OpCode;\n  if (opCode !== OpCode.Comment || (!slice.remainingBits && !slice.remainingRefs)) {\n    return undefined;\n  }\n\n  const buffer = readSnakeBytes(slice);\n  return buffer.toString('utf-8');\n}\n\nfunction readForwardPayloadCell(slice: Slice) {\n  let forwardPayload = slice.loadBit() && slice.remainingRefs ? slice.loadRef() : undefined;\n\n  if (!forwardPayload && slice.remainingBits) {\n    const builder = new Builder().storeBits(slice.loadBits(slice.remainingBits));\n    range(0, slice.remainingRefs).forEach(() => {\n      builder.storeRef(slice.loadRef());\n    });\n    forwardPayload = builder.endCell();\n  }\n\n  return forwardPayload ?? undefined;\n}\n\nexport function readSnakeBytes(slice: Slice) {\n  let buffer = Buffer.alloc(0);\n\n  while (slice.remainingBits >= 8) {\n    buffer = Buffer.concat([buffer, slice.loadBuffer(slice.remainingBits / 8)]);\n    if (slice.remainingRefs) {\n      slice = slice.loadRef().beginParse();\n    } else {\n      break;\n    }\n  }\n\n  return buffer;\n}\n\nexport function buildMtwCardsNftMetadata(metadata: {\n  image?: string;\n  id?: number;\n  attributes?: ApiNftAttribute[];\n}): ApiNftMetadata | undefined {\n  const { id, image, attributes } = metadata;\n\n  let mtwCardType: ApiMtwCardType | undefined;\n  let mtwCardTextType: ApiMtwCardTextType | undefined;\n  let result: ApiNftMetadata = {};\n  if (image) result.imageUrl = image;\n  if (id !== undefined) result.mtwCardId = id;\n\n  if (attributes && Array.isArray(attributes) && attributes.length) {\n    mtwCardType = attributes\n      .find((attribute) => attribute.trait_type === 'Card Type')?.value\n      // Clean non-ascii characters with regex\n      .replace(/[^\\x20-\\x7E]/g, '')\n      .trim()\n      .toLowerCase() as ApiMtwCardType;\n\n    if (mtwCardType) {\n      mtwCardTextType = attributes\n        .find((attribute) => attribute.trait_type === 'Text')?.value\n        .toLowerCase() as ApiMtwCardTextType;\n\n      result.mtwCardType = mtwCardType;\n      if (mtwCardType === 'standard') {\n        result.mtwCardBorderShineType = attributes\n          .find((attribute) => attribute.trait_type === 'Shine')?.value\n          .toLowerCase() as ApiMtwCardBorderShineType;\n      }\n\n      if (mtwCardTextType === 'dark' || mtwCardType === 'silver') {\n        result.mtwCardTextType = 'dark';\n      } else {\n        result.mtwCardTextType = 'light';\n      }\n\n      result = omitUndefined(result);\n    }\n  }\n\n  return !isEmptyObject(result) ? result : undefined;\n}\n\nexport function parseTonapiioNft(\n  network: ApiNetwork,\n  rawNft: NftItem,\n  nftSuperCollectionsByCollectionAddress: Record<string, ApiNftSuperCollection>,\n): ApiNft | undefined {\n  if (!rawNft.metadata) {\n    return undefined;\n  }\n\n  try {\n    const {\n      address,\n      index,\n      collection,\n      metadata: rawMetadata,\n      previews,\n      sale,\n      trust,\n      owner,\n    } = rawNft;\n\n    const {\n      name, image, description, render_type: renderType, attributes, lottie,\n    } = rawMetadata as {\n      name?: string;\n      image?: string;\n      description?: string;\n      render_type?: string;\n      attributes?: {\n        trait_type: string;\n        value: string;\n      }[];\n      lottie?: string;\n    };\n\n    const collectionAddress = collection && toBase64Address(collection.address, true, network);\n    let hasScamLink = false;\n\n    if (!collectionAddress || !checkIsTrustedCollection(collectionAddress)) {\n      for (const text of [name, description].filter(Boolean)) {\n        if (checkHasScamLink(text)) {\n          hasScamLink = true;\n        }\n      }\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-enum-comparison\n    const isWhitelisted = trust === 'whitelist';\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-enum-comparison\n    const isScam = hasScamLink || description === 'SCAM' || trust === 'blacklist';\n    const isHidden = renderType === 'hidden' || isScam;\n    const imageFromPreview = previews!.find((x) => x.resolution === '1500x1500')!.url;\n    const isFragmentGift = getIsFragmentGift(nftSuperCollectionsByCollectionAddress, collectionAddress);\n\n    const metadata = {\n      attributes,\n      ...(isWhitelisted && lottie && { lottie: getProxiedLottieUrl(lottie) }),\n      ...(collectionAddress === MTW_CARDS_COLLECTION && buildMtwCardsNftMetadata(rawMetadata)),\n      ...(isFragmentGift && { fragmentUrl: image!.replace(NFT_FRAGMENT_GIFT_IMAGE_TO_URL_REGEX, 'https://$1') }),\n    };\n\n    return omitUndefined<ApiNft>({\n      index,\n      name,\n      ownerAddress: owner ? toBase64Address(owner.address, false, network) : undefined,\n      address: toBase64Address(address, true, network),\n      image: fixIpfsUrl(imageFromPreview || image || ''),\n      thumbnail: previews!.find((x) => x.resolution === '500x500')!.url,\n      isOnSale: Boolean(sale),\n      isHidden,\n      isScam,\n      description,\n      ...(collection && {\n        collectionAddress,\n        collectionName: collection.name,\n        isOnFragment: isFragmentGift || NFT_FRAGMENT_COLLECTIONS.includes(collection.address),\n        isTelegramGift: isFragmentGift,\n      }),\n      metadata,\n    });\n  } catch (err) {\n    logDebugError('buildNft', err);\n    return undefined;\n  }\n}\n\nexport function getIsFragmentGift(\n  nftSuperCollectionsByCollectionAddress: Record<string, ApiNftSuperCollection>,\n  collectionAddress?: string,\n) {\n  return collectionAddress\n    ? nftSuperCollectionsByCollectionAddress[collectionAddress]?.id === TELEGRAM_GIFTS_SUPER_COLLECTION\n    : false;\n}\n","export function areDeepEqual<T>(value1: T, value2: T): boolean {\n  const type1 = typeof value1;\n  const type2 = typeof value2;\n  if (type1 !== type2) {\n    return false;\n  }\n\n  // eslint-disable-next-line no-null/no-null\n  if (type1 !== 'object' || value1 === null || value2 === null) {\n    return value1 === value2;\n  }\n\n  const isArray1 = Array.isArray(value1);\n  const isArray2 = Array.isArray(value2);\n\n  if (isArray1 !== isArray2) {\n    return false;\n  }\n\n  if (isArray1) {\n    const array1 = value1 as any[];\n    const array2 = value2 as any[];\n\n    if (array1.length !== array2.length) {\n      return false;\n    }\n\n    return array1.every((member1, i) => areDeepEqual(member1, array2[i]));\n  }\n\n  const object1 = value1 as AnyLiteral;\n  const object2 = value2 as AnyLiteral;\n  const keys1 = Object.keys(object1);\n  const keys2 = Object.keys(object2);\n\n  if (!keys1.every((key1) => object2.hasOwnProperty(key1))) {\n    return false;\n  }\n  if (!keys2.every((key2) => object1.hasOwnProperty(key2))) {\n    return false;\n  }\n\n  return keys1.every((key1) => areDeepEqual(object1[key1], object2[key1]));\n}\n","import type { ApiDapp, ApiDappRequest } from '../api/types';\n\nexport function getDappConnectionUniqueId(request: ApiDappRequest | ApiDapp): string {\n  return (request as any).sseOptions?.appClientId ?? (request as any).sse?.appClientId ?? 'jsbridge';\n}\n","import type chains from '../chains';\nimport type { ApiDbSseConnection } from '../db';\nimport type { StorageKey } from '../storages/types';\nimport type {\n  ApiActivity,\n  ApiDappsState,\n  ApiLocalTransactionParams,\n  ApiTonAccount,\n  ApiTonWallet,\n  ApiTransactionActivity,\n  OnApiUpdate,\n} from '../types';\n\nimport {\n  IS_CAPACITOR, IS_CORE_WALLET, IS_EXTENSION, MAIN_ACCOUNT_ID,\n} from '../../config';\nimport { parseAccountId } from '../../util/account';\nimport { buildLocalTxId } from '../../util/activities';\nimport { areDeepEqual } from '../../util/areDeepEqual';\nimport { assert } from '../../util/assert';\nimport { logDebugError } from '../../util/logs';\nimport { toBase64Address } from '../chains/ton/util/tonCore';\nimport { getEnvironment } from '../environment';\nimport * as migrations from '../migrations';\nimport { storage } from '../storages';\nimport capacitorStorage from '../storages/capacitorStorage';\nimport idbStorage from '../storages/idb';\nimport localStorage from '../storages/localStorage';\nimport {\n  checkHasScamLink,\n  checkHasTelegramBotMention,\n  getKnownAddresses,\n  getScamMarkers,\n} from './addresses';\nimport { hexToBytes } from './utils';\n\nconst actualStateVersion = 19;\nlet migrationEnsurePromise: Promise<void>;\n\nexport function buildLocalTransaction(\n  params: ApiLocalTransactionParams,\n  normalizedAddress: string,\n  subId?: number,\n): ApiTransactionActivity {\n  const { amount, ...restParams } = params;\n  const txId = buildLocalTxId(params.txId ?? params.externalMsgHashNorm!, subId);\n\n  return updateActivityMetadata({\n    id: txId,\n    status: 'pending',\n    kind: 'transaction',\n    timestamp: Date.now(),\n    isIncoming: false,\n    amount: -amount,\n    normalizedAddress,\n    ...restParams,\n    txId,\n  });\n}\n\nexport function updateActivityMetadata<T extends ApiActivity>(activity: T): T {\n  if (activity.kind !== 'transaction') {\n    return activity;\n  }\n\n  const {\n    normalizedAddress, comment, isIncoming, nft,\n  } = activity;\n  let { metadata = {} } = activity;\n\n  const isNftTransfer = Boolean(nft);\n  const knownAddresses = getKnownAddresses();\n  const hasScamMarkers = comment ? getScamMarkers().some((sm) => sm.test(comment)) : false;\n  const shouldCheckComment = !hasScamMarkers && comment && isIncoming\n    && (isNftTransfer || comment.toLowerCase().includes('claim'));\n  const hasScamInComment = shouldCheckComment\n    ? (checkHasScamLink(comment) || checkHasTelegramBotMention(comment))\n    : false;\n\n  if (normalizedAddress in knownAddresses) {\n    metadata = { ...metadata, ...knownAddresses[normalizedAddress] };\n  }\n\n  if (hasScamMarkers || hasScamInComment) {\n    metadata.isScam = true;\n  }\n\n  return { ...activity, metadata };\n}\n\nlet currentOnUpdate: OnApiUpdate | undefined;\n\nexport function connectUpdater(onUpdate: OnApiUpdate) {\n  currentOnUpdate = onUpdate;\n}\n\nexport function disconnectUpdater() {\n  currentOnUpdate = undefined;\n}\n\nexport function isUpdaterAlive(onUpdate: OnApiUpdate) {\n  return currentOnUpdate === onUpdate;\n}\n\nexport function startStorageMigration(onUpdate: OnApiUpdate, ton: typeof chains.ton, accountIds?: string[]) {\n  migrationEnsurePromise = migrateStorage(onUpdate, ton, accountIds)\n    .catch((err) => {\n      logDebugError('Migration error', err);\n      currentOnUpdate?.({\n        type: 'showError',\n        error: 'Migration error',\n      });\n    });\n  return migrationEnsurePromise;\n}\n\nexport function waitStorageMigration() {\n  return migrationEnsurePromise;\n}\n\nexport async function migrateStorage(onUpdate: OnApiUpdate, ton: typeof chains.ton, accountIds?: string[]) {\n  let version = Number(await storage.getItem('stateVersion', true));\n\n  if (version === actualStateVersion) {\n    return;\n  }\n\n  if (IS_CORE_WALLET && !version) {\n    await migrateCoreWallet(onUpdate);\n  }\n\n  if (IS_CAPACITOR && !version) {\n    if (await storage.getItem('accounts' as StorageKey, true)) {\n      // Fix broken version\n      version = 10;\n    } else {\n      // Prepare for migration to secure storage\n      const idbVersion = await idbStorage.getItem('stateVersion');\n      if (idbVersion) {\n        version = Number(idbVersion);\n      }\n    }\n  }\n\n  // Migration to chrome.storage\n  if (IS_EXTENSION && !version && !(await storage.getItem('addresses' as StorageKey))) {\n    version = await idbStorage.getItem('stateVersion');\n\n    if (version) {\n      // Switching from IndexedDB to `chrome.storage.local`\n      const idbData = await idbStorage.getAll!();\n      await storage.setMany!(idbData);\n    }\n  }\n\n  if (!version) {\n    await storage.setItem('stateVersion', actualStateVersion);\n    return;\n  }\n\n  // First version (v1)\n  if (!version) {\n    // Support multi-accounts\n    const mnemonicEncrypted = await storage.getItem('mnemonicEncrypted' as StorageKey);\n    if (mnemonicEncrypted) {\n      await storage.setItem('mnemonicsEncrypted' as StorageKey, JSON.stringify({\n        [MAIN_ACCOUNT_ID]: mnemonicEncrypted,\n      }));\n      await storage.removeItem('mnemonicEncrypted' as StorageKey);\n    }\n\n    // Change accountId format ('0' -> '0-ton', '1-ton-mainnet' -> '1-ton')\n    if (!mnemonicEncrypted) {\n      for (const field of ['mnemonicsEncrypted', 'addresses', 'publicKeys'] as unknown as StorageKey[]) {\n        const raw = await storage.getItem(field);\n        if (!raw) continue;\n\n        const oldItem = JSON.parse(raw);\n\n        const newItem = Object.entries(oldItem).reduce((prevValue, [accountId, data]) => {\n          const [id, chain = 'ton'] = accountId.split('-');\n          const internalAccountId = [id, chain].join('-');\n          prevValue[internalAccountId] = data;\n          return prevValue;\n        }, {} as any);\n\n        await storage.setItem(field, JSON.stringify(newItem));\n      }\n    }\n\n    version = 1;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 1) {\n    const addresses = await storage.getItem('addresses' as StorageKey) as string | undefined;\n    if (addresses && addresses.includes('-undefined')) {\n      for (const field of ['mnemonicsEncrypted', 'addresses', 'publicKeys'] as unknown as StorageKey[]) {\n        const newValue = (await storage.getItem(field) as string).replace('-undefined', '-ton');\n        await storage.setItem(field, newValue);\n      }\n    }\n\n    version = 2;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version >= 2 && version <= 4) {\n    for (const key of ['addresses', 'mnemonicsEncrypted', 'publicKeys', 'dapps'] as StorageKey[]) {\n      const rawData = await storage.getItem(key);\n      if (typeof rawData === 'string') {\n        await storage.setItem(key, JSON.parse(rawData));\n      }\n    }\n\n    version = 5;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 5) {\n    const dapps = await storage.getItem('dapps') as ApiDappsState;\n    if (dapps) {\n      for (const accountDapps of Object.values(dapps)) {\n        for (const dapp of Object.values(accountDapps as Record<string, any>)) {\n          dapp.connectedAt = 1;\n        }\n      }\n      await storage.setItem('dapps', dapps);\n    }\n\n    version = 6;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 6) {\n    for (const key of ['addresses', 'mnemonicsEncrypted', 'publicKeys', 'accounts', 'dapps'] as StorageKey[]) {\n      let data = await storage.getItem(key) as AnyLiteral;\n      if (!data) continue;\n\n      data = Object.entries(data).reduce((byAccountId, [internalAccountId, accountData]) => {\n        const parsed = parseAccountId(internalAccountId);\n        const mainnetAccountId = buildOldAccountId({ ...parsed, network: 'mainnet' });\n        const testnetAccountId = buildOldAccountId({ ...parsed, network: 'testnet' });\n        return {\n          ...byAccountId,\n          [mainnetAccountId]: accountData,\n          [testnetAccountId]: accountData,\n        };\n      }, {} as AnyLiteral);\n\n      await storage.setItem(key, data);\n    }\n\n    version = 7;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 7) {\n    const addresses = (await storage.getItem('addresses' as StorageKey)) as Record<string, string> | undefined;\n\n    if (addresses) {\n      const publicKeys = (await storage.getItem('publicKeys' as StorageKey)) as Record<string, string>;\n      const accounts = (await storage.getItem('accounts') ?? {}) as Record<string, ApiTonWallet>;\n\n      for (const [accountId, oldAddress] of Object.entries(addresses)) {\n        const newAddress = toBase64Address(oldAddress, false);\n\n        accounts[accountId] = {\n          ...accounts[accountId],\n          address: newAddress,\n          publicKey: publicKeys[accountId],\n        };\n\n        onUpdate({\n          type: 'updateAccount',\n          accountId,\n          chain: 'ton',\n          address: newAddress,\n        });\n      }\n\n      await storage.setItem('accounts', accounts);\n\n      await storage.removeItem('addresses' as StorageKey);\n      await storage.removeItem('publicKeys' as StorageKey);\n    }\n\n    version = 8;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 8) {\n    if (getEnvironment().isSseSupported) {\n      const dapps = await storage.getItem('dapps') as ApiDappsState;\n\n      if (dapps) {\n        const items: ApiDbSseConnection[] = [];\n\n        for (const accountDapps of Object.values(dapps)) {\n          for (const dapp of Object.values(accountDapps as Record<string, any>)) {\n            if (dapp.sse?.appClientId) {\n              items.push({ clientId: dapp.sse?.appClientId });\n            }\n          }\n        }\n      }\n    }\n\n    version = 9;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 9) {\n    if (IS_CAPACITOR) {\n      const data = await idbStorage.getAll!();\n\n      for (const [key, value] of Object.entries(data)) {\n        await capacitorStorage.setItem(key as StorageKey, value);\n        const newValue = await capacitorStorage.getItem(key as StorageKey, true);\n\n        if (!areDeepEqual(value, newValue)) {\n          throw new Error('Migration error!');\n        }\n      }\n      await idbStorage.clear();\n    }\n\n    version = 10;\n    await storage.setItem('stateVersion', version);\n  }\n\n  let isIosKeychainModeMigrated = false;\n  if (getEnvironment().isIosApp && version >= 10 && version <= 13) {\n    await iosBackupAndMigrateKeychainMode();\n    isIosKeychainModeMigrated = true;\n  }\n\n  if (version === 10 || version === 11 || version === 12) {\n    const accounts: Record<string, {\n      publicKey: string;\n      address: string;\n      version?: string;\n    }> | undefined = await storage.getItem('accounts', true);\n\n    if (accounts) {\n      for (const account of Object.values(accounts)) {\n        const { publicKey, address, version: walletVersion } = account;\n\n        if (walletVersion || !publicKey) continue;\n\n        const publicKeyBytes = hexToBytes(publicKey);\n        const walletInfo = ton.pickWalletByAddress('mainnet', publicKeyBytes, address);\n\n        account.version = walletInfo.version;\n      }\n\n      await storage.setItem('accounts', accounts);\n    }\n\n    version = 13;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 13) {\n    const accounts: Record<string, {\n      publicKey: string;\n      address: string;\n      version?: string;\n    }> | undefined = await storage.getItem('accounts', true);\n\n    if (accounts) {\n      for (const [accountId, account] of Object.entries(accounts)) {\n        const { network } = parseAccountId(accountId);\n        if (network === 'testnet') {\n          account.address = toBase64Address(account.address, false, network);\n\n          onUpdate({\n            type: 'updateAccount',\n            accountId,\n            chain: 'ton',\n            address: account.address,\n          });\n        }\n      }\n\n      version = 14;\n      await storage.setItem('accounts', accounts);\n    }\n  }\n\n  if (version === 14 || version === 15) {\n    if (getEnvironment().isIosApp && !isIosKeychainModeMigrated) {\n      await iosBackupAndMigrateKeychainMode();\n    }\n\n    version = 16;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 16) {\n    await migrations.migration16.start();\n\n    version = 17;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 17) {\n    await migrations.migration17.start();\n\n    version = 18;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 18) {\n    await migrations.migration18.start(accountIds);\n\n    version = 19;\n    await storage.setItem('stateVersion', version);\n  }\n}\n\nfunction buildOldAccountId(account: { id: number; network: string }) {\n  const { id, network } = account;\n  return `${id}-ton-${network}`;\n}\n\nasync function iosBackupAndMigrateKeychainMode() {\n  const keys = await capacitorStorage.getKeys();\n\n  if (keys?.length) {\n    const items: [string, any][] = [];\n\n    for (const key of keys) {\n      if (key.startsWith('backup_')) {\n        continue;\n      }\n\n      const backupKey = `backup_${key}` as StorageKey;\n      const value = await capacitorStorage.getItem(key as StorageKey, true);\n\n      assert(value !== undefined, 'Empty value!');\n      await capacitorStorage.setItem(backupKey, value);\n      const backupValue = await capacitorStorage.getItem(backupKey);\n      assert(areDeepEqual(value, backupValue), 'Data has not been saved!');\n\n      items.push([key, value]);\n    }\n\n    for (const [key, value] of items) {\n      let shouldRewrite = false;\n      await capacitorStorage.setItem(key as StorageKey, value).catch(() => {\n        shouldRewrite = true;\n      });\n\n      if (shouldRewrite) {\n        await capacitorStorage.removeItem(key as StorageKey);\n        await capacitorStorage.setItem(key as StorageKey, value);\n      }\n    }\n  }\n}\n\nasync function migrateCoreWallet(onUpdate: OnApiUpdate) {\n  const currentStorage = IS_EXTENSION ? storage : localStorage;\n\n  const [\n    // Default Core Wallet version is v3R2\n    // https://github.com/toncenter/ton-wallet/blob/master/src/js/Controller.js#L128\n    walletVersion = 'v3R2',\n    isTestnet,\n    address,\n    words,\n    publicKey,\n    isTonProxyEnabled,\n    isTonMagicEnabled,\n  ] = await Promise.all([\n    currentStorage.getItem('walletVersion' as StorageKey),\n    currentStorage.getItem('isTestnet' as StorageKey),\n    currentStorage.getItem('address' as StorageKey),\n    currentStorage.getItem('words' as StorageKey),\n    currentStorage.getItem('publicKey' as StorageKey),\n    currentStorage.getItem('proxy' as StorageKey),\n    currentStorage.getItem('magic' as StorageKey),\n  ]);\n\n  if (isTestnet) {\n    onUpdate({\n      type: 'updateSettings',\n      settings: {\n        isTestnet: true,\n      },\n    });\n  }\n\n  const network = isTestnet ? 'testnet' : 'mainnet';\n  const accountId = `0-ton-${network}`;\n\n  if (address && words && publicKey) {\n    const secondNetwork = network === 'mainnet' ? 'testnet' : 'mainnet';\n    const secondAccountId = `0-ton-${secondNetwork}`;\n    const secondAddress = toBase64Address(address, false, secondNetwork);\n\n    const newAccountById: Record<string, ApiTonAccount> = {};\n    newAccountById[accountId] = {\n      type: 'ton',\n      mnemonicEncrypted: words,\n      ton: {\n        type: 'ton',\n        address,\n        version: walletVersion,\n        publicKey,\n        index: 0,\n      },\n    };\n\n    newAccountById[secondAccountId] = {\n      type: 'ton',\n      mnemonicEncrypted: words,\n      ton: {\n        type: 'ton',\n        address: secondAddress,\n        version: walletVersion,\n        publicKey,\n        index: 0,\n      },\n    };\n\n    await storage.setItem('accounts', newAccountById);\n\n    onUpdate({\n      type: 'migrateCoreApplication',\n      isTestnet,\n      accountId,\n      address,\n      secondAccountId,\n      secondAddress,\n      isTonProxyEnabled,\n      isTonMagicEnabled,\n    });\n\n    // Clean up storage after migrate the app from Core Wallet\n    [\n      'walletVersion', 'isTestnet', 'words', 'address', 'publicKey', 'magic', 'proxy', 'isLedger',\n      'ledgerTransportType', '__time', 'isDebug',\n    ].forEach((key) => {\n      void currentStorage.removeItem(key as StorageKey);\n    });\n  }\n}\n","import { Cell } from '@ton/core';\n\nimport type {\n  ApiActivity,\n  ApiNetwork,\n  ApiNft,\n  ApiNftSuperCollection,\n  ApiSwapActivity,\n  ApiSwapDexLabel,\n  ApiToken,\n  ApiTransactionActivity,\n  ApiTransactionType,\n} from '../../../types';\nimport type {\n  AddressBook,\n  AnyAction,\n  AnyTokenMetadata,\n  AuctionBidAction,\n  CallContractAction,\n  ChangeDnsAction,\n  ContractDeployAction,\n  DeleteDnsAction,\n  DexDepositLiquidityAction,\n  DexSlug,\n  DexWithdrawLiquidityAction,\n  JettonBurnAction,\n  JettonMasterMetadata,\n  JettonMintAction,\n  JettonTransferAction,\n  MetadataMap,\n  NftCollectionMetadata,\n  NftItemMetadata,\n  NftMintAction,\n  NftTransferAction,\n  RenewDnsAction,\n  StakeDepositAction,\n  StakeWithdrawalAction,\n  StakeWithdrawalRequestAction,\n  SwapAction,\n  TonTransferAction,\n} from './types';\n\nimport {\n  BURN_ADDRESS,\n  DNS_IMAGE_GEN_URL,\n  ETHENA_STAKING_VAULT,\n  LIQUID_POOL,\n  MTW_CARDS_COLLECTION,\n  MYCOIN_STAKING_POOL,\n  NFT_FRAGMENT_COLLECTIONS,\n  NFT_FRAGMENT_GIFT_IMAGE_TO_URL_REGEX,\n  STON_PTON_ADDRESS,\n  TON_TSUSDE,\n  TON_USDE,\n  TONCOIN,\n} from '../../../../config';\nimport { buildTxId, parseTxId } from '../../../../util/activities';\nimport { toMilliseconds, toSeconds } from '../../../../util/datetime';\nimport { toDecimal } from '../../../../util/decimals';\nimport { getDnsDomainZone } from '../../../../util/dns';\nimport { fixIpfsUrl, getProxiedLottieUrl } from '../../../../util/fetch';\nimport { omitUndefined } from '../../../../util/iteratees';\nimport { logDebugError } from '../../../../util/logs';\nimport safeExec from '../../../../util/safeExec';\nimport { buildMtwCardsNftMetadata, getIsFragmentGift, readComment } from '../util/metadata';\nimport { toBase64Address } from '../util/tonCore';\nimport {\n  checkHasScamLink,\n  checkIsTrustedCollection,\n  getNftSuperCollectionsByCollectionAddress,\n} from '../../../common/addresses';\nimport { updateActivityMetadata } from '../../../common/helpers';\nimport { buildTokenSlug, getTokenBySlug } from '../../../common/tokens';\nimport {\n  EXCESS_OP_CODES,\n  JettonStakingOpCode,\n  OpCode,\n  OUR_FEE_PAYLOAD_BOC,\n  TeleitemOpCode,\n} from '../constants';\nimport { callToncenterV3 } from './other';\n\ntype ActionsResponse = {\n  actions: AnyAction[];\n  address_book: AddressBook;\n  metadata?: MetadataMap;\n};\n\ntype ParseOptions = {\n  network: ApiNetwork;\n  addressBook: AddressBook;\n  walletAddress: string;\n  metadata: MetadataMap;\n  nftSuperCollectionsByCollectionAddress: Record<string, ApiNftSuperCollection>;\n  isPending?: boolean;\n};\n\nconst RAW_LIQUID_POOL_ADDRESS = '0:F6FF877DD4CE1355B101572045F09D54C29309737EB52CA542CFA6C195F7CC5B';\nconst RAW_NFT_CARD_COLLECTION = '0:901362FD85FC31D55F2C82617D91EADA1F1D6B34AF559A047572D56F20D046CA';\nconst TME_RENEW_HASH_SUFFIX = '0000000000000000000000000000000000000000000000';\n\nconst RAW_NFT_COLLECTIONS_TO_RELOAD_METADATA = new Set<string | null>([RAW_NFT_CARD_COLLECTION]);\n\ntype FetchActionsOptions = {\n  network: ApiNetwork;\n  filter: {\n    /** Mismatches `walletAddress` when actions are requested for a specific token */\n    address: string | string[];\n  } | {\n    actionId: string | string[];\n  };\n  limit: number;\n  walletAddress: string;\n  fromTimestamp?: number;\n  toTimestamp?: number;\n  shouldIncludeFrom?: boolean;\n  shouldIncludeTo?: boolean;\n  includeTypes?: AnyAction['type'][];\n  excludeTypes?: AnyAction['type'][];\n};\n\nexport async function fetchActions(options: FetchActionsOptions): Promise<ApiActivity[]> {\n  const {\n    network, filter, limit, toTimestamp, fromTimestamp,\n    shouldIncludeFrom, shouldIncludeTo, walletAddress,\n    includeTypes, excludeTypes,\n  } = options;\n\n  const data: AnyLiteral = {\n    account: 'address' in filter ? filter.address : undefined,\n    action_id: 'actionId' in filter ? filter.actionId : undefined,\n    limit,\n    start_utime: fromTimestamp && toSeconds(fromTimestamp) + (!shouldIncludeFrom ? 1 : 0),\n    end_utime: toTimestamp && toSeconds(toTimestamp) - (!shouldIncludeTo ? 1 : 0),\n    sort: 'desc',\n    ...(includeTypes?.length && { action_type: includeTypes.join(',') }),\n    ...(excludeTypes?.length && { exclude_action_type: excludeTypes.join(',') }),\n  };\n\n  // The API sorts the actions by trace_end_lt + trace_id + action_end_lt + action_id.\n  // That is, the actions are grouped by the trace, and sorted by the time inside the groups.\n  const {\n    actions: rawActions,\n    address_book: addressBook,\n    metadata = {},\n  } = await callToncenterV3<ActionsResponse>(network, '/actions', data);\n  const nftSuperCollectionsByCollectionAddress = await getNftSuperCollectionsByCollectionAddress();\n\n  return parseActions(\n    network,\n    walletAddress,\n    rawActions,\n    addressBook,\n    metadata,\n    nftSuperCollectionsByCollectionAddress,\n  );\n}\n\nexport async function fetchPendingActions(network: ApiNetwork, address: string): Promise<ApiActivity[]> {\n  const {\n    actions,\n    address_book: addressBook,\n    metadata = {},\n  } = await callToncenterV3<ActionsResponse>(network, '/pendingActions', {\n    account: address,\n  });\n\n  const nftSuperCollectionsByCollectionAddress = await getNftSuperCollectionsByCollectionAddress();\n\n  return parseActions(\n    network,\n    address,\n    actions,\n    addressBook,\n    metadata,\n    nftSuperCollectionsByCollectionAddress,\n    true,\n  );\n}\n\nexport function parseActions(\n  network: ApiNetwork,\n  walletAddress: string,\n  rawActions: AnyAction[],\n  addressBook: AddressBook,\n  metadata: MetadataMap,\n  nftSuperCollectionsByCollectionAddress: Record<string, ApiNftSuperCollection>,\n  isPending?: boolean,\n): ApiActivity[] {\n  const options: ParseOptions = {\n    network,\n    addressBook,\n    walletAddress,\n    metadata,\n    nftSuperCollectionsByCollectionAddress,\n    isPending,\n  };\n  const activities = [];\n\n  for (const action of rawActions) {\n    activities.push(...parseAction(action, options));\n  }\n\n  return activities;\n}\n\nfunction parseAction(action: AnyAction, options: ParseOptions): ApiActivity[] {\n  let result: (ApiActivity | undefined)[] = [];\n\n  switch (action.type) {\n    case 'ton_transfer': {\n      result = [parseTonTransfer(action, options)];\n      break;\n    }\n    case 'call_contract': {\n      result = [parseCallContract(action, options)];\n      break;\n    }\n    case 'contract_deploy': {\n      result = [parseContractDeploy(action, options)];\n      break;\n    }\n    case 'nft_transfer': {\n      result = [parseNftTransfer(action, options)];\n      break;\n    }\n    case 'nft_mint': {\n      result = [parseNftMint(action, options)];\n      break;\n    }\n    case 'jetton_transfer': {\n      result = [parseJettonTransfer(action, options)];\n      break;\n    }\n    case 'jetton_mint': {\n      result = [parseJettonMint(action, options)];\n      break;\n    }\n    case 'jetton_burn': {\n      result = [parseJettonBurn(action, options)];\n      break;\n    }\n    case 'stake_deposit': {\n      result = [parseStakeDeposit(action, options)];\n      break;\n    }\n    case 'stake_withdrawal': {\n      result = [parseStakeWithdrawal(action, options)];\n      break;\n    }\n    case 'stake_withdrawal_request': {\n      result = [parseStakeWithdrawalRequest(action, options)];\n      break;\n    }\n    case 'jetton_swap': {\n      result = [parseJettonSwap(action, options)];\n      break;\n    }\n    case 'change_dns':\n    case 'delete_dns':\n    case 'renew_dns': {\n      result = [parseDns(action, options)];\n      break;\n    }\n    case 'auction_bid': {\n      result = [parseAuctionBid(action, options)];\n      break;\n    }\n    case 'dex_deposit_liquidity': {\n      result = parseLiquidityDeposit(action, options);\n      break;\n    }\n    case 'dex_withdraw_liquidity': {\n      result = parseLiquidityWithdraw(action, options);\n      break;\n    }\n  }\n\n  for (let i = 0; i < result.length; i++) {\n    const activity = result[i];\n    if (!activity) continue;\n\n    if ('nft' in activity && activity.nft?.isHidden) {\n      activity.shouldHide = true;\n    }\n\n    if (activity.kind === 'transaction' && !activity.isIncoming) {\n      activity.shouldLoadDetails ??= true;\n    }\n\n    result[i] = updateActivityMetadata(activity);\n  }\n\n  return result.filter(Boolean);\n}\n\nfunction parseTonTransfer(action: TonTransferAction, options: ParseOptions): ApiTransactionActivity {\n  const { details, details: { encrypted: isEncrypted, source, destination, value } } = action;\n\n  const comment = (!isEncrypted && details.comment) || undefined;\n  const encryptedComment = (isEncrypted && details.comment) || undefined;\n\n  return {\n    ...parseCommonFields(action, options, source, destination, value),\n    slug: TONCOIN.slug,\n    comment,\n    encryptedComment,\n  };\n}\n\nfunction parseCallContract(action: CallContractAction, options: ParseOptions): ApiTransactionActivity | undefined {\n  const { walletAddress } = options;\n  const { details, details: { source, destination, value } } = action;\n\n  const common = parseCommonFields(action, options, source, destination, value);\n  const opCode = Number(details.opcode);\n  const shouldHide = !common.isIncoming && [OpCode.OurFee, TeleitemOpCode.Ok].includes(opCode);\n\n  let type: ApiTransactionType | undefined;\n  if (EXCESS_OP_CODES.includes(opCode)) {\n    type = 'excess';\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-enum-comparison\n  } else if (opCode === OpCode.Bounced) {\n    type = 'bounced';\n  } else if ([JettonStakingOpCode.UnstakeRequest, JettonStakingOpCode.ClaimRewards].includes(opCode)) {\n    type = 'unstakeRequest';\n  } else if (common.toAddress !== walletAddress) {\n    type = 'callContract';\n  }\n\n  return {\n    ...common,\n    slug: TONCOIN.slug,\n    type,\n    shouldHide,\n  };\n}\n\nfunction parseContractDeploy(action: ContractDeployAction, options: ParseOptions): ApiTransactionActivity | undefined {\n  const { details: { source, destination } } = action;\n\n  if (!source) {\n    return undefined;\n  }\n\n  // Deploy action is additional and always occurs alongside others (duplicating amount), so we hide amount and fee.\n\n  return {\n    ...parseCommonFields(action, options, source, destination),\n    slug: TONCOIN.slug,\n    type: 'contractDeploy',\n    shouldLoadDetails: false,\n    fee: 0n,\n  };\n}\n\nfunction parseJettonTransfer(action: JettonTransferAction, options: ParseOptions): ApiTransactionActivity {\n  const { addressBook } = options;\n  const {\n    details,\n    details: {\n      is_encrypted_comment: isEncrypted,\n      forward_payload: forwardPayload,\n      sender,\n      receiver,\n      amount,\n    },\n  } = action;\n\n  const common = parseCommonFields(action, options, sender, receiver, amount);\n  const { isIncoming, toAddress, fromAddress } = common;\n\n  const comment = (!isEncrypted && details.comment) || undefined;\n  const encryptedComment = (isEncrypted && details.comment) || undefined;\n  const tokenAddress = addressBook[details.asset].user_friendly;\n  const slug = buildTokenSlug('ton', tokenAddress);\n  const shouldHide = !isIncoming && forwardPayload === OUR_FEE_PAYLOAD_BOC;\n\n  let type: ApiTransactionType;\n  if (toAddress === BURN_ADDRESS) {\n    type = 'burn';\n  } else if (toAddress === MYCOIN_STAKING_POOL) {\n    type = 'stake';\n  } else if (fromAddress === MYCOIN_STAKING_POOL) {\n    type = 'unstake';\n  } else if (tokenAddress === TON_USDE.tokenAddress) {\n    if (fromAddress === ETHENA_STAKING_VAULT) {\n      type = 'unstake';\n    } else if (toAddress === ETHENA_STAKING_VAULT) {\n      type = 'stake';\n    }\n  }\n\n  return {\n    ...common,\n    slug,\n    comment,\n    encryptedComment,\n    shouldHide,\n    type,\n  };\n}\n\nfunction parseJettonMint(action: JettonMintAction, options: ParseOptions): ApiTransactionActivity {\n  const { addressBook } = options;\n  const {\n    details,\n    details: {\n      receiver,\n      receiver_jetton_wallet: jettonWalletRaw,\n      amount,\n    },\n  } = action;\n\n  const tokenAddress = addressBook[details.asset].user_friendly;\n  const slug = buildTokenSlug('ton', tokenAddress);\n\n  let commonFields: ReturnType<typeof parseCommonFields>;\n  let type: ApiTransactionType = 'mint';\n\n  if (\n    tokenAddress === TON_TSUSDE.tokenAddress\n    && action.end_lt !== action.trace_end_lt\n  ) {\n    // TODO After fix on Toncenter's side, move it to transfer parsing (currently it's mistakenly detected as mint)\n    type = 'unstakeRequest';\n    commonFields = {\n      ...parseCommonFields(action, options, receiver, receiver, 0),\n      toAddress: ETHENA_STAKING_VAULT,\n      isIncoming: false,\n      normalizedAddress: ETHENA_STAKING_VAULT,\n    };\n  } else {\n    commonFields = parseCommonFields(action, options, jettonWalletRaw, receiver, amount);\n  }\n\n  return {\n    ...commonFields,\n    slug,\n    type,\n  };\n}\n\nfunction parseJettonBurn(action: JettonBurnAction, options: ParseOptions): ApiTransactionActivity {\n  const { network } = options;\n  const { details, details: { owner, owner_jetton_wallet: jettonWallet, amount } } = action;\n\n  const slug = buildTokenSlug('ton', toBase64Address(details.asset, true, network));\n\n  return {\n    ...parseCommonFields(action, options, owner, jettonWallet, amount),\n    slug,\n    type: 'burn',\n  };\n}\n\nfunction parseNftTransfer(action: NftTransferAction, options: ParseOptions): ApiTransactionActivity {\n  const {\n    metadata,\n    walletAddress,\n    addressBook,\n    nftSuperCollectionsByCollectionAddress,\n  } = options;\n\n  const {\n    nft_item_index: index,\n    nft_item: rawNftAddress,\n    nft_collection: rawCollectionAddress,\n    new_owner: newOwner,\n    old_owner: oldOwner,\n    forward_payload: forwardPayload,\n    is_purchase: isPurchase,\n    price,\n    response_destination: responseDestination,\n    marketplace,\n  } = action.details;\n\n  const { nft, isMetadataMissing } = parseToncenterNft(\n    metadata,\n    rawNftAddress,\n    nftSuperCollectionsByCollectionAddress,\n    rawCollectionAddress ?? undefined,\n    index ?? undefined,\n  );\n\n  let shouldHide = !nft && rawCollectionAddress ? isHiddenCollection(rawCollectionAddress, metadata) : undefined;\n\n  // Hide duplicate NFT transfer actions that appear when listing NFT on Getgems marketplace\n  // These are actions where old_owner and new_owner are not the wallet address,\n  // but wallet address is only in response_destination\n  if (oldOwner && newOwner && responseDestination) {\n    const oldOwnerAddress = addressBook[oldOwner]?.user_friendly;\n    const newOwnerAddress = addressBook[newOwner]?.user_friendly;\n\n    if (oldOwnerAddress !== walletAddress && newOwnerAddress !== walletAddress) {\n      shouldHide = true;\n    }\n  }\n\n  const activity: ApiTransactionActivity = {\n    ...parseCommonFields(action, options, oldOwner ?? rawNftAddress, newOwner),\n    shouldHide,\n    slug: TONCOIN.slug,\n    nft,\n    comment: (forwardPayload && safeReadComment(forwardPayload)) || undefined,\n    shouldReload: (isMetadataMissing && RAW_NFT_COLLECTIONS_TO_RELOAD_METADATA.has(action.details.nft_collection))\n      || undefined,\n  };\n\n  if (activity.toAddress === BURN_ADDRESS) {\n    activity.type = 'burn';\n  } else if (isPurchase && price) {\n    const isBuying = addressBook[newOwner]?.user_friendly === walletAddress;\n    activity.type = 'nftTrade';\n    activity.isIncoming = !isBuying;\n    activity.amount = isBuying ? -BigInt(price) : BigInt(price);\n    activity.extra = {\n      marketplace: marketplace ?? undefined,\n    };\n  }\n\n  return activity;\n}\n\nfunction parseNftMint(action: NftMintAction, options: ParseOptions): ApiTransactionActivity {\n  const { metadata, nftSuperCollectionsByCollectionAddress } = options;\n\n  const {\n    owner,\n    nft_item_index: index,\n    nft_item: rawNftAddress,\n    nft_collection: rawCollectionAddress,\n  } = action.details;\n\n  const { nft, isMetadataMissing } = parseToncenterNft(\n    metadata,\n    rawNftAddress,\n    nftSuperCollectionsByCollectionAddress,\n    rawCollectionAddress ?? undefined,\n    index ?? undefined,\n  );\n\n  return {\n    ...parseCommonFields(action, options, owner, rawNftAddress),\n    slug: TONCOIN.slug,\n    nft,\n    type: 'mint',\n    shouldReload: (isMetadataMissing && RAW_NFT_COLLECTIONS_TO_RELOAD_METADATA.has(action.details.nft_collection))\n      || undefined,\n  };\n}\n\nfunction isHiddenCollection(rawCollectionAddress: string, metadata: MetadataMap) {\n  const collectionMetadata = metadata[rawCollectionAddress]?.token_info[0] as NftCollectionMetadata | undefined;\n  return collectionMetadata?.name?.includes('Withdrawal Payout');\n}\n\nfunction parseStakeDeposit(action: StakeDepositAction, options: ParseOptions): ApiTransactionActivity {\n  const { details: { stake_holder: holder, pool, amount } } = action;\n\n  return {\n    ...parseCommonFields(action, options, holder, pool, amount),\n    slug: TONCOIN.slug,\n    type: 'stake',\n  };\n}\n\nfunction parseStakeWithdrawal(action: StakeWithdrawalAction, options: ParseOptions): ApiTransactionActivity {\n  const { addressBook } = options;\n  const { details, details: { stake_holder: holder, amount } } = action;\n\n  // Fix issue with old data when pool is null\n  const pool = details.pool ?? RAW_LIQUID_POOL_ADDRESS;\n  const fixedOptions = pool in addressBook ? options : {\n    ...options,\n    addressBook: {\n      ...addressBook,\n      // eslint-disable-next-line no-null/no-null\n      [pool]: { user_friendly: LIQUID_POOL, domain: null },\n    },\n  };\n\n  return {\n    ...parseCommonFields(action, fixedOptions, pool, holder, amount),\n    slug: TONCOIN.slug,\n    type: 'unstake',\n    shouldLoadDetails: details.provider === 'tonstakers' && !details.payout_nft,\n  };\n}\n\nfunction parseStakeWithdrawalRequest(\n  action: StakeWithdrawalRequestAction,\n  options: ParseOptions,\n): ApiTransactionActivity {\n  const { details: { stake_holder: holder, pool } } = action;\n\n  return {\n    ...parseCommonFields(action, options, holder, pool, 0), // TODO (actions) Replace to real fee\n    slug: TONCOIN.slug,\n    type: 'unstakeRequest',\n  };\n}\n\nfunction parseJettonSwap(action: SwapAction, options: ParseOptions): ApiSwapActivity {\n  const { metadata, isPending } = options;\n  const {\n    end_utime: endUtime,\n    success: isSuccess,\n    details: {\n      dex_incoming_transfer: {\n        amount: fromAmount,\n        asset: fromAsset,\n      },\n      dex_outgoing_transfer: {\n        amount: toAmount,\n        asset: toAsset,\n      },\n    },\n  } = action;\n\n  const decimalsFrom = (fromAsset && parseToncenterJetton(fromAsset, metadata)?.decimals) || TONCOIN.decimals;\n  const decimalsTo = (toAsset && parseToncenterJetton(toAsset, metadata)?.decimals) || TONCOIN.decimals;\n\n  const fromTokenAddress = fromAsset ? toBase64Address(fromAsset, true) : undefined;\n  const toTokenAddress = toAsset ? toBase64Address(toAsset, true) : undefined;\n\n  const from = fromTokenAddress && fromTokenAddress !== STON_PTON_ADDRESS\n    ? buildTokenSlug('ton', fromTokenAddress) : TONCOIN.slug;\n  const to = toTokenAddress && toTokenAddress !== STON_PTON_ADDRESS\n    ? buildTokenSlug('ton', toTokenAddress) : TONCOIN.slug;\n\n  return {\n    kind: 'swap',\n    id: buildActionActivityId(action),\n    timestamp: toMilliseconds(endUtime),\n    from,\n    fromAmount: toDecimal(BigInt(fromAmount), decimalsFrom),\n    to,\n    toAmount: toDecimal(BigInt(toAmount), decimalsTo),\n    networkFee: '0',\n    swapFee: '0',\n    ourFee: '0',\n    status: isPending ? 'pending' : isSuccess ? 'completed' : 'failed',\n    hashes: [],\n    externalMsgHashNorm: action.trace_external_hash_norm ?? action.trace_external_hash,\n    shouldLoadDetails: true,\n  };\n}\n\nfunction parseDns(\n  action: ChangeDnsAction | RenewDnsAction | DeleteDnsAction,\n  options: ParseOptions,\n): ApiTransactionActivity {\n  const { metadata, nftSuperCollectionsByCollectionAddress } = options;\n  const { details: { source, asset } } = action;\n\n  const { nft } = parseToncenterNft(metadata, asset, nftSuperCollectionsByCollectionAddress);\n\n  let type: ApiTransactionType;\n  if (action.type === 'change_dns') {\n    const { sum_type: sumType } = action.details.value;\n    if (sumType === 'DNSSmcAddress') {\n      type = 'dnsChangeAddress';\n    } else if (sumType === 'DNSAdnlAddress') {\n      type = 'dnsChangeSite';\n    } else if (sumType === 'DNSStorageAddress') {\n      type = 'dnsChangeStorage';\n    } else if (sumType === 'DNSNextResolver') {\n      type = 'dnsChangeSubdomains';\n    }\n  } else if (\n    action.type === 'renew_dns'\n    || (action.type === 'delete_dns' && action.details.hash.endsWith(TME_RENEW_HASH_SUFFIX))\n  ) {\n    type = 'dnsRenew';\n  } else {\n    type = 'dnsDelete';\n  }\n\n  return {\n    ...parseCommonFields(action, options, source, asset, 0), // TODO (actions) Replace to real fee\n    slug: TONCOIN.slug,\n    type,\n    nft,\n  };\n}\n\nfunction parseAuctionBid(action: AuctionBidAction, options: ParseOptions): ApiTransactionActivity {\n  const { metadata, nftSuperCollectionsByCollectionAddress } = options;\n  const { details } = action;\n\n  const {\n    bidder,\n    auction,\n    nft_item_index: index,\n    nft_item: rawNftAddress,\n    nft_collection: rawCollectionAddress,\n  } = details;\n\n  const { nft } = parseToncenterNft(\n    metadata,\n    rawNftAddress ?? undefined,\n    nftSuperCollectionsByCollectionAddress,\n    rawCollectionAddress ?? undefined,\n    index ?? undefined,\n  );\n\n  return {\n    ...parseCommonFields(action, options, bidder, auction, details.amount),\n    slug: TONCOIN.slug,\n    type: 'auctionBid',\n    nft,\n  };\n}\n\nexport function parseLiquidityDeposit(\n  action: DexDepositLiquidityAction,\n  options: ParseOptions,\n): ApiTransactionActivity[] {\n  const { addressBook } = options;\n  const { details, details: { source, pool, destination_liquidity: destinationAddress, dex } } = action;\n\n  const common = parseCommonFields(action, options, source, pool ?? destinationAddress);\n\n  const partialExtended = {\n    ...common,\n    type: 'liquidityDeposit',\n    extra: {\n      dex: convertDexId(dex),\n    },\n  } as const;\n\n  const activities: ApiTransactionActivity[] = [{\n    ...partialExtended,\n    amount: -BigInt(details.amount_1 ?? 0n),\n    slug: getAssetSlug(addressBook, details.asset_1),\n  }];\n\n  // eslint-disable-next-line no-null/no-null\n  if (details.amount_2 !== null) {\n    const id = buildActionActivityId(action, 'additional');\n    activities.push({\n      ...partialExtended,\n      id,\n      txId: id,\n      amount: -BigInt(details.amount_2),\n      slug: getAssetSlug(addressBook, details.asset_2),\n    });\n  }\n\n  return activities;\n}\n\nfunction parseLiquidityWithdraw(action: DexWithdrawLiquidityAction, options: ParseOptions): ApiTransactionActivity[] {\n  const { addressBook } = options;\n  const { details, details: { source, pool, dex } } = action;\n\n  const common = parseCommonFields(action, options, pool, source);\n\n  const partialExtended = {\n    ...common,\n    shouldLoadDetails: true,\n    type: 'liquidityWithdraw',\n    extra: {\n      dex: convertDexId(dex),\n    },\n  } as const;\n\n  const additionalId = buildActionActivityId(action, 'additional');\n\n  return [\n    {\n      ...partialExtended,\n      amount: BigInt(details.amount_1),\n      slug: getAssetSlug(addressBook, details.asset_1),\n    },\n    {\n      ...partialExtended,\n      id: additionalId,\n      txId: additionalId,\n      amount: BigInt(details.amount_2),\n      slug: getAssetSlug(addressBook, details.asset_2),\n    },\n  ];\n}\n\nfunction getAssetSlug(addressBook: AddressBook, rawAddress?: string | null) {\n  return rawAddress ? buildTokenSlug('ton', addressBook[rawAddress].user_friendly) : TONCOIN.slug;\n}\n\nfunction parseCommonFields(\n  action: AnyAction,\n  options: ParseOptions,\n  rawFromAddress: string,\n  rawToAddress: string,\n  amountString: string | number = 0,\n) {\n  const id = buildActionActivityId(action);\n  const { walletAddress, network, addressBook, isPending } = options;\n  const fromAddress = addressBook[rawFromAddress].user_friendly;\n  const toAddress = addressBook[rawToAddress].user_friendly;\n  const isIncoming = toAddress === walletAddress;\n  const normalizedAddress = toBase64Address(isIncoming ? fromAddress : toAddress, true, network);\n  const amount = isIncoming ? BigInt(amountString) : -BigInt(amountString);\n  return {\n    kind: 'transaction',\n    id,\n    txId: id,\n    timestamp: toMilliseconds(action.end_utime),\n    externalMsgHashNorm: action.trace_external_hash_norm ?? action.trace_external_hash,\n    fee: 0n, // Calculated when TransactionModal opens\n    fromAddress,\n    toAddress,\n    isIncoming,\n    normalizedAddress,\n    amount,\n    status: isPending ? 'pending' : action.success ? 'completed' : 'failed',\n  } satisfies Partial<ApiTransactionActivity>;\n}\n\nfunction parseToncenterNft(\n  metadataMap: MetadataMap,\n  rawNftAddress: string,\n  nftSuperCollectionsByCollectionAddress: Record<string, ApiNftSuperCollection>,\n  rawCollectionAddress?: string,\n  index?: string,\n): { nft?: ApiNft; isMetadataMissing?: true } {\n  try {\n    const nftMetadata = extractMetadata<NftItemMetadata>(rawNftAddress, metadataMap, 'nft_items');\n\n    if (!nftMetadata) {\n      return { isMetadataMissing: true };\n    }\n\n    const { name, description, extra } = nftMetadata;\n    let { image } = nftMetadata;\n    const lottie = extra?.lottie ? getProxiedLottieUrl(extra.lottie) : undefined;\n\n    const nftAddress = toBase64Address(rawNftAddress, true);\n    const collectionMetadata = rawCollectionAddress\n      ? extractMetadata<NftCollectionMetadata>(rawCollectionAddress, metadataMap, 'nft_collections')\n      : undefined;\n    const collectionAddress = rawCollectionAddress ? toBase64Address(rawCollectionAddress, true) : undefined;\n\n    // TODO (actions) Determine that this is a domain by the collection address once Toncenter adds it\n    const domain = extra?.domain ?? name ?? '';\n    const { zone: domainZone, base: domainBase } = getDnsDomainZone(domain) ?? {};\n\n    if (domainZone && (!collectionAddress || !image)) {\n      if (domainZone.suffixes[0] === 'ton') {\n        image = `${DNS_IMAGE_GEN_URL}${domainBase}`;\n      }\n\n      const nft = omitUndefined<ApiNft>({\n        index: Number(index),\n        name: domain,\n        address: nftAddress,\n\n        thumbnail: extra?._image_medium ?? image!,\n        image: image!,\n        description,\n        isOnSale: false, // TODO (actions) Replace with real value when Toncenter supports it\n        collectionAddress: collectionAddress ?? domainZone.resolver,\n        collectionName: domainZone.collectionName,\n        metadata: {\n          ...(lottie && { lottie }),\n        },\n      });\n      return { nft };\n    }\n\n    let hasScamLink = false;\n\n    if (!collectionAddress || !checkIsTrustedCollection(collectionAddress)) {\n      for (const text of [name, description].filter(Boolean)) {\n        if (checkHasScamLink(text)) {\n          hasScamLink = true;\n        }\n      }\n    }\n\n    const isScam = hasScamLink; // TODO (actions) Replace with real value when Toncenter supports it\n    const isHidden = extra?.render_type === 'hidden' || isScam;\n    const isFragmentGift = getIsFragmentGift(nftSuperCollectionsByCollectionAddress, collectionAddress);\n    const isMtwCard = collectionAddress === MTW_CARDS_COLLECTION;\n    const fixedImage = image ? fixIpfsUrl(image) : undefined;\n\n    const thumbnail = extra?._image_medium ?? fixedImage!;\n\n    const nft: ApiNft = omitUndefined<ApiNft>({\n      index: Number(index),\n      name: name!,\n      address: nftAddress,\n      thumbnail,\n      image: fixedImage!,\n      description,\n      isOnSale: false, // TODO (actions) Replace with real value when Toncenter supports it\n      isHidden,\n      metadata: {\n        ...(isFragmentGift && {\n          fragmentUrl: image!.replace(NFT_FRAGMENT_GIFT_IMAGE_TO_URL_REGEX, 'https://$1'),\n        }),\n        // `id` must be set to `index + 1`. Unlike TonApi where this field is preformatted,\n        // we need to manually adjust it here due to data source differences.\n        ...(isMtwCard && buildMtwCardsNftMetadata({\n          id: Number(index || 0) + 1, image, attributes: extra?.attributes,\n        })),\n      },\n      ...(collectionAddress && {\n        collectionAddress,\n        collectionName: collectionMetadata?.name,\n        isOnFragment: isFragmentGift || NFT_FRAGMENT_COLLECTIONS.includes(rawCollectionAddress!),\n        isTelegramGift: isFragmentGift,\n      }),\n    });\n\n    return { nft };\n  } catch (err) {\n    logDebugError('parseToncenterNft', err);\n    return {};\n  }\n}\n\nfunction parseToncenterJetton(rawAddress: string, metadata: MetadataMap): ApiToken | undefined {\n  const tokenAddress = toBase64Address(rawAddress, true);\n  const slug = buildTokenSlug('ton', tokenAddress);\n  const token = getTokenBySlug(slug);\n\n  if (token) {\n    return token;\n  }\n\n  const jettonMetadata = extractMetadata<JettonMasterMetadata>(rawAddress, metadata, 'jetton_masters');\n\n  if (!jettonMetadata) {\n    return undefined;\n  }\n\n  return {\n    tokenAddress,\n    slug,\n    chain: 'ton',\n    name: jettonMetadata.name!,\n    symbol: jettonMetadata.symbol!,\n    image: jettonMetadata.image!,\n    decimals: Number(jettonMetadata.extra!.decimals),\n  };\n}\n\nfunction extractMetadata<T extends AnyTokenMetadata>(\n  rawAddress: string,\n  metadata: MetadataMap,\n  type: AnyTokenMetadata['type'],\n): T | undefined {\n  const data = metadata[rawAddress];\n  if (!data || !data.is_indexed) return undefined;\n  return data.token_info?.find((tokenInfo) => tokenInfo.type === type) as T;\n}\n\nfunction safeReadComment(payloadBase64: string) {\n  return safeExec(() => {\n    const cell = Cell.fromBase64(payloadBase64);\n    if (cell.isExotic) return undefined;\n    return readComment(cell.asSlice());\n  });\n}\n\nfunction buildActionActivityId(action: AnyAction, type?: 'additional') {\n  // `lt` in activity ID is needed for sorting when timestamps are same.\n  // The sorting is tuned to match the Toncenter API sorting as close as possible.\n  const subId = `${action.start_lt}-${action.action_id}`;\n  return buildTxId(\n    action.trace_id ?? action.trace_external_hash_norm ?? action.trace_external_hash,\n    subId,\n    type,\n  );\n}\n\nexport function parseActionActivityId(id: string) {\n  const { hash: traceId, subId } = parseTxId(id);\n  const [startLt, actionId] = subId!.split('-');\n  return { traceId, startLt, actionId };\n}\n\nfunction convertDexId(toncenterDex: DexSlug | undefined): ApiSwapDexLabel | undefined {\n  switch (toncenterDex) {\n    case 'dedust':\n      return 'dedust';\n    case 'stonfi':\n    case 'stonfi_v2':\n      return 'ston';\n    default:\n      return undefined;\n  }\n}\n","export function createCallbackManager<T extends AnyToVoidFunction = AnyToVoidFunction>() {\n  const callbacks = new Set<T>();\n\n  function addCallback(cb: T) {\n    callbacks.add(cb);\n\n    return () => {\n      removeCallback(cb);\n    };\n  }\n\n  function removeCallback(cb: T) {\n    callbacks.delete(cb);\n  }\n\n  function runCallbacks(...args: Parameters<T>) {\n    callbacks.forEach((callback) => {\n      callback(...args);\n    });\n  }\n\n  function hasCallbacks() {\n    return Boolean(callbacks.size);\n  }\n\n  return {\n    runCallbacks,\n    addCallback,\n    removeCallback,\n    hasCallbacks,\n  };\n}\n\nexport type CallbackManager<T extends AnyToVoidFunction = AnyToVoidFunction>\n  = ReturnType<typeof createCallbackManager<T>>;\n\nexport class EventEmitter {\n  private channels = new Map<string, CallbackManager>();\n\n  on(name: string, handler: AnyToVoidFunction) {\n    this.resolveChannel(name).addCallback(handler);\n    return this;\n  }\n\n  removeListener(name: string, handler: AnyToVoidFunction) {\n    this.resolveChannel(name).removeCallback(handler);\n    return this;\n  }\n\n  emit(name: string, ...args: any) {\n    this.resolveChannel(name).runCallbacks(...args);\n    return this;\n  }\n\n  private resolveChannel(name: string) {\n    let channel = this.channels.get(name);\n    if (!channel) {\n      channel = createCallbackManager();\n      this.channels.set(name, channel);\n    }\n\n    return channel;\n  }\n}\n","import { createCallbackManager } from './callbacks';\nimport { setCancellableTimeout } from './schedulers';\n\nconst focusListeners = createCallbackManager<NoneToVoidFunction>();\n\nlet isFocused = true;\n\n/**\n * Calls `cb` when `ms` milliseconds pass if the app is focused at that moment.\n * Otherwise, waits until the app is focused or `forceMs` millisecond pass (since the very beginning).\n * Returns a function to cancel the timers.\n */\nexport function onFocusAwareDelay(ms: number, forceMs: number, cb: NoneToVoidFunction) {\n  let cleanup: NoneToVoidFunction;\n\n  const callCb = () => {\n    cleanup();\n    cb();\n  };\n\n  // Stage 1: waiting for the minimum time to pass\n  cleanup = setCancellableTimeout(ms, () => {\n    if (isFocused) {\n      callCb();\n    } else {\n      // If the window is not focused, stage2: waiting for either the maximum time to pass or the window to get focused\n      const unsubscribeFocus = focusListeners.addCallback(callCb);\n      const cancelSecondTimeout = setCancellableTimeout(forceMs - ms, callCb);\n      cleanup = () => {\n        unsubscribeFocus();\n        cancelSecondTimeout();\n      };\n    }\n  });\n\n  // We don't return just `cleanup` because it's not constant\n  return () => cleanup();\n}\n\n/**\n * @see onFocusAwareDelay\n */\nexport function focusAwareDelay(ms: number, msWhenNotFocused: number) {\n  return new Promise<void>((resolve) => {\n    onFocusAwareDelay(ms, msWhenNotFocused, resolve);\n  });\n}\n\nexport function setIsAppFocused(_isFocused: boolean) {\n  isFocused = _isFocused;\n\n  if (_isFocused) {\n    focusListeners.runCallbacks();\n  }\n}\n","export const SEC = 1000;\nexport const MINUTE = 60 * SEC;\nexport const DAYS_IN_YEAR = 365;\nexport const FIRST_TRANSACTIONS_LIMIT = 50;\n\nexport const FAKE_TX_ID = 'fakeTxId';\n","import type { WalletPollingOptions } from './walletPolling';\n\nimport Deferred from '../../../util/Deferred';\nimport { focusAwareDelay, onFocusAwareDelay } from '../../../util/focusAwareDelay';\nimport { setCancellableTimeout, throttle } from '../../../util/schedulers';\nimport { MINUTE, SEC } from '../../constants';\n\nexport type Period = number | {\n  focused: number;\n  notFocused: number;\n};\n\nexport const activeWalletTiming = {\n  updateOnStart: true,\n  minUpdateDelay: { focused: SEC, notFocused: 3 * SEC },\n  fallbackUpdateStartDelay: 3 * SEC,\n  fallbackUpdatePeriod: { focused: 1.1 * SEC, notFocused: 10 * SEC },\n  forceUpdatePeriod: { focused: MINUTE, notFocused: 2 * MINUTE },\n} satisfies Partial<WalletPollingOptions>;\n\nexport const inactiveWalletTiming = {\n  updateOnStart: false,\n  minUpdateDelay: { focused: 5 * SEC, notFocused: 30 * SEC },\n  fallbackUpdateStartDelay: 5 * SEC,\n  fallbackUpdatePeriod: { focused: 30 * SEC, notFocused: MINUTE },\n  forceUpdatePeriod: { focused: 2 * MINUTE, notFocused: 5 * MINUTE },\n} satisfies Partial<WalletPollingOptions>;\n\ninterface PollingLoopOptions<Dep> {\n  period: Period;\n  /** The minimum time between the `poll` calls */\n  minDelay?: Period;\n  /** If `true`, `poll` won't be called at the loop start */\n  skipInitialPoll?: boolean;\n  /** Called before any `poll` call */\n  prepare?: () => Promise<Dep>;\n  /** Called periodically. Never executed in parallel. If returns 'stop', the polling stops. */\n  poll: (dependency: Dep) => MaybePromise<void | 'stop'>;\n}\n\n/**\n * Executes the given functions indefinitely with pauses.\n * An execution can be triggered manually, in which case the scheduled execution will be delayed.\n */\nexport function pollingLoop<Dep>({\n  period,\n  minDelay = 0,\n  skipInitialPoll,\n  prepare = () => Promise.resolve() as Promise<Dep>,\n  poll,\n}: PollingLoopOptions<Dep>) {\n  let isStopped = false;\n  let cancelPause: NoneToVoidFunction | undefined;\n  const dependenciesDeferred = new Deferred<Dep>();\n\n  // Using `throttle` to avoid parallel execution\n  const iteration = throttle(async () => {\n    if (isStopped) {\n      return;\n    }\n\n    cancelPause?.();\n    const dependencies = await dependenciesDeferred.promise;\n\n    try {\n      const response = await poll(dependencies);\n      if (response === 'stop') {\n        isStopped = true;\n      }\n    } finally {\n      if (!isStopped) {\n        scheduleIteration();\n      }\n    }\n  }, () => {\n    return focusAwareDelay(...periodToMs(minDelay));\n  });\n\n  function scheduleIteration() {\n    cancelPause?.();\n    cancelPause = onFocusAwareDelay(...periodToMs(period), iteration);\n  }\n\n  void prepare().then((dependencies) => {\n    if (isStopped) {\n      return;\n    }\n\n    dependenciesDeferred.resolve(dependencies);\n\n    if (skipInitialPoll) {\n      scheduleIteration();\n    } else {\n      iteration();\n    }\n  });\n\n  return {\n    poll: iteration,\n    stop() {\n      isStopped = true;\n      cancelPause?.();\n    },\n  };\n}\n\n/**\n * Wraps the given `action` function. When the wrapped function is executed, it executes `action` immediately, and\n * several times after that. The number of additional executions is equal to `pauses.length`. Each number in `pauses` is\n * the pause (in milliseconds) between the `action` executions. When the wrapped function is executed, the previously\n * scheduled additional executions are cancelled.\n *\n * `attemptNumber` starts from 0 and increments with each additional execution.\n */\nexport function withDoubleCheck<Args extends unknown[], Result>(\n  pauses: number[],\n  action: (attemptNumber: number, ...args: Args) => MaybePromise<Result>,\n) {\n  let isStopped = false;\n  let cancelDoubleCheck: NoneToVoidFunction | undefined;\n\n  async function makeAttempt(attemptNumber: number, args: Args) {\n    cancelDoubleCheck?.();\n\n    try {\n      return await action(attemptNumber, ...args);\n    } finally {\n      if (!isStopped && attemptNumber < pauses.length) {\n        cancelDoubleCheck?.(); // Cancelling again due to possible race conditions\n        cancelDoubleCheck = setCancellableTimeout(\n          pauses[attemptNumber],\n          () => makeAttempt(attemptNumber + 1, args),\n        );\n      }\n    }\n  }\n\n  return {\n    /** Executes `actions` and returns the result of the first execution */\n    run(...args: Args) {\n      isStopped = false;\n      return makeAttempt(0, args);\n    },\n    /** Cancels the scheduled additional executions */\n    cancel() {\n      isStopped = true;\n      cancelDoubleCheck?.();\n    },\n  };\n}\n\nexport function periodToMs(period: Period): [ms: number, forceMs: number] {\n  if (typeof period === 'number') {\n    return [period, period];\n  }\n\n  const { focused, notFocused } = period;\n  return [focused, notFocused];\n}\n","import type { Period } from './utils';\n\nimport { focusAwareDelay, onFocusAwareDelay } from '../../../util/focusAwareDelay';\nimport { handleError } from '../../../util/handleError';\nimport { setCancellableTimeout, throttle } from '../../../util/schedulers';\nimport { periodToMs } from './utils';\n\nexport type PollCallback = () => MaybePromise<void>;\n\nexport interface FallbackPollingOptions {\n  pollOnStart?: boolean;\n  minPollDelay: Period;\n  pollingStartDelay: number;\n  pollingPeriod: Period;\n  forcedPollingPeriod: Period;\n  /** Never executed in parallel */\n  poll: PollCallback;\n}\n\n/**\n * Schedules regular polling when the socket is disconnected.\n */\nexport class FallbackPollingScheduler {\n  #options: FallbackPollingOptions;\n\n  #cancelScheduledPoll?: NoneToVoidFunction;\n\n  #isDestroyed = false;\n\n  constructor(isSocketConnected: boolean, options: FallbackPollingOptions) {\n    this.#options = options;\n\n    if (isSocketConnected) {\n      this.#scheduleForcedPolling();\n    } else {\n      this.#schedulePolling();\n    }\n\n    if (options.pollOnStart) {\n      this.#poll();\n    }\n  }\n\n  /** Call this method when the socket source of data becomes available */\n  public onSocketConnect() {\n    if (this.#isDestroyed) return;\n    this.#scheduleForcedPolling();\n    this.#poll();\n  }\n\n  /** Call this method when the socket source of data becomes unavailable */\n  public onSocketDisconnect() {\n    if (this.#isDestroyed) return;\n    this.#schedulePolling();\n  }\n\n  /** Call this method when the socket shows that it's alive */\n  public onSocketMessage() {\n    if (this.#isDestroyed) return;\n    this.#scheduleForcedPolling();\n  }\n\n  public destroy() {\n    this.#isDestroyed = true;\n    this.#cancelScheduledPoll?.();\n  }\n\n  // Using `throttle` to avoid parallel execution.\n  #poll = throttle(async () => {\n    if (this.#isDestroyed) return;\n\n    try {\n      await this.#options.poll();\n    } catch (err: any) {\n      handleError(err);\n    }\n  }, () => {\n    return focusAwareDelay(...periodToMs(this.#options.minPollDelay));\n  });\n\n  /** Sets up a polling running when the socket is disconnected */\n  #schedulePolling() {\n    this.#cancelScheduledPoll?.();\n\n    const { pollingStartDelay, pollingPeriod } = this.#options;\n\n    const handleTimeout = () => {\n      this.#cancelScheduledPoll = onFocusAwareDelay(...periodToMs(pollingPeriod), handleTimeout);\n      this.#poll();\n    };\n\n    this.#cancelScheduledPoll = setCancellableTimeout(pollingStartDelay, handleTimeout);\n  }\n\n  /** Sets up a polling running when the socket is connected (to mitigate network and backend problems) */\n  #scheduleForcedPolling() {\n    this.#cancelScheduledPoll?.();\n\n    const schedule = () => {\n      const { forcedPollingPeriod } = this.#options;\n      this.#cancelScheduledPoll = onFocusAwareDelay(...periodToMs(forcedPollingPeriod), () => {\n        schedule();\n        this.#poll();\n      });\n    };\n\n    schedule();\n  }\n}\n","import { DEFAULT_TIMEOUT } from '../config';\nimport { createCallbackManager } from './callbacks';\nimport { logDebug, logDebugError } from './logs';\nimport { setCancellableTimeout } from './schedulers';\n\nexport type InMessageCallback<T> = (message: T) => void;\nexport type ConnectCallback = NoneToVoidFunction;\n/** isUnexpected is false when the socket is closed manually, i.e. by calling close() */\nexport type DisconnectCallback = (isUnexpected: boolean) => void;\n\nconst RECONNECT_BASE_DELAY = 500;\nconst RECONNECT_MAX_DELAY = 5000;\n\n/**\n * Like WebSocket, but reconnects automatically when the socket disconnects\n */\nexport default class ReconnectingWebSocket<OutMessage, InMessage> {\n  #url: string;\n\n  #socket?: WebSocket;\n\n  /** `true` between the `open` and the `close` events, i.e. when the socket can send and receive messages */\n  #isConnected = false;\n\n  #reconnectAttemptCount = 0;\n\n  /** Cancels setTimeout of the WebSocket open timeout and the reconnect delay (they never happen simultaneously) */\n  #cancelTimeout?: NoneToVoidFunction;\n\n  #outMessageQueue: OutMessage[] = [];\n\n  #inMessageListeners = createCallbackManager<InMessageCallback<InMessage>>();\n\n  #connectListeners = createCallbackManager<ConnectCallback>();\n\n  #disconnectListeners = createCallbackManager<DisconnectCallback>();\n\n  constructor(url: string | URL) {\n    this.#url = url.toString();\n    this.#startSocket();\n  }\n\n  /**\n   * Sends a message via the socket.\n   * If the socket is disconnected, stashes the message until the socket is connected.\n   */\n  public send(message: OutMessage) {\n    if (this.#socket && this.#isConnected) {\n      this.#sendMessageNow(message);\n    } else {\n      this.#outMessageQueue.push(message);\n    }\n  }\n\n  /**\n   * Returns `true` is the socket is connected now. You may send messages regardless of the connection status.\n   * The objects always initializes in the disconnected state.\n   */\n  public get isConnected() {\n    return this.#isConnected;\n  }\n\n  /** Closes the current socket connection and creates a new one. Call it when you suspect the socket has hung. */\n  public reconnect() {\n    this.close();\n    this.#startSocket();\n  }\n\n  /** Registers a callback firing when a message arrives from the socket */\n  public onMessage(callback: InMessageCallback<InMessage>) {\n    return this.#inMessageListeners.addCallback(callback);\n  }\n\n  /**\n   * Registers a callback firing when the socket is connected initially or reconnected.\n   * I.e. when isConnected switches from `false` to `true`.\n   */\n  public onConnect(callback: ConnectCallback) {\n    return this.#connectListeners.addCallback(callback);\n  }\n\n  /**\n   * Registers a callback firing when the socket is disconnected.\n   * I.e. when isConnected switches from `true` to `false`.\n   */\n  public onDisconnect(callback: DisconnectCallback) {\n    return this.#disconnectListeners.addCallback(callback);\n  }\n\n  /** Call it when you don't need the socket anymore. The callbacks won't fire after that. */\n  public close() {\n    this.#stopSocket();\n\n    if (this.#isConnected) {\n      this.#isConnected = false;\n      this.#disconnectListeners.runCallbacks(false);\n    }\n  }\n\n  #startSocket() {\n    this.#stopSocket();\n\n    this.#socket = new WebSocket(this.#url);\n    this.#socket.binaryType = 'arraybuffer';\n\n    this.#socket.onerror = () => logDebugError('WebSocket error event', this.#url);\n    this.#socket.onopen = this.#handleSocketOpen;\n    this.#socket.onclose = this.#handleSocketClose;\n    this.#socket.onmessage = this.#handleSocketMessage;\n\n    // If the socket doesn't open in several seconds, retry opening it\n    this.#cancelTimeout = setCancellableTimeout(DEFAULT_TIMEOUT, () => this.#handleSocketClose('openTimeout'));\n  }\n\n  #stopSocket() {\n    this.#cancelTimeout?.();\n\n    if (!this.#socket) {\n      return;\n    }\n\n    this.#socket.onerror = null; // eslint-disable-line no-null/no-null\n    this.#socket.onopen = null; // eslint-disable-line no-null/no-null\n    this.#socket.onclose = null; // eslint-disable-line no-null/no-null\n    this.#socket.onmessage = null; // eslint-disable-line no-null/no-null\n    this.#socket.close();\n\n    this.#socket = undefined;\n  }\n\n  #sendMessageNow(message: OutMessage) {\n    if (!this.#socket) throw new Error('No active socket');\n    this.#socket.send(JSON.stringify(message));\n  }\n\n  #handleSocketOpen = () => {\n    logDebug('WebSocket opened', this.#url);\n\n    this.#cancelTimeout?.();\n    this.#reconnectAttemptCount = 0;\n\n    while (this.#outMessageQueue.length) {\n      this.#sendMessageNow(this.#outMessageQueue.shift()!);\n    }\n\n    if (!this.#isConnected) {\n      this.#isConnected = true;\n      this.#connectListeners.runCallbacks();\n    }\n  };\n\n  #handleSocketClose = (event: CloseEvent | 'openTimeout') => {\n    if (event === 'openTimeout') {\n      logDebugError('WebSocket open timeout');\n    } else {\n      logDebugError('WebSocket closed unexpectedly', event.code, event.reason, event.wasClean);\n    }\n\n    this.#stopSocket();\n\n    this.#reconnectAttemptCount++;\n    const reconnectDelay = Math.min(RECONNECT_BASE_DELAY * this.#reconnectAttemptCount, RECONNECT_MAX_DELAY);\n    this.#cancelTimeout = setCancellableTimeout(reconnectDelay, () => this.#startSocket());\n\n    if (this.#isConnected) {\n      if (event === 'openTimeout') {\n        throw new Error('Unexpected timeout event in an open socket');\n      }\n\n      this.#isConnected = false;\n      this.#disconnectListeners.runCallbacks(true);\n    }\n  };\n\n  #handleSocketMessage = ({ data }: MessageEvent<string | ArrayBuffer>) => {\n    this.#inMessageListeners.runCallbacks(\n      data instanceof ArrayBuffer\n        ? data as InMessage\n        : JSON.parse(data),\n    );\n  };\n}\n","import type { ApiActivity, ApiNetwork } from '../../../types';\nimport type { ActionsSocketMessage, AddressBook, AnyAction, ClientSocketMessage, ServerSocketMessage } from './types';\n\nimport { TONCENTER_ACTIONS_VERSION, TONCENTER_MAINNET_URL, TONCENTER_TESTNET_URL } from '../../../../config';\nimport { findDifference } from '../../../../util/iteratees';\nimport ReconnectingWebSocket, { type InMessageCallback } from '../../../../util/reconnectingWebsocket';\nimport safeExec from '../../../../util/safeExec';\nimport { forbidConcurrency, setCancellableTimeout, throttle } from '../../../../util/schedulers';\nimport { getNftSuperCollectionsByCollectionAddress } from '../../../common/addresses';\nimport { addBackendHeadersToSocketUrl } from '../../../common/backend';\nimport { SEC } from '../../../constants';\nimport { parseActions } from './actions';\n\nconst ACTUALIZATION_DELAY = 10;\n\n// Toncenter closes the socket after 30 seconds of inactivity\nconst PING_INTERVAL = 20 * SEC;\n\n// When the internet connection is interrupted, the Toncenter socket doesn't always disconnect automatically.\n// Disconnecting manually if there is no response for \"ping\".\nconst PONG_TIMEOUT = 5 * SEC;\n\nconst toncenterSockets: Partial<Record<ApiNetwork, ToncenterSocket>> = {};\n\nexport interface WalletWatcher {\n  /** Whether the socket is connected and subscribed to the given wallets */\n  readonly isConnected: boolean;\n  /** Removes the watcher and cleans the memory */\n  destroy(): void;\n}\n\ninterface WalletWatcherInternal extends WalletWatcher {\n  id: number;\n  addresses: string[];\n  isConnected: boolean;\n  /**\n   * Called when new activities (either regular or pending) arrive into one of the listened address.\n   *\n   * Called only when isConnected is true. Therefore, when the socket reconnects, the users should synchronize,\n   * otherwise the activities arriving during the reconnect will miss.\n   */\n  onNewActivities?: NewActivitiesCallback;\n  /** Called when isConnected turns true */\n  onConnect?: NoneToVoidFunction;\n  /** Called when isConnected turns false */\n  onDisconnect?: NoneToVoidFunction;\n}\n\nexport type NewActivitiesCallback = (update: ActivitiesUpdate) => void;\n\nexport interface ActivitiesUpdate {\n  address: string;\n  /**\n   * Multiple events with the same normalized hash can arrive. Every time it happens, the new event data must replace\n   * the previous event data in the app state. If the `activities` array is empty, the actions with that normalized hash\n   * must be removed from the app state. Pending actions are eventually either removed or replaced with confirmed actions.\n   */\n  messageHashNormalized: string;\n  /** Pending actions are not confirmed by the blockchain yet */\n  arePending: boolean;\n  activities: ApiActivity[];\n}\n\n/**\n * Connects to Toncenter to passively listen to updates.\n */\nclass ToncenterSocket {\n  #network: ApiNetwork;\n\n  #socket?: ReconnectingWebSocket<ClientSocketMessage, ServerSocketMessage>;\n\n  /** See #rememberAddressesOfNormalizedHash */\n  #addressesByHash: Record<string, string[]> = {};\n\n  #walletWatchers: WalletWatcherInternal[] = [];\n\n  /** The addresses that the socket is currently subscribed to */\n  #subscribedAddresses = new Set<string>();\n\n  /**\n   * A shared incremental counter for various unique ids. The fact that it's incremental is used to tell what actions\n   * happened earlier or later than others.\n   */\n  #currentUniqueId = 0;\n\n  #stopPing?: NoneToVoidFunction;\n  #cancelReconnect?: NoneToVoidFunction;\n\n  constructor(network: ApiNetwork) {\n    this.#network = network;\n  }\n\n  public watchWallets(\n    addresses: string[],\n    {\n      onNewActivities,\n      onConnect,\n      onDisconnect,\n    }: Pick<WalletWatcherInternal, 'onNewActivities' | 'onConnect' | 'onDisconnect'> = {},\n  ): WalletWatcher {\n    const id = this.#currentUniqueId++;\n    const watcher: WalletWatcherInternal = {\n      id,\n      addresses,\n      isConnected: false,\n      onNewActivities,\n      onConnect,\n      onDisconnect,\n      destroy: this.#destroyWalletWatcher.bind(this, id),\n    };\n    this.#walletWatchers.push(watcher);\n    this.#actualizeSocket();\n    return watcher;\n  }\n\n  /** Removes the given watcher and unsubscribes from its wallets. Brings the sockets to the proper state. */\n  #destroyWalletWatcher(watcherId: number) {\n    const index = this.#walletWatchers.findIndex((watcher) => watcher.id === watcherId);\n    if (index >= 0) {\n      this.#walletWatchers.splice(index, 1);\n      this.#actualizeSocket();\n    }\n  }\n\n  /**\n   * Creates or destroys the given socket (if needed) and subscribes to the watched wallets.\n   *\n   * The method is throttled in order to:\n   *  - Avoid sending too many requests when the watched addresses change many times in a short time range.\n   *  - Avoid reconnecting the socket when watched addresses arrive shortly after stopping watching all addresses.\n   */\n  #actualizeSocket = throttle(() => {\n    if (this.#doesHaveWatchedAddresses()) {\n      this.#socket ??= this.#createSocket();\n      if (this.#socket.isConnected) {\n        this.#sendWatchedWalletsToSocket();\n      } // Otherwise, the addresses will be sent when the socket gets connected\n    } else {\n      this.#socket?.close();\n      this.#socket = undefined;\n    }\n  }, ACTUALIZATION_DELAY, false);\n\n  #createSocket() {\n    const url = getSocketUrl(this.#network);\n    const socket = new ReconnectingWebSocket<ClientSocketMessage, ServerSocketMessage>(url);\n    socket.onMessage(this.#handleSocketMessage);\n    socket.onConnect(this.#handleSocketConnect);\n    socket.onDisconnect(this.#handleSocketDisconnect);\n    return socket;\n  }\n\n  #handleSocketMessage: InMessageCallback<ServerSocketMessage> = (message) => {\n    this.#cancelReconnect?.();\n\n    if ('status' in message) {\n      if (message.status === 'subscribed') {\n        this.#handleSubscribed(message);\n      }\n    }\n\n    if ('type' in message) {\n      if (message.type === 'trace_invalidated') {\n        message = {\n          ...message,\n          type: 'pending_actions',\n          actions: [],\n          address_book: {},\n          metadata: {},\n        };\n        // Falling down to the below `if` intentionally\n      }\n\n      if (message.type === 'actions' || message.type === 'pending_actions') {\n        void this.#handleNewActions(message);\n      }\n    }\n  };\n\n  #handleSocketConnect = () => {\n    this.#socket?.send({\n      operation: 'configure',\n      include_address_book: true,\n      include_metadata: true,\n      supported_action_types: [TONCENTER_ACTIONS_VERSION],\n    });\n    this.#sendWatchedWalletsToSocket();\n\n    this.#startPing();\n  };\n\n  #handleSocketDisconnect = () => {\n    this.#subscribedAddresses.clear();\n    this.#stopPing?.();\n\n    for (const watcher of this.#walletWatchers) {\n      if (watcher.isConnected) {\n        watcher.isConnected = false;\n        if (watcher.onDisconnect) safeExec(watcher.onDisconnect);\n      }\n    }\n  };\n\n  #handleSubscribed(message: Extract<ServerSocketMessage, { status: any }>) {\n    for (const watcher of this.#walletWatchers) {\n      // If message id < watcher id, then the watcher was created after the subscribe request was sent, therefore\n      // the socket may be not subscribed to all the watcher addresses yet.\n      if (message.id && Number(message.id) < watcher.id) {\n        continue;\n      }\n\n      if (!watcher.isConnected) {\n        watcher.isConnected = true;\n        if (watcher.onConnect) safeExec(watcher.onConnect);\n      }\n    }\n  }\n\n  // Limiting the concurrency to 1 to ensure the new activities are reported in the order they were received\n  #handleNewActions = forbidConcurrency(async (message: ActionsSocketMessage) => {\n    const arePending = message.type === 'pending_actions';\n    const messageHashNormalized = message.trace_external_hash_norm;\n    const activitiesByAddress = await parseSocketActions(this.#network, message, this.#getWatchedAddresses(true));\n    const addressesToNotify = this.#rememberAddressesOfHash(\n      messageHashNormalized,\n      Object.keys(activitiesByAddress),\n      arePending,\n    );\n\n    for (const watcher of this.#walletWatchers) {\n      if (!isWatcherReadyForNewActivities(watcher)) {\n        continue;\n      }\n\n      for (const address of watcher.addresses) {\n        if (!addressesToNotify.has(address)) {\n          continue;\n        }\n\n        safeExec(() => watcher.onNewActivities({\n          address,\n          messageHashNormalized,\n          arePending,\n          activities: activitiesByAddress[address] ?? [],\n        }));\n      }\n    }\n  });\n\n  #sendWatchedWalletsToSocket() {\n    // It's necessary to collect the watched addresses synchronously with locking the request id.\n    // It makes sure that all the watchers with ids < the response id will be subscribed.\n    const requestId = String(this.#currentUniqueId++);\n\n    const oldAddresses = this.#subscribedAddresses;\n    const newAddresses = this.#getWatchedAddresses();\n    const deletedAddresses = findDifference(oldAddresses, newAddresses);\n    const addedAddresses = findDifference(newAddresses, oldAddresses);\n\n    if (deletedAddresses.length) {\n      this.#socket!.send({\n        operation: 'unsubscribe',\n        addresses: deletedAddresses,\n      });\n    }\n\n    if (addedAddresses.length) {\n      this.#socket!.send({\n        operation: 'subscribe',\n        id: requestId,\n        addresses: addedAddresses,\n        types: ['actions', 'pending_actions'],\n      });\n    }\n\n    this.#subscribedAddresses = newAddresses;\n  }\n\n  #doesHaveWatchedAddresses() {\n    return this.#walletWatchers.some((watcher) => watcher.addresses.length);\n  }\n\n  #getWatchedAddresses(isOnlyReadyForNewActivities?: boolean) {\n    const watchedAddresses = new Set<string>();\n\n    for (const watcher of this.#walletWatchers) {\n      if (isOnlyReadyForNewActivities && !isWatcherReadyForNewActivities(watcher)) {\n        continue;\n      }\n\n      for (const address of watcher.addresses) {\n        watchedAddresses.add(address);\n      }\n    }\n\n    return watchedAddresses;\n  }\n\n  #startPing() {\n    this.#stopPing?.();\n\n    const pingIntervalId = setInterval(() => {\n      this.#socket?.send({ operation: 'ping' });\n\n      this.#cancelReconnect?.();\n      this.#cancelReconnect = setCancellableTimeout(PONG_TIMEOUT, () => {\n        this.#socket?.reconnect();\n      });\n    }, PING_INTERVAL);\n\n    this.#stopPing = () => clearInterval(pingIntervalId);\n  }\n\n  /**\n   * When a pending action is invalidated, a message arrives with no data except the normalized hash. In order to find\n   * what addresses it belongs to and notify those addresses, we save the addresses from the previous message with the\n   * same normalized hash.\n   *\n   * @returns The addresses that should be notified about the new actions, even if no new action belongs to the address\n   */\n  #rememberAddressesOfHash(\n    messageHashNormalized: string,\n    newActionAddresses: Iterable<string>,\n    areNewActionsPending: boolean,\n  ) {\n    const prevSavedAddresses = this.#addressesByHash[messageHashNormalized] ?? [];\n    const nextSavedAddresses: string[] = [];\n    const addressesToNotify = new Set<string>();\n\n    // Notifying the addresses where the actions were seen at previously. It is necessary to let the addresses know that\n    // the given normalized message hash is no longer in the activity history.\n    for (const address of prevSavedAddresses) {\n      addressesToNotify.add(address);\n    }\n\n    for (const address of newActionAddresses) {\n      addressesToNotify.add(address);\n\n      // Saving the corresponding addresses only for pending actions, because confirmed actions don't change or invalidate\n      if (areNewActionsPending) {\n        nextSavedAddresses.push(address);\n      }\n    }\n\n    if (nextSavedAddresses.length) {\n      this.#addressesByHash[messageHashNormalized] = nextSavedAddresses;\n    } else {\n      delete this.#addressesByHash[messageHashNormalized];\n    }\n\n    return addressesToNotify;\n  }\n}\n\nexport type { ToncenterSocket };\n\n/** Returns a singleton (one constant instance per a network) */\nexport function getToncenterSocket(network: ApiNetwork) {\n  toncenterSockets[network] ??= new ToncenterSocket(network);\n  return toncenterSockets[network];\n}\n\n/**\n * Returns true if the activities update is final, i.e. no other updates are expected for the corresponding message hash.\n */\nexport function isActivityUpdateFinal(update: ActivitiesUpdate) {\n  return !update.arePending || !update.activities.length;\n}\n\nfunction getSocketUrl(network: ApiNetwork) {\n  const url = new URL(network === 'testnet' ? TONCENTER_TESTNET_URL : TONCENTER_MAINNET_URL);\n  url.protocol = 'wss:';\n  url.pathname = '/api/streaming/v1/ws';\n  addBackendHeadersToSocketUrl(url);\n  return url;\n}\n\nasync function parseSocketActions(network: ApiNetwork, message: ActionsSocketMessage, addressWhitelist: Set<string>) {\n  const actionsByAddress = groupActionsByAddress(message.actions, message.address_book);\n  const activitiesByAddress: Record<string, ApiActivity[]> = {};\n  const nftSuperCollectionsByCollectionAddress = await getNftSuperCollectionsByCollectionAddress();\n\n  for (const [address, actions] of Object.entries(actionsByAddress)) {\n    if (!addressWhitelist.has(address)) {\n      continue;\n    }\n\n    activitiesByAddress[address] = parseActions(\n      network,\n      address,\n      actions,\n      message.address_book,\n      message.metadata,\n      nftSuperCollectionsByCollectionAddress,\n      message.type === 'pending_actions',\n    );\n  }\n\n  return activitiesByAddress;\n}\n\nfunction groupActionsByAddress(actions: AnyAction[], addressBook: AddressBook) {\n  const byAddress: Record<string, AnyAction[]> = {};\n\n  for (const action of actions) {\n    for (const rawAddress of action.accounts!) {\n      const address = addressBook[rawAddress]?.user_friendly ?? rawAddress;\n      byAddress[address] ??= [];\n      byAddress[address].push(action);\n    }\n  }\n\n  return byAddress;\n}\n\nfunction isWatcherReadyForNewActivities(\n  watcher: WalletWatcherInternal,\n): watcher is WalletWatcherInternal & { onNewActivities: NewActivitiesCallback } {\n  // Even though the socket may already listen to some wallet addresses, we promise the class users to trigger the\n  // onNewActions callback only in the connected state.\n  return watcher.isConnected && !!watcher.onNewActivities;\n}\n","import type { ActivitiesUpdate, NewActivitiesCallback } from './socket';\n\nimport { setCancellableTimeout } from '../../../../util/schedulers';\nimport { isActivityUpdateFinal } from './socket';\n\n/**\n * The Toncenter websocket sends too many updates of pending actions. For example, sends a pending activity right before\n * sending the confirmed version of that activity. This function throttles them, but makes sure the pending actions are\n * created immediately.\n */\nexport function throttleToncenterSocketActions(\n  delayMs: number,\n  onUpdates: (updates: ActivitiesUpdate[]) => void,\n): NewActivitiesCallback {\n  // A record item is created when the first pending version arrives and is removed when it gets confirmed or invalidated.\n  // All message hashes are throttled independently.\n  const updatesByHash: Record<string, { toReport?: ActivitiesUpdate; cancelReport?: NoneToVoidFunction }> = {};\n\n  const scheduleReport = (hash: string) => {\n    updatesByHash[hash] ??= {};\n    updatesByHash[hash].cancelReport ??= setCancellableTimeout(delayMs, () => {\n      delete updatesByHash[hash].cancelReport;\n      const { toReport } = updatesByHash[hash];\n      if (toReport) {\n        onUpdates([toReport]);\n      }\n    });\n  };\n\n  return (update) => {\n    const hash = update.messageHashNormalized;\n\n    if (isActivityUpdateFinal(update)) {\n      // This is the final update for the hash. It should be delivered immediately and removed.\n      updatesByHash[hash]?.cancelReport?.();\n      delete updatesByHash[hash];\n      onUpdates([update]);\n    } else if (!updatesByHash[hash]) {\n      // This is the first version of the hash's update. It should (and must for pendings) be delivered immediately.\n      onUpdates([update]);\n      scheduleReport(hash);\n    } else {\n      // Otherwise, throttle the update\n      updatesByHash[hash].toReport = update;\n      scheduleReport(hash);\n    }\n  };\n}\n","import type { ApiActivity, ApiNetwork } from '../../../types';\nimport type { ActivitiesUpdate, WalletWatcher } from './socket';\n\nimport { createCallbackManager } from '../../../../util/callbacks';\nimport { compareActivities } from '../../../../util/compareActivities';\nimport { focusAwareDelay } from '../../../../util/focusAwareDelay';\nimport { extractKey } from '../../../../util/iteratees';\nimport { logDebugError } from '../../../../util/logs';\nimport { FallbackPollingScheduler } from '../../../common/polling/fallbackPollingScheduler';\nimport { periodToMs } from '../../../common/polling/utils';\nimport { FIRST_TRANSACTIONS_LIMIT, MINUTE, SEC } from '../../../constants';\nimport { fetchActions, fetchPendingActions } from './actions';\nimport { getToncenterSocket, isActivityUpdateFinal } from './socket';\nimport { throttleToncenterSocketActions } from './throttleSocketActions';\n\nconst SOCKET_THROTTLE_DELAY = 250;\nconst MIN_POLL_DELAY = { focused: SEC, notFocused: 3 * SEC };\nconst POLLING_START_DELAY = 3 * SEC;\nconst POLLING_PERIOD = { focused: 1.1 * SEC, notFocused: 10 * SEC };\nconst FORCED_POLLING_PERIOD = { focused: MINUTE, notFocused: 2 * MINUTE };\n\nconst FINISHED_HASH_MEMORY_SIZE = 100;\n\n/**\n * The activities are sorted by timestamp descending.\n * The updates may arrive not in the order of activity time and may duplicate.\n * `allPendingActivities` doesn't contain activities with the hashes of the current or past confirmed activities.\n */\nexport type OnActivityUpdate = (\n  newConfirmedActivities: ApiActivity[],\n  allPendingActivities: readonly ApiActivity[],\n) => void;\n\nexport type OnLoadingChange = (isLoading: boolean) => void;\n\n/**\n * Streams the new activities (confirmed and pending) in the given TON wallet as they are received from the Toncenter\n * API (with no artificial activities like CEX swaps). Uses the socket, and fallbacks to HTTP polling when the socket is\n * unavailable.\n */\nexport class ActivityStream {\n  #network: ApiNetwork;\n  #address: string;\n\n  #newestConfirmedActivityTimestamp?: number;\n\n  #pendingActivities = managePendingActivities();\n\n  #walletWatcher: WalletWatcher;\n\n  #fallbackPollingScheduler: FallbackPollingScheduler;\n\n  #updateListeners = createCallbackManager<OnActivityUpdate>();\n  #loadingListeners = createCallbackManager<OnLoadingChange>();\n\n  /** When `true`, the polling retries until succeeds, and the confirmed actions from the socket get stashed */\n  #doesNeedToRestoreHistory = false;\n\n  /** Sorted by timestamp descending */\n  #socketConfirmedActionsStash: ApiActivity[] = [];\n\n  #isDestroyed = false;\n\n  constructor(\n    network: ApiNetwork,\n    address: string,\n    newestConfirmedActivityTimestamp: number | undefined,\n    pollOnStart: boolean,\n  ) {\n    this.#network = network;\n    this.#address = address;\n    this.#newestConfirmedActivityTimestamp = newestConfirmedActivityTimestamp;\n\n    this.#walletWatcher = getToncenterSocket(network).watchWallets(\n      [address],\n      {\n        onConnect: this.#handleSocketConnect,\n        onDisconnect: this.#handleSocketDisconnect,\n        onNewActivities: throttleToncenterSocketActions(SOCKET_THROTTLE_DELAY, this.#handleSocketNewActivities),\n      },\n    );\n\n    this.#doesNeedToRestoreHistory = this.#walletWatcher.isConnected;\n\n    this.#fallbackPollingScheduler = new FallbackPollingScheduler(this.#walletWatcher.isConnected, {\n      pollOnStart,\n      minPollDelay: MIN_POLL_DELAY,\n      pollingStartDelay: POLLING_START_DELAY,\n      pollingPeriod: POLLING_PERIOD,\n      forcedPollingPeriod: FORCED_POLLING_PERIOD,\n      poll: this.#poll,\n    });\n  }\n\n  /**\n   * Registers a callback firing then new activities arrive.\n   * The callback is calls are throttled.\n   */\n  public onUpdate(callback: OnActivityUpdate) {\n    return this.#updateListeners.addCallback(callback);\n  }\n\n  /**\n   * Registers a callback firing when the regular polling starts of finishes.\n   * Guaranteed to be called with `isLoading=false` after calling the `onUpdate` callbacks.\n   */\n  public onLoadingChange(callback: OnLoadingChange) {\n    return this.#loadingListeners.addCallback(callback);\n  }\n\n  public destroy() {\n    this.#isDestroyed = true;\n    this.#walletWatcher.destroy();\n    this.#fallbackPollingScheduler.destroy();\n  }\n\n  #handleSocketConnect = () => {\n    // When the socket gets connected, it's important to load the confirmed activities since the last activity,\n    // otherwise the activities arriving from the socket will create a gap in the activity history.\n    this.#doesNeedToRestoreHistory = true;\n    this.#fallbackPollingScheduler.onSocketConnect();\n  };\n\n  #handleSocketDisconnect = () => {\n    this.#doesNeedToRestoreHistory = false;\n    this.#fallbackPollingScheduler.onSocketDisconnect();\n  };\n\n  #handleSocketNewActivities = (updates: ActivitiesUpdate[]) => {\n    if (this.#isDestroyed) return;\n\n    const pendingUpdates = updates.filter((update) => update.arePending);\n    const confirmedActivities = updates\n      .filter((update) => !update.arePending)\n      .flatMap((update) => update.activities)\n      .sort(compareActivities);\n\n    const instantConfirmedActivities = this.#doesNeedToRestoreHistory ? [] : confirmedActivities;\n    const stashedConfirmedActivities = this.#doesNeedToRestoreHistory ? confirmedActivities : [];\n\n    // One of the goals here is preventing the stashed activities from removing pending activities (switching an activity\n    // from pending to confirmed must be seamless). Another goal is delivering the pending activities with no delay.\n    this.#socketConfirmedActionsStash.unshift(...stashedConfirmedActivities);\n    this.#handleNewActivities(instantConfirmedActivities, undefined, pendingUpdates);\n  };\n\n  /** Fetches the activities when the socket is not connected or has just connected */\n  #poll = async () => {\n    try {\n      this.#loadingListeners.runCallbacks(true);\n\n      const [pendingActivities, newConfirmedActivities] = await Promise.all([\n        loadPendingActivities(this.#network, this.#address),\n        this.#loadNewConfirmedActivities(),\n      ]);\n\n      if (this.#isDestroyed) return;\n\n      this.#handleNewActivities(\n        margeConfirmedActivitiesOnSocketConnect(\n          newConfirmedActivities,\n          this.#socketConfirmedActionsStash.splice(0),\n        ),\n        pendingActivities,\n      );\n\n      this.#doesNeedToRestoreHistory = false;\n    } finally {\n      if (!this.#isDestroyed) {\n        this.#loadingListeners.runCallbacks(false);\n      }\n    }\n  };\n\n  async #loadNewConfirmedActivities() {\n    while (!this.#isDestroyed) {\n      try {\n        return await fetchActions({\n          network: this.#network,\n          filter: { address: this.#address },\n          walletAddress: this.#address,\n          fromTimestamp: this.#newestConfirmedActivityTimestamp,\n          limit: FIRST_TRANSACTIONS_LIMIT,\n        });\n      } catch (err) {\n        logDebugError('loadNewConfirmedActivities', err);\n\n        if (this.#isDestroyed || !this.#doesNeedToRestoreHistory) {\n          break;\n        }\n\n        await focusAwareDelay(...periodToMs(MIN_POLL_DELAY));\n      }\n    }\n\n    return [];\n  }\n\n  /** The method expected one of `allPendingActivities` and `pendingUpdates`, not both at the same time */\n  #handleNewActivities(\n    confirmedActivities: ApiActivity[],\n    allPendingActivities?: ApiActivity[],\n    pendingUpdates?: ActivitiesUpdate[],\n  ) {\n    // If nothing new, do nothing\n    if (!confirmedActivities.length && !(allPendingActivities || pendingUpdates?.length)) {\n      return;\n    }\n\n    if (confirmedActivities.length) {\n      this.#newestConfirmedActivityTimestamp = confirmedActivities[0].timestamp;\n    }\n    this.#pendingActivities.update(confirmedActivities, allPendingActivities, pendingUpdates);\n    this.#updateListeners.runCallbacks(confirmedActivities, this.#pendingActivities.all);\n  }\n}\n\nasync function loadPendingActivities(network: ApiNetwork, address: string) {\n  try {\n    return await fetchPendingActions(network, address);\n  } catch (err) {\n    logDebugError('loadPendingActivities', err);\n    return undefined;\n  }\n}\n\n/**\n * Keeps the list of all current pending activities by merging the incoming updates.\n */\nfunction managePendingActivities() {\n  /** Sorted by timestamp descending */\n  let pendingActivities: readonly ApiActivity[] = [];\n\n  /**\n   * External message hash normalized of the recently confirmed activities and invalidated pending activities.\n   * Helps to avoid excessive pendings occurring because of race conditions that cause pendings to arrive after the\n   * corresponding confirmed activities. The race conditions can occur because of the socket and polling working together.\n   *\n   * There still can be situations where an older pending activity version replaces a newer one, but it is not a problem.\n   */\n  const finishedHashes = new Set<string>();\n\n  function update(\n    confirmedActivities: ApiActivity[],\n    allPendingActivities?: readonly ApiActivity[],\n    pendingUpdates?: ActivitiesUpdate[],\n  ) {\n    rememberFinishedHashes(extractKey(confirmedActivities, 'externalMsgHashNorm'));\n    if (pendingUpdates) {\n      rememberFinishedHashes(extractKey(pendingUpdates.filter(isActivityUpdateFinal), 'messageHashNormalized'));\n    }\n\n    if (allPendingActivities) {\n      pendingActivities = allPendingActivities;\n    } else if (pendingUpdates) {\n      pendingActivities = mergePendingActivities(pendingActivities, pendingUpdates);\n    }\n\n    pendingActivities = pendingActivities.filter(({ externalMsgHashNorm }) => !(\n      externalMsgHashNorm\n      && finishedHashes.has(externalMsgHashNorm)\n    ));\n  }\n\n  function rememberFinishedHashes(messageHashNorms: Iterable<string | undefined>) {\n    for (const hash of messageHashNorms) {\n      if (hash !== undefined) {\n        finishedHashes.add(hash);\n      }\n    }\n\n    releaseFinishedHashesMemory();\n  }\n\n  function releaseFinishedHashesMemory() {\n    // JS Set iterates the elements in the order of insertion.\n    // Deleting elements from Set during iteration doesn't disrupt the iteration.\n    // That is, this loop removes the oldest elements.\n    for (const hash of finishedHashes) {\n      if (finishedHashes.size <= FINISHED_HASH_MEMORY_SIZE) {\n        break;\n      }\n\n      finishedHashes.delete(hash);\n    }\n  }\n\n  return {\n    get all() {\n      return pendingActivities;\n    },\n    update,\n  };\n}\n\n/**\n * Merges the activities when the socket gets connected. At this moment of connection the socket starts receiving\n * activities, and activities are requested via the HTTP endpoint. These lists can contain duplicates, this function\n * eliminates them.\n *\n * Both the activity lists must be sorted by timestamp descending.\n */\nfunction margeConfirmedActivitiesOnSocketConnect(\n  polledActivities: ApiActivity[],\n  socketActivities: ApiActivity[],\n) {\n  const newestPolledActivityTimestamp = polledActivities[0]?.timestamp ?? -Infinity;\n  const mergedActivities: ApiActivity[] = [];\n\n  for (const activity of socketActivities) {\n    if (activity.timestamp <= newestPolledActivityTimestamp) {\n      break;\n    }\n\n    mergedActivities.push(activity);\n  }\n\n  mergedActivities.push(...polledActivities);\n\n  return mergedActivities;\n}\n\nfunction mergePendingActivities(\n  currentPendingActivities: readonly ApiActivity[],\n  socketUpdates: ActivitiesUpdate[],\n) {\n  if (!socketUpdates.length) {\n    return currentPendingActivities;\n  }\n\n  const hashesToRemove = new Set<string | undefined>(\n    extractKey(socketUpdates, 'messageHashNormalized'),\n  );\n\n  return [\n    ...currentPendingActivities.filter(\n      (activity) => !hashesToRemove.has(activity.externalMsgHashNorm),\n    ),\n    ...socketUpdates.flatMap((update) => update.arePending ? update.activities : []),\n  ].sort(compareActivities);\n}\n","import type { ApiNetwork, ApiTransaction } from '../../../types';\nimport type { ApiTransactionExtended } from '../types';\nimport type { AddressBook, Transaction, TransactionMessage } from './types';\n\nimport { TONCOIN } from '../../../../config';\nimport { buildTxId } from '../../../../util/activities';\nimport { toSeconds } from '../../../../util/datetime';\nimport { omitUndefined } from '../../../../util/iteratees';\nimport { toBase64Address } from '../util/tonCore';\nimport { callToncenterV3 } from './other';\n\nexport async function fetchTransactions(options: {\n  network: ApiNetwork;\n  address: string | string[];\n  limit: number;\n  fromTimestamp?: number;\n  toTimestamp?: number;\n  shouldIncludeFrom?: boolean;\n  shouldIncludeTo?: boolean;\n}): Promise<ApiTransaction[]> {\n  const {\n    network,\n    address,\n    limit,\n    toTimestamp,\n    fromTimestamp,\n    shouldIncludeFrom,\n    shouldIncludeTo,\n  } = options;\n\n  const data: {\n    transactions: Transaction[];\n    address_book: AddressBook;\n  } = await callToncenterV3(network, '/transactions', {\n    account: address,\n    limit,\n    start_utime: fromTimestamp && toSeconds(fromTimestamp) + (!shouldIncludeFrom ? 1 : 0),\n    end_utime: toTimestamp && toSeconds(toTimestamp) - (!shouldIncludeTo ? 1 : 0),\n    sort: 'desc',\n  });\n\n  const {\n    transactions: rawTransactions,\n    address_book: addressBook,\n  } = data;\n\n  if (!rawTransactions.length) {\n    return [];\n  }\n\n  return rawTransactions\n    .map((rawTx) => parseRawTransaction(network, rawTx, addressBook))\n    .flat();\n}\n\nexport function parseRawTransaction(\n  network: ApiNetwork,\n  rawTx: Transaction,\n  addressBook: AddressBook,\n): ApiTransactionExtended[] {\n  const {\n    now,\n    hash,\n    total_fees: totalFees,\n    description: {\n      compute_ph: {\n        exit_code: exitCode,\n      },\n    },\n  } = rawTx;\n\n  const timestamp = now * 1000;\n  const isIncoming = !!rawTx.in_msg.source && !rawTx.out_msgs.length;\n  const inMsgHashNorm = rawTx.in_msg.hash_norm ?? rawTx.in_msg.hash;\n  const msgs: TransactionMessage[] = isIncoming ? [rawTx.in_msg] : rawTx.out_msgs;\n\n  if (!msgs.length) return [];\n\n  const oneMsgFee = BigInt(totalFees) / BigInt(msgs.length);\n\n  const transactions: ApiTransactionExtended[] = [];\n\n  msgs.forEach((msg, i) => {\n    const {\n      source,\n      destination,\n      value,\n      fwd_fee: fwdFee,\n      opcode,\n      hash: msgHash,\n      bounced,\n    } = msg;\n\n    if (!destination) {\n      // This is log\n      return;\n    }\n\n    const fromAddress = addressBook[source!].user_friendly;\n    const toAddress = addressBook[destination].user_friendly;\n    const normalizedAddress = toBase64Address(isIncoming ? source! : destination, true, network);\n    const fee = oneMsgFee + BigInt(fwdFee ?? 0);\n\n    const tx: ApiTransactionExtended = omitUndefined({\n      txId: msgs.length > 1 ? buildTxId(hash, i) : buildTxId(hash),\n      timestamp,\n      isIncoming,\n      fromAddress,\n      toAddress,\n      amount: isIncoming ? BigInt(value!) : -BigInt(value!),\n      slug: TONCOIN.slug,\n      fee,\n      externalMsgHashNorm: isIncoming ? undefined : inMsgHashNorm,\n      normalizedAddress,\n      shouldHide: exitCode ? true : undefined,\n      hash,\n      opCode: Number(opcode) || undefined,\n      msgHash,\n      type: bounced ? 'bounced' : undefined,\n      status: 'completed',\n    });\n\n    transactions.push(tx);\n  });\n\n  return transactions;\n}\n\nexport async function fetchLatestTxLt(network: ApiNetwork, address: string): Promise<number | undefined> {\n  const { transactions }: { transactions: any[] } = await callToncenterV3(network, '/transactions', {\n    account: address,\n    limit: 1,\n    sort: 'desc',\n  });\n\n  if (!transactions.length) {\n    return undefined;\n  }\n\n  return Number(transactions[0].lt);\n}\n","import { Address } from '@ton/core';\n\nimport type { ApiNetwork } from '../../types';\n\nimport { getDnsDomainZone, isDnsDomain } from '../../../util/dns';\nimport { dnsResolve } from './util/dns';\nimport { getTonClient, toBase64Address } from './util/tonCore';\nimport { getKnownAddressInfo } from '../../common/addresses';\nimport { DnsCategory } from './constants';\nimport { fetchAddressBook } from './toncenter';\n\nexport async function resolveAddress(network: ApiNetwork, address: string, skipFormatSelection?: boolean): Promise<{\n  address: string;\n  name?: string;\n  isMemoRequired?: boolean;\n  isScam?: boolean;\n} | 'dnsNotResolved' | 'invalidAddress'> {\n  const isDomain = isDnsDomain(address);\n  let domain: string | undefined;\n\n  if (isDomain) {\n    const resolvedAddress = await resolveAddressByDomain(network, address);\n    if (!resolvedAddress) {\n      return 'dnsNotResolved';\n    }\n\n    domain = address;\n    address = resolvedAddress;\n\n    if (!skipFormatSelection) {\n      const addressBook = await fetchAddressBook(network, [address]);\n      address = addressBook[address].user_friendly;\n    }\n  }\n\n  let normalizedAddress: string;\n  try {\n    normalizedAddress = normalizeAddress(address);\n  } catch {\n    return 'invalidAddress';\n  }\n  const known = getKnownAddressInfo(normalizedAddress);\n\n  if (known) {\n    return {\n      address,\n      ...known,\n      name: domain ?? known.name,\n    };\n  }\n\n  return { address, name: domain };\n}\n\nasync function resolveAddressByDomain(network: ApiNetwork, domain: string) {\n  try {\n    const zoneMatch = getDnsDomainZone(domain);\n    if (!zoneMatch) {\n      return undefined;\n    }\n\n    const result = await dnsResolve(\n      getTonClient(network),\n      zoneMatch.zone.resolver,\n      zoneMatch.base,\n      DnsCategory.Wallet,\n    );\n\n    if (!(result instanceof Address)) {\n      return undefined;\n    }\n\n    return toBase64Address(result, undefined, network);\n  } catch (err: any) {\n    if (!err.message?.includes('exit_code')) {\n      throw err;\n    }\n    return undefined;\n  }\n}\n\nexport function normalizeAddress(address: string, network?: ApiNetwork) {\n  return toBase64Address(address, true, network);\n}\n","import { beginCell, Cell, storeStateInit } from '@ton/core';\n\nimport type { ApiNetwork, ApiTonWallet, ApiWalletInfo, ApiWalletWithVersionInfo } from '../../types';\nimport type { ApiTonWalletVersion, ContractInfo } from './types';\nimport type { TonWallet } from './util/tonCore';\n\nimport { DEFAULT_WALLET_VERSION } from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { extractKey, findLast } from '../../../util/iteratees';\nimport withCacheAsync from '../../../util/withCacheAsync';\nimport { fetchJettonBalances } from './util/tonapiio';\nimport {\n  getTonClient, toBase64Address, walletClassMap,\n} from './util/tonCore';\nimport { fetchStoredTonWallet } from '../../common/accounts';\nimport { base64ToBytes, hexToBytes, sha256 } from '../../common/utils';\nimport { ALL_WALLET_VERSIONS, ContractType, KnownContracts, WORKCHAIN } from './constants';\nimport { getWalletInfos } from './toncenter';\n\nexport const isAddressInitialized = withCacheAsync(\n  async (network: ApiNetwork, walletOrAddress: TonWallet | string) => {\n    return (await getWalletInfo(network, walletOrAddress)).isInitialized;\n  },\n);\n\nexport const isActiveSmartContract = withCacheAsync(async (network: ApiNetwork, address: string) => {\n  const { isInitialized, version } = await getWalletInfo(network, address);\n  return isInitialized ? !version : undefined;\n}, (value) => value !== undefined);\n\nexport function publicKeyToAddress(\n  network: ApiNetwork,\n  publicKey: Uint8Array,\n  walletVersion: ApiTonWalletVersion,\n) {\n  const wallet = buildWallet(publicKey, walletVersion);\n  return toBase64Address(wallet.address, false, network);\n}\n\nexport function buildWallet(publicKey: Uint8Array | string, walletVersion: ApiTonWalletVersion): TonWallet {\n  if (typeof publicKey === 'string') {\n    publicKey = hexToBytes(publicKey);\n  }\n\n  const WalletClass = walletClassMap[walletVersion];\n  if (!WalletClass) {\n    throw new Error(`Unsupported wallet contract version \"${walletVersion}\"`);\n  }\n\n  return WalletClass.create({\n    publicKey: Buffer.from(publicKey),\n    workchain: WORKCHAIN,\n  });\n}\n\nexport async function getWalletInfo(network: ApiNetwork, walletOrAddress: TonWallet | string): Promise<ApiWalletInfo> {\n  const address = typeof walletOrAddress === 'string'\n    ? walletOrAddress\n    : toBase64Address(walletOrAddress.address, undefined, network);\n\n  return (await getWalletInfos(network, [address]))[address];\n}\n\nexport async function getContractInfo(network: ApiNetwork, address: string): Promise<{\n  isInitialized: boolean;\n  isSwapAllowed?: boolean;\n  isWallet?: boolean;\n  contractInfo?: ContractInfo;\n  codeHash?: string;\n}> {\n  const data = await getTonClient(network).getAddressInfo(address);\n\n  const { code, state } = data;\n\n  const codeHashOld = Buffer.from(await sha256(base64ToBytes(code))).toString('hex');\n  const contractInfo = Object.values(KnownContracts).find((info) => info.hash === codeHashOld);\n  // For inactive addresses, `code` is an empty string. Cell.fromBase64 throws when `code` is an empty string.\n  const codeHash = code && Cell.fromBase64(code).hash().toString('hex');\n\n  const isInitialized = state === 'active';\n  const isWallet = state === 'active' ? contractInfo?.type === ContractType.Wallet : undefined;\n  const isSwapAllowed = contractInfo?.isSwapAllowed;\n\n  return {\n    isInitialized,\n    isWallet,\n    isSwapAllowed,\n    contractInfo,\n    codeHash,\n  };\n}\n\nexport async function getAccountBalance(accountId: string) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  return getWalletBalance(network, address);\n}\n\nexport async function getWalletBalance(network: ApiNetwork, walletOrAddress: TonWallet | string): Promise<bigint> {\n  return (await getWalletInfo(network, walletOrAddress)).balance;\n}\n\nexport async function getWalletSeqno(network: ApiNetwork, walletOrAddress: TonWallet | string): Promise<number> {\n  const { seqno } = await getWalletInfo(network, walletOrAddress);\n  return seqno || 0;\n}\n\nexport async function pickBestWallet(network: ApiNetwork, publicKey: Uint8Array): Promise<{\n  wallet: TonWallet;\n  version: ApiTonWalletVersion;\n  balance: bigint;\n  lastTxId?: string;\n}> {\n  const allWallets = await getWalletVersionInfos(network, publicKey);\n  const defaultWallet = allWallets.filter(({ version }) => version === DEFAULT_WALLET_VERSION)[0];\n\n  if (defaultWallet.lastTxId) {\n    return defaultWallet;\n  }\n\n  const withBiggestBalance = allWallets.reduce<typeof allWallets[0] | undefined>((best, current) => {\n    return current.balance > (best?.balance ?? 0n) ? current : best;\n  }, undefined);\n\n  if (withBiggestBalance) {\n    return withBiggestBalance;\n  }\n\n  const withLastTx = findLast(allWallets, ({ lastTxId }) => !!lastTxId);\n\n  if (withLastTx) {\n    return withLastTx;\n  }\n\n  // Workaround for NOT holders who do not have transactions\n  const v4Wallet = allWallets.find(({ version }) => version === 'v4R2')!;\n  const v4JettonBalances = await fetchJettonBalances(network, v4Wallet.address);\n  if (v4JettonBalances.length > 0) {\n    return v4Wallet;\n  }\n\n  return defaultWallet;\n}\n\nexport async function getWalletVersionInfos(\n  network: ApiNetwork,\n  publicKey: Uint8Array,\n  versions: ApiTonWalletVersion[] = ALL_WALLET_VERSIONS,\n): Promise<(ApiWalletWithVersionInfo & { wallet: TonWallet })[]> {\n  const items = versions.map((version) => {\n    const wallet = buildWallet(publicKey, version);\n    const address = toBase64Address(wallet.address, false, network);\n    return { wallet, address, version };\n  });\n\n  const walletInfos = await getWalletInfos(network, extractKey(items, 'address'));\n\n  return items.map((item) => {\n    return {\n      ...walletInfos[item.address] ?? {\n        balance: 0n,\n        isInitialized: false,\n      },\n      ...item,\n    };\n  });\n}\n\nexport function getWalletVersions(\n  network: ApiNetwork,\n  publicKey: Uint8Array,\n  versions: ApiTonWalletVersion[] = ALL_WALLET_VERSIONS,\n): {\n    wallet: TonWallet;\n    address: string;\n    version: ApiTonWalletVersion;\n  }[] {\n  return versions.map((version) => {\n    const wallet = buildWallet(publicKey, version);\n    const address = toBase64Address(wallet.address, false, network);\n\n    return {\n      wallet,\n      address,\n      version,\n    };\n  });\n}\n\nexport async function getWalletStateInit(accountId: string, storedWallet: ApiTonWallet) {\n  const wallet = await getTonWallet(accountId, storedWallet);\n\n  return beginCell()\n    .storeWritable(storeStateInit(wallet.init))\n    .endCell();\n}\n\nexport function pickWalletByAddress(network: ApiNetwork, publicKey: Uint8Array, address: string) {\n  address = toBase64Address(address, false, network);\n\n  const allWallets = getWalletVersions(network, publicKey);\n\n  return allWallets.find((w) => w.address === address)!;\n}\n\nexport async function getTonWallet(accountId: string, tonWallet?: ApiTonWallet) {\n  const { publicKey, version } = tonWallet ?? await fetchStoredTonWallet(accountId);\n  if (!publicKey) {\n    throw new Error('Public key is missing');\n  }\n\n  return buildWallet(publicKey, version);\n}\n","import * as tonWebMnemonic from 'tonweb-mnemonic';\nimport * as bip39 from 'bip39';\nimport nacl from 'tweetnacl';\n\nimport type { ApiAccountWithMnemonic, ApiNetwork, ApiTonWallet } from '../../types';\nimport type { ApiTonWalletVersion } from './types';\nimport type { TonWallet } from './util/tonCore';\nimport { ApiAuthError } from '../../types';\n\nimport { DEFAULT_WALLET_VERSION } from '../../../config';\nimport * as HDKey from '../../../lib/ed25519-hd-key';\nimport isMnemonicPrivateKey from '../../../util/isMnemonicPrivateKey';\nimport { omitUndefined } from '../../../util/iteratees';\nimport { logDebugError } from '../../../util/logs';\nimport { getWalletPublicKey, toBase64Address } from './util/tonCore';\nimport { fetchStoredAccount } from '../../common/accounts';\nimport { getMnemonic } from '../../common/mnemonic';\nimport { bytesToHex, hexToBytes } from '../../common/utils';\nimport { resolveAddress } from './address';\nimport { TON_BIP39_PATH } from './constants';\nimport { buildWallet, getWalletInfo, pickBestWallet, publicKeyToAddress } from './wallet';\n\nexport function generateMnemonic() {\n  return tonWebMnemonic.generateMnemonic();\n}\n\nexport function validateMnemonic(mnemonic: string[]) {\n  return tonWebMnemonic.validateMnemonic(mnemonic);\n}\n\nexport function privateKeyHexToKeyPair(privateKeyHex: string) {\n  return nacl.sign.keyPair.fromSeed(hexToBytes(privateKeyHex));\n}\n\nexport async function fetchPrivateKey(accountId: string, password: string, account?: ApiAccountWithMnemonic) {\n  try {\n    const { secretKey: privateKey } = await fetchKeyPair(accountId, password, account) || {};\n\n    return privateKey;\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.error(err);\n\n    return undefined;\n  }\n}\n\nexport async function fetchKeyPair(accountId: string, password: string, account?: ApiAccountWithMnemonic) {\n  try {\n    account = account ?? await fetchStoredAccount<ApiAccountWithMnemonic>(accountId);\n    const mnemonic = await getMnemonic(accountId, password, account);\n    if (!mnemonic) {\n      return undefined;\n    }\n\n    if (isMnemonicPrivateKey(mnemonic)) {\n      return privateKeyHexToKeyPair(mnemonic[0]);\n    } else if (account.type === 'bip39') {\n      return bip39MnemonicToKeyPair(mnemonic);\n    } else {\n      return await tonWebMnemonic.mnemonicToKeyPair(mnemonic);\n    }\n  } catch (err) {\n    logDebugError('fetchKeyPair', err);\n\n    return undefined;\n  }\n}\n\nexport async function rawSign(accountId: string, password: string, dataHex: string) {\n  const privateKey = await fetchPrivateKey(accountId, password);\n  if (!privateKey) {\n    return undefined;\n  }\n\n  const signature = nacl.sign.detached(hexToBytes(dataHex), privateKey);\n\n  return bytesToHex(signature);\n}\n\nexport function getWalletFromBip39Mnemonic(\n  network: ApiNetwork,\n  mnemonic: string[],\n  version?: ApiTonWalletVersion,\n): Promise<ApiTonWallet> {\n  const { publicKey } = bip39MnemonicToKeyPair(mnemonic);\n  return getWalletFromKeys(publicKey, network, version);\n}\n\nexport async function getWalletFromMnemonic(\n  mnemonic: string[],\n  network: ApiNetwork,\n  version?: ApiTonWalletVersion,\n): Promise<ApiTonWallet & { lastTxId?: string }> {\n  const { publicKey } = await tonWebMnemonic.mnemonicToKeyPair(mnemonic);\n  return getWalletFromKeys(publicKey, network, version);\n}\n\nexport function getWalletFromPrivateKey(\n  privateKey: string,\n  network: ApiNetwork,\n  version?: ApiTonWalletVersion,\n): Promise<ApiTonWallet> {\n  const { publicKey } = privateKeyHexToKeyPair(privateKey);\n  return getWalletFromKeys(publicKey, network, version);\n}\n\nasync function getWalletFromKeys(\n  publicKey: Uint8Array,\n  network: ApiNetwork,\n  version?: ApiTonWalletVersion,\n): Promise<ApiTonWallet & { lastTxId?: string }> {\n  let wallet: TonWallet;\n  let lastTxId: string | undefined;\n  if (version) {\n    wallet = buildWallet(publicKey, version);\n  } else {\n    ({ wallet, version, lastTxId } = await pickBestWallet(network, publicKey));\n  }\n\n  const address = toBase64Address(wallet.address, false, network);\n  const publicKeyHex = bytesToHex(publicKey);\n\n  return {\n    type: 'ton',\n    publicKey: publicKeyHex,\n    address,\n    version,\n    index: 0,\n    lastTxId,\n  };\n}\n\nfunction bip39MnemonicToKeyPair(mnemonic: string[]) {\n  const hexSeed = bip39.mnemonicToSeedSync(mnemonic.join(' '));\n  const { key: privateKey } = HDKey.derivePath(TON_BIP39_PATH, hexSeed.toString('hex'));\n  return nacl.sign.keyPair.fromSeed(privateKey);\n}\n\nexport function getOtherVersionWallet(\n  network: ApiNetwork,\n  wallet: ApiTonWallet,\n  otherVersion: ApiTonWalletVersion,\n): ApiTonWallet {\n  if (!wallet.publicKey) {\n    throw new Error('The wallet has no public key');\n  }\n\n  const publicKey = hexToBytes(wallet.publicKey);\n  const newAddress = publicKeyToAddress(network, publicKey, otherVersion);\n  return {\n    type: 'ton',\n    address: newAddress,\n    publicKey: wallet.publicKey,\n    version: otherVersion,\n    index: wallet.index,\n  };\n}\n\nexport async function getWalletFromAddress(\n  network: ApiNetwork,\n  addressOrDomain: string,\n): Promise<{ title?: string; wallet: ApiTonWallet } | { error: ApiAuthError }> {\n  const resolvedAddress = await resolveAddress(network, addressOrDomain, true);\n  if (resolvedAddress === 'dnsNotResolved') return { error: ApiAuthError.DomainNotResolved };\n  if (resolvedAddress === 'invalidAddress') return { error: ApiAuthError.InvalidAddress };\n  const rawAddress = resolvedAddress.address;\n\n  const [walletInfo, publicKey] = await Promise.all([\n    getWalletInfo(network, rawAddress),\n    getWalletPublicKey(network, rawAddress),\n  ]);\n\n  return {\n    title: resolvedAddress.name,\n    wallet: omitUndefined<ApiTonWallet>({\n      type: 'ton',\n      publicKey: publicKey ? bytesToHex(publicKey) : undefined,\n      address: walletInfo.address,\n      // The wallet has no version until it's initialized as a wallet. Using the default version just for the type\n      // compliance, it plays no role for view wallets anyway.\n      version: walletInfo?.version ?? DEFAULT_WALLET_VERSION,\n      index: 0,\n      isInitialized: walletInfo?.isInitialized ?? false,\n    }),\n  };\n}\n","import type { ApiChain } from '../api/types';\n\nimport { CHAIN_CONFIG } from '../config';\n\nexport function getChainConfig<T extends ApiChain>(chain: T) {\n  return CHAIN_CONFIG[chain];\n}\n\nexport function findChainConfig(chain: any) {\n  return chain in CHAIN_CONFIG ? CHAIN_CONFIG[chain as ApiChain] : undefined;\n}\n","import type { ApiChain, ApiToken, ApiTokenWithPrice } from '../api/types';\nimport type { UserToken } from '../global/types';\n\nimport { CHAIN_CONFIG, PRICELESS_TOKEN_HASHES, STAKED_TOKEN_SLUGS, TONCOIN } from '../config';\nimport { getChainConfig } from './chain';\nimport { pick } from './iteratees';\n\nconst chainByNativeSlug = Object.fromEntries(\n  Object.entries(CHAIN_CONFIG).map(([chain, { nativeToken }]) => [nativeToken.slug, chain]),\n) as Record<string, ApiChain>;\n\nexport function getIsNativeToken(slug?: string) {\n  return slug ? slug in chainByNativeSlug : false;\n}\n\nexport function getIsTonToken(slug: string, withNative?: boolean) {\n  return Boolean(slug.startsWith('ton-') || (withNative && slug === TONCOIN.slug));\n}\n\nexport function getNativeToken(chain: ApiChain): ApiToken {\n  return getChainConfig(chain).nativeToken;\n}\n\nexport function getChainBySlug(slug: string) {\n  const items = slug.split('-');\n  return items.length > 1 ? items[0] as ApiChain : chainByNativeSlug[slug];\n}\n\nexport function getIsServiceToken(token?: ApiToken) {\n  const { type, codeHash = '', slug = '' } = token ?? {};\n\n  return type === 'lp_token'\n    || STAKED_TOKEN_SLUGS.has(slug)\n    || PRICELESS_TOKEN_HASHES.has(codeHash);\n}\n\nexport function buildUserToken(token: ApiTokenWithPrice | ApiToken): UserToken {\n  return {\n    ...pick(token, [\n      'symbol',\n      'slug',\n      'name',\n      'image',\n      'decimals',\n      'keywords',\n      'chain',\n      'tokenAddress',\n      'type',\n    ]),\n    amount: 0n,\n    totalValue: '0',\n    price: 0,\n    priceUsd: 0,\n    change24h: 0,\n  };\n}\n","import type { ApiCheckTransactionDraftResult, ApiFetchEstimateDieselResult } from '../../api/chains/ton/types';\nimport type { FeePrecision, FeeTerms } from './types';\n\nimport { TONCOIN } from '../../config';\nimport { Big } from '../../lib/big.js';\nimport { bigintMax, bigintMin } from '../bigint';\nimport { getIsNativeToken } from '../tokens';\n\ntype ApiFee = Pick<ApiCheckTransactionDraftResult, 'fee' | 'realFee' | 'diesel'> & {\n  /** The slug of the token that is being transferred */\n  tokenSlug: string;\n};\n\nexport type ExplainedTransferFee = {\n  /** Whether the result implies paying the fee with a diesel */\n  isGasless: boolean;\n  /**\n   * The fee that will be sent with the transfer. The wallet must have it on the balance to send the transfer.\n   * Show this in the transfer form when the input amount is  the balance, but the remaining balance can't cover the\n   * full fee; show `realFee` otherwise. Undefined means that it's unknown.\n   */\n  fullFee?: {\n    precision: FeePrecision;\n    terms: FeeTerms<bigint>;\n    /** The sum of `terms` measured in the native token */\n    nativeSum: bigint;\n  };\n  /**\n   * The real fee (the full fee minus the excess). Undefined means that it's unknown. There is no need to fall back to\n   * `fullFee` when `realFee` is undefined (because it's undefined too in this case).\n   */\n  realFee?: {\n    precision: FeePrecision;\n    terms: FeeTerms<bigint>;\n    /** The sum of `terms` measured in the native token */\n    nativeSum: bigint;\n  };\n  /** The excess fee. Measured in the native token. It's always approximate. Undefined means that it's unknown. */\n  excessFee?: bigint;\n  /**\n   * Whether the full token balance can be transferred despite the fee.\n   * If yes, the fee will be taken from the transferred amount.\n   */\n  canTransferFullBalance: boolean;\n};\n\ntype AvailableDiesel = ApiFetchEstimateDieselResult & { amount: bigint };\ntype ApiFeeWithDiesel = ApiFee & { diesel: AvailableDiesel };\n\ntype MaxTransferAmountInput = {\n  /** The wallet balance of the transferred token. Undefined means that it's unknown. */\n  tokenBalance: bigint | undefined;\n  /** The slug of the token that is being transferred */\n  tokenSlug: string;\n  /** The full fee terms calculated by `explainApiTransferFee`. Undefined means that they're unknown. */\n  fullFee: FeeTerms<bigint> | undefined;\n  /** Whether the full token balance can be transferred despite the fee. */\n  canTransferFullBalance: boolean;\n};\n\ntype BalanceSufficientForTransferInput = Omit<MaxTransferAmountInput, 'tokenSlug'> & {\n  /** The wallet balance of the native token of the transfer chain. Undefined means that it's unknown. */\n  nativeTokenBalance: bigint | undefined;\n  /** The transferred amount. Use 0 for NFT transfers. Undefined means that it's unspecified. */\n  transferAmount: bigint | undefined;\n};\n\n/**\n * Converts the transfer fee data returned from API into data that is ready to be displayed in the transfer form UI.\n */\nexport function explainApiTransferFee(input: ApiFee): ExplainedTransferFee {\n  return shouldUseDiesel(input)\n    ? explainGaslessTransferFee(input)\n    : explainGasfullTransferFee(input);\n}\n\n/**\n * Calculates the maximum amount available for the transfer.\n * Returns undefined when it can't be calculated because of insufficient input data.\n */\nexport function getMaxTransferAmount({\n  tokenBalance,\n  tokenSlug,\n  fullFee,\n  canTransferFullBalance,\n}: MaxTransferAmountInput): bigint | undefined {\n  if (tokenBalance === undefined) {\n    return undefined;\n  }\n\n  // Returning the full balance when the fee is unknown for a better UX\n  if (canTransferFullBalance || !fullFee) {\n    return tokenBalance;\n  }\n\n  let fee = fullFee.token ?? 0n;\n  if (getIsNativeToken(tokenSlug)) {\n    // When the token is native, both `token` and `native` refer to the same currency, so they should be added\n    fee += fullFee.native ?? 0n;\n  }\n\n  return bigintMax(tokenBalance - fee, 0n);\n}\n\n/**\n * Decides whether the balance is sufficient to transfer the amount and pay the fees.\n * Returns undefined when it can't be calculated because of insufficient input data.\n */\nexport function isBalanceSufficientForTransfer({\n  tokenBalance,\n  nativeTokenBalance,\n  transferAmount,\n  fullFee,\n  canTransferFullBalance,\n}: BalanceSufficientForTransferInput) {\n  if (transferAmount === undefined || tokenBalance === undefined || nativeTokenBalance === undefined || !fullFee) {\n    return undefined;\n  }\n\n  const isFullTokenTransfer = transferAmount === tokenBalance && canTransferFullBalance;\n  const tokenRequiredAmount = (fullFee.token ?? 0n) + (isFullTokenTransfer ? 0n : transferAmount);\n  const nativeTokenRequiredAmount = fullFee.native ?? 0n;\n\n  return tokenRequiredAmount <= tokenBalance && nativeTokenRequiredAmount <= nativeTokenBalance;\n}\n\nexport function isDieselAvailable(diesel: ApiFetchEstimateDieselResult): diesel is AvailableDiesel {\n  return diesel.status !== 'not-available' && diesel.amount !== undefined;\n}\n\nexport function getDieselTokenAmount(diesel: ApiFetchEstimateDieselResult) {\n  return diesel.status === 'stars-fee' ? 0n : (diesel.amount ?? 0n);\n}\n\nfunction shouldUseDiesel(input: ApiFee): input is ApiFeeWithDiesel {\n  return input.diesel !== undefined && isDieselAvailable(input.diesel);\n}\n\n/**\n * Converts the data of a transfer not involving diesel\n */\nfunction explainGasfullTransferFee(input: ApiFee) {\n  const result: ExplainedTransferFee = {\n    isGasless: false,\n    canTransferFullBalance: input.tokenSlug === TONCOIN.slug,\n  };\n\n  if (input.fee !== undefined) {\n    result.fullFee = {\n      precision: input.realFee === input.fee ? 'exact' : 'lessThan',\n      terms: { native: input.fee },\n      nativeSum: input.fee,\n    };\n    result.realFee = result.fullFee;\n  }\n\n  if (input.realFee !== undefined) {\n    result.realFee = {\n      precision: input.realFee === input.fee ? 'exact' : 'approximate',\n      terms: { native: input.realFee },\n      nativeSum: input.realFee,\n    };\n  }\n\n  if (input.fee !== undefined && input.realFee !== undefined) {\n    result.excessFee = input.fee - input.realFee;\n  }\n\n  return result;\n}\n\n/**\n * Converts the diesel of semi-diesel transfer data\n */\nfunction explainGaslessTransferFee({ diesel }: ApiFeeWithDiesel) {\n  const isStarsDiesel = diesel.status === 'stars-fee';\n  const dieselKey = isStarsDiesel ? 'stars' : 'token';\n  const realFeeInDiesel = convertFee(diesel.realFee, diesel.nativeAmount, diesel.amount);\n  // Cover as much displayed real fee as possible with diesel, because in the excess it will return as the native token.\n  const dieselRealFee = bigintMin(diesel.amount, realFeeInDiesel);\n  // Cover the remaining real fee with the native token.\n  const nativeRealFee = bigintMax(0n, diesel.realFee - diesel.nativeAmount);\n\n  return {\n    isGasless: true,\n    canTransferFullBalance: false,\n    fullFee: {\n      precision: 'lessThan',\n      terms: {\n        [dieselKey]: diesel.amount,\n        native: diesel.remainingFee,\n      },\n      nativeSum: diesel.nativeAmount + diesel.remainingFee,\n    },\n    realFee: {\n      precision: 'approximate',\n      terms: {\n        [dieselKey]: dieselRealFee,\n        native: nativeRealFee,\n      },\n      nativeSum: diesel.realFee,\n    },\n    excessFee: diesel.nativeAmount + diesel.remainingFee - diesel.realFee,\n  } satisfies ExplainedTransferFee;\n}\n\n/**\n * `exampleFromAmount` and `exampleToAmount` define the exchange rate used to convert `amount`.\n * `exampleFromAmount` is defined in the same currency as `amount`. Mustn't be 0.\n * `exampleToAmount` is defined in the currency you want to get.\n */\nfunction convertFee(\n  amount: bigint,\n  exampleFromAmount: bigint,\n  exampleToAmount: bigint,\n) {\n  const exchangeRate = Big(exampleToAmount.toString()).div(exampleFromAmount.toString());\n  return BigInt(Big(amount.toString()).mul(exchangeRate).round().toString());\n}\n","// This JS library implements TON message comment encryption and decryption for Web\n// Reference C++ code - SimpleEncryptionV2 - https://github.com/ton-blockchain/ton/blob/cc0eb453cb3bf69f92693160103d33112856c056/tonlib/tonlib/keys/SimpleEncryption.cpp#L110\n// Dependencies:\n// - TonWeb 0.0.60\n// - aes-js - 3.1.2 - https://github.com/ricmoo/aes-js/releases/tag/v3.1.2 - for aes-cbc without padding\n// - noble-ed25519 - 1.7.3 - // https://github.com/paulmillr/noble-ed25519/releases/tag/1.7.3 - for getSharedKey\n\nimport type { Address } from '@ton/core';\n\nimport aesjs from '../../../../lib/aes-js';\nimport { getSharedSecret } from '../../../../lib/noble-ed25519';\nimport { OpCode } from '../constants';\nimport { toBase64Address } from './tonCore';\n\nasync function hmacSha512(key: Uint8Array, data: Uint8Array): Promise<Uint8Array> {\n  const hmacAlgo = { name: 'HMAC', hash: 'SHA-512' };\n  const hmacKey = await crypto.subtle.importKey('raw', key, hmacAlgo, false, ['sign']);\n  const signature = await crypto.subtle.sign(hmacAlgo, hmacKey, data);\n  const result = new Uint8Array(signature);\n  if (result.length !== 512 / 8) throw new Error();\n  return result;\n}\n\nfunction getAesCbcState(hash: Uint8Array) {\n  if (hash.length < 48) throw new Error();\n  const key = hash.slice(0, 32);\n  const iv = hash.slice(32, 32 + 16);\n\n  // Note that native crypto.subtle AES-CBC not suitable here because\n  // even if the data IS a multiple of 16 bytes, padding will still be added\n  // So we use aes-js\n\n  return new aesjs.ModeOfOperation.cbc(key, iv);\n}\n\nfunction getRandomPrefix(dataLength: number, minPadding: number): Uint8Array {\n  const prefixLength = ((minPadding + 15 + dataLength) & -16) - dataLength;\n  const prefix = crypto.getRandomValues(new Uint8Array(prefixLength));\n  prefix[0] = prefixLength;\n  if ((prefixLength + dataLength) % 16 !== 0) throw new Error();\n  return prefix;\n}\n\nfunction combineSecrets(a: Uint8Array, b: Uint8Array) {\n  return hmacSha512(a, b);\n}\n\nasync function encryptDataWithPrefix(data: Uint8Array, sharedSecret: Uint8Array, salt: Uint8Array) {\n  if (data.length % 16 !== 0) throw new Error();\n  const dataHash = await combineSecrets(salt, data);\n  const msgKey = dataHash.slice(0, 16);\n\n  const res = new Uint8Array(data.length + 16);\n  res.set(msgKey, 0);\n\n  const cbcStateSecret = await combineSecrets(sharedSecret, msgKey);\n  const encrypted = getAesCbcState(cbcStateSecret).encrypt(data);\n  res.set(encrypted, 16);\n\n  return res;\n}\n\nasync function encryptDataImpl(data: Uint8Array, sharedSecret: Uint8Array, salt: Uint8Array) {\n  const prefix = getRandomPrefix(data.length, 16);\n  const combined = new Uint8Array(prefix.length + data.length);\n  combined.set(prefix, 0);\n  combined.set(data, prefix.length);\n  return encryptDataWithPrefix(combined, sharedSecret, salt);\n}\n\nexport async function encryptData(\n  data: Uint8Array, myPublicKey: Uint8Array, theirPublicKey: Uint8Array, privateKey: Uint8Array, salt: Uint8Array,\n) {\n  const sharedSecret = await getSharedSecret(privateKey, theirPublicKey);\n\n  const encrypted = await encryptDataImpl(data, sharedSecret, salt);\n  const prefixedEncrypted = new Uint8Array(myPublicKey.length + encrypted.length);\n  for (let i = 0; i < myPublicKey.length; i++) {\n    prefixedEncrypted[i] = theirPublicKey[i] ^ myPublicKey[i];\n  }\n  prefixedEncrypted.set(encrypted, myPublicKey.length);\n  return prefixedEncrypted;\n}\n\nexport async function encryptMessageComment(\n  comment: string,\n  myPublicKey: Uint8Array,\n  theirPublicKey: Uint8Array,\n  myPrivateKey: Uint8Array,\n  senderAddress: Address | string,\n) {\n  if (!comment || !comment.length) throw new Error('empty comment');\n\n  if (myPrivateKey.length === 64) {\n    myPrivateKey = myPrivateKey.slice(0, 32); // convert nacl private key\n  }\n\n  const commentBytes = new TextEncoder().encode(comment);\n\n  const salt = new TextEncoder().encode(toBase64Address(senderAddress, true));\n\n  const encryptedBytes = await encryptData(commentBytes, myPublicKey, theirPublicKey, myPrivateKey, salt);\n\n  const payload = new Uint8Array(encryptedBytes.length + 4);\n\n  const buffer = Buffer.alloc(4);\n  buffer.writeUInt32BE(OpCode.Encrypted);\n\n  payload.set(buffer, 0);\n  payload.set(encryptedBytes, 4);\n\n  return payload;\n}\n\nasync function doDecrypt(\n  cbcStateSecret: Uint8Array, msgKey: Uint8Array, encryptedData: Uint8Array, salt: Uint8Array,\n): Promise<Uint8Array> {\n  const decryptedData = getAesCbcState(cbcStateSecret).decrypt(encryptedData);\n  const dataHash = await combineSecrets(salt, decryptedData);\n  const gotMsgKey = dataHash.slice(0, 16);\n  if (msgKey.join(',') !== gotMsgKey.join(',')) {\n    throw new Error('Failed to decrypt: hash mismatch');\n  }\n  const prefixLength = decryptedData[0];\n  if (prefixLength > decryptedData.length || prefixLength < 16) {\n    throw new Error('Failed to decrypt: invalid prefix size');\n  }\n  return decryptedData.slice(prefixLength);\n}\n\nasync function decryptDataImpl(\n  encryptedData: Uint8Array, sharedSecret: Uint8Array, salt: Uint8Array,\n): Promise<Uint8Array> {\n  if (encryptedData.length < 16) throw new Error('Failed to decrypt: data is too small');\n  if (encryptedData.length % 16 !== 0) throw new Error('Failed to decrypt: data size is not divisible by 16');\n  const msgKey = encryptedData.slice(0, 16);\n  const data = encryptedData.slice(16);\n  const cbcStateSecret = await combineSecrets(sharedSecret, msgKey);\n  const res = await doDecrypt(cbcStateSecret, msgKey, data, salt);\n  return res;\n}\n\nexport async function decryptData(data: Uint8Array, publicKey: Uint8Array, privateKey: Uint8Array, salt: Uint8Array) {\n  if (data.length < publicKey.length) {\n    throw new Error('Failed to decrypt: data is too small');\n  }\n  const theirPublicKey = new Uint8Array(publicKey.length);\n  for (let i = 0; i < publicKey.length; i++) {\n    theirPublicKey[i] = data[i] ^ publicKey[i];\n  }\n  const sharedSecret = await getSharedSecret(privateKey, theirPublicKey);\n\n  const decrypted = await decryptDataImpl(data.slice(publicKey.length), sharedSecret, salt);\n  return decrypted;\n}\n\nexport async function decryptMessageComment(\n  encryptedData: Uint8Array, myPublicKey: Uint8Array, myPrivateKey: Uint8Array, senderAddress: Address | string,\n) {\n  if (myPrivateKey.length === 64) {\n    myPrivateKey = myPrivateKey.slice(0, 32); // convert nacl private key\n  }\n\n  const salt = new TextEncoder().encode(toBase64Address(senderAddress, true));\n\n  const decryptedBytes = await decryptData(encryptedData, myPublicKey, myPrivateKey, salt);\n  return new TextDecoder().decode(decryptedBytes);\n}\n","import { callBackendPost } from '../../../common/backend';\n\nconst DIESEL_URL = '/diesel';\n\nexport function dieselSendBoc(boc: string) {\n  return callBackendPost<{ result: string; paymentLink?: string }>(\n    `${DIESEL_URL}/sendBoc`, { boc, isAddition: true }, { shouldRetry: true },\n  );\n}\n","import { callBackendPost } from '../../../common/backend';\n\nconst DIESEL_URL = '/diesel';\n\nexport function dieselW5SendRequest(boc: string) {\n  return callBackendPost<{ result: string; paymentLink?: string }>(\n    `${DIESEL_URL}/w5/sendBoc`, { boc, isAddition: true }, { shouldRetry: true },\n  );\n}\n","import type { Cell, Message } from '@ton/core';\nimport { beginCell, external, storeMessage } from '@ton/core';\n\nimport type { GaslessType } from '../transfer';\nimport type { TonClient } from './TonClient';\nimport type { TonWallet } from './tonCore';\n\nimport { dieselSendBoc } from './diesel';\nimport { dieselW5SendRequest } from './w5diesel';\n\nexport async function sendExternal(\n  client: TonClient,\n  wallet: TonWallet,\n  message: Cell,\n  gaslessType?: GaslessType,\n) {\n  const {\n    address,\n    init,\n  } = wallet;\n\n  let neededInit: { data: Cell; code: Cell } | undefined;\n  if (init && !await client.isContractDeployed(address)) {\n    neededInit = init;\n  }\n\n  const ext = external({\n    to: address,\n    init: neededInit ? {\n      code: neededInit.code,\n      data: neededInit.data,\n    } : undefined,\n    body: message,\n  });\n\n  const cell = beginCell()\n    .store(storeMessage(ext))\n    .endCell();\n\n  const isW5Gasless = gaslessType === 'w5';\n\n  const msgHash = cell.hash().toString('base64');\n  const msgHashNormalized = getExternalMsgHashNormalized(ext);\n  const bodyMessageHash = message.hash().toString('base64');\n  const boc = cell.toBoc().toString('base64');\n\n  let paymentLink;\n  if (isW5Gasless) {\n    const result = await dieselW5SendRequest(boc);\n    paymentLink = result.paymentLink;\n  } else if (gaslessType === 'diesel') {\n    const result = await dieselSendBoc(boc);\n    paymentLink = result.paymentLink;\n  } else {\n    await client.sendFile(boc);\n  }\n\n  return {\n    boc,\n    msgHash: isW5Gasless ? bodyMessageHash : msgHash,\n    msgHashNormalized,\n    paymentLink,\n  };\n}\n\nfunction getExternalMsgHashNormalized(message: Message): string {\n  const cell = beginCell()\n    .storeUint(2, 2) // Message type: external-in\n    .storeUint(0, 2) // No sender address for external messages\n    .storeAddress(message.info.dest) // Store recipient address\n    .storeUint(0, 4) // Import fee is always zero for external messages\n    .storeBit(false) // No StateInit in this message\n    .storeBit(true) // Store the body as a reference\n    .storeRef(message.body) // Store the message body\n    .endCell();\n\n  return cell.hash().toString('base64');\n}\n","import type { ApiNetwork } from '../types';\n\nimport Deferred from '../../util/Deferred';\nimport generateUniqueId from '../../util/generateUniqueId';\n\nconst byId: Record<string, Deferred> = {};\nconst byAddress: Record<string, Deferred> = {};\n\nexport async function waitAndCreatePendingTransfer(network: ApiNetwork, address: string) {\n  const key = `${network}:${address}`;\n  const prevPending = byAddress[key];\n\n  const id = generateUniqueId();\n  const pendingTransfer = new Deferred();\n  byAddress[key] = pendingTransfer;\n  byId[id] = pendingTransfer;\n\n  if (prevPending) {\n    await prevPending.promise;\n  }\n\n  return { id, pendingTransfer };\n}\n\nexport function getPendingTransfer(id: string): Deferred | undefined {\n  return byId[id];\n}\n","import type { ApiNetwork } from '../../types';\nimport type { AddressBook, AnyAction, TraceDetail, Transaction } from './toncenter/types';\nimport type { ParsedTrace, ParsedTracePart } from './types';\n\nimport { bigintAbs } from '../../../util/bigint';\nimport { groupBy } from '../../../util/iteratees';\nimport { fetchTrace } from './toncenter/traces';\nimport { parseRawTransaction } from './toncenter';\n\n/**\n * Returns `undefined` when there is no trace for the given hash. It may be unavailable YET, for example if the trace is\n * requested immediately after receiving an action from the socket.\n */\nexport async function fetchAndParseTrace(\n  network: ApiNetwork,\n  walletAddress: string,\n  msgHashNormalized: string,\n  isActionPending?: boolean,\n): Promise<ParsedTrace | undefined> {\n  const { trace, addressBook } = await fetchTrace({ network, msgHashNormalized, isActionPending });\n\n  return trace && parseTrace({\n    network,\n    walletAddress,\n    actions: trace.actions,\n    traceDetail: trace.trace,\n    addressBook,\n    transactions: trace.transactions,\n  });\n}\n\nexport function parseTrace(options: {\n  network: ApiNetwork;\n  walletAddress: string;\n  actions: AnyAction[];\n  traceDetail: TraceDetail;\n  addressBook: AddressBook;\n  transactions: Record<string, Transaction>;\n}): ParsedTrace {\n  const {\n    network,\n    walletAddress,\n    actions,\n    traceDetail,\n    addressBook,\n    transactions,\n  } = options;\n\n  const byTransactionIndex = isFailedTransactionTrace(traceDetail)\n    ? parseFailedTransactions(traceDetail, transactions)\n    : parseCompletedTransactions(network, walletAddress, traceDetail, addressBook, transactions);\n\n  return {\n    actions,\n    traceDetail,\n    addressBook,\n    byTransactionIndex,\n    totalSent: byTransactionIndex.reduce((total, { sent }) => total + sent, 0n),\n    totalReceived: byTransactionIndex.reduce((total, { received }) => total + received, 0n),\n    totalNetworkFee: byTransactionIndex.reduce((total, { networkFee }) => total + networkFee, 0n),\n  };\n}\n\nfunction isFailedTransactionTrace(traceDetails: TraceDetail) {\n  return traceDetails.children.length === 0;\n}\n\nfunction parseCompletedTransactions(\n  network: ApiNetwork,\n  walletAddress: string,\n  traceDetail: TraceDetail,\n  addressBook: AddressBook,\n  rawTransactions: Record<string, Transaction>,\n): ParsedTracePart[] {\n  const transactions = Object.values(rawTransactions)\n    .map((rawTx) => parseRawTransaction(network, rawTx, addressBook))\n    .flat();\n\n  const byHash = groupBy(transactions, 'hash');\n  const byTransactionIndex: ParsedTracePart[] = [];\n\n  let isWalletTransactionFound = false;\n\n  function processTrace(_traceDetail: TraceDetail, _index?: number) {\n    const hash = _traceDetail.tx_hash;\n    const txs = byHash[hash] || [];\n\n    if (!isWalletTransactionFound) {\n      isWalletTransactionFound = txs.some(({\n        fromAddress,\n        isIncoming,\n      }) => {\n        return fromAddress === walletAddress && !isIncoming;\n      });\n\n      // In gasless operations, we need to skip transactions before our wallet\n      if (!isWalletTransactionFound) {\n        _traceDetail.children.forEach(processTrace);\n        return;\n      }\n    }\n\n    for (const [i, tx] of txs.entries()) {\n      const {\n        fromAddress,\n        toAddress,\n        amount,\n        isIncoming,\n        fee,\n        msgHash,\n        type,\n      } = tx;\n\n      const index = _index ?? i;\n\n      if (!(index in byTransactionIndex)) {\n        // First transaction from wallet includes all sub-transactions, and its hash is not unique\n        byTransactionIndex.push({\n          hashes: new Set(),\n          sent: 0n,\n          received: 0n,\n          networkFee: 0n,\n          isSuccess: true,\n        });\n      } else {\n        byTransactionIndex[index].hashes.add(hash);\n      }\n\n      if (fromAddress === walletAddress && !isIncoming) {\n        byTransactionIndex[index].sent += bigintAbs(amount);\n        byTransactionIndex[index].networkFee = fee;\n      } else if (toAddress === walletAddress && isIncoming && type !== 'bounced') {\n        byTransactionIndex[index].received += bigintAbs(amount);\n      }\n\n      const child = _traceDetail.children.find(({ in_msg_hash }) => in_msg_hash === msgHash);\n      if (child) {\n        processTrace(child, index);\n      }\n    }\n  }\n\n  processTrace(traceDetail);\n\n  return byTransactionIndex;\n}\n\nfunction parseFailedTransactions(\n  traceDetails: TraceDetail,\n  rawTransactions: Record<string, Transaction>,\n): ParsedTracePart[] {\n  const txHash = traceDetails.tx_hash;\n  const rawTx = rawTransactions[txHash];\n\n  // The root transaction can represent multiple actual failed transactions. Instead, the returned array contains only\n  // one item. The actual number of failed transactions can be obtained by parsing `rawTx.in_msg.message_content.body`\n  // probably, but this is not needed, so the code is simplified.\n  return [{\n    hashes: new Set([txHash]),\n    sent: 0n,\n    received: 0n,\n    networkFee: BigInt(rawTx.total_fees),\n    isSuccess: false,\n  }];\n}\n","import type { ApiNetwork } from '../../../types';\nimport type { AddressBook, MetadataMap, Trace } from './types';\n\nimport { callToncenterV3 } from './other';\n\nexport type TracesResponse = {\n  traces: Trace[];\n  address_book: AddressBook;\n  metadata: MetadataMap;\n};\n\nexport async function fetchTrace(options: {\n  network: ApiNetwork;\n  msgHashNormalized: string;\n  isActionPending?: boolean;\n}): Promise<{\n    trace?: Trace;\n    addressBook: AddressBook;\n    metadata: MetadataMap;\n  }> {\n  const { network, msgHashNormalized, isActionPending } = options;\n\n  const response = await callToncenterV3<TracesResponse>(\n    network,\n    isActionPending ? '/pendingTraces' : '/traces',\n    {\n      [isActionPending ? 'ext_msg_hash' : 'msg_hash']: msgHashNormalized,\n      include_actions: true,\n    },\n  );\n\n  return {\n    trace: response.traces[0],\n    addressBook: response.address_book,\n    metadata: response.metadata,\n  };\n}\n","import type { ApiActivity, ApiNetwork, ApiSwapActivity, ApiTransactionActivity } from '../../types';\nimport type { AnyAction, CallContractAction, JettonTransferAction, SwapAction } from './toncenter/types';\nimport type { ParsedTrace, ParsedTracePart } from './types';\n\nimport { TONCOIN } from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { getActivityTokenSlugs, getIsActivityPending } from '../../../util/activities';\nimport { fromDecimal, toDecimal } from '../../../util/decimals';\nimport { intersection } from '../../../util/iteratees';\nimport { logDebug, logDebugError } from '../../../util/logs';\nimport { pause } from '../../../util/schedulers';\nimport withCacheAsync from '../../../util/withCacheAsync';\nimport { resolveTokenWalletAddress } from './util/tonCore';\nimport { fetchStoredTonWallet } from '../../common/accounts';\nimport { getTokenBySlug, tokensPreload } from '../../common/tokens';\nimport { SEC } from '../../constants';\nimport { OpCode, OUR_FEE_PAYLOAD_BOC } from './constants';\nimport { fetchActions, fetchTransactions, parseActionActivityId, parseLiquidityDeposit } from './toncenter';\nimport { fetchAndParseTrace } from './traces';\n\ntype ActivityDetailsResult = {\n  activity: ApiActivity;\n  sentForFee: bigint;\n  excess: bigint;\n};\n\nconst GET_TRANSACTIONS_LIMIT = 128;\n\nconst TRACE_ATTEMPT_COUNT = 5;\nconst TRACE_RETRY_DELAY = SEC;\n\nexport const checkHasTransaction = withCacheAsync(async (network: ApiNetwork, address: string) => {\n  const transactions = await fetchTransactions({\n    network,\n    address,\n    limit: 1,\n  });\n  return Boolean(transactions.length);\n});\n\nexport async function fetchActivitySlice(\n  accountId: string,\n  tokenSlug?: string,\n  toTimestamp?: number,\n  fromTimestamp?: number,\n  limit?: number,\n  shouldIncludeFrom?: boolean,\n): Promise<ApiActivity[]> {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  if (!tokenSlug) {\n    return fetchActions({\n      network,\n      filter: { address },\n      walletAddress: address,\n      limit: limit ?? GET_TRANSACTIONS_LIMIT,\n      fromTimestamp,\n      toTimestamp,\n      shouldIncludeFrom,\n    });\n  } else {\n    let tokenWalletAddress = address;\n\n    if (tokenSlug !== TONCOIN.slug) {\n      await tokensPreload.promise;\n      tokenWalletAddress = await resolveTokenWalletAddress(network, address, getTokenBySlug(tokenSlug).tokenAddress!);\n    }\n\n    const activities = await fetchActions({\n      network,\n      filter: { address: tokenWalletAddress },\n      walletAddress: address,\n      limit: limit ?? GET_TRANSACTIONS_LIMIT,\n      fromTimestamp,\n      toTimestamp,\n      shouldIncludeFrom,\n    });\n\n    return activities.filter((activity) => getActivityTokenSlugs(activity).includes(tokenSlug));\n  }\n}\n\nexport async function fetchNewestActionId(network: ApiNetwork, address: string) {\n  const transactions = await fetchTransactions({\n    network,\n    address,\n    limit: 1,\n  });\n\n  if (!transactions.length) {\n    return undefined;\n  }\n\n  return transactions[0].txId;\n}\n\nexport async function fetchActivityDetails(\n  accountId: string,\n  activity: ApiActivity,\n): Promise<ActivityDetailsResult | undefined> {\n  const { network } = parseAccountId(accountId);\n  const { address: walletAddress } = await fetchStoredTonWallet(accountId);\n  let result: ActivityDetailsResult | undefined;\n\n  // The trace can be unavailable immediately after the action is received, so a couple of delayed retries are made\n  for (let attempt = 0; attempt < TRACE_ATTEMPT_COUNT && !result; attempt++) {\n    if (attempt > 0) {\n      await pause(TRACE_RETRY_DELAY);\n    }\n\n    const parsedTrace = await fetchAndParseTrace(\n      network,\n      walletAddress,\n      activity.externalMsgHashNorm!,\n      getIsActivityPending(activity),\n    );\n    if (!parsedTrace) {\n      continue;\n    }\n\n    result = calculateActivityDetails(activity, parsedTrace);\n  }\n\n  if (!result) {\n    logDebugError('Trace unavailable for activity', activity.id);\n  }\n\n  return result;\n}\n\nexport function calculateActivityDetails(\n  activity: ApiActivity,\n  parsedTrace: ParsedTrace,\n): ActivityDetailsResult | undefined {\n  const { actionId } = parseActionActivityId(activity.id);\n  const { actions, byTransactionIndex } = parsedTrace;\n\n  const action = actions.find(({ action_id }) => action_id === actionId);\n  if (!action) {\n    // This can happen when the trace is requested too early, for example right after receiving the action from a socket\n    return undefined;\n  }\n\n  const actionHashes = new Set(action.transactions);\n\n  const tracePart = byTransactionIndex.find((item) => {\n    return intersection(item.hashes, actionHashes).size;\n  })!;\n\n  let result: ActivityDetailsResult;\n\n  if (activity.kind === 'swap') {\n    result = setSwapDetails({\n      parsedTrace, activity, action: action as SwapAction, tracePart,\n    });\n  } else {\n    result = setTransactionDetails({\n      parsedTrace, activity, action, tracePart,\n    });\n  }\n\n  logDebug('Calculation of fee for action', {\n    actionId: action.action_id,\n    externalMsgHashNorm: activity.externalMsgHashNorm,\n    activityStatus: activity.status,\n    networkFee: toDecimal(tracePart.networkFee),\n    realFee: toDecimal(getActivityRealFee(result.activity)),\n    sentForFee: toDecimal(result.sentForFee),\n    excess: toDecimal(result.excess),\n    details: action.details,\n  });\n\n  return result;\n}\n\nfunction setSwapDetails(options: {\n  parsedTrace: ParsedTrace;\n  action: SwapAction;\n  activity: ApiSwapActivity;\n  tracePart: ParsedTracePart;\n}): ActivityDetailsResult {\n  const { action, tracePart, parsedTrace: { actions } } = options;\n  let { activity } = options;\n\n  const { details } = action;\n\n  let sentForFee = tracePart.sent;\n  let excess = tracePart.received;\n\n  // When the transaction is failed, its `sent` and `received` are always 0 (as defined in `parseFailedTransactions`)\n  if (tracePart.isSuccess) {\n    if (!details.asset_in) {\n      // TON -> token\n      sentForFee -= BigInt(details.dex_incoming_transfer.amount);\n    } else if (!details.asset_out) {\n      // Token -> TON\n      excess -= BigInt(details.dex_outgoing_transfer.amount);\n    }\n  }\n\n  const realFee = tracePart.networkFee + sentForFee - excess;\n\n  activity = {\n    ...activity,\n    networkFee: toDecimal(realFee),\n  };\n\n  let ourFee: bigint | undefined;\n  if (!details.asset_in) {\n    const ourFeeAction = actions.find((_action) => {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-enum-comparison\n      return _action.type === 'call_contract' && Number(_action.details.opcode) === OpCode.OurFee;\n    }) as CallContractAction | undefined;\n    if (ourFeeAction?.success) {\n      ourFee = BigInt(ourFeeAction.details.value);\n    }\n  } else {\n    const ourFeeAction = actions.find((_action) => {\n      return _action.type === 'jetton_transfer' && _action.details.forward_payload === OUR_FEE_PAYLOAD_BOC;\n    }) as JettonTransferAction | undefined;\n    if (ourFeeAction?.success) {\n      ourFee = BigInt(ourFeeAction.details.amount);\n    }\n  }\n\n  if (ourFee) {\n    const tokenIn = getTokenBySlug(activity.from);\n    activity.ourFee = toDecimal(ourFee, tokenIn?.decimals);\n  }\n\n  delete activity.shouldLoadDetails;\n\n  return { activity, sentForFee, excess };\n}\n\nfunction setTransactionDetails(options: {\n  parsedTrace: ParsedTrace;\n  action: AnyAction;\n  activity: ApiTransactionActivity;\n  tracePart: ParsedTracePart;\n}): ActivityDetailsResult {\n  const {\n    action,\n    tracePart,\n    parsedTrace: {\n      addressBook,\n      totalSent,\n      totalReceived,\n      totalNetworkFee,\n    },\n  } = options;\n\n  let { activity } = options;\n  let { networkFee, sent: sentForFee, received: excess } = tracePart;\n\n  switch (action.type) {\n    case 'ton_transfer':\n    case 'call_contract': {\n      sentForFee -= BigInt(action.details.value);\n      break;\n    }\n    case 'nft_transfer': {\n      if (action.details.is_purchase) {\n        sentForFee -= BigInt(action.details.price!);\n      }\n      break;\n    }\n    case 'stake_deposit': {\n      sentForFee -= BigInt(action.details.amount);\n      break;\n    }\n    case 'stake_withdrawal': {\n      excess -= BigInt(action.details.amount);\n      break;\n    }\n    case 'dex_deposit_liquidity': {\n      // Liquidity deposit can be either a dual transaction or two separate single transactions.\n      // We display the deposit as separate actions, so we divide by the number of actions.\n      const activitiesPerAction = BigInt(parseLiquidityDeposit(action, {\n        addressBook,\n        // The below fields don't matter here, they are only to satisfy the type requirements:\n        network: 'mainnet',\n        walletAddress: '',\n        metadata: {},\n        nftSuperCollectionsByCollectionAddress: {},\n      }).length);\n\n      networkFee = totalNetworkFee / activitiesPerAction;\n      sentForFee = totalSent / activitiesPerAction;\n      excess = totalReceived / activitiesPerAction;\n\n      if (!action.details.asset_1) {\n        sentForFee -= BigInt(action.details.amount_1 ?? 0n) / activitiesPerAction;\n      } else if (!action.details.asset_2) {\n        sentForFee -= BigInt(action.details.amount_2 ?? 0n) / activitiesPerAction;\n      }\n      break;\n    }\n    case 'dex_withdraw_liquidity': {\n      if (!action.details.asset_1) {\n        excess -= BigInt(action.details.amount_1);\n      } else if (!action.details.asset_2) {\n        excess -= BigInt(action.details.amount_2);\n      }\n\n      sentForFee /= 2n;\n      excess /= 2n;\n      break;\n    }\n  }\n\n  // When the transaction is failed, its `sent` and `received` are always 0 (as defined in `parseFailedTransactions`)\n  if (!tracePart.isSuccess) {\n    sentForFee = 0n;\n    excess = 0n;\n  }\n\n  const realFee = networkFee + sentForFee - excess;\n\n  activity = {\n    ...activity,\n    fee: realFee,\n  };\n\n  delete activity.shouldLoadDetails;\n\n  return { activity, sentForFee, excess };\n}\n\nexport function getActivityRealFee(activity: ApiActivity) {\n  return activity.kind === 'swap' ? fromDecimal(activity.networkFee, TONCOIN.decimals) : activity.fee;\n}\n","import type { Cell } from '@ton/core';\nimport { beginCell, external, storeMessage } from '@ton/core';\n\nimport type {\n  ApiActivity,\n  ApiEmulationResult,\n  ApiNetwork,\n  ApiNftSuperCollection,\n  ApiTransactionActivity,\n} from '../../types';\nimport type { EmulationResponse } from './toncenter/emulation';\nimport type { TonWallet } from './util/tonCore';\n\nimport { BURN_ADDRESS, TONCOIN } from '../../../config';\nimport { logDebugError } from '../../../util/logs';\nimport { toBase64Address } from './util/tonCore';\nimport { getNftSuperCollectionsByCollectionAddress } from '../../common/addresses';\nimport { FAKE_TX_ID } from '../../constants';\nimport { fetchEmulateTrace } from './toncenter/emulation';\nimport { calculateActivityDetails, getActivityRealFee } from './activities';\nimport { parseActions } from './toncenter';\nimport { parseTrace } from './traces';\n\nexport async function emulateTransaction(\n  network: ApiNetwork,\n  wallet: TonWallet,\n  transaction: Cell,\n  isInitialized?: boolean,\n) {\n  const boc = buildExternalBoc(wallet, transaction, isInitialized);\n  const emulation = await fetchEmulateTrace(network, boc);\n  const walletAddress = toBase64Address(wallet.address, false, network);\n  const nftSuperCollectionsByCollectionAddress = await getNftSuperCollectionsByCollectionAddress();\n  return parseEmulation(network, walletAddress, emulation, nftSuperCollectionsByCollectionAddress);\n}\n\nfunction parseEmulation(\n  network: ApiNetwork,\n  walletAddress: string,\n  emulation: EmulationResponse,\n  nftSuperCollectionsByCollectionAddress: Record<string, ApiNftSuperCollection>,\n): ApiEmulationResult {\n  const parsedTrace = parseTrace({\n    network,\n    walletAddress,\n    actions: emulation.actions,\n    traceDetail: emulation.trace,\n    addressBook: emulation.address_book,\n    transactions: emulation.transactions,\n  });\n\n  const allActivities = parseActions(\n    network,\n    walletAddress,\n    emulation.actions,\n    emulation.address_book,\n    emulation.metadata,\n    nftSuperCollectionsByCollectionAddress,\n  );\n\n  const walletActivities: ApiActivity[] = [];\n  let totalRealFee = 0n;\n  let totalExcess = 0n;\n\n  for (let activity of allActivities) {\n    if (\n      activity.shouldHide || (\n        activity.kind === 'transaction'\n        && activity.fromAddress !== walletAddress\n        && activity.toAddress !== walletAddress\n      )) {\n      continue;\n    }\n\n    if (activity.shouldLoadDetails) {\n      const result = calculateActivityDetails(activity, parsedTrace);\n      if (result) {\n        activity = result.activity;\n        totalExcess += result.excess;\n      } else {\n        logDebugError('Unparsable trace for emulated activity', activity.id);\n      }\n    }\n\n    walletActivities.push(activity);\n    totalRealFee += getActivityRealFee(activity);\n  }\n\n  if (totalExcess) {\n    addExcessActivity(walletAddress, walletActivities, totalExcess);\n  }\n\n  return {\n    networkFee: parsedTrace.totalNetworkFee,\n    received: parsedTrace.totalReceived,\n    byTransactionIndex: parsedTrace.byTransactionIndex,\n    activities: walletActivities,\n    realFee: totalRealFee,\n  };\n}\n\nfunction addExcessActivity(walletAddress: string, activities: ApiActivity[], excess: bigint) {\n  const index = activities.findIndex((activity) => {\n    return activity.kind === 'transaction' && activity.type === 'excess';\n  });\n\n  if (index !== -1) {\n    const excessActivity = activities.splice(index, 1)[0] as ApiTransactionActivity;\n    activities.push({\n      ...excessActivity,\n      amount: excessActivity.amount + excess,\n    });\n  } else {\n    activities.push({\n      id: FAKE_TX_ID,\n      txId: FAKE_TX_ID,\n      timestamp: activities[activities.length - 1].timestamp,\n      kind: 'transaction',\n      amount: excess,\n      slug: TONCOIN.slug,\n      normalizedAddress: BURN_ADDRESS,\n      fromAddress: BURN_ADDRESS,\n      toAddress: walletAddress,\n      isIncoming: true,\n      fee: 0n,\n      type: 'excess',\n      status: 'completed',\n    });\n  }\n}\n\nfunction buildExternalBoc(wallet: TonWallet, body: Cell, isInitialized?: boolean) {\n  const externalMessage = external({\n    to: wallet.address,\n    init: !isInitialized ? {\n      code: wallet.init.code,\n      data: wallet.init.data,\n    } : undefined,\n    body,\n  });\n\n  return beginCell()\n    .store(storeMessage(externalMessage))\n    .endCell()\n    .toBoc()\n    .toString('base64');\n}\n","import type { ApiNetwork } from '../../../types';\nimport type { AccountState, AddressBook, AnyAction, MetadataMap, TraceDetail, Transaction } from './types';\n\nimport { TONCENTER_MAINNET_URL, TONCENTER_TESTNET_URL } from '../../../../config';\nimport { fetchWithRetry } from '../../../../util/fetch';\nimport { getToncenterHeaders } from './other';\n\nexport type EmulationResponse = {\n  mc_block_seqno: number;\n  trace: TraceDetail;\n  actions: AnyAction[];\n  transactions: Record<string, Transaction>;\n  account_states: Record<string, AccountState>;\n  rand_seed: string;\n  metadata: MetadataMap;\n  address_book: AddressBook;\n};\n\nexport async function fetchEmulateTrace(network: ApiNetwork, boc: string): Promise<EmulationResponse> {\n  const baseUrl = network === 'testnet' ? TONCENTER_TESTNET_URL : TONCENTER_MAINNET_URL;\n\n  const response = await fetchWithRetry(`${baseUrl}/api/emulate/v1/emulateTrace`, {\n    method: 'POST',\n    headers: {\n      ...getToncenterHeaders(network),\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      boc,\n      ignore_chksig: true,\n      include_code_data: false,\n      with_actions: true,\n      include_address_book: true,\n      include_metadata: true,\n    }),\n  });\n\n  return response.json();\n}\n","import type { JettonBalance } from 'tonapi-sdk-js';\nimport { Address, Cell } from '@ton/core';\n\nimport type { ApiBalanceBySlug, ApiNetwork, ApiToken, ApiTokenWithPrice, OnApiUpdate } from '../../types';\nimport type { AnyPayload, JettonMetadata, TonTransferParams } from './types';\n\nimport { TON_USDT_SLUG } from '../../../config';\nimport { fetchJsonWithProxy, fixIpfsUrl } from '../../../util/fetch';\nimport { logDebugError } from '../../../util/logs';\nimport { fetchJettonMetadata, fixBase64ImageData, parsePayloadBase64 } from './util/metadata';\nimport { fetchJettonBalances } from './util/tonapiio';\nimport {\n  buildTokenTransferBody,\n  getTokenBalance,\n  getTonClient,\n  resolveTokenAddress,\n  resolveTokenWalletAddress,\n  toBase64Address, toRawAddress,\n} from './util/tonCore';\nimport { buildTokenSlug, getTokenByAddress, updateTokens } from '../../common/tokens';\nimport {\n  CLAIM_MINTLESS_AMOUNT,\n  DEFAULT_DECIMALS,\n  TINIEST_TOKEN_TRANSFER_REAL_AMOUNT,\n  TINY_TOKEN_TRANSFER_AMOUNT,\n  TINY_TOKEN_TRANSFER_REAL_AMOUNT,\n  TOKEN_TRANSFER_AMOUNT,\n  TOKEN_TRANSFER_FORWARD_AMOUNT,\n  TOKEN_TRANSFER_REAL_AMOUNT,\n} from './constants';\nimport { updateTokenHashes } from './priceless';\nimport { isActiveSmartContract } from './wallet';\n\nexport type TokenBalanceParsed = {\n  slug: string;\n  balance: bigint;\n  token: ApiToken;\n  jettonWallet: string;\n};\n\nasync function getTokenBalances(network: ApiNetwork, address: string) {\n  const balancesRaw = await fetchJettonBalances(network, address);\n  return balancesRaw.map((balance) => parseTokenBalance(network, balance)).filter(Boolean);\n}\n\nfunction parseTokenBalance(network: ApiNetwork, balanceRaw: JettonBalance): TokenBalanceParsed | undefined {\n  if (!balanceRaw.jetton) {\n    return undefined;\n  }\n\n  try {\n    const { balance, jetton, wallet_address: walletAddress } = balanceRaw;\n    const tokenAddress = toBase64Address(jetton.address, true, network);\n    const token = buildTokenByMetadata(tokenAddress, jetton);\n\n    return {\n      slug: token.slug,\n      balance: BigInt(balance),\n      token,\n      jettonWallet: toBase64Address(walletAddress.address, undefined, network),\n    };\n  } catch (err) {\n    logDebugError('parseTokenBalance', err);\n    return undefined;\n  }\n}\n\nexport async function insertMintlessPayload(\n  network: ApiNetwork,\n  fromAddress: string,\n  tokenAddress: string,\n  transfer: TonTransferParams,\n): Promise<TonTransferParams> {\n  const { toAddress, payload } = transfer;\n\n  const token = getTokenByAddress(tokenAddress);\n  if (typeof payload !== 'string' || !token?.customPayloadApiUrl) {\n    return transfer;\n  }\n\n  const parsedPayload = await parsePayloadBase64(network, toAddress, payload);\n  if (parsedPayload.type !== 'tokens:transfer') {\n    throw new Error('Invalid payload');\n  }\n\n  const {\n    mintlessTokenBalance,\n    isMintlessClaimed,\n    stateInit,\n    customPayload,\n  } = await getMintlessParams({\n    network,\n    token,\n    fromAddress,\n    tokenWalletAddress: transfer.toAddress,\n  });\n\n  if (!mintlessTokenBalance || isMintlessClaimed) {\n    return transfer;\n  }\n\n  const newPayload = buildTokenTransferBody({\n    toAddress: parsedPayload.destination,\n    queryId: parsedPayload.queryId,\n    tokenAmount: parsedPayload.amount,\n    forwardAmount: parsedPayload.forwardAmount,\n    forwardPayload: Cell.fromBase64(parsedPayload.forwardPayload!),\n    responseAddress: parsedPayload.responseDestination,\n    customPayload: Cell.fromBase64(customPayload!),\n  });\n\n  return {\n    ...transfer,\n    stateInit: stateInit ? Cell.fromBase64(stateInit) : undefined,\n    payload: newPayload,\n    isBase64Payload: false,\n  };\n}\n\nexport async function buildTokenTransfer(options: {\n  network: ApiNetwork;\n  tokenAddress: string;\n  fromAddress: string;\n  toAddress: string;\n  amount: bigint;\n  payload?: AnyPayload;\n  shouldSkipMintless?: boolean;\n  forwardAmount?: bigint;\n}) {\n  const {\n    network,\n    tokenAddress,\n    fromAddress,\n    toAddress,\n    amount,\n    shouldSkipMintless,\n    forwardAmount = TOKEN_TRANSFER_FORWARD_AMOUNT,\n  } = options;\n  let { payload } = options;\n\n  const tokenWalletAddress = await resolveTokenWalletAddress(network, fromAddress, tokenAddress);\n  const token = getTokenByAddress(tokenAddress);\n\n  const {\n    isTokenWalletDeployed = !!(await isActiveSmartContract(network, tokenWalletAddress)),\n    isMintlessClaimed,\n    mintlessTokenBalance,\n    customPayload,\n    stateInit,\n  } = await getMintlessParams({\n    network, fromAddress, token, tokenWalletAddress, shouldSkipMintless,\n  });\n\n  if (isTokenWalletDeployed) {\n    const realTokenAddress = await resolveTokenAddress(network, tokenWalletAddress);\n    if (tokenAddress !== realTokenAddress) {\n      throw new Error('Invalid contract');\n    }\n  }\n\n  payload = buildTokenTransferBody({\n    tokenAmount: amount,\n    toAddress,\n    forwardAmount,\n    forwardPayload: payload,\n    responseAddress: fromAddress,\n    customPayload: customPayload ? Cell.fromBase64(customPayload) : undefined,\n  });\n\n  // eslint-disable-next-line prefer-const\n  let { amount: toncoinAmount, realAmount } = getToncoinAmountForTransfer(\n    token, Boolean(mintlessTokenBalance) && !isMintlessClaimed,\n  );\n\n  if (forwardAmount > TOKEN_TRANSFER_FORWARD_AMOUNT) {\n    toncoinAmount += forwardAmount;\n  }\n\n  return {\n    amount: toncoinAmount,\n    realAmount,\n    toAddress: tokenWalletAddress,\n    payload,\n    stateInit: stateInit ? Cell.fromBase64(stateInit) : undefined,\n    mintlessTokenBalance,\n    isTokenWalletDeployed,\n  };\n}\n\nexport async function getTokenBalanceWithMintless(network: ApiNetwork, accountAddress: string, tokenAddress: string) {\n  const tokenWalletAddress = await resolveTokenWalletAddress(network, accountAddress, tokenAddress);\n  const token = getTokenByAddress(tokenAddress);\n\n  const {\n    isTokenWalletDeployed = !!(await isActiveSmartContract(network, tokenWalletAddress)),\n    mintlessTokenBalance,\n  } = await getMintlessParams({\n    network, fromAddress: accountAddress, token, tokenWalletAddress,\n  });\n\n  return calculateTokenBalanceWithMintless(network, tokenWalletAddress, isTokenWalletDeployed, mintlessTokenBalance);\n}\n\nexport async function calculateTokenBalanceWithMintless(\n  network: ApiNetwork,\n  tokenWalletAddress: string,\n  isTokenWalletDeployed?: boolean,\n  mintlessTokenBalance = 0n,\n) {\n  let balance = 0n;\n  if (isTokenWalletDeployed) {\n    balance += await getTokenBalance(network, tokenWalletAddress);\n  }\n  if (mintlessTokenBalance) {\n    balance += mintlessTokenBalance;\n  }\n  return balance;\n}\n\nasync function getMintlessParams(options: {\n  network: ApiNetwork;\n  fromAddress: string;\n  token: ApiToken;\n  tokenWalletAddress: string;\n  shouldSkipMintless?: boolean;\n}) {\n  const {\n    network, fromAddress, token, tokenWalletAddress, shouldSkipMintless,\n  } = options;\n\n  const isMintlessToken = !!token.customPayloadApiUrl;\n  let isTokenWalletDeployed: boolean | undefined;\n  let customPayload: string | undefined;\n  let stateInit: string | undefined;\n\n  let isMintlessClaimed: boolean | undefined;\n  let mintlessTokenBalance: bigint | undefined;\n\n  if (isMintlessToken && !shouldSkipMintless) {\n    isTokenWalletDeployed = !!(await isActiveSmartContract(network, tokenWalletAddress));\n    isMintlessClaimed = isTokenWalletDeployed && await checkMintlessTokenWalletIsClaimed(network, tokenWalletAddress);\n\n    if (!isMintlessClaimed) {\n      const data = await fetchMintlessTokenWalletData(token.customPayloadApiUrl!, fromAddress);\n      const isExpired = data\n        ? Date.now() > new Date(Number(data.compressed_info.expired_at) * 1000).getTime()\n        : true;\n\n      if (data && !isExpired) {\n        customPayload = data.custom_payload;\n        mintlessTokenBalance = BigInt(data.compressed_info.amount);\n\n        if (!isTokenWalletDeployed) {\n          stateInit = data.state_init;\n        }\n      }\n    }\n  }\n\n  return {\n    isTokenWalletDeployed,\n    isMintlessClaimed,\n    mintlessTokenBalance,\n    customPayload,\n    stateInit,\n  };\n}\n\nexport async function checkMintlessTokenWalletIsClaimed(network: ApiNetwork, tokenWalletAddress: string) {\n  const res = await getTonClient(network)\n    .runMethod(Address.parse(tokenWalletAddress), 'is_claimed');\n  return res.stack.readBoolean();\n}\n\nasync function fetchMintlessTokenWalletData(customPayloadApiUrl: string, address: string) {\n  const rawAddress = toRawAddress(address);\n\n  return (await fetchJsonWithProxy(`${customPayloadApiUrl}/wallet/${rawAddress}`).catch(() => undefined)) as {\n    custom_payload: string;\n    state_init: string;\n    compressed_info: {\n      amount: string;\n      start_from: string;\n      expired_at: string;\n    };\n  } | undefined;\n}\n\nexport async function fetchToken(network: ApiNetwork, address: string) {\n  const metadata = await fetchJettonMetadata(network, address);\n\n  return buildTokenByMetadata(address, metadata);\n}\n\nfunction buildTokenByMetadata(address: string, metadata: JettonMetadata): ApiToken {\n  const {\n    name,\n    symbol,\n    image,\n    image_data: imageData,\n    decimals,\n    custom_payload_api_uri: customPayloadApiUrl,\n  } = metadata;\n\n  return {\n    slug: buildTokenSlug('ton', address),\n    name,\n    symbol,\n    decimals: decimals === undefined ? DEFAULT_DECIMALS : Number(decimals),\n    chain: 'ton',\n    tokenAddress: address,\n    image: (image && fixIpfsUrl(image)) || (imageData && fixBase64ImageData(imageData)) || undefined,\n    customPayloadApiUrl,\n  };\n}\n\n/**\n * A pure function guessing the \"fee\" that needs to be attached to the token transfer.\n * In contrast to the blockchain fee, this fee is a part of the transfer itself.\n *\n * `amount` is what should be attached (acts as a fee for the user);\n * `realAmount` is approximately what will be actually spent (the rest will return in the excess).\n */\nexport function getToncoinAmountForTransfer(token: ApiToken, willClaimMintless: boolean) {\n  let amount = 0n;\n  let realAmount = 0n;\n\n  if (token.slug === TON_USDT_SLUG) {\n    amount += TINY_TOKEN_TRANSFER_AMOUNT;\n    realAmount += TINIEST_TOKEN_TRANSFER_REAL_AMOUNT;\n  } else if (token.isTiny) {\n    amount += TINY_TOKEN_TRANSFER_AMOUNT;\n    realAmount += TINY_TOKEN_TRANSFER_REAL_AMOUNT;\n  } else {\n    amount += TOKEN_TRANSFER_AMOUNT;\n    realAmount += TOKEN_TRANSFER_REAL_AMOUNT;\n  }\n\n  if (willClaimMintless) {\n    amount += CLAIM_MINTLESS_AMOUNT;\n    realAmount += CLAIM_MINTLESS_AMOUNT;\n  }\n\n  return { amount, realAmount };\n}\n\nexport async function loadTokenBalances(\n  network: ApiNetwork,\n  address: string,\n  onUpdate: OnApiUpdate,\n): Promise<ApiBalanceBySlug> {\n  const tokenBalances = await getTokenBalances(network, address);\n  const tokens: ApiTokenWithPrice[] = tokenBalances.map(({ token }) => ({\n    ...token,\n    price: 0,\n    priceUsd: 0,\n    percentChange24h: 0,\n  }));\n  await updateTokens(tokens, onUpdate);\n  await updateTokenHashes(network, tokens.map((token) => token.slug), onUpdate);\n  return Object.fromEntries(tokenBalances.map(({ slug, balance }) => [slug, balance]));\n}\n","import type { ApiNetwork, ApiTokenWithPrice, OnApiUpdate } from '../../types';\n\nimport { buildCollectionByKey } from '../../../util/iteratees';\nimport { logDebugError } from '../../../util/logs';\nimport { getTokensCache, tokensPreload, updateTokens } from '../../common/tokens';\nimport { getAccountStates } from './toncenter';\n\nexport async function updateTokenHashes(network: ApiNetwork, tokenSlugs: string[], onUpdate?: OnApiUpdate) {\n  await tokensPreload.promise;\n  const cachedTokens = getTokensCache().bySlug;\n\n  const tokensToFetch = tokenSlugs.reduce<ApiTokenWithPrice[]>((tokensToFetch, tokenSlug) => {\n    const token = cachedTokens[tokenSlug];\n\n    if (\n      token\n      && token.chain === 'ton'\n      && !token.codeHash\n      && ['LP', 'STAKED', 'POOL'].some((option) => token.symbol.toUpperCase().includes(option))\n    ) {\n      tokensToFetch.push(token);\n    }\n\n    return tokensToFetch;\n  }, []);\n\n  if (!tokensToFetch.length) {\n    return;\n  }\n\n  const tokensByAddress = buildCollectionByKey(tokensToFetch, 'tokenAddress');\n\n  try {\n    const states = await getAccountStates(network, tokensToFetch.map((token) => token.tokenAddress!));\n\n    for (const address of Object.keys(states)) {\n      if (!tokensByAddress[address]) continue;\n      tokensByAddress[address].codeHash = Buffer.from(states[address].code_hash, 'base64').toString('hex');\n    }\n\n    await updateTokens(Object.values(tokensByAddress).filter((token) => token.codeHash), onUpdate);\n  } catch (err) {\n    logDebugError('Failed to fetch contract code hashes for tokens', err);\n  }\n}\n","import { Cell, internal, loadStateInit, SendMode } from '@ton/core';\nimport { WalletContractV5R1 } from '@ton/ton/dist/wallets/WalletContractV5R1';\n\nimport type { DieselStatus } from '../../../global/types';\nimport type Deferred from '../../../util/Deferred';\nimport type { CheckTransactionDraftOptions } from '../../methods/types';\nimport type {\n  ApiAccountWithMnemonic,\n  ApiAnyDisplayError,\n  ApiNetwork,\n  ApiParsedPayload,\n  ApiSignedTransfer,\n  ApiToken,\n} from '../../types';\nimport type {\n  AnyPayload,\n  ApiCheckMultiTransactionDraftResult,\n  ApiCheckTransactionDraftResult,\n  ApiEmulationWithFallbackResult,\n  ApiFetchEstimateDieselResult,\n  ApiSubmitMultiTransferResult,\n  ApiSubmitTransferOptions,\n  ApiSubmitTransferTonResult,\n  ApiSubmitTransferWithDieselResult,\n  ApiTonWalletVersion,\n  TonTransferParams,\n} from './types';\nimport type { TonWallet } from './util/tonCore';\nimport { ApiTransactionDraftError, ApiTransactionError } from '../../types';\n\nimport { DEFAULT_FEE, DIESEL_ADDRESS } from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { bigintMultiplyToNumber } from '../../../util/bigint';\nimport { fromDecimal, toDecimal } from '../../../util/decimals';\nimport { getDieselTokenAmount, isDieselAvailable } from '../../../util/fee/transferFee';\nimport { omit, pick } from '../../../util/iteratees';\nimport { logDebug, logDebugError } from '../../../util/logs';\nimport { pause } from '../../../util/schedulers';\nimport { decryptMessageComment, encryptMessageComment } from './util/encryption';\nimport { parsePayloadBase64 } from './util/metadata';\nimport { sendExternal } from './util/sendExternal';\nimport {\n  commentToBytes,\n  getOurFeePayload,\n  getTonClient,\n  getWalletPublicKey,\n  packBytesAsSnake,\n  packBytesAsSnakeCell,\n  packBytesAsSnakeForEncryptedData,\n  parseAddress,\n  parseBase64,\n} from './util/tonCore';\nimport { fetchStoredAccount, fetchStoredTonWallet } from '../../common/accounts';\nimport { callBackendGet } from '../../common/backend';\nimport { getPendingTransfer, waitAndCreatePendingTransfer } from '../../common/pendingTransfers';\nimport { getTokenByAddress } from '../../common/tokens';\nimport { base64ToBytes } from '../../common/utils';\nimport { MINUTE, SEC } from '../../constants';\nimport { ApiServerError, handleServerError } from '../../errors';\nimport { checkHasTransaction, fetchNewestActionId } from './activities';\nimport { resolveAddress } from './address';\nimport { fetchKeyPair, fetchPrivateKey } from './auth';\nimport { ATTEMPTS, FEE_FACTOR, TRANSFER_TIMEOUT_SEC } from './constants';\nimport { emulateTransaction } from './emulation';\nimport {\n  buildTokenTransfer,\n  calculateTokenBalanceWithMintless,\n  getTokenBalanceWithMintless,\n  getToncoinAmountForTransfer,\n} from './tokens';\nimport { buildWallet, getContractInfo, getTonWallet, getWalletBalance, getWalletInfo } from './wallet';\n\nconst WAIT_TRANSFER_TIMEOUT = MINUTE;\nconst WAIT_PAUSE = SEC;\n\nconst MAX_BALANCE_WITH_CHECK_DIESEL = 100000000n; // 0.1 TON\nconst PENDING_DIESEL_TIMEOUT_SEC = 15 * 60; // 15 min\n\nconst DIESEL_NOT_AVAILABLE: ApiFetchEstimateDieselResult = {\n  status: 'not-available',\n  nativeAmount: 0n,\n  remainingFee: 0n,\n  realFee: 0n,\n};\n\nexport async function checkTransactionDraft(\n  options: CheckTransactionDraftOptions,\n): Promise<ApiCheckTransactionDraftResult> {\n  const {\n    accountId,\n    amount = 0n,\n    tokenAddress,\n    shouldEncrypt,\n    isBase64Data,\n    stateInit: stateInitString,\n    forwardAmount,\n    allowGasless,\n  } = options;\n  let { toAddress, data } = options;\n\n  const { network } = parseAccountId(accountId);\n\n  let result: ApiCheckTransactionDraftResult = {};\n\n  try {\n    result = await checkToAddress(network, toAddress);\n    if ('error' in result) {\n      return result;\n    }\n\n    toAddress = result.resolvedAddress!;\n\n    const { isInitialized } = await getContractInfo(network, toAddress);\n\n    let stateInit: Cell | undefined;\n\n    if (stateInitString) {\n      try {\n        stateInit = Cell.fromBase64(stateInitString);\n      } catch {\n        return {\n          ...result,\n          error: ApiTransactionDraftError.InvalidStateInit,\n        };\n      }\n    }\n\n    if (result.isBounceable && !isInitialized && !stateInit) {\n      result.isToAddressNew = !(await checkHasTransaction(network, toAddress));\n      return {\n        ...result,\n        error: ApiTransactionDraftError.InactiveContract,\n      };\n    }\n\n    result.resolvedAddress = toAddress;\n\n    if (amount < 0n) {\n      return {\n        ...result,\n        error: ApiTransactionDraftError.InvalidAmount,\n      };\n    }\n\n    const wallet = await getTonWallet(accountId);\n\n    if (typeof data === 'string' && isBase64Data) {\n      data = base64ToBytes(data);\n    }\n\n    if (data && typeof data === 'string' && shouldEncrypt) {\n      const toPublicKey = await getWalletPublicKey(network, toAddress);\n      if (!toPublicKey) {\n        return {\n          ...result,\n          error: ApiTransactionDraftError.WalletNotInitialized,\n        };\n      }\n    }\n\n    const { address, isInitialized: isWalletInitialized } = await fetchStoredTonWallet(accountId);\n\n    if (data && typeof data === 'string' && !isBase64Data) {\n      data = commentToBytes(data);\n    }\n\n    let toncoinAmount: bigint;\n    const { seqno, balance: toncoinBalance } = await getWalletInfo(network, wallet);\n    let balance: bigint;\n    let fee: bigint;\n    let realFee: bigint;\n\n    if (!tokenAddress) {\n      balance = toncoinBalance;\n      toncoinAmount = amount;\n      fee = 0n;\n      realFee = 0n;\n\n      if (data instanceof Uint8Array) {\n        data = shouldEncrypt ? packBytesAsSnakeForEncryptedData(data) : packBytesAsSnake(data);\n      }\n    } else {\n      const tokenTransfer = await buildTokenTransfer({\n        network,\n        tokenAddress,\n        fromAddress: address,\n        toAddress,\n        amount,\n        payload: data,\n        forwardAmount,\n      });\n      ({ amount: toncoinAmount, toAddress, payload: data } = tokenTransfer);\n      const { realAmount: realToncoinAmount, isTokenWalletDeployed, mintlessTokenBalance } = tokenTransfer;\n\n      // When the token is transferred, actually some TON is transferred, and the token sits inside the payload.\n      // From the user perspective, this TON amount is a fee.\n      fee = toncoinAmount;\n      realFee = realToncoinAmount;\n\n      const tokenWalletAddress = toAddress;\n      balance = await calculateTokenBalanceWithMintless(\n        network, tokenWalletAddress, isTokenWalletDeployed, mintlessTokenBalance,\n      );\n    }\n\n    const isFullTonTransfer = !tokenAddress && toncoinBalance === amount;\n    const { transaction } = await signTransaction({\n      network,\n      wallet,\n      toAddress,\n      amount: toncoinAmount,\n      payload: data,\n      stateInit,\n      isFullBalance: isFullTonTransfer,\n      shouldEncrypt,\n      seqno,\n    });\n    // todo: Use `received` from the emulation to calculate the real fee. Check what happens when the receiver is the same wallet.\n    const { networkFee } = applyFeeFactorToEmulationResult(\n      await emulateTransactionWithFallback(network, wallet, transaction, isWalletInitialized),\n    );\n    fee += networkFee;\n    realFee += networkFee;\n    result.fee = fee;\n    result.realFee = realFee;\n    result.diesel = DIESEL_NOT_AVAILABLE;\n\n    let isEnoughBalance: boolean;\n\n    if (!tokenAddress) {\n      isEnoughBalance = toncoinBalance >= fee + (isFullTonTransfer ? 0n : amount);\n    } else {\n      const canTransferGasfully = toncoinBalance >= fee;\n\n      if (allowGasless) {\n        result.diesel = await getDiesel({\n          accountId,\n          tokenAddress,\n          canTransferGasfully,\n          toncoinBalance,\n          tokenBalance: balance,\n        });\n      }\n\n      if (isDieselAvailable(result.diesel)) {\n        isEnoughBalance = amount + getDieselTokenAmount(result.diesel) <= balance;\n      } else {\n        isEnoughBalance = canTransferGasfully && amount <= balance;\n      }\n    }\n\n    return isEnoughBalance ? result : {\n      ...result,\n      error: ApiTransactionDraftError.InsufficientBalance,\n    };\n  } catch (err: any) {\n    return {\n      ...handleServerError(err),\n      ...result,\n    };\n  }\n}\n\nfunction estimateDiesel(\n  address: string,\n  tokenAddress: string,\n  toncoinAmount: string,\n  isW5?: boolean,\n  isStars?: boolean,\n) {\n  return callBackendGet<{\n    status: DieselStatus;\n    // The amount is defined only when the status is \"available\" or \"stars-fee\": https://github.com/mytonwallet-org/mytonwallet-backend/blob/44c1bf43fb776286152db8901b45fe8341752e35/src/endpoints/diesel.ts#L163\n    amount?: string;\n    pendingCreatedAt?: string;\n  }>('/diesel/estimate', {\n    address, tokenAddress, toncoinAmount, isW5, isStars,\n  });\n}\n\nexport async function checkToAddress(network: ApiNetwork, toAddress: string) {\n  const result: {\n    addressName?: string;\n    isScam?: boolean;\n    resolvedAddress?: string;\n    isToAddressNew?: boolean;\n    isBounceable?: boolean;\n    isMemoRequired?: boolean;\n  } = {};\n\n  const resolved = await resolveAddress(network, toAddress);\n  if (resolved === 'dnsNotResolved') return { ...result, error: ApiTransactionDraftError.DomainNotResolved };\n  if (resolved === 'invalidAddress') return { ...result, error: ApiTransactionDraftError.InvalidToAddress };\n  result.addressName = resolved.name;\n  result.resolvedAddress = resolved.address;\n  result.isMemoRequired = resolved.isMemoRequired;\n  result.isScam = resolved.isScam;\n  toAddress = resolved.address;\n\n  const { isUserFriendly, isTestOnly, isBounceable } = parseAddress(toAddress);\n\n  result.isBounceable = isBounceable;\n\n  const regex = /[+=/]/;\n  const isUrlSafe = !regex.test(toAddress);\n\n  if (!isUserFriendly || !isUrlSafe || (network === 'mainnet' && isTestOnly)) {\n    return {\n      ...result,\n      error: ApiTransactionDraftError.InvalidAddressFormat,\n    };\n  }\n\n  return result;\n}\n\nexport async function submitTransfer(options: ApiSubmitTransferOptions): Promise<ApiSubmitTransferTonResult> {\n  const {\n    accountId,\n    password,\n    amount,\n    tokenAddress,\n    shouldEncrypt,\n    isBase64Data,\n    forwardAmount,\n    noFeeCheck,\n  } = options;\n  let { stateInit } = options;\n\n  let { toAddress, data } = options;\n\n  const { network } = parseAccountId(accountId);\n\n  try {\n    const account = await fetchStoredAccount<ApiAccountWithMnemonic>(accountId);\n    const { address: fromAddress, isInitialized } = account.ton;\n    const wallet = await getTonWallet(accountId, account.ton);\n    const { publicKey, secretKey } = (await fetchKeyPair(accountId, password, account))!;\n\n    let encryptedComment: string | undefined;\n\n    if (typeof data === 'string') {\n      ({ payload: data, encryptedComment } = await stringToPayload({\n        network, toAddress, fromAddress, data, secretKey, publicKey, shouldEncrypt, isBase64Data,\n      }));\n    }\n\n    let toncoinAmount: bigint;\n\n    if (!tokenAddress) {\n      toncoinAmount = amount;\n\n      if (data instanceof Uint8Array) {\n        data = shouldEncrypt ? packBytesAsSnakeForEncryptedData(data) : packBytesAsSnake(data);\n      }\n    } else {\n      ({\n        amount: toncoinAmount,\n        toAddress,\n        payload: data,\n        stateInit,\n      } = await buildTokenTransfer({\n        network,\n        tokenAddress,\n        fromAddress,\n        toAddress,\n        amount,\n        payload: data,\n        forwardAmount,\n      }));\n    }\n\n    const { pendingTransfer } = await waitAndCreatePendingTransfer(network, fromAddress);\n    const { seqno, balance: toncoinBalance } = await getWalletInfo(network, wallet);\n    const isFullTonTransfer = !tokenAddress && toncoinBalance === amount;\n\n    const { transaction } = await signTransaction({\n      network,\n      wallet,\n      toAddress,\n      amount: toncoinAmount,\n      payload: data,\n      stateInit,\n      privateKey: secretKey,\n      isFullBalance: isFullTonTransfer,\n      shouldEncrypt,\n      seqno,\n    });\n\n    if (!noFeeCheck) {\n      const { networkFee } = await emulateTransactionWithFallback(network, wallet, transaction, isInitialized);\n\n      const isEnoughBalance = isFullTonTransfer\n        ? toncoinBalance > networkFee\n        : toncoinBalance >= toncoinAmount + networkFee;\n\n      if (!isEnoughBalance) {\n        return { error: ApiTransactionError.InsufficientBalance };\n      }\n    }\n\n    const client = getTonClient(network);\n    const { msgHash, boc, msgHashNormalized } = await sendExternal(client, wallet, transaction);\n\n    void retrySendBoc(network, fromAddress, boc, seqno, pendingTransfer);\n\n    return {\n      amount,\n      seqno,\n      encryptedComment,\n      toAddress,\n      msgHash,\n      msgHashNormalized,\n      toncoinAmount,\n    };\n  } catch (err: any) {\n    logDebugError('submitTransfer', err);\n\n    return { error: resolveTransactionError(err) };\n  }\n}\n\nexport async function submitTransferWithDiesel(options: {\n  accountId: string;\n  password: string;\n  toAddress: string;\n  amount: bigint;\n  data?: AnyPayload;\n  tokenAddress: string;\n  shouldEncrypt?: boolean;\n  dieselAmount: bigint;\n  isGaslessWithStars?: boolean;\n}): Promise<ApiSubmitTransferWithDieselResult> {\n  try {\n    const {\n      toAddress,\n      amount,\n      accountId,\n      password,\n      tokenAddress,\n      shouldEncrypt,\n      dieselAmount,\n      isGaslessWithStars,\n    } = options;\n\n    let { data } = options;\n\n    const { network } = parseAccountId(accountId);\n\n    const [{ address: fromAddress, version }, keyPair] = await Promise.all([\n      fetchStoredTonWallet(accountId),\n      fetchKeyPair(accountId, password),\n    ]);\n\n    const { publicKey, secretKey } = keyPair!;\n\n    let encryptedComment: string | undefined;\n\n    if (typeof data === 'string') {\n      ({ payload: data, encryptedComment } = await stringToPayload({\n        network, toAddress, fromAddress, data, secretKey, publicKey, shouldEncrypt,\n      }));\n    }\n\n    const messages: TonTransferParams[] = [\n      await buildTokenTransfer({\n        network,\n        tokenAddress,\n        fromAddress,\n        toAddress,\n        amount,\n        payload: data,\n      }),\n    ];\n\n    if (!isGaslessWithStars) {\n      messages.push(\n        await buildTokenTransfer({\n          network,\n          tokenAddress,\n          fromAddress,\n          toAddress: DIESEL_ADDRESS,\n          amount: dieselAmount,\n          shouldSkipMintless: true,\n          payload: getOurFeePayload(),\n        }),\n      );\n    }\n\n    const result = await submitMultiTransfer({\n      accountId,\n      password,\n      messages,\n      isGasless: true,\n    });\n\n    return {\n      ...result,\n      encryptedComment,\n      withW5Gasless: version === 'W5',\n    };\n  } catch (err) {\n    logDebugError('submitTransferWithDiesel', err);\n\n    return { error: resolveTransactionError(err) };\n  }\n}\n\nasync function stringToPayload({\n  network, toAddress, data, shouldEncrypt, publicKey, secretKey, fromAddress, isBase64Data,\n}: {\n  network: ApiNetwork;\n  data: string;\n  shouldEncrypt?: boolean;\n  toAddress: string;\n  publicKey: Uint8Array;\n  secretKey: Uint8Array;\n  fromAddress: string;\n  isBase64Data?: boolean;\n}): Promise<{\n    payload?: Uint8Array | Cell;\n    encryptedComment?: string;\n  }> {\n  let payload: Uint8Array | Cell | undefined;\n  let encryptedComment: string | undefined;\n\n  if (!data) {\n    payload = undefined;\n  } else if (isBase64Data) {\n    payload = parseBase64(data);\n  } else if (shouldEncrypt) {\n    const toPublicKey = (await getWalletPublicKey(network, toAddress))!;\n    payload = await encryptMessageComment(data, publicKey, toPublicKey, secretKey, fromAddress);\n    encryptedComment = Buffer.from(payload.slice(4)).toString('base64');\n  } else {\n    payload = commentToBytes(data);\n  }\n\n  return { payload, encryptedComment };\n}\n\nexport function resolveTransactionError(error: any): ApiAnyDisplayError | string {\n  if (error instanceof ApiServerError) {\n    if (error.message.includes('exitcode=35,')) {\n      return ApiTransactionError.IncorrectDeviceTime;\n    } else if (error.statusCode === 400) {\n      return error.message;\n    } else if (error.displayError) {\n      return error.displayError;\n    }\n  }\n  return ApiTransactionError.UnsuccesfulTransfer;\n}\n\nasync function signTransaction({\n  network,\n  wallet,\n  toAddress,\n  amount,\n  payload,\n  stateInit,\n  privateKey,\n  isFullBalance,\n  expireAt,\n  shouldEncrypt,\n  seqno,\n}: {\n  network: ApiNetwork;\n  wallet: TonWallet;\n  toAddress: string;\n  amount: bigint;\n  payload?: AnyPayload;\n  stateInit?: Cell;\n  privateKey?: Uint8Array;\n  isFullBalance?: boolean;\n  expireAt?: number;\n  shouldEncrypt?: boolean;\n  seqno?: number;\n}) {\n  seqno ??= (await getWalletInfo(network, wallet)).seqno;\n\n  if (!privateKey) {\n    privateKey = new Uint8Array(64);\n  } else {\n    logDebug('Signing transactions', { seqno, toAddress, amount });\n  }\n\n  if (!expireAt) {\n    expireAt = Math.round(Date.now() / 1000) + TRANSFER_TIMEOUT_SEC;\n  }\n\n  if (payload instanceof Uint8Array) {\n    payload = shouldEncrypt\n      ? packBytesAsSnakeForEncryptedData(payload) as Cell\n      : packBytesAsSnake(payload, 0) as Cell;\n  }\n\n  const init = stateInit ? loadStateInit(\n    stateInit.asSlice(),\n  ) : undefined;\n\n  const sendMode = (isFullBalance\n    ? SendMode.CARRY_ALL_REMAINING_BALANCE\n    : SendMode.PAY_GAS_SEPARATELY) + SendMode.IGNORE_ERRORS;\n\n  const transferParams = {\n    seqno,\n    secretKey: Buffer.from(privateKey),\n    messages: [internal({\n      value: amount,\n      to: toAddress,\n      body: payload,\n      init,\n      bounce: parseAddress(toAddress).isBounceable,\n    })],\n    sendMode,\n    timeout: expireAt,\n  };\n  const transaction = wallet instanceof WalletContractV5R1 // Otherwise, TypeScript emits an error\n    ? wallet.createTransfer(transferParams)\n    : wallet.createTransfer(transferParams);\n\n  return { seqno, transaction };\n}\n\nexport async function getAccountNewestActionId(accountId: string) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  return fetchNewestActionId(network, address);\n}\n\nexport async function checkMultiTransactionDraft(\n  accountId: string,\n  messages: TonTransferParams[],\n  withDiesel?: boolean,\n): Promise<ApiCheckMultiTransactionDraftResult> {\n  let totalAmount: bigint = 0n;\n\n  const { network } = parseAccountId(accountId);\n  const tonWallet = await fetchStoredTonWallet(accountId);\n  const { isInitialized, version } = tonWallet;\n\n  try {\n    for (const { toAddress, amount } of messages) {\n      if (amount < 0n) {\n        return { error: ApiTransactionDraftError.InvalidAmount };\n      }\n\n      const isMainnet = network === 'mainnet';\n      const { isValid, isTestOnly } = parseAddress(toAddress);\n\n      if (!isValid || (isMainnet && isTestOnly)) {\n        return { error: ApiTransactionDraftError.InvalidToAddress };\n      }\n\n      totalAmount += amount;\n    }\n\n    // Check individual token balances\n    const { hasInsufficientTokenBalance, parsedPayloads } = await isTokenBalanceInsufficient(\n      network,\n      tonWallet.address,\n      messages,\n    );\n\n    const wallet = await getTonWallet(accountId, tonWallet);\n    const { balance } = await getWalletInfo(network, wallet);\n\n    const { transaction } = await signMultiTransaction({ network, wallet, messages, version });\n    const emulation = applyFeeFactorToEmulationResult(\n      await emulateTransactionWithFallback(network, wallet, transaction, isInitialized),\n    );\n    const result = { emulation, parsedPayloads };\n\n    // TODO Should `totalAmount` be `0` for `withDiesel`?\n    // Check for insufficient balance (both tokens and TON) and return error\n    const hasInsufficientTonBalance = !withDiesel && balance < totalAmount + result.emulation.networkFee;\n\n    if (hasInsufficientTokenBalance || hasInsufficientTonBalance) {\n      return { ...result, error: ApiTransactionDraftError.InsufficientBalance };\n    }\n\n    return result;\n  } catch (err: any) {\n    return handleServerError(err);\n  }\n}\n\nasync function isTokenBalanceInsufficient(\n  network: ApiNetwork,\n  walletAddress: string,\n  messages: TonTransferParams[],\n): Promise<{\n    hasInsufficientTokenBalance: boolean;\n    parsedPayloads: (ApiParsedPayload | undefined)[];\n  }> {\n  const payloadParsingResults = await Promise.all(\n    messages.map(async ({ payload, toAddress }) => {\n      if (!payload) return { tokenResult: undefined, parsedPayload: undefined };\n\n      try {\n        const payloadAsString = getPayloadFromTransfer({ payload, isBase64Payload: true })!.toBoc().toString('base64');\n        const parsedPayload = await parsePayloadBase64(network, toAddress, payloadAsString);\n\n        if (parsedPayload?.type === 'tokens:transfer') {\n          return {\n            tokenResult: {\n              tokenAddress: parsedPayload.tokenAddress,\n              amount: parsedPayload.amount,\n            },\n            parsedPayload,\n          };\n        }\n\n        return { tokenResult: undefined, parsedPayload };\n      } catch (e) {\n        // If payload parsing fails, treat as regular TON transfer\n        logDebugError('isTokenBalanceInsufficient', 'Error parsing payload', e);\n      }\n\n      return { tokenResult: undefined, parsedPayload: undefined };\n    }),\n  );\n\n  // Accumulate token amounts by address\n  const tokenAmountsByAddress: Record<string, bigint> = {};\n  const parsedPayloads = payloadParsingResults.map((result) => result?.parsedPayload);\n  let hasUnknownToken = false;\n\n  for (const result of payloadParsingResults) {\n    if (result?.tokenResult) {\n      const { tokenAddress, amount } = result.tokenResult;\n\n      if (!tokenAddress) {\n        // Possible when the jetton wallet is not deployed, therefore the minter address is unknown and set to \"\".\n        // This is handled in `parsePayloadSlice`. If the sender jetton wallet is not deployed, assuming the balance is 0.\n        hasUnknownToken = true;\n        continue;\n      }\n\n      if (!tokenAmountsByAddress[tokenAddress]) {\n        tokenAmountsByAddress[tokenAddress] = 0n;\n      }\n      tokenAmountsByAddress[tokenAddress] += amount;\n    }\n  }\n\n  if (hasUnknownToken) {\n    return { hasInsufficientTokenBalance: true, parsedPayloads };\n  }\n\n  const tokenAddresses = Object.keys(tokenAmountsByAddress);\n  if (tokenAddresses.length === 0) {\n    return { hasInsufficientTokenBalance: false, parsedPayloads }; // No token transfers\n  }\n\n  const tokenBalances = await Promise.all(\n    tokenAddresses.map((tokenAddress) =>\n      getTokenBalanceWithMintless(network, walletAddress, tokenAddress),\n    ),\n  );\n\n  // Check if any token has insufficient balance\n  for (let i = 0; i < tokenAddresses.length; i++) {\n    const tokenAddress = tokenAddresses[i];\n    const requiredAmount = tokenAmountsByAddress[tokenAddress];\n    const availableBalance = tokenBalances[i];\n\n    if (availableBalance < requiredAmount) {\n      return { hasInsufficientTokenBalance: true, parsedPayloads };\n    }\n  }\n\n  return { hasInsufficientTokenBalance: false, parsedPayloads };\n}\n\nexport type GaslessType = 'diesel' | 'w5';\n\ninterface SubmitMultiTransferOptions {\n  accountId: string;\n  password: string;\n  messages: TonTransferParams[];\n  expireAt?: number;\n  isGasless?: boolean;\n}\n\nexport async function submitMultiTransfer({\n  accountId, password, messages, expireAt, isGasless,\n}: SubmitMultiTransferOptions): Promise<ApiSubmitMultiTransferResult> {\n  const { network } = parseAccountId(accountId);\n\n  const account = await fetchStoredAccount<ApiAccountWithMnemonic>(accountId);\n  const { address: fromAddress, isInitialized, version } = account.ton;\n  const { pendingTransfer } = await waitAndCreatePendingTransfer(network, fromAddress);\n\n  try {\n    const wallet = await getTonWallet(accountId, account.ton);\n    const privateKey = await fetchPrivateKey(accountId, password, account);\n\n    let totalAmount = 0n;\n    messages.forEach((message) => {\n      totalAmount += BigInt(message.amount);\n    });\n\n    const { balance } = await getWalletInfo(network, wallet);\n\n    const gaslessType = isGasless ? version === 'W5' ? 'w5' : 'diesel' : undefined;\n    const withW5Gasless = gaslessType === 'w5';\n\n    const { seqno, transaction } = await signMultiTransaction({\n      network, wallet, messages, version, privateKey, expireAt, withW5Gasless,\n    });\n\n    if (!isGasless) {\n      const { networkFee } = await emulateTransactionWithFallback(network, wallet, transaction, isInitialized);\n      if (balance < totalAmount + networkFee) {\n        return { error: ApiTransactionError.InsufficientBalance };\n      }\n    }\n\n    const client = getTonClient(network);\n    const { msgHash, boc, paymentLink, msgHashNormalized } = await sendExternal(\n      client, wallet, transaction, gaslessType,\n    );\n\n    if (!isGasless) {\n      void retrySendBoc(network, fromAddress, boc, seqno, pendingTransfer);\n    } else {\n      // TODO: Wait for gasless transfer\n      pendingTransfer.resolve();\n    }\n\n    const clearedMessages = messages.map((message) => {\n      if (typeof message.payload !== 'string' && typeof message.payload !== 'undefined') {\n        return omit(message, ['payload']);\n      }\n      return message;\n    });\n\n    return {\n      seqno,\n      amount: totalAmount.toString(),\n      messages: clearedMessages,\n      boc,\n      msgHash,\n      msgHashNormalized,\n      paymentLink,\n      withW5Gasless,\n    };\n  } catch (err) {\n    pendingTransfer.resolve();\n\n    logDebugError('submitMultiTransfer', err);\n    return { error: resolveTransactionError(err) };\n  }\n}\n\nasync function signMultiTransaction({\n  network,\n  wallet,\n  messages,\n  version,\n  privateKey,\n  expireAt,\n  withW5Gasless,\n}: {\n  network: ApiNetwork;\n  wallet: TonWallet;\n  messages: TonTransferParams[];\n  version: ApiTonWalletVersion;\n  privateKey?: Uint8Array;\n  /** Unix seconds */\n  expireAt?: number;\n  withW5Gasless?: boolean;\n}) {\n  const { seqno } = await getWalletInfo(network, wallet);\n\n  if (!privateKey) {\n    privateKey = new Uint8Array(64);\n  } else {\n    logDebug('Signing transaction', {\n      seqno,\n      messages: messages.map((msg) => pick(msg, ['toAddress', 'amount'])),\n    });\n  }\n\n  if (!expireAt) {\n    expireAt = Math.round(Date.now() / 1000) + (withW5Gasless ? PENDING_DIESEL_TIMEOUT_SEC : TRANSFER_TIMEOUT_SEC);\n  }\n\n  let hasPayload = false;\n\n  const preparedMessages = messages.map((message) => {\n    const {\n      amount, toAddress, stateInit, isBase64Payload,\n    } = message;\n    let { payload } = message;\n\n    payload = getPayloadFromTransfer({ payload, isBase64Payload });\n\n    const init = stateInit ? loadStateInit(\n      stateInit.asSlice(),\n    ) : undefined;\n\n    if (!hasPayload && payload) {\n      hasPayload = true;\n    }\n\n    return internal({\n      value: amount,\n      to: toAddress,\n      body: payload,\n      bounce: parseAddress(toAddress).isBounceable,\n      init,\n    });\n  });\n\n  if (version === 'W5') {\n    // TODO Remove it. There is bug in @ton/ton library that causes transactions to be executed in reverse order.\n    preparedMessages.reverse();\n  }\n\n  const transferParams = {\n    authType: withW5Gasless ? 'internal' as const : undefined,\n    seqno,\n    secretKey: Buffer.from(privateKey),\n    messages: preparedMessages,\n    sendMode: SendMode.PAY_GAS_SEPARATELY + SendMode.IGNORE_ERRORS,\n    timeout: expireAt,\n  };\n\n  const transaction = wallet instanceof WalletContractV5R1 // Otherwise, TypeScript emits an error\n    ? wallet.createTransfer(transferParams)\n    : wallet.createTransfer(transferParams);\n\n  return { seqno, transaction };\n}\n\nasync function retrySendBoc(\n  network: ApiNetwork,\n  address: string,\n  boc: string,\n  seqno: number,\n  pendingTransfer?: Deferred,\n) {\n  const tonClient = getTonClient(network);\n  const waitUntil = Date.now() + WAIT_TRANSFER_TIMEOUT;\n\n  while (Date.now() < waitUntil) {\n    const [error, walletInfo] = await Promise.all([\n      tonClient.sendFile(boc).catch((err) => String(err)),\n      getWalletInfo(network, address).catch(() => undefined),\n    ]);\n\n    // Errors mean that `seqno` was changed or not enough of balance\n    if (error?.match(/(exitcode=33|exitcode=133|inbound external message rejected by account)/)) {\n      break;\n    }\n\n    // seqno here may change before exit code appears\n    if (walletInfo && walletInfo.seqno > seqno) {\n      break;\n    }\n\n    await pause(WAIT_PAUSE);\n  }\n\n  pendingTransfer?.resolve();\n}\n\nasync function emulateTransactionWithFallback(\n  network: ApiNetwork,\n  wallet: TonWallet,\n  transaction: Cell,\n  isInitialized?: boolean,\n): Promise<ApiEmulationWithFallbackResult> {\n  try {\n    const emulation = await emulateTransaction(network, wallet, transaction, isInitialized);\n    return { isFallback: false, ...emulation };\n  } catch (err) {\n    logDebugError('Failed to emulate a transaction', err);\n  }\n\n  // Falling back to the legacy fee estimation method just in case.\n  // It doesn't support estimating more than 20 transactions (inside `transaction`) at once.\n  // eslint-disable-next-line no-null/no-null\n  const { code = null, data = null } = !isInitialized ? wallet.init : {};\n  const { source_fees: fees } = await getTonClient(network).estimateExternalMessageFee(wallet.address, {\n    body: transaction,\n    initCode: code,\n    initData: data,\n    ignoreSignature: true,\n  });\n  const networkFee = BigInt(fees.in_fwd_fee + fees.storage_fee + fees.gas_fee + fees.fwd_fee);\n  return { isFallback: true, networkFee };\n}\n\nexport async function sendSignedMessage(accountId: string, message: ApiSignedTransfer, pendingTransferId?: string) {\n  const { network } = parseAccountId(accountId);\n  const { address: fromAddress, publicKey, version } = await fetchStoredTonWallet(accountId);\n  const client = getTonClient(network);\n  const wallet = buildWallet(publicKey!, version);\n  const { base64, seqno } = message;\n  const pendingTransfer = pendingTransferId ? getPendingTransfer(pendingTransferId) : undefined;\n\n  try {\n    const { boc, msgHashNormalized } = await sendExternal(client, wallet, Cell.fromBase64(base64));\n\n    void retrySendBoc(network, fromAddress, boc, seqno, pendingTransfer);\n\n    return { boc, msgHashNormalized };\n  } catch (err) {\n    pendingTransfer?.resolve();\n    throw err;\n  }\n}\n\nexport async function sendSignedMessages(accountId: string, messages: ApiSignedTransfer[]) {\n  const { network } = parseAccountId(accountId);\n  const { address: fromAddress, publicKey, version } = await fetchStoredTonWallet(accountId);\n  const client = getTonClient(network);\n  const wallet = buildWallet(publicKey!, version);\n\n  const attempts = ATTEMPTS + messages.length;\n  let index = 0;\n  let attempt = 0;\n\n  let firstBoc: string | undefined;\n\n  const msgHashesNormalized: string[] = [];\n  let pendingTransfer: Deferred | undefined;\n\n  while (index < messages.length && attempt < attempts) {\n    const { base64, seqno } = messages[index];\n    try {\n      ({ pendingTransfer } = await waitAndCreatePendingTransfer(network, fromAddress));\n\n      const { boc, msgHashNormalized } = await sendExternal(client, wallet, Cell.fromBase64(base64));\n      msgHashesNormalized.push(msgHashNormalized);\n\n      if (index === 0) {\n        firstBoc = boc;\n      }\n\n      void retrySendBoc(network, fromAddress, boc, seqno, pendingTransfer);\n\n      index++;\n    } catch (err) {\n      pendingTransfer?.resolve();\n      logDebugError('sendSignedMessages', err);\n    }\n    attempt++;\n  }\n\n  return { successNumber: index, firstBoc, msgHashesNormalized };\n}\n\nexport async function decryptComment(\n  accountId: string, encryptedComment: string, fromAddress: string, password: string,\n) {\n  const keyPair = await fetchKeyPair(accountId, password);\n  if (!keyPair) {\n    return undefined;\n  }\n\n  const { secretKey, publicKey } = keyPair;\n\n  const buffer = Buffer.from(encryptedComment, 'base64');\n\n  return decryptMessageComment(buffer, publicKey, secretKey, fromAddress);\n}\n\n/**\n * The goal of the function is acting like `checkTransactionDraft` but return only the diesel information\n */\nexport function fetchEstimateDiesel(\n  accountId: string, tokenAddress: string,\n): Promise<ApiFetchEstimateDieselResult> {\n  return getDiesel({\n    accountId,\n    tokenAddress,\n    // We pass `false` because `fetchEstimateDiesel` assumes that the transfer is gasless anyway\n    canTransferGasfully: false,\n  });\n}\n\n/**\n * Decides whether the transfer must be gasless and fetches the diesel estimate from the backend.\n */\nasync function getDiesel({\n  accountId,\n  tokenAddress,\n  canTransferGasfully,\n  toncoinBalance,\n  tokenBalance,\n}: {\n  accountId: string;\n  tokenAddress: string;\n  canTransferGasfully: boolean;\n  // The below fields allow to avoid network requests if you already have these data\n  toncoinBalance?: bigint;\n  tokenBalance?: bigint;\n}): Promise<ApiFetchEstimateDieselResult> {\n  const { network } = parseAccountId(accountId);\n  if (network !== 'mainnet') return DIESEL_NOT_AVAILABLE;\n\n  const storedTonWallet = await fetchStoredTonWallet(accountId);\n  const wallet = await getTonWallet(accountId, storedTonWallet);\n\n  const token = getTokenByAddress(tokenAddress);\n  if (!token.isGaslessEnabled && !token.isStarsEnabled) return DIESEL_NOT_AVAILABLE;\n\n  const { address, version } = storedTonWallet;\n  toncoinBalance ??= await getWalletBalance(network, wallet);\n  const fee = getDieselToncoinFee(token);\n  const toncoinNeeded = fee.amount - toncoinBalance;\n\n  if (toncoinBalance >= MAX_BALANCE_WITH_CHECK_DIESEL || toncoinNeeded <= 0n) return DIESEL_NOT_AVAILABLE;\n\n  const rawDiesel = await estimateDiesel(\n    address,\n    tokenAddress,\n    toDecimal(toncoinNeeded),\n    version === 'W5',\n    fee.isStars,\n  );\n  const diesel: ApiFetchEstimateDieselResult = {\n    status: rawDiesel.status,\n    amount: rawDiesel.amount === undefined\n      ? undefined\n      : fromDecimal(rawDiesel.amount, rawDiesel.status === 'stars-fee' ? 0 : token.decimals),\n    nativeAmount: toncoinNeeded,\n    remainingFee: toncoinBalance,\n    realFee: fee.realFee,\n  };\n\n  const tokenAmount = getDieselTokenAmount(diesel);\n  if (tokenAmount === 0n) {\n    return diesel;\n  }\n\n  tokenBalance ??= await getTokenBalanceWithMintless(network, address, tokenAddress);\n  const canPayDiesel = tokenBalance >= tokenAmount;\n  const isAwaitingNotExpiredPrevious = Boolean(\n    rawDiesel.pendingCreatedAt\n    && Date.now() - new Date(rawDiesel.pendingCreatedAt).getTime() < PENDING_DIESEL_TIMEOUT_SEC * SEC,\n  );\n\n  // When both TON and diesel are insufficient, we want to show the TON fee\n  const shouldBeGasless = (!canTransferGasfully && canPayDiesel) || isAwaitingNotExpiredPrevious;\n  return shouldBeGasless ? diesel : DIESEL_NOT_AVAILABLE;\n}\n\n/**\n * Guesses the total TON fee (including the gas attached to the transaction) that will be spent on a diesel transfer.\n *\n * `amount` is what will be taken from the wallet;\n * `realFee` is approximately what will be actually spent (the rest will return in the excess);\n * `isStars` tells whether the fee is estimated considering that the diesel will be paid in stars.\n */\nfunction getDieselToncoinFee(token: ApiToken) {\n  const isStars = !token.isGaslessEnabled && token.isStarsEnabled;\n  let { amount, realAmount: realFee } = getToncoinAmountForTransfer(token, false);\n\n  // Multiplying by 2 because the diesel transfer has 2 transactions:\n  // - for the transfer itself,\n  // - for sending the diesel to the MTW wallet.\n  if (!isStars) {\n    amount *= 2n;\n    realFee *= 2n;\n  }\n\n  amount += DEFAULT_FEE;\n  realFee += DEFAULT_FEE;\n\n  return { amount, realFee, isStars };\n}\n\nfunction applyFeeFactorToEmulationResult(estimation: ApiEmulationWithFallbackResult): ApiEmulationWithFallbackResult {\n  estimation = {\n    ...estimation,\n    networkFee: bigintMultiplyToNumber(estimation.networkFee, FEE_FACTOR),\n  };\n\n  if ('byTransactionIndex' in estimation) {\n    estimation.byTransactionIndex = estimation.byTransactionIndex.map((transaction) => ({\n      ...transaction,\n      networkFee: bigintMultiplyToNumber(transaction.networkFee, FEE_FACTOR),\n    }));\n  }\n\n  return estimation;\n}\n\nfunction getPayloadFromTransfer(\n  { payload, isBase64Payload }: Pick<TonTransferParams, 'payload' | 'isBase64Payload'>,\n): Cell | undefined {\n  if (payload === undefined) {\n    return undefined;\n  }\n\n  if (payload instanceof Cell) {\n    return payload;\n  }\n\n  if (typeof payload === 'string') {\n    if (isBase64Payload) {\n      return Cell.fromBase64(payload);\n    }\n\n    // This is what @ton/core does under the hood when a string payload is passed to `internal()`\n    return packBytesAsSnakeCell(commentToBytes(payload));\n  }\n\n  if (payload instanceof Uint8Array) {\n    return payload.length ? packBytesAsSnakeCell(payload) : undefined;\n  }\n\n  throw new TypeError(`Unexpected payload type ${typeof payload}`);\n}\n","import type { NftItem } from 'tonapi-sdk-js';\nimport type { Cell } from '@ton/core';\nimport { Address, Builder } from '@ton/core';\n\nimport type { ApiNft, ApiNftUpdate } from '../../types';\nimport type { ApiCheckTransactionDraftResult } from './types';\n\nimport {\n  BURN_ADDRESS,\n  NFT_BATCH_SIZE,\n  NOTCOIN_EXCHANGERS,\n  NOTCOIN_FORWARD_TON_AMOUNT,\n  NOTCOIN_VOUCHERS_ADDRESS,\n} from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { bigintMultiplyToNumber } from '../../../util/bigint';\nimport { compact } from '../../../util/iteratees';\nimport { generateQueryId } from './util';\nimport { parseTonapiioNft } from './util/metadata';\nimport {\n  fetchAccountEvents, fetchAccountNfts, fetchNftByAddress, fetchNftItems,\n} from './util/tonapiio';\nimport { commentToBytes, packBytesAsSnake, toBase64Address } from './util/tonCore';\nimport { fetchStoredTonWallet } from '../../common/accounts';\nimport { getNftSuperCollectionsByCollectionAddress } from '../../common/addresses';\nimport {\n  NFT_PAYLOAD_SAFE_MARGIN,\n  NFT_TRANSFER_AMOUNT,\n  NFT_TRANSFER_FORWARD_AMOUNT,\n  NFT_TRANSFER_REAL_AMOUNT,\n  NftOpCode,\n} from './constants';\nimport { checkMultiTransactionDraft, checkToAddress, submitMultiTransfer } from './transfer';\nimport { isActiveSmartContract } from './wallet';\n\nexport async function getAccountNfts(accountId: string, options?: {\n  collectionAddress?: string;\n  offset?: number;\n  limit?: number;\n}): Promise<ApiNft[]> {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n  const nftSuperCollectionsByCollectionAddress = await getNftSuperCollectionsByCollectionAddress();\n\n  const rawNfts = await fetchAccountNfts(network, address, options);\n  return compact(rawNfts.map((rawNft) => parseTonapiioNft(network, rawNft, nftSuperCollectionsByCollectionAddress)));\n}\n\nexport async function checkNftOwnership(accountId: string, nftAddress: string) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n  const rawNft = await fetchNftByAddress(network, nftAddress);\n  const nftSuperCollectionsByCollectionAddress = await getNftSuperCollectionsByCollectionAddress();\n\n  const nft = parseTonapiioNft(network, rawNft, nftSuperCollectionsByCollectionAddress);\n\n  return address === nft?.ownerAddress;\n}\n\nexport async function getNftUpdates(accountId: string, fromSec: number) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n  const nftSuperCollectionsByCollectionAddress = await getNftSuperCollectionsByCollectionAddress();\n\n  const events = await fetchAccountEvents(network, address, fromSec);\n  fromSec = events[0]?.timestamp ?? fromSec;\n  events.reverse();\n  const updates: ApiNftUpdate[] = [];\n\n  for (const event of events) {\n    for (const action of event.actions) {\n      let to: string;\n      let nftAddress: string;\n      let rawNft: NftItem | undefined;\n      const isPurchase = !!action.NftPurchase;\n\n      if (action.NftItemTransfer) {\n        const { sender, recipient, nft: rawNftAddress } = action.NftItemTransfer;\n        if (!sender || !recipient) continue;\n        to = recipient.address;\n        nftAddress = toBase64Address(rawNftAddress, true, network);\n      } else if (action.NftPurchase) {\n        const { buyer } = action.NftPurchase;\n        to = buyer.address;\n        rawNft = action.NftPurchase.nft;\n        if (!rawNft) {\n          continue;\n        }\n        nftAddress = toBase64Address(rawNft.address, true, network);\n      } else {\n        continue;\n      }\n\n      if (Address.parse(to).equals(Address.parse(address))) {\n        if (!rawNft) {\n          [rawNft] = await fetchNftItems(network, [nftAddress]);\n        }\n\n        if (rawNft) {\n          const nft = parseTonapiioNft(network, rawNft, nftSuperCollectionsByCollectionAddress);\n\n          if (nft) {\n            updates.push({\n              type: 'nftReceived',\n              accountId,\n              nftAddress,\n              nft,\n            });\n          }\n        }\n      } else if (!isPurchase && await isActiveSmartContract(network, to)) {\n        updates.push({\n          type: 'nftPutUpForSale',\n          accountId,\n          nftAddress,\n        });\n      } else {\n        updates.push({\n          type: 'nftSent',\n          accountId,\n          nftAddress,\n          newOwnerAddress: to,\n        });\n      }\n    }\n  }\n\n  return [fromSec, updates] as [number, ApiNftUpdate[]];\n}\n\nexport async function checkNftTransferDraft(options: {\n  accountId: string;\n  nfts: ApiNft[];\n  toAddress: string;\n  comment?: string;\n}): Promise<ApiCheckTransactionDraftResult> {\n  const { accountId, nfts, comment } = options;\n  let { toAddress } = options;\n\n  const { network } = parseAccountId(accountId);\n  const { address: fromAddress } = await fetchStoredTonWallet(accountId);\n\n  const result: ApiCheckTransactionDraftResult = await checkToAddress(network, toAddress);\n  if ('error' in result) {\n    return result;\n  }\n\n  toAddress = result.resolvedAddress!;\n\n  const messages = nfts\n    .slice(0, NFT_BATCH_SIZE) // We only need to check the first batch of a multi-transaction\n    .map((nft) => buildNftTransferMessage(nft, fromAddress, toAddress, comment));\n\n  const checkResult = await checkMultiTransactionDraft(accountId, messages);\n\n  if (checkResult.emulation) {\n    // todo: Use `received` from the emulation to calculate the real fee. Check what happens when the receiver is the same wallet.\n    const batchFee = checkResult.emulation.networkFee;\n    result.fee = calculateNftTransferFee(nfts.length, messages.length, batchFee, NFT_TRANSFER_AMOUNT);\n    result.realFee = calculateNftTransferFee(nfts.length, messages.length, batchFee, NFT_TRANSFER_REAL_AMOUNT);\n  }\n\n  if ('error' in checkResult) {\n    result.error = checkResult.error;\n  }\n\n  return result;\n}\n\nexport async function submitNftTransfers(options: {\n  accountId: string;\n  password: string;\n  nfts: ApiNft[];\n  toAddress: string;\n  comment?: string;\n}) {\n  const {\n    accountId, password, nfts, toAddress, comment,\n  } = options;\n  const { address: fromAddress } = await fetchStoredTonWallet(accountId);\n  const messages = nfts.map((nft) => buildNftTransferMessage(nft, fromAddress, toAddress, comment));\n  return submitMultiTransfer({ accountId, password, messages });\n}\n\nfunction buildNftTransferMessage(nft: ApiNft, fromAddress: string, toAddress: string, comment?: string) {\n  const isNotcoinBurn = nft.collectionAddress === NOTCOIN_VOUCHERS_ADDRESS\n    && (toAddress === BURN_ADDRESS || NOTCOIN_EXCHANGERS.includes(toAddress as any));\n  const payload = isNotcoinBurn\n    ? buildNotcoinVoucherExchange(fromAddress, nft.address, nft.index)\n    : buildNftTransferPayload(fromAddress, toAddress, comment);\n\n  return {\n    payload,\n    amount: NFT_TRANSFER_AMOUNT,\n    toAddress: nft.address,\n  };\n}\n\nfunction buildNotcoinVoucherExchange(fromAddress: string, nftAddress: string, nftIndex: number) {\n  const first4Bits = Address.parse(nftAddress).hash.readUint8() >> 4;\n  const toAddress = NOTCOIN_EXCHANGERS[first4Bits];\n\n  const payload = new Builder()\n    .storeUint(0x5fec6642, 32)\n    .storeUint(nftIndex, 64)\n    .endCell();\n\n  return buildNftTransferPayload(fromAddress, toAddress, payload, NOTCOIN_FORWARD_TON_AMOUNT);\n}\n\nfunction buildNftTransferPayload(\n  fromAddress: string,\n  toAddress: string,\n  payload?: string | Cell,\n  forwardAmount = NFT_TRANSFER_FORWARD_AMOUNT,\n) {\n  let builder = new Builder()\n    .storeUint(NftOpCode.TransferOwnership, 32)\n    .storeUint(generateQueryId(), 64)\n    .storeAddress(Address.parse(toAddress))\n    .storeAddress(Address.parse(fromAddress))\n    .storeBit(false) // null custom_payload\n    .storeCoins(forwardAmount);\n\n  let forwardPayload: Cell | Uint8Array | undefined;\n\n  if (payload) {\n    if (typeof payload === 'string') {\n      const bytes = commentToBytes(payload);\n      const freeBytes = Math.floor((builder.availableBits - NFT_PAYLOAD_SAFE_MARGIN) / 8);\n      forwardPayload = packBytesAsSnake(bytes, freeBytes);\n    } else {\n      forwardPayload = payload;\n    }\n  }\n\n  if (forwardPayload instanceof Uint8Array) {\n    builder.storeBit(0);\n    builder = builder.storeBuffer(Buffer.from(forwardPayload));\n  } else {\n    builder = builder.storeMaybeRef(forwardPayload);\n  }\n\n  return builder.endCell();\n}\n\nexport function calculateNftTransferFee(\n  totalNftCount: number,\n  // How many NFTs were added to the multi-transaction before estimating it\n  estimatedBatchSize: number,\n  // The blockchain fee of the estimated multi-transaction\n  estimatedBatchBlockchainFee: bigint,\n  // How much TON is attached to each NFT during the transfer\n  amountPerNft: bigint,\n) {\n  const fullBatchCount = Math.floor(totalNftCount / estimatedBatchSize);\n  let remainingBatchSize = totalNftCount % estimatedBatchSize;\n\n  // The blockchain fee for the first NFT in a batch is almost twice higher than the fee for the other NFTs. Therefore,\n  // simply using the average NFT fee to calculate the last incomplete batch fee gives an insufficient number. To fix\n  // that, we increase the last batch size.\n  //\n  // A real life example:\n  // 1 NFT  in the batch: 0.002939195 TON\n  // 2 NFTs in the batch: 0.004470516 TON\n  // 3 NFTs in the batch: 0.006001837 TON\n  // 4 NFTs in the batch: 0.007533158 TON\n  if (remainingBatchSize > 0 && remainingBatchSize < estimatedBatchSize) {\n    remainingBatchSize += 1;\n  }\n\n  const totalBlockchainFee = bigintMultiplyToNumber(\n    estimatedBatchBlockchainFee,\n    (fullBatchCount * estimatedBatchSize + remainingBatchSize) / estimatedBatchSize,\n  );\n  return totalBlockchainFee + BigInt(totalNftCount) * amountPerNft;\n}\n","import type {\n  ApiAccountWithTon,\n  ApiNftTransferPayload,\n  ApiParsedPayload,\n  ApiTokensTransferNonStandardPayload,\n  ApiTokensTransferPayload,\n} from '../../api/types';\n\nimport { DEFAULT_MAX_MESSAGES, LEDGER_MAX_MESSAGES, W5_MAX_MESSAGES } from '../../api/chains/ton/constants';\n\nexport function isNftTransferPayload(payload: ApiParsedPayload | undefined): payload is ApiNftTransferPayload {\n  return payload?.type === 'nft:transfer';\n}\n\nexport function isTokenTransferPayload(\n  payload: ApiParsedPayload | undefined,\n): payload is ApiTokensTransferPayload | ApiTokensTransferNonStandardPayload {\n  return payload?.type === 'tokens:transfer' || payload?.type === 'tokens:transfer-non-standard';\n}\n\n/** How many messages can be sent in a single transaction */\nexport function getMaxMessagesInTransaction(account: ApiAccountWithTon) {\n  const { type, ton: { version } } = account;\n\n  if (type === 'ledger') {\n    return LEDGER_MAX_MESSAGES;\n  } else if (version === 'W5') {\n    return W5_MAX_MESSAGES;\n  } else {\n    return DEFAULT_MAX_MESSAGES;\n  }\n}\n","import type { ApiDomainData, ApiNft } from '../../types';\nimport type { TonTransferParams } from './types';\n\nimport { parseAccountId } from '../../../util/account';\nimport { YEAR } from '../../../util/dateFormat';\nimport { split } from '../../../util/iteratees';\nimport { getMaxMessagesInTransaction } from '../../../util/ton/transfer';\nimport { parseTonapiioNft } from './util/metadata';\nimport { DnsItem } from './contracts/DnsItem';\nimport { fetchStoredTonAccount, fetchStoredTonWallet } from '../../common/accounts';\nimport { getNftSuperCollectionsByCollectionAddress } from '../../common/addresses';\nimport { callBackendGet } from '../../common/backend';\nimport { TON_GAS } from './constants';\nimport { checkMultiTransactionDraft, submitMultiTransfer } from './transfer';\n\nexport async function checkDnsRenewalDraft(accountId: string, nftAddresses: string[]) {\n  const account = await fetchStoredTonAccount(accountId);\n  const maxMessages = getMaxMessagesInTransaction(account);\n  const transactionCount = Math.ceil(nftAddresses.length / maxMessages);\n\n  const messages = nftAddresses\n    .slice(0, maxMessages)\n    .map(makeRenewMessage);\n\n  const result = await checkMultiTransactionDraft(accountId, messages);\n\n  if ('error' in result) {\n    return result;\n  }\n\n  const totalAmount = TON_GAS.changeDns * BigInt(nftAddresses.length);\n  const realFee = totalAmount + result.emulation.networkFee * BigInt(transactionCount); // Not very correct, but  the actual fee\n\n  return { realFee };\n}\n\nexport async function* submitDnsRenewal(accountId: string, password: string, nftAddresses: string[]) {\n  const account = await fetchStoredTonAccount(accountId);\n  const maxMessages = getMaxMessagesInTransaction(account);\n  const nftBatches = split(nftAddresses, maxMessages);\n\n  for (const nftBatch of nftBatches) {\n    const messages: TonTransferParams[] = nftBatch.map(makeRenewMessage);\n\n    yield {\n      addresses: nftBatch,\n      result: await submitMultiTransfer({ accountId, password, messages }),\n    };\n  }\n}\n\nexport async function checkDnsChangeWalletDraft(accountId: string, nftAddress: string, address: string) {\n  const result = await checkMultiTransactionDraft(accountId, [makeChangeMessage(nftAddress, address)]);\n\n  if ('error' in result) {\n    return result;\n  }\n\n  return { realFee: result.emulation.networkFee + TON_GAS.changeDns };\n}\n\nexport function submitDnsChangeWallet(accountId: string, password: string, nftAddress: string, address: string) {\n  return submitMultiTransfer({\n    accountId,\n    password,\n    messages: [makeChangeMessage(nftAddress, address)],\n  });\n}\n\nfunction makeRenewMessage(nftAddress: string) {\n  return {\n    toAddress: nftAddress,\n    payload: DnsItem.buildFillUpMessage(),\n    amount: TON_GAS.changeDns,\n  };\n}\n\nfunction makeChangeMessage(nftAddress: string, linkedAddress: string) {\n  return {\n    toAddress: nftAddress,\n    payload: DnsItem.buildChangeDnsWalletMessage(linkedAddress),\n    amount: TON_GAS.changeDns,\n  };\n}\n\nexport async function fetchDomains(accountId: string) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n  const data = await callBackendGet<Record<string, ApiDomainData>>('/dns/getDomains', { address });\n  const nftSuperCollectionsByCollectionAddress = await getNftSuperCollectionsByCollectionAddress();\n\n  const expirationByAddress: Record<string, number> = {};\n  const linkedAddressByAddress: Record<string, string> = {};\n  const nfts: Record<string, ApiNft> = {};\n\n  Object.keys(data).forEach((nftAddress) => {\n    const { lastFillUpTime, linkedAddress, nft: rawNft } = data[nftAddress];\n    expirationByAddress[nftAddress] = new Date(lastFillUpTime).getTime() + YEAR;\n    if (linkedAddress) {\n      linkedAddressByAddress[nftAddress] = linkedAddress;\n    }\n    const nft = parseTonapiioNft(network, rawNft, nftSuperCollectionsByCollectionAddress);\n    if (nft) {\n      nfts[nftAddress] = nft;\n    }\n  });\n\n  return {\n    expirationByAddress,\n    linkedAddressByAddress,\n    nfts,\n  };\n}\n","/*\nTo activate dev setting, enter `devSettings.simulateLongUnstaking = true;` in the browser console,\neither in the main frame or in the worker (different commands for different frames).\n*/\n\ndeclare const self: (WorkerGlobalScope | Window) & {\n  devSettings: {\n    simulateLongUnstaking?: boolean;\n  };\n};\n\nexport function getDevSettings() {\n  return self.devSettings ?? {};\n}\n\nself.devSettings = {};\n","import type {\n  Cell, Contract, ContractProvider,\n} from '@ton/core';\nimport {\n  Address, beginCell, contractAddress, TupleReader,\n} from '@ton/core';\n\nexport type NominatorPoolConfig = object;\n\nexport type Nominator = {\n  address: Address;\n  amount: bigint;\n  pendingDepositAmount: bigint;\n  withdrawRequested: boolean;\n};\n\nexport function nominatorPoolConfigToCell(config: NominatorPoolConfig): Cell {\n  return beginCell().endCell();\n}\n\nexport class NominatorPool implements Contract {\n  constructor(readonly address: Address, readonly init?: { code: Cell; data: Cell }) {}\n\n  static createFromAddress(address: Address) {\n    return new NominatorPool(address);\n  }\n\n  static createFromConfig(config: NominatorPoolConfig, code: Cell, workchain = 0) {\n    const data = nominatorPoolConfigToCell(config);\n    const init = { code, data };\n    return new NominatorPool(contractAddress(workchain, init), init);\n  }\n\n  async getListNominators(provider: ContractProvider): Promise<Nominator[]> {\n    const res = await provider.get('list_nominators', []);\n    const tupleReader = (res.stack).readTuple();\n    const itemsArray = (tupleReader as any).items as bigint[][];\n\n    return itemsArray.map((items: bigint[]) => {\n      const tupleItems = items.map((value) => ({ type: 'int' as const, value }));\n      const tuple = new TupleReader(tupleItems);\n\n      const hash = tuple.readBigNumber().toString(16).padStart(64, '0');\n      const address = Address.parse(`0:${hash}`);\n      const amount = tuple.readBigNumber();\n      const pendingDepositAmount = tuple.readBigNumber();\n      const withdrawRequested = Boolean(tuple.readNumber());\n\n      return {\n        address,\n        amount,\n        pendingDepositAmount,\n        withdrawRequested,\n      };\n    });\n  }\n}\n","import type { ApiBackendConfig, ApiStakingCommonData } from '../types';\n\nimport Deferred from '../../util/Deferred';\n\nexport type AccountCache = { stakedAt?: number };\n\nlet stakingCommonCache: ApiStakingCommonData | undefined;\nconst stakingCommonCacheDeferred = new Deferred();\n\nconst accountCache: Record<string, AccountCache> = {};\n\nlet backendConfig: ApiBackendConfig | undefined;\nconst configDeferred = new Deferred();\n\nexport function getAccountCache(accountId: string, address: string) {\n  return accountCache[`${accountId}:${address}`] ?? {};\n}\n\nexport function updateAccountCache(accountId: string, address: string, partial: Partial<AccountCache>) {\n  const key = `${accountId}:${address}`;\n  accountCache[key] = { ...accountCache[key], ...partial };\n}\n\nexport function setStakingCommonCache(data: ApiStakingCommonData) {\n  stakingCommonCache = data;\n  stakingCommonCacheDeferred.resolve();\n}\n\nexport async function getStakingCommonCache() {\n  await stakingCommonCacheDeferred.promise;\n  return stakingCommonCache!;\n}\n\nexport function setBackendConfigCache(config: ApiBackendConfig) {\n  backendConfig = config;\n  configDeferred.resolve();\n}\n\n/** Returns the config provided by the backend */\nexport async function getBackendConfigCache() {\n  await configDeferred.promise;\n  return backendConfig!;\n}\n","import { randomBytes } from '../../util/random';\nimport { storage } from '../storages';\n\nlet clientId: string | undefined;\n\nexport async function getClientId() {\n  clientId = await storage.getItem('clientId');\n\n  if (!clientId) {\n    clientId = Buffer.from(randomBytes(10)).toString('hex');\n\n    const referrer = await storage.getItem('referrer');\n    if (referrer) clientId = `${clientId}:${referrer}`;\n\n    await storage.setItem('clientId', clientId);\n  }\n  return clientId;\n}\n","import { Address } from '@ton/core';\n\nimport type {\n  ApiBackendStakingState,\n  ApiBalanceBySlug,\n  ApiEthenaStakingState,\n  ApiJettonStakingState,\n  ApiLoyaltyType,\n  ApiNetwork,\n  ApiStakingCommonData,\n  ApiStakingJettonPool,\n  ApiStakingState,\n} from '../../types';\nimport type { StakingPoolConfigUnpacked } from './contracts/JettonStaking/StakingPool';\nimport type { Nominator } from './contracts/NominatorPool';\nimport type { ApiCheckTransactionDraftResult, ApiSubmitTransferTonResult, TonTransferParams } from './types';\nimport { ApiLiquidUnstakeMode, ApiTransactionDraftError } from '../../types';\n\nimport {\n  DEBUG,\n  ETHENA_STAKING_VAULT,\n  LIQUID_JETTON,\n  LIQUID_POOL,\n  TON_TSUSDE,\n  TON_USDE,\n  TONCOIN,\n  UNSTAKE_TON_GRACE_PERIOD,\n  VALIDATION_PERIOD_MS,\n} from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { bigintDivideToNumber, bigintMultiplyToNumber } from '../../../util/bigint';\nimport { fromDecimal } from '../../../util/decimals';\nimport { getDevSettings } from '../../../util/devSettings';\nimport { getIsActiveStakingState } from '../../../util/staking';\nimport calcJettonStakingApr from '../../../util/ton/calcJettonStakingApr';\nimport {\n  buildJettonClaimPayload,\n  buildJettonUnstakePayload,\n  buildLiquidStakingDepositBody,\n  buildLiquidStakingWithdrawBody,\n  getJettonPoolStakeWallet,\n  getTonClient,\n  resolveTokenWalletAddress,\n  toBase64Address,\n  unpackDicts,\n} from './util/tonCore';\nimport { TsUSDeWallet } from './contracts/Ethena/TsUSDeWallet';\nimport { StakeWallet } from './contracts/JettonStaking/StakeWallet';\nimport { StakingPool } from './contracts/JettonStaking/StakingPool';\nimport { NominatorPool } from './contracts/NominatorPool';\nimport { fetchStoredTonAccount, fetchStoredTonWallet } from '../../common/accounts';\nimport { callBackendGet } from '../../common/backend';\nimport { getAccountCache, getStakingCommonCache, updateAccountCache } from '../../common/cache';\nimport { getClientId } from '../../common/other';\nimport { buildTokenSlug, getTokenByAddress, getTokenBySlug } from '../../common/tokens';\nimport { isKnownStakingPool } from '../../common/utils';\nimport { STAKE_COMMENT, TON_GAS, UNSTAKE_COMMENT } from './constants';\nimport { checkTransactionDraft, submitTransfer } from './transfer';\n\nexport async function checkStakeDraft(accountId: string, amount: bigint, state: ApiStakingState) {\n  let result: ApiCheckTransactionDraftResult;\n\n  switch (state.type) {\n    case 'nominators': {\n      if (amount < TON_GAS.stakeNominators) {\n        return { error: ApiTransactionDraftError.InvalidAmount };\n      }\n\n      result = await checkTransactionDraft({\n        accountId,\n        toAddress: state.pool,\n        amount: amount + TON_GAS.stakeNominators,\n        data: STAKE_COMMENT,\n      });\n      if ('fee' in result && result.fee) {\n        result.fee = TON_GAS.stakeNominators + result.fee;\n      }\n      break;\n    }\n    case 'liquid': {\n      result = await checkTransactionDraft({\n        accountId,\n        toAddress: LIQUID_POOL,\n        amount: amount + TON_GAS.stakeLiquid,\n        data: buildLiquidStakingDepositBody(),\n      });\n      if ('fee' in result && result.fee) {\n        result.fee = TON_GAS.stakeLiquid + result.fee;\n      }\n      break;\n    }\n    case 'jetton': {\n      const { tokenSlug, pool, period } = state;\n      const { tokenAddress } = getTokenBySlug(tokenSlug);\n\n      result = await checkTransactionDraft({\n        accountId,\n        toAddress: pool,\n        tokenAddress,\n        amount,\n        data: StakingPool.stakePayload(period),\n        forwardAmount: TON_GAS.stakeJettonsForward,\n      });\n      break;\n    }\n    case 'ethena': {\n      result = await checkTransactionDraft({\n        accountId,\n        toAddress: ETHENA_STAKING_VAULT,\n        tokenAddress: TON_USDE.tokenAddress,\n        amount,\n        forwardAmount: TON_GAS.stakeEthenaForward,\n      });\n      break;\n    }\n  }\n\n  return result;\n}\n\nexport async function checkUnstakeDraft(accountId: string, amount: bigint, state: ApiStakingState) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n  const commonData = await getStakingCommonCache();\n\n  let result: ApiCheckTransactionDraftResult;\n  let tokenAmount: bigint | undefined;\n\n  switch (state.type) {\n    case 'nominators': {\n      result = await checkTransactionDraft({\n        accountId,\n        toAddress: state.pool,\n        amount: TON_GAS.unstakeNominators,\n        data: UNSTAKE_COMMENT,\n      });\n      break;\n    }\n    case 'liquid': {\n      if (amount > state.balance) {\n        return { error: ApiTransactionDraftError.InsufficientBalance };\n      } else if (amount === state.balance) {\n        tokenAmount = state.tokenBalance;\n      } else {\n        tokenAmount = bigintDivideToNumber(amount, commonData.liquid.currentRate);\n      }\n\n      const params = await buildLiquidStakingWithdraw(network, address, tokenAmount);\n\n      result = await checkTransactionDraft({\n        accountId,\n        toAddress: params.toAddress,\n        amount: params.amount,\n        data: params.payload,\n      });\n      break;\n    }\n    case 'jetton': {\n      tokenAmount = amount;\n\n      result = await checkTransactionDraft({\n        accountId,\n        toAddress: state.stakeWalletAddress,\n        amount: TON_GAS.unstakeJettons,\n        data: buildJettonUnstakePayload(amount, true),\n      });\n      break;\n    }\n    case 'ethena': {\n      if (amount > state.balance) {\n        return { error: ApiTransactionDraftError.InsufficientBalance };\n      } else if (amount === state.balance) {\n        tokenAmount = state.tokenBalance;\n      } else {\n        const rate = network === 'testnet' ? 1 : commonData.ethena.rate;\n        tokenAmount = bigintDivideToNumber(amount, rate);\n      }\n\n      result = await checkTransactionDraft({\n        accountId,\n        toAddress: TON_TSUSDE.tokenAddress,\n        amount: tokenAmount,\n        tokenAddress: TON_TSUSDE.tokenAddress,\n        forwardAmount: TON_GAS.unstakeEthenaForward,\n      });\n      break;\n    }\n  }\n\n  return {\n    ...result,\n    type: state.type,\n    tokenAmount,\n  };\n}\n\nexport async function submitStake(\n  accountId: string,\n  password: string,\n  amount: bigint,\n  state: ApiStakingState,\n) {\n  let result: ApiSubmitTransferTonResult;\n\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  switch (state.type) {\n    case 'nominators': {\n      result = await submitTransfer({\n        accountId,\n        password,\n        toAddress: toBase64Address(state.pool, true, network),\n        amount: amount + TON_GAS.stakeNominators,\n        data: STAKE_COMMENT,\n      });\n      break;\n    }\n    case 'liquid': {\n      result = await submitTransfer({\n        accountId,\n        password,\n        toAddress: LIQUID_POOL,\n        amount: amount + TON_GAS.stakeLiquid,\n        data: buildLiquidStakingDepositBody(),\n      });\n      break;\n    }\n    case 'jetton': {\n      const { tokenSlug, pool, period } = state;\n      const { tokenAddress } = getTokenBySlug(tokenSlug);\n\n      result = await submitTransfer({\n        accountId,\n        password,\n        toAddress: pool,\n        tokenAddress,\n        amount,\n        data: StakingPool.stakePayload(period),\n        forwardAmount: TON_GAS.stakeJettonsForward,\n      });\n      if (!('error' in result)) {\n        result.toAddress = pool;\n      }\n      break;\n    }\n    case 'ethena': {\n      result = await submitTransfer({\n        accountId,\n        password,\n        toAddress: ETHENA_STAKING_VAULT,\n        tokenAddress: TON_USDE.tokenAddress,\n        amount,\n        forwardAmount: TON_GAS.stakeEthenaForward,\n      });\n      break;\n    }\n  }\n\n  if (!('error' in result)) {\n    updateAccountCache(accountId, address, { stakedAt: Date.now() });\n  }\n\n  return result;\n}\n\nexport async function submitUnstake(\n  accountId: string,\n  password: string,\n  amount: bigint,\n  state: ApiStakingState,\n) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  let result: ApiSubmitTransferTonResult;\n\n  switch (state.type) {\n    case 'nominators': {\n      result = await submitTransfer({\n        accountId,\n        password,\n        toAddress: toBase64Address(state.pool, true, network),\n        amount: TON_GAS.unstakeNominators,\n        data: UNSTAKE_COMMENT,\n      });\n      break;\n    }\n    case 'liquid': {\n      const mode = !state.instantAvailable\n        ? ApiLiquidUnstakeMode.BestRate\n        : ApiLiquidUnstakeMode.Default;\n\n      const params = await buildLiquidStakingWithdraw(network, address, amount, mode);\n\n      result = await submitTransfer({\n        accountId,\n        password,\n        toAddress: params.toAddress,\n        amount: params.amount,\n        data: params.payload,\n      });\n      break;\n    }\n    case 'jetton': {\n      result = await submitTransfer({\n        accountId,\n        password,\n        toAddress: state.stakeWalletAddress,\n        amount: TON_GAS.unstakeJettons,\n        data: buildJettonUnstakePayload(amount, true),\n      });\n      break;\n    }\n    case 'ethena': {\n      result = await submitTransfer({\n        accountId,\n        password,\n        toAddress: TON_TSUSDE.tokenAddress,\n        amount,\n        tokenAddress: TON_TSUSDE.tokenAddress,\n        forwardAmount: TON_GAS.unstakeEthenaForward,\n      });\n      if (!('error' in result)) {\n        result.localActivityParams = {\n          slug: TON_TSUSDE.slug,\n          amount: 0n,\n          toAddress: TON_TSUSDE.tokenAddress,\n        };\n      }\n    }\n  }\n\n  return result;\n}\n\nexport async function buildLiquidStakingWithdraw(\n  network: ApiNetwork,\n  address: string,\n  amount: bigint,\n  mode: ApiLiquidUnstakeMode = ApiLiquidUnstakeMode.Default,\n): Promise<TonTransferParams> {\n  const tokenWalletAddress = await resolveTokenWalletAddress(network, address, LIQUID_JETTON);\n\n  const payload = buildLiquidStakingWithdrawBody({\n    amount,\n    responseAddress: address,\n    fillOrKill: mode === ApiLiquidUnstakeMode.Instant,\n    waitTillRoundEnd: mode === ApiLiquidUnstakeMode.BestRate,\n  });\n\n  return {\n    amount: TON_GAS.unstakeLiquid,\n    toAddress: tokenWalletAddress,\n    payload,\n  };\n}\n\ntype StakingStateOptions = {\n  accountId: string;\n  backendState: ApiBackendStakingState;\n  commonData: ApiStakingCommonData;\n  address: string;\n  loyaltyType?: ApiLoyaltyType;\n  network: ApiNetwork;\n  balances: ApiBalanceBySlug;\n};\n\nexport async function getStakingStates(\n  accountId: string,\n  commonData: ApiStakingCommonData,\n  backendState: ApiBackendStakingState,\n  balances: ApiBalanceBySlug,\n): Promise<ApiStakingState[]> {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  const {\n    loyaltyType,\n    shouldUseNominators,\n    type: backendType,\n  } = backendState;\n\n  const options: StakingStateOptions = {\n    accountId,\n    backendState,\n    commonData,\n    address,\n    loyaltyType,\n    network,\n    balances,\n  };\n\n  const promises: Promise<ApiStakingState>[] = [];\n\n  for (const poolConfig of commonData.jettonPools) {\n    const slug = buildTokenSlug('ton', poolConfig.token);\n    if (slug in balances) {\n      promises.push(buildJettonState(options, poolConfig));\n    }\n  }\n\n  if (shouldUseNominators || backendType === 'nominators') {\n    promises.push(buildNominatorsState(options));\n  }\n\n  if (TON_USDE.slug in balances && (!commonData.ethena.isDisabled || DEBUG)) {\n    promises.push(buildEthenaState(options));\n  }\n\n  return [buildLiquidState(options), ...await Promise.all(promises)];\n}\n\nfunction buildLiquidState({\n  accountId,\n  address,\n  backendState,\n  commonData,\n  loyaltyType,\n  balances,\n}: StakingStateOptions): ApiStakingState {\n  const { currentRate } = commonData.liquid;\n  const tokenSlug = buildTokenSlug('ton', LIQUID_JETTON);\n  const tokenBalance = balances[tokenSlug] ?? 0n;\n  const unstakeRequestAmount = fromDecimal(backendState.liquid?.unstakeRequestAmount ?? 0);\n\n  const accountCache = getAccountCache(accountId, address);\n  const stakedAt = Math.max(accountCache.stakedAt ?? 0, backendState.stakedAt ?? 0);\n\n  const isInstantUnstake = Date.now() - stakedAt > VALIDATION_PERIOD_MS && !getDevSettings().simulateLongUnstaking;\n  const liquidAvailable = isInstantUnstake ? commonData.liquid.available : 0n;\n  const { start, end } = getLiquidStakingTimeRange(commonData);\n\n  let liquidApy = commonData.liquid.apy;\n  if (loyaltyType && loyaltyType in commonData.liquid.loyaltyApy) {\n    liquidApy = commonData.liquid.loyaltyApy[loyaltyType];\n  }\n\n  const balance = bigintMultiplyToNumber(tokenBalance, currentRate) + unstakeRequestAmount;\n\n  return {\n    type: 'liquid',\n    id: 'liquid',\n    tokenSlug: TONCOIN.slug,\n    pool: LIQUID_POOL,\n    balance,\n    annualYield: liquidApy,\n    yieldType: 'APY',\n    tokenBalance,\n    unstakeRequestAmount,\n    instantAvailable: liquidAvailable,\n    start,\n    end,\n  };\n}\n\nasync function buildNominatorsState({\n  network,\n  address,\n  backendState,\n  commonData,\n}: StakingStateOptions): Promise<ApiStakingState> {\n  const balance = backendState.balance;\n  const { address: pool, apy } = backendState.nominatorsPool;\n\n  const isPrevRoundUnlocked = Date.now() > commonData.prevRound.unlock;\n  const start = isPrevRoundUnlocked ? commonData.round.start : commonData.prevRound.start;\n  const end = isPrevRoundUnlocked ? commonData.round.unlock : commonData.prevRound.unlock;\n\n  let currentNominator: Nominator | undefined;\n\n  if (backendState.type === 'nominators') {\n    const nominatorPool = getTonClient(network).open(new NominatorPool(Address.parse(pool)));\n    const nominators = await nominatorPool.getListNominators();\n    const addressObject = Address.parse(address);\n    currentNominator = nominators.find((n) => n.address.equals(addressObject));\n  }\n\n  return {\n    type: 'nominators',\n    id: 'nominators',\n    tokenSlug: TONCOIN.slug,\n    balance: currentNominator ? balance : 0n,\n    annualYield: apy,\n    yieldType: 'APY',\n    pool,\n    start,\n    end,\n    pendingDepositAmount: currentNominator?.pendingDepositAmount ?? 0n,\n    unstakeRequestAmount: currentNominator?.withdrawRequested ? balance : 0n,\n  };\n}\n\nasync function buildJettonState(\n  options: StakingStateOptions,\n  pool: ApiStakingJettonPool,\n): Promise<ApiJettonStakingState> {\n  const { network } = options;\n\n  // common\n  const {\n    pool: poolAddress,\n    token: tokenAddress,\n    poolConfig,\n  } = pool;\n\n  const { decimals, slug: tokenSlug } = getTokenByAddress(tokenAddress);\n\n  // pool\n  const { tvl, rewardJettons } = unpackDicts(poolConfig) as StakingPoolConfigUnpacked;\n  const { rewardsDeposits } = Object.values(rewardJettons!)[0];\n  const now = Math.floor(Date.now() / 1000);\n\n  let dailyReward: bigint = 0n;\n  for (const { startTime, endTime, distributionSpeed } of Object.values(rewardsDeposits)) {\n    if (startTime < now && endTime > now) {\n      dailyReward += distributionSpeed;\n    }\n  }\n\n  const apr = calcJettonStakingApr({ tvl, dailyReward, decimals });\n\n  // wallet\n  const { address, balances } = options;\n  const periodConfig = pool.periods[0];\n  const stakedTokenSlug = buildTokenSlug('ton', periodConfig.token);\n\n  const stakeWallet = await getJettonPoolStakeWallet(network, poolAddress, periodConfig.period, address);\n\n  let unclaimedRewards = 0n;\n  let balance = 0n;\n  let poolWallets: string[] | undefined;\n\n  if (stakedTokenSlug in balances) { // Avoiding the request when it's unnecessary\n    const walletData = await stakeWallet.getStorageData().catch(() => undefined);\n\n    if (walletData) {\n      const poolWalletAddress = await resolveTokenWalletAddress(network, poolAddress, tokenAddress);\n      const rewards = StakeWallet.getAvailableRewards(walletData, poolConfig);\n      unclaimedRewards = (rewards && rewards[poolWalletAddress]) ?? 0n;\n      balance = walletData.jettonBalance;\n      poolWallets = Object.keys(rewards);\n    }\n  }\n\n  const state: ApiJettonStakingState = {\n    type: 'jetton',\n    id: poolAddress,\n    pool: poolAddress,\n    tokenAddress,\n    tokenSlug,\n    annualYield: apr,\n    yieldType: 'APR',\n    balance,\n    unclaimedRewards,\n    poolWallets,\n    stakeWalletAddress: toBase64Address(stakeWallet.address, true),\n    tokenAmount: 0n,\n    tvl,\n    dailyReward,\n    period: periodConfig.period,\n  };\n\n  return state;\n}\n\nasync function buildEthenaState(options: StakingStateOptions): Promise<ApiEthenaStakingState> {\n  const {\n    network, balances, address: walletAddress,\n    commonData, commonData: { ethena: { apy, apyVerified } },\n    backendState: { ethena: { isVerified } },\n  } = options;\n\n  const rate = network === 'testnet' ? 1 : commonData.ethena.rate;\n\n  const tonClient = getTonClient(network);\n  const tsUsdeWalletAddress = await resolveTokenWalletAddress(network, walletAddress, TON_TSUSDE.tokenAddress);\n  const tsUsdeWallet = tonClient.open(TsUSDeWallet.createFromAddress(Address.parse(tsUsdeWalletAddress)));\n  const { lockedUsdeBalance, unlockTime } = await tsUsdeWallet.getTimeLockData();\n\n  const tokenBalance = balances[TON_TSUSDE.slug] ?? 0n;\n  const balance = bigintMultiplyToNumber(tokenBalance, rate);\n\n  const state: ApiEthenaStakingState = {\n    id: 'ethena',\n    type: 'ethena',\n    tokenSlug: TON_USDE.slug,\n    yieldType: 'APY',\n    annualYield: isVerified ? apyVerified : apy,\n    annualYieldStandard: apy,\n    annualYieldVerified: apyVerified,\n    balance,\n    pool: ETHENA_STAKING_VAULT,\n    tokenBalance,\n    unstakeRequestAmount: lockedUsdeBalance,\n    unlockTime: unlockTime && lockedUsdeBalance ? unlockTime * 1000 : undefined,\n    tsUsdeWalletAddress,\n  };\n\n  // If the user never passed verification and has no active USDe staking, we should optimistically show the high APY.\n  if (isVerified === undefined && !getIsActiveStakingState(state)) {\n    state.annualYield = apyVerified;\n  }\n\n  return state;\n}\n\nfunction getLiquidStakingTimeRange(commonData: ApiStakingCommonData) {\n  const { prevRound, round: currentRound } = commonData;\n  const now = Date.now();\n  const gracePeriod = UNSTAKE_TON_GRACE_PERIOD;\n\n  const round = (\n    // Show date of next unlock plus few minutes\n    // (except when grace period is active and payout has already occurred  i.e. collection has disappeared).\n    (now > prevRound.unlock && now < prevRound.unlock + gracePeriod && !commonData.liquid.collection)\n    || now >= prevRound.unlock + gracePeriod\n  ) ? currentRound : prevRound;\n\n  return {\n    start: round.start,\n    end: round.unlock + gracePeriod,\n  };\n}\n\nexport async function getBackendStakingState(accountId: string): Promise<ApiBackendStakingState> {\n  const account = await fetchStoredTonAccount(accountId);\n  const state = await fetchBackendStakingState(account.ton.address, account.type === 'view');\n  return {\n    ...state,\n    nominatorsPool: {\n      ...state.nominatorsPool,\n      start: state.nominatorsPool.start * 1000,\n      end: state.nominatorsPool.end * 1000,\n    },\n  };\n}\n\nexport async function fetchBackendStakingState(address: string, isViewOnly: boolean): Promise<ApiBackendStakingState> {\n  const clientId = await getClientId();\n  const stakingState = await callBackendGet(`/staking/state/${address}`, {\n    isViewMode: isViewOnly ? 1 : undefined,\n  }, {\n    'X-App-ClientID': clientId,\n  });\n\n  stakingState.balance = fromDecimal(stakingState.balance);\n  stakingState.totalProfit = fromDecimal(stakingState.totalProfit);\n\n  if (!isKnownStakingPool(stakingState.nominatorsPool.address)) {\n    throw Error('Unexpected pool address, likely a malicious activity');\n  }\n\n  return stakingState;\n}\n\nexport function submitTokenStakingClaim(\n  accountId: string,\n  password: string,\n  state: ApiJettonStakingState,\n) {\n  return submitTransfer({\n    accountId,\n    password,\n    toAddress: state.stakeWalletAddress,\n    amount: TON_GAS.claimJettons,\n    data: buildJettonClaimPayload(state.poolWallets!),\n  });\n}\n\nexport async function submitUnstakeEthenaLocked(\n  accountId: string,\n  password: string,\n  state: ApiEthenaStakingState,\n) {\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  const result = await submitTransfer({\n    accountId,\n    password,\n    toAddress: state.tsUsdeWalletAddress,\n    amount: TON_GAS.unstakeEthenaLocked,\n    data: TsUSDeWallet.transferTimelockedMessage({\n      jettonAmount: state.unstakeRequestAmount,\n      to: Address.parse(TON_TSUSDE.tokenAddress),\n      responseAddress: Address.parse(address),\n      forwardTonAmount: TON_GAS.unstakeEthenaLockedForward,\n    }),\n  });\n\n  if (!('error' in result)) {\n    result.localActivityParams = {\n      type: 'unstake',\n      amount: state.unstakeRequestAmount,\n      isIncoming: true,\n      slug: TON_USDE.slug,\n      fromAddress: ETHENA_STAKING_VAULT,\n      toAddress: address,\n    };\n  }\n\n  return result;\n}\n","import type { ApiStakingState, ApiStakingType } from '../../api/types';\n\nimport {\n  ETHENA_STAKING_MIN_AMOUNT,\n  MIN_ACTIVE_STAKING_REWARDS,\n  NOMINATORS_STAKING_MIN_AMOUNT,\n  STAKING_MIN_AMOUNT,\n} from '../../config';\n\nexport function getStakingMinAmount(type?: ApiStakingType) {\n  switch (type) {\n    case 'nominators':\n      return NOMINATORS_STAKING_MIN_AMOUNT;\n    case 'ethena':\n      return ETHENA_STAKING_MIN_AMOUNT;\n    default:\n      return STAKING_MIN_AMOUNT;\n  }\n}\n\nexport function getUnstakeTime(state?: ApiStakingState) {\n  switch (state?.type) {\n    case 'nominators':\n    case 'liquid':\n      return state.end;\n    case 'ethena':\n      return state.unlockTime;\n    default:\n      return undefined;\n  }\n}\n\nexport function getStakingTitle(stakingType?: ApiStakingState['type']) {\n  return stakingType === 'ethena' ? 'How does it work?' : 'Why this is safe';\n}\n\nexport type StakingStateStatus = 'inactive' | 'active' | 'unstakeRequested' | 'readyToClaim';\n\nexport function getStakingStateStatus(state: ApiStakingState): StakingStateStatus {\n  if (state.unstakeRequestAmount) {\n    if (state.type === 'ethena' && state.unlockTime && state.unlockTime <= Date.now()) {\n      return 'readyToClaim';\n    }\n\n    return 'unstakeRequested';\n  }\n  if (getIsActiveStakingState(state)) {\n    return 'active';\n  }\n  return 'inactive';\n}\n\nexport function getIsActiveStakingState(state: ApiStakingState) {\n  return Boolean(\n    state.balance\n    || state.unstakeRequestAmount\n    || ('unclaimedRewards' in state && state.unclaimedRewards > MIN_ACTIVE_STAKING_REWARDS),\n  );\n}\n\nexport function getIsLongUnstake(state: ApiStakingState, amount?: bigint): boolean | undefined {\n  switch (state.type) {\n    case 'nominators': {\n      return true;\n    }\n    case 'liquid': {\n      return amount === undefined ? false : amount > state.instantAvailable;\n    }\n    case 'jetton': {\n      return false;\n    }\n    case 'ethena': {\n      return true;\n    }\n  }\n\n  return undefined;\n}\n\nexport function getFullStakingBalance(state: ApiStakingState): bigint {\n  switch (state.type) {\n    case 'jetton': {\n      return state.balance + state.unclaimedRewards;\n    }\n    case 'ethena': {\n      return state.balance + state.unstakeRequestAmount;\n    }\n  }\n\n  return state.balance;\n}\n","import { DAYS_IN_YEAR } from '../../api/constants';\nimport { toBig } from '../decimals';\n\nexport default function calcJettonStakingApr({\n  tvl, dailyReward, decimals,\n}: {\n  tvl: bigint;\n  dailyReward: bigint;\n  decimals: number;\n}) {\n  if (!tvl) {\n    return 0;\n  }\n\n  const apr = toBig(dailyReward, decimals)\n    .div(toBig(tvl, decimals))\n    .mul(DAYS_IN_YEAR)\n    .mul(100)\n    .toFixed(2);\n\n  return Number(apr);\n}\n","import { Builder, Cell } from '@ton/core';\n\nimport type { ApiNetwork } from '../../types';\n\nimport { getTonClient } from './util/tonCore';\n\nexport function packPayloadToBoc(payload: string | Uint8Array) {\n  let cell = new Cell();\n  if (payload) {\n    if (payload instanceof Cell) {\n      cell = payload;\n    } else if (typeof payload === 'string') {\n      if (payload.length > 0) {\n        cell = new Builder()\n          .storeUint(0, 32)\n          .storeStringTail(payload)\n          .asCell();\n      }\n    } else {\n      cell = new Builder()\n        .storeBuffer(Buffer.from(payload))\n        .asCell();\n    }\n  }\n  return cell.toBoc().toString('base64');\n}\n\nexport async function checkApiAvailability(network: ApiNetwork) {\n  try {\n    await getTonClient(network).getMasterchainInfo();\n    return true;\n  } catch (err: any) {\n    return false;\n  }\n}\n","import type {\n  ApiNetwork,\n  ApiSwapBuildRequest,\n  ApiTokensTransferPayload,\n} from '../../types';\nimport type { TonTransferParams } from './types';\n\nimport { DIESEL_ADDRESS, SWAP_FEE_ADDRESS, TONCOIN } from '../../../config';\nimport { assert as originalAssert } from '../../../util/assert';\nimport { fromDecimal } from '../../../util/decimals';\nimport { isTokenTransferPayload } from '../../../util/ton/transfer';\nimport { parsePayloadBase64 } from './util/metadata';\nimport { resolveTokenWalletAddress, toBase64Address } from './util/tonCore';\nimport { getTokenByAddress } from '../../common/tokens';\nimport { getContractInfo } from './wallet';\n\nconst FEE_ADDRESSES = [SWAP_FEE_ADDRESS, DIESEL_ADDRESS];\nconst MAX_NETWORK_FEE = 1000000000n; // 1 TON\n\nexport async function validateDexSwapTransfers(\n  network: ApiNetwork,\n  address: string,\n  request: ApiSwapBuildRequest,\n  transfers: TonTransferParams[],\n) {\n  const assert = (condition: boolean, message: string) => {\n    originalAssert(condition, message, {\n      network, address, request, transfers,\n    });\n  };\n\n  assert(transfers.length <= 2, 'Too many transfers');\n\n  const [mainTransfer, feeTransfer] = transfers;\n\n  if (request.from === TONCOIN.symbol) {\n    const maxAmount = fromDecimal(request.fromAmount) + fromDecimal(request.ourFee) + MAX_NETWORK_FEE;\n    const { isSwapAllowed, codeHash } = await getContractInfo(network, mainTransfer.toAddress);\n\n    assert(!!isSwapAllowed, `Not allowed swap contract: ${codeHash}`);\n    assert(mainTransfer.amount <= maxAmount, 'Main transfer amount is too big');\n\n    if (feeTransfer) {\n      assert(feeTransfer.amount <= mainTransfer.amount, 'Fee transfer amount is too big');\n      assert(feeTransfer.amount + mainTransfer.amount < maxAmount, 'Total amount is too big');\n      assert(FEE_ADDRESSES.includes(toBase64Address(feeTransfer.toAddress, false)), 'Unexpected fee transfer address');\n    }\n  } else {\n    const token = getTokenByAddress(request.from);\n    assert(!!token, 'Unknown \"from\" token');\n\n    const maxAmount = fromDecimal(request.fromAmount, token.decimals)\n      + fromDecimal(request.ourFee ?? 0, token.decimals)\n      + fromDecimal(request.dieselFee ?? 0, token.decimals);\n    const maxTonAmount = MAX_NETWORK_FEE;\n\n    const walletAddress = await resolveTokenWalletAddress(network, address, token.tokenAddress!);\n    const parsedPayload = await parsePayloadBase64(network, mainTransfer.toAddress, mainTransfer.payload as string);\n\n    assert(mainTransfer.toAddress === walletAddress, 'Main transfer address is not the token wallet address');\n    assert(isTokenTransferPayload(parsedPayload), 'Main transfer payload is not a token transfer');\n\n    const { amount: tokenAmount, destination } = parsedPayload as ApiTokensTransferPayload;\n    assert(tokenAmount <= maxAmount, 'Main transfer token amount is too big');\n\n    assert(mainTransfer.amount < maxTonAmount, 'Main transfer TON amount is too big');\n\n    const { isSwapAllowed } = await getContractInfo(network, destination);\n\n    assert(!!isSwapAllowed, 'Main transfer destination is not a swap smart contract');\n\n    if (feeTransfer) {\n      const feePayload = await parsePayloadBase64(network, feeTransfer.toAddress, feeTransfer.payload as string);\n\n      assert(feeTransfer.amount + mainTransfer.amount < maxTonAmount, 'Total TON amount is too big');\n      assert(feeTransfer.toAddress === walletAddress, 'Fee transfer address is not the token wallet address');\n      assert(isTokenTransferPayload(feePayload), 'Fee transfer payload is not a token transfer');\n\n      const { amount: tokenFeeAmount, destination: feeDestination } = feePayload as ApiTokensTransferPayload;\n\n      assert(tokenAmount + tokenFeeAmount <= maxAmount, 'Total token amount is too big');\n      assert(FEE_ADDRESSES.includes(toBase64Address(feeDestination, false)), 'Unexpected fee transfer destination');\n    }\n  }\n}\n","import type { ApiActivity, ApiSwapActivity, ApiSwapHistoryItem } from '../types';\n\nimport { SWAP_API_VERSION, SWAP_CROSSCHAIN_SLUGS, TONCOIN } from '../../config';\nimport { parseAccountId } from '../../util/account';\nimport { buildBackendSwapId, getActivityTokenSlugs, parseTxId } from '../../util/activities';\nimport { compareActivities } from '../../util/compareActivities';\nimport { logDebugError } from '../../util/logs';\nimport { fetchStoredAccount } from './accounts';\nimport { callBackendGet, callBackendPost } from './backend';\nimport { buildTokenSlug, getTokenByAddress, getTokenBySlug } from './tokens';\n\nexport function swapGetHistory(address: string, params: {\n  fromTimestamp?: number;\n  toTimestamp?: number;\n  status?: ApiSwapHistoryItem['status'];\n  isCex?: boolean;\n  asset?: string;\n  hashes?: string[];\n}): Promise<ApiSwapHistoryItem[]> {\n  return callBackendPost(`/swap/history/${address}`, {\n    ...params,\n    swapVersion: SWAP_API_VERSION,\n  });\n}\n\nexport function swapGetHistoryItem(address: string, id: string): Promise<ApiSwapHistoryItem> {\n  return callBackendGet(`/swap/history/${address}/${id}`, {\n    swapVersion: SWAP_API_VERSION,\n  });\n}\n\nexport function swapItemToActivity(swap: ApiSwapHistoryItem): ApiSwapActivity {\n  return {\n    ...swap,\n    id: buildBackendSwapId(swap.id),\n    kind: 'swap',\n    from: getSwapItemSlug(swap, swap.from),\n    to: getSwapItemSlug(swap, swap.to),\n    shouldLoadDetails: !swap.cex,\n  };\n}\n\nexport function getSwapItemSlug(item: ApiSwapHistoryItem, asset: string) {\n  if (asset === TONCOIN.symbol) {\n    return TONCOIN.slug;\n  }\n  if (item.cex) {\n    return getTokenByAddress(asset)?.slug ?? asset;\n  }\n  return buildTokenSlug('ton', asset);\n}\n\nexport async function patchSwapItem(options: {\n  address: string;\n  swapId: string;\n  authToken: string;\n  msgHash?: string;\n  error?: string;\n}) {\n  const {\n    address, swapId, authToken, msgHash, error,\n  } = options;\n  await callBackendPost(`/swap/history/${address}/${swapId}/update`, {\n    swapVersion: SWAP_API_VERSION,\n    msgHash,\n    error,\n  }, {\n    method: 'PATCH',\n    authToken,\n  });\n}\n\nexport async function swapReplaceCexActivities(\n  accountId: string,\n  activities: ApiActivity[],\n  slug?: string,\n  isToNow?: boolean,\n): Promise<ApiActivity[]> {\n  if (!activities.length || parseAccountId(accountId).network === 'testnet' || !canHaveCexSwap(slug, activities)) {\n    return activities;\n  }\n\n  try {\n    const { ton: { address } = {} } = await fetchStoredAccount(accountId);\n    if (!address) {\n      return activities;\n    }\n\n    const firstTimestamp = activities[0].timestamp;\n    const lastTimestamp = activities[activities.length - 1].timestamp;\n\n    const [fromTime, toTime] = firstTimestamp < lastTimestamp\n      ? [firstTimestamp, isToNow ? Date.now() : lastTimestamp]\n      : [lastTimestamp, isToNow ? Date.now() : firstTimestamp];\n\n    const hashes = activities.map(({ id }) => parseTxId(id).hash);\n\n    const swaps = await swapGetHistory(address, {\n      fromTimestamp: fromTime,\n      toTimestamp: toTime,\n      asset: slug ? getTokenBySlug(slug).tokenAddress ?? TONCOIN.symbol : undefined,\n      hashes,\n      isCex: true,\n    });\n\n    if (!swaps.length) {\n      return activities;\n    }\n\n    const result: ApiActivity[] = [];\n    const allSwapHashes = new Set<string>();\n\n    for (const swap of swaps) {\n      swap.hashes.forEach((hash) => allSwapHashes.add(hash));\n\n      const isSwapHere = swap.timestamp > fromTime && swap.timestamp < toTime;\n      if (isSwapHere) {\n        result.push(swapItemToActivity(swap));\n      }\n    }\n\n    for (const activity of activities) {\n      if (activity.kind === 'transaction' && allSwapHashes.has(parseTxId(activity.id).hash)) {\n        result.push({ ...activity, shouldHide: true });\n      } else {\n        result.push(activity);\n      }\n    }\n\n    result.sort(compareActivities);\n\n    return result;\n  } catch (err) {\n    logDebugError('swapReplaceCexActivities', err);\n    return activities;\n  }\n}\n\nfunction canHaveCexSwap(slug: string | undefined, activities: ApiActivity[]): boolean {\n  if (slug) {\n    return SWAP_CROSSCHAIN_SLUGS.has(slug);\n  }\n\n  return activities.some((activity) => {\n    return getActivityTokenSlugs(activity).some((slug) => {\n      return SWAP_CROSSCHAIN_SLUGS.has(slug);\n    });\n  });\n}\n","import type { ApiActivity, ApiNetwork } from '../types';\n\nimport { parseAccountId } from '../../util/account';\nimport { buildCollectionByKey, findDifference, split } from '../../util/iteratees';\nimport { logDebug, logDebugError } from '../../util/logs';\nimport { pause } from '../../util/schedulers';\nimport { fetchActions, parseActionActivityId } from '../chains/ton/toncenter';\nimport { SEC } from '../constants';\nimport { fetchStoredTonWallet } from './accounts';\nimport { swapReplaceCexActivities } from './swap';\n\nconst RELOAD_ACTIVITIES_ATTEMPTS = 4;\nconst RELOAD_ACTIVITIES_PAUSE = SEC;\nconst FETCH_ACTIONS_BATCH_SIZE = 100;\n\n/** Enriches the activities with missing metadata and CEX swap activities */\nexport async function enrichActivities(\n  accountId: string,\n  activities: ApiActivity[],\n  tokenSlug?: string,\n  isToNow?: boolean,\n) {\n  try {\n    activities = await reloadIncompleteActivities(accountId, activities);\n    activities = await swapReplaceCexActivities(accountId, activities, tokenSlug, isToNow);\n  } catch (err) {\n    logDebugError('enrichActivities', err);\n  }\n\n  return activities;\n}\n\nasync function reloadIncompleteActivities(accountId: string, activities: ApiActivity[]) {\n  try {\n    const { network } = parseAccountId(accountId);\n    const { address } = await fetchStoredTonWallet(accountId);\n\n    let actionIdsToReload = activities\n      .filter((activity) => activity.shouldReload)\n      .map((activity) => parseActionActivityId(activity.id).actionId);\n\n    for (let attempt = 0; attempt < RELOAD_ACTIVITIES_ATTEMPTS && actionIdsToReload.length; attempt++) {\n      logDebug(`Reload incomplete activities #${attempt + 1}`, actionIdsToReload);\n      await pause(RELOAD_ACTIVITIES_PAUSE);\n\n      ({ activities, actionIdsToReload } = await tryReloadIncompleteActivities(\n        network,\n        address,\n        activities,\n        actionIdsToReload,\n      ));\n    }\n  } catch (err) {\n    logDebugError('reloadIncompleteActivities', err);\n  }\n\n  return activities;\n}\n\nasync function tryReloadIncompleteActivities(\n  network: ApiNetwork,\n  address: string,\n  activities: ApiActivity[],\n  actionIdsToReload: string[],\n) {\n  const actionIdBatches = split(actionIdsToReload, FETCH_ACTIONS_BATCH_SIZE);\n\n  const batchResults = await Promise.all(actionIdBatches.map(async (actionIds) => {\n    const reloadedActivities = await fetchActions({\n      network,\n      filter: { actionId: actionIds },\n      walletAddress: address,\n      limit: FETCH_ACTIONS_BATCH_SIZE,\n    });\n    return reloadedActivities.filter((activity) => !activity.shouldReload);\n  }));\n\n  const reloadedActivities = batchResults.flat();\n\n  if (reloadedActivities.length) {\n    const replaceById = buildCollectionByKey(reloadedActivities, 'id');\n    const reloadedActionIds = reloadedActivities.map((activity) => parseActionActivityId(activity.id).actionId);\n\n    activities = activities.map((activity) => replaceById[activity.id] ?? activity);\n    actionIdsToReload = findDifference(actionIdsToReload, reloadedActionIds);\n  }\n\n  return { activities, actionIdsToReload };\n}\n","import type { InMessageCallback } from '../../util/reconnectingWebsocket';\nimport type {\n  ApiChain,\n  ApiClientSocketMessage,\n  ApiNetwork,\n  ApiNewActivitySocketMessage,\n  ApiServerSocketMessage,\n  ApiSocketEventType,\n  ApiSubscribedSocketMessage,\n} from '../types';\n\nimport { BRILLIANT_API_BASE_URL } from '../../config';\nimport ReconnectingWebSocket from '../../util/reconnectingWebsocket';\nimport safeExec from '../../util/safeExec';\nimport { throttle } from '../../util/schedulers';\nimport { addBackendHeadersToSocketUrl } from './backend';\nimport { getBackendConfigCache } from './cache';\n\nconst ACTUALIZATION_DELAY = 10;\n\ninterface WatchedWallet {\n  chain: ApiChain;\n  events: ApiSocketEventType[];\n  address: string;\n}\n\nexport interface WalletWatcher {\n  /** Whether the socket is connected and subscribed to the given wallets */\n  readonly isConnected: boolean;\n  /** Removes the watcher and cleans the memory */\n  destroy(): void;\n}\n\ninterface WalletWatcherInternal extends WalletWatcher {\n  id: number;\n  wallets: WatchedWallet[];\n  isConnected: boolean;\n  /**\n   * Called when a new activity arrives into one of the listened address.\n   * In this context activity is any confirmed wallet change.\n   * Called only for wallets with an `activity` event.\n   *\n   * Called only when isConnected is true. Therefore, when the socket reconnects, the users should synchronize,\n   * otherwise the activity happening during the reconnect will miss.\n   */\n  onNewActivity?: NewActivityCallback;\n  /** Called when isConnected turns true */\n  onConnect?: NoneToVoidFunction;\n  /** Called when isConnected turns false */\n  onDisconnect?: NoneToVoidFunction;\n}\n\nexport type NewActivityCallback = (wallet: WatchedWallet) => void;\n\n/**\n * Connects to the MTW backend to passively listen to updates.\n */\nclass BackendSocket {\n  #network: ApiNetwork;\n\n  /** Defined only when the socket it needed (i.e. somebody wants to watch something) */\n  #socket?: ReconnectingWebSocket<ApiClientSocketMessage, ApiServerSocketMessage>;\n\n  #walletWatchers: WalletWatcherInternal[] = [];\n\n  /**\n   * A shared incremental counter for various unique ids. The fact that it's incremental is used to tell what actions\n   * happened earlier or later than others.\n   */\n  #currentUniqueId = 0;\n\n  constructor(network: ApiNetwork) {\n    this.#network = network;\n  }\n\n  public watchWallets(\n    wallets: WatchedWallet[],\n    {\n      onNewActivity,\n      onConnect,\n      onDisconnect,\n    }: Pick<WalletWatcherInternal, 'onNewActivity' | 'onConnect' | 'onDisconnect'> = {},\n  ): WalletWatcher {\n    const id = this.#currentUniqueId++;\n    const watcher: WalletWatcherInternal = {\n      id,\n      wallets,\n      isConnected: false,\n      onNewActivity,\n      onConnect,\n      onDisconnect,\n      destroy: this.#destroyWalletWatcher.bind(this, id),\n    };\n    this.#walletWatchers.push(watcher);\n    this.#actualizeSocket();\n    return watcher;\n  }\n\n  /** Removes the given watcher and unsubscribes from its wallets. Brings the sockets to the proper state. */\n  #destroyWalletWatcher(watcherId: number) {\n    const index = this.#walletWatchers.findIndex((watcher) => watcher.id === watcherId);\n    if (index >= 0) {\n      this.#walletWatchers.splice(index, 1);\n      this.#actualizeSocket();\n    }\n  }\n\n  /**\n   * Creates or destroys the given socket (if needed) and subscribes to the watched wallets.\n   *\n   * The method is throttled in order to:\n   *  - Avoid sending too many requests when the watched addresses change many times in a short time range.\n   *  - Avoid reconnecting the socket when watched addresses arrive shortly after stopping watching all addresses.\n   */\n  #actualizeSocket = throttle(async () => {\n    const { isWebSocketEnabled } = await getBackendConfigCache();\n\n    if (isWebSocketEnabled && this.#doesHaveWatchedAddresses()) {\n      this.#socket ??= this.#createSocket();\n      if (this.#socket.isConnected) {\n        this.#sendWatchedWalletsToSocket();\n      } // Otherwise, the addresses will be sent when the socket gets connected\n    } else {\n      this.#socket?.close();\n      this.#socket = undefined;\n    }\n  }, ACTUALIZATION_DELAY, false);\n\n  #createSocket() {\n    const url = getSocketUrl(this.#network);\n    const socket = new ReconnectingWebSocket<ApiClientSocketMessage, ApiServerSocketMessage>(url);\n    socket.onMessage(this.#handleSocketMessage);\n    socket.onConnect(this.#handleSocketConnect);\n    socket.onDisconnect(this.#handleSocketDisconnect);\n    return socket;\n  }\n\n  #handleSocketMessage: InMessageCallback<ApiServerSocketMessage> = (message) => {\n    switch (message.type) {\n      case 'subscribed':\n        this.#handleSubscribed(message);\n        break;\n      case 'newActivity':\n        this.#handleNewActivity(message);\n        break;\n    }\n  };\n\n  #handleSocketConnect = () => {\n    this.#sendWatchedWalletsToSocket();\n  };\n\n  #handleSocketDisconnect = () => {\n    for (const watcher of this.#walletWatchers) {\n      if (watcher.isConnected) {\n        watcher.isConnected = false;\n        if (watcher.onDisconnect) safeExec(watcher.onDisconnect);\n      }\n    }\n  };\n\n  #handleSubscribed(message: ApiSubscribedSocketMessage) {\n    for (const watcher of this.#walletWatchers) {\n      // If message id < watcher id, then the watcher was created after the subscribe request was sent, therefore\n      // the socket may be not subscribed to all the watcher addresses yet.\n      if (message.id < watcher.id) {\n        continue;\n      }\n\n      if (!watcher.isConnected) {\n        watcher.isConnected = true;\n        if (watcher.onConnect) safeExec(watcher.onConnect);\n      }\n    }\n  }\n\n  #handleNewActivity(message: ApiNewActivitySocketMessage) {\n    const messageAddresses = new Set(message.addresses);\n\n    for (const { wallets, isConnected, onNewActivity } of this.#walletWatchers) {\n      // Even though the socket may already listen to some wallet addresses, we promise the class users to trigger the\n      // onNewActivity callback only in the connected state.\n      if (!isConnected || !onNewActivity) {\n        continue;\n      }\n\n      for (const wallet of wallets) {\n        const doesWalletMatch = (\n          wallet.chain === message.chain\n          && messageAddresses.has(wallet.address)\n          && wallet.events.includes('activity')\n        );\n\n        if (doesWalletMatch) {\n          safeExec(() => onNewActivity(wallet));\n        }\n      }\n    }\n  }\n\n  #sendWatchedWalletsToSocket() {\n    // It's necessary to collect the watched addresses synchronously with locking the request id.\n    // It makes sure that all the watchers with ids < the response id will be subscribed.\n    const addresses = this.#getWatchedAddresses(['activity']);\n    const requestId = this.#currentUniqueId++;\n\n    this.#socket!.send({\n      type: 'subscribe',\n      id: requestId,\n      addresses: addresses.map((address) => ({\n        ...address,\n        events: ['activity'],\n      })),\n    });\n  }\n\n  #doesHaveWatchedAddresses() {\n    return this.#walletWatchers.some((watcher) => watcher.wallets.length);\n  }\n\n  /** Collects the addresses (grouped by chain) from the current watchers */\n  #getWatchedAddresses(events: ApiSocketEventType[]) {\n    const addresses: { chain: ApiChain; address: string }[] = [];\n\n    for (const watcher of this.#walletWatchers) {\n      for (const wallet of watcher.wallets) {\n        if (!wallet.events.some((event) => events.includes(event))) {\n          continue;\n        }\n\n        addresses.push({\n          chain: wallet.chain,\n          address: wallet.address,\n        });\n      }\n    }\n\n    return addresses;\n  }\n}\n\nfunction getSocketUrl(network: ApiNetwork) {\n  const url = new URL(BRILLIANT_API_BASE_URL);\n  url.protocol = url.protocol === 'http' ? 'ws' : 'wss';\n  url.pathname += `${network === 'testnet' ? 'testnet/' : ''}ws`;\n  addBackendHeadersToSocketUrl(url);\n  return url;\n}\n\nconst backendSockets: Partial<Record<ApiNetwork, BackendSocket>> = {};\n\n/** Returns a singleton (one constant instance per a network) */\nexport function getBackendSocket(network: ApiNetwork) {\n  backendSockets[network] ??= new BackendSocket(network);\n  return backendSockets[network];\n}\n\nexport type { BackendSocket };\n","import type { ApiChain, ApiNetwork } from '../../types';\nimport type { WalletWatcher } from '../backendSocket';\nimport type { Period } from './utils';\n\nimport { focusAwareDelay } from '../../../util/focusAwareDelay';\nimport { pause, throttle } from '../../../util/schedulers';\nimport { getBackendSocket } from '../backendSocket';\nimport { FallbackPollingScheduler } from './fallbackPollingScheduler';\nimport { periodToMs } from './utils';\n\nconst UPDATE_CALLBACK_DELAY = 10;\n\nexport interface WalletPollingOptions {\n  chain: ApiChain;\n  network: ApiNetwork;\n  address: string;\n  /** Whether an update should be triggerred when the polling object is created */\n  updateOnStart?: boolean;\n  /** The minimum delay between `onUpdate` calls */\n  minUpdateDelay: Period;\n  /**\n   * How much time the fallback polling will start after the socket disconnects.\n   * Also applies at the very beginning (until the socket is connected).\n   */\n  fallbackUpdateStartDelay: number;\n  /** Update periods when the socket is disconnected */\n  fallbackUpdatePeriod: Period;\n  /** Update periods when the socket is connected but there is no new activity coming */\n  forceUpdatePeriod: Period;\n  /**\n   * Called whenever the wallet data should be updated.\n   * The polling always waits until the returned promise resolves before running this callback again.\n   *\n   * @param isConfident `true` when the update was reported by the socket. `false` when the update is initiated by a\n   *  timer. If `false`, the app should check a piece of wallet before refreshing the whole data (to avoid excessive\n   *  network requests).\n   */\n  onUpdate(isConfident: boolean): MaybePromise<unknown>;\n}\n\n/**\n * Helps polling wallet balance and activity. Uses the backend websocket as the primary signal source and falls back\n * to simple time intervals if the websocket is unavailable. It doesn't provide the updated data, it provides signals\n * when the data should be fetched using the plain HTTP API.\n */\nexport class WalletPolling {\n  #options: WalletPollingOptions;\n\n  #walletWatcher: WalletWatcher;\n\n  #fallbackPollingScheduler: FallbackPollingScheduler;\n\n  #isDestroyed = false;\n\n  /** Undefined when no update is pending. Otherwise, holds the `isConfident` value (see `onUpdate` for more details) */\n  #pendingUpdate?: boolean;\n\n  constructor(options: WalletPollingOptions) {\n    this.#options = options;\n\n    this.#walletWatcher = getBackendSocket(options.network).watchWallets(\n      [{\n        chain: options.chain,\n        events: ['activity'],\n        address: options.address,\n      }],\n      {\n        onNewActivity: this.#handleSocketNewActivity,\n        onConnect: this.#handleSocketConnect,\n        onDisconnect: this.#handleSocketDisconnect,\n      },\n    );\n\n    this.#fallbackPollingScheduler = new FallbackPollingScheduler(this.#walletWatcher.isConnected, {\n      pollOnStart: options.updateOnStart,\n      minPollDelay: options.minUpdateDelay,\n      pollingStartDelay: options.fallbackUpdateStartDelay,\n      pollingPeriod: options.fallbackUpdatePeriod,\n      forcedPollingPeriod: options.forceUpdatePeriod,\n      poll: this.#triggerBackupNotifications,\n    });\n  }\n\n  public destroy() {\n    this.#isDestroyed = true;\n    this.#walletWatcher.destroy();\n    this.#fallbackPollingScheduler.destroy();\n  }\n\n  #handleSocketNewActivity = () => {\n    this.#pendingUpdate = true;\n    this.#runUpdateCallback();\n    this.#fallbackPollingScheduler.onSocketMessage();\n  };\n\n  #handleSocketConnect = () => {\n    this.#triggerBackupNotifications();\n    this.#fallbackPollingScheduler.onSocketConnect();\n  };\n\n  #handleSocketDisconnect = () => {\n    this.#fallbackPollingScheduler.onSocketDisconnect();\n  };\n\n  #triggerBackupNotifications = () => {\n    this.#pendingUpdate ??= false;\n    this.#runUpdateCallback();\n  };\n\n  #runUpdateCallback = throttle(async () => {\n    if (this.#pendingUpdate === undefined) {\n      return;\n    }\n\n    // To let sneak in the updates arriving in short-time batches. Otherwise, they will cause another onUpdate call.\n    await pause(UPDATE_CALLBACK_DELAY);\n    if (this.#isDestroyed) return;\n\n    const isConfident = this.#pendingUpdate;\n    this.#pendingUpdate = undefined;\n    await this.#options.onUpdate(isConfident);\n  }, () => {\n    const [ms, forceMs] = periodToMs(this.#options.minUpdateDelay);\n    return focusAwareDelay(\n      ms - UPDATE_CALLBACK_DELAY,\n      forceMs - UPDATE_CALLBACK_DELAY,\n    );\n  });\n}\n","import type { ApiTransactionActivity } from '../types';\n\nimport { createCallbackManager } from '../../util/callbacks';\n\nexport const txCallbacks = createCallbackManager();\n\nexport function whenTxComplete(normalizedAddress: string, amount: bigint) {\n  return new Promise<{ result: boolean; transaction: ApiTransactionActivity }>((resolve) => {\n    txCallbacks.addCallback(\n      function callback(transaction: ApiTransactionActivity) {\n        if (transaction.normalizedAddress === normalizedAddress && transaction.amount === -amount) {\n          txCallbacks.removeCallback(callback);\n          resolve({ result: true, transaction });\n        }\n      },\n    );\n  });\n}\n","type OnSwitch = (isOn: boolean) => void;\n\n/**\n * A virtual multi-input OR gate (https://en.wikipedia.org/wiki/OR_gate).\n * Triggers the callback when the gate output changes.\n */\nexport class OrGate<T> {\n  #enabledItems = new Set<T>();\n  #onSwitch: OnSwitch;\n\n  constructor(onSwitch: OnSwitch) {\n    this.#onSwitch = onSwitch;\n  }\n\n  get isOn() {\n    return this.#enabledItems.size > 0;\n  }\n\n  on(item: T) {\n    this.toggle(item, true);\n  }\n\n  off(item: T) {\n    this.toggle(item, false);\n  }\n\n  toggle(item: T, isItemOn: boolean) {\n    const prevIsOn = this.isOn;\n    this.#enabledItems[isItemOn ? 'add' : 'delete'](item);\n    const nextIsOn = this.isOn;\n\n    if (prevIsOn !== nextIsOn) {\n      this.#onSwitch(nextIsOn);\n    }\n  }\n}\n","import type { ApiActivity } from '../../types';\nimport type { ActivityStream, OnActivityUpdate, OnLoadingChange } from './toncenter';\n\nimport { createCallbackManager } from '../../../util/callbacks';\nimport { compareActivities } from '../../../util/compareActivities';\nimport { areSortedArraysEqual, extractKey } from '../../../util/iteratees';\nimport { OrGate } from '../../../util/orGate';\nimport { throttle } from '../../../util/schedulers';\nimport { enrichActivities } from '../../common/activities';\n\n/**\n * Like `ActivityStream` but applies `enrichActivities` to the confirmed activities.\n *\n * @see enrichActivities\n */\nexport class RichActivityStream {\n  #accountId: string;\n\n  /** Sorted by timestamp descending */\n  #confirmedActivitiesToReport: ApiActivity[] = [];\n\n  #pendingActivities = managePendingActivities();\n\n  #isLoading = new OrGate<'raw' | 'enrich'>((isLoading) => this.#loadingListeners.runCallbacks(isLoading));\n\n  #updateListeners = createCallbackManager<OnActivityUpdate>();\n  #triggerUpdateListeners = deduplicateActivityUpdates(this.#updateListeners.runCallbacks);\n  #loadingListeners = createCallbackManager<OnLoadingChange>();\n\n  #isDestroyed = false;\n\n  #onDestroy: NoneToVoidFunction[];\n\n  constructor(\n    accountId: string,\n    rawActivityStream: ActivityStream,\n  ) {\n    this.#accountId = accountId;\n\n    this.#onDestroy = [\n      rawActivityStream.onUpdate(this.#handleRawActivitiesUpdate),\n      rawActivityStream.onLoadingChange((isLoading) => this.#isLoading.toggle('raw', isLoading)),\n    ];\n  }\n\n  /**\n   * Registers a callback firing then new activities arrive.\n   * The callback is throttled under the hood.\n   */\n  public onUpdate(callback: OnActivityUpdate) {\n    return this.#updateListeners.addCallback(callback);\n  }\n\n  /**\n   * Registers a callback firing when the data from HTTP endpoints starts of finishes loading.\n   * The \"loading\" state includes the time when `rawActivityStream` is polling.\n   */\n  public onLoadingChange(callback: OnLoadingChange) {\n    return this.#loadingListeners.addCallback(callback);\n  }\n\n  public destroy() {\n    this.#isDestroyed = true;\n\n    for (const unsubscribe of this.#onDestroy) {\n      unsubscribe();\n    }\n  }\n\n  #handleRawActivitiesUpdate: OnActivityUpdate = (confirmedActivities, pendingActivities) => {\n    this.#pendingActivities.updateAfterRawUpdate(confirmedActivities, pendingActivities);\n    this.#reportActivities([]);\n\n    if (confirmedActivities.length) {\n      this.#confirmedActivitiesToReport.unshift(...confirmedActivities);\n      this.#enrichAndReportActivities();\n    }\n  };\n\n  // Using `throttle` to batch the new activities and ensure that they are reported in the order they were received\n  #enrichAndReportActivities = throttle(async () => {\n    if (this.#isDestroyed) return;\n\n    try {\n      this.#isLoading.on('enrich');\n\n      const rawConfirmedActivities = this.#confirmedActivitiesToReport;\n      this.#confirmedActivitiesToReport = [];\n      const richConfirmedActivities = await enrichActivities(this.#accountId, rawConfirmedActivities, undefined, true);\n\n      this.#pendingActivities.updateAfterEnrichment(rawConfirmedActivities);\n      this.#reportActivities(richConfirmedActivities);\n    } finally {\n      this.#isLoading.off('enrich');\n    }\n  }, 0);\n\n  #reportActivities(confirmedActivities: ApiActivity[]) {\n    if (!this.#isDestroyed) {\n      this.#triggerUpdateListeners(confirmedActivities, this.#pendingActivities.all);\n    }\n  }\n}\n\n/**\n * Manages pending activities to ensure that switching activities from pending to confirmed is seamless.\n * If not used, the pending activities received from `ActivityStream` will disappear temporarily while the confirmed\n * activities are being enriched.\n */\nfunction managePendingActivities() {\n  /** The latest pending activities provided by `rawActivityStream` */\n  let pendingActivities: readonly ApiActivity[] = [];\n  /** Pending activities that no longer exist but their corresponding confirmed activities are being enriched */\n  let zombiePendingActivities: ApiActivity[] = [];\n\n  const updateAfterRawUpdate = (confirmedActivities: ApiActivity[], newPendingActivities: readonly ApiActivity[]) => {\n    const confirmedHashes = new Set(extractKey(confirmedActivities, 'externalMsgHashNorm'));\n\n    zombiePendingActivities = [\n      ...zombiePendingActivities,\n      ...pendingActivities.filter((activity) => confirmedHashes.has(activity.externalMsgHashNorm)),\n    ].sort(compareActivities);\n\n    pendingActivities = newPendingActivities;\n  };\n\n  const updateAfterEnrichment = (rawConfirmedActivities: ApiActivity[]) => {\n    const confirmedHashes = new Set(extractKey(rawConfirmedActivities, 'externalMsgHashNorm'));\n\n    zombiePendingActivities = zombiePendingActivities\n      .filter((activity) => !confirmedHashes.has(activity.externalMsgHashNorm));\n  };\n\n  return {\n    /** Sorted by timestamp descending */\n    get all() {\n      return [...pendingActivities, ...zombiePendingActivities].sort(compareActivities);\n    },\n    updateAfterRawUpdate,\n    updateAfterEnrichment,\n  };\n}\n\n/**\n * Makes sure the update callback is not called uselessly. For example, with no confirmed activities and with the\n * same pending activities.\n */\nfunction deduplicateActivityUpdates(onUpdate: OnActivityUpdate): OnActivityUpdate {\n  let lastPendingActivities: readonly ApiActivity[] = [];\n\n  return (newConfirmedActivities, pendingActivities) => {\n    if (newConfirmedActivities.length || !areSortedArraysEqual(lastPendingActivities, pendingActivities)) {\n      onUpdate(newConfirmedActivities, pendingActivities);\n    }\n\n    lastPendingActivities = pendingActivities;\n  };\n}\n","import type {\n  ApiAccountAny,\n  ApiActivity,\n  ApiActivityTimestamps,\n  ApiBalanceBySlug,\n  ApiNftUpdate,\n  ApiStakingState,\n  ApiTonWallet,\n  ApiUpdatingStatus,\n  ApiVestingInfo,\n  ApiWalletInfo,\n  OnApiUpdate,\n} from '../../types';\n\nimport {\n  IS_CORE_WALLET,\n  IS_STAKING_DISABLED,\n  LEDGER_WALLET_VERSIONS,\n  POPULAR_WALLET_VERSIONS,\n  TONCOIN,\n} from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { getActivityTokenSlugs } from '../../../util/activities';\nimport { areDeepEqual } from '../../../util/areDeepEqual';\nimport Deferred from '../../../util/Deferred';\nimport { focusAwareDelay } from '../../../util/focusAwareDelay';\nimport { compact, pick } from '../../../util/iteratees';\nimport { logDebugError } from '../../../util/logs';\nimport { createTaskQueue, pause, throttle } from '../../../util/schedulers';\nimport { fetchStoredAccount, fetchStoredTonWallet, updateStoredTonWallet } from '../../common/accounts';\nimport { enrichActivities } from '../../common/activities';\nimport { getBackendConfigCache, getStakingCommonCache } from '../../common/cache';\nimport { inactiveWalletTiming, periodToMs, pollingLoop, withDoubleCheck } from '../../common/polling/utils';\nimport { WalletPolling } from '../../common/polling/walletPolling';\nimport { txCallbacks } from '../../common/txCallbacks';\nimport { hexToBytes } from '../../common/utils';\nimport { FIRST_TRANSACTIONS_LIMIT, MINUTE, SEC } from '../../constants';\nimport { fetchActivitySlice } from './activities';\nimport { getWalletFromAddress } from './auth';\nimport { fetchDomains } from './domains';\nimport { getAccountNfts, getNftUpdates } from './nfts';\nimport { RichActivityStream } from './richActivityStream';\nimport { getBackendStakingState, getStakingStates } from './staking';\nimport { loadTokenBalances } from './tokens';\nimport { ActivityStream } from './toncenter';\nimport { fetchVestings } from './vesting';\nimport { getWalletInfo, getWalletVersionInfos, isAddressInitialized } from './wallet';\n\ntype OnUpdatingStatusChange = (kind: ApiUpdatingStatus['kind'], isUpdating: boolean) => void;\n\nconst POLL_DELAY_AFTER_SOCKET = 3 * SEC;\nconst POLL_MIN_INTERVAL = { focused: 2 * SEC, notFocused: 10 * SEC };\nconst BALANCE_INTERVAL = { focused: MINUTE, notFocused: 5 * MINUTE };\nconst INITIALIZATION_INTERVAL = { focused: MINUTE, notFocused: 5 * MINUTE };\nconst STAKING_INTERVAL = { focused: 5 * SEC, notFocused: 20 * SEC };\nconst VERSIONS_INTERVAL = { focused: 5 * MINUTE, notFocused: 15 * MINUTE };\nconst VESTING_INTERVAL = { focused: 10 * SEC, notFocused: MINUTE };\nconst TON_DNS_INTERVAL = { focused: 15 * SEC, notFocused: 2 * MINUTE };\n\nconst NFT_FULL_INTERVAL = { focused: MINUTE, notFocused: 5 * MINUTE };\nconst DOUBLE_CHECK_NFT_PAUSE = 5 * SEC;\n\nconst inactiveUpdateConcurrencyLimiter = createTaskQueue();\n\nexport function setupActivePolling(\n  accountId: string,\n  account: ApiAccountAny,\n  onUpdate: OnApiUpdate,\n  onUpdatingStatusChange: OnUpdatingStatusChange,\n  newestActivityTimestamps: ApiActivityTimestamps,\n): NoneToVoidFunction {\n  if (!('ton' in account) || !account.ton) {\n    return () => {};\n  }\n\n  const balanceAndDomainPolling = setupBalanceAndDomainPolling(\n    accountId,\n    onUpdate,\n    onUpdatingStatusChange.bind(undefined, 'balance'),\n  );\n  const stopActivityPolling = setupActivityPolling(\n    accountId,\n    account.ton.address,\n    newestActivityTimestamps,\n    handleWalletUpdate,\n    onUpdate,\n    onUpdatingStatusChange.bind(undefined, 'activities'),\n  );\n  const nftPolling = setupNftPolling(accountId, onUpdate);\n  const walletInitializationPolling = setupWalletInitializationPolling(accountId);\n  const stopWalletVersionPolling = setupWalletVersionsPolling(accountId, onUpdate);\n  const stopTonDnsPolling = setupTonDnsPolling(accountId, onUpdate);\n  const stopStakingPolling = setupStakingPolling(accountId, balanceAndDomainPolling.getBalances, onUpdate);\n  const stopVestingPolling = setupVestingPolling(accountId, onUpdate);\n\n  async function handleWalletUpdate() {\n    // The TON balance updates in `getWalletInfo` several seconds after an activity arrive from the Toncenter socket.\n    // This delay is up to 2 seconds, and 1 second is added as a safety margin.\n    // We suppose that the other HTTP API data can be delayed, so we delay all socket-triggerred pollings.\n    await pause(POLL_DELAY_AFTER_SOCKET);\n\n    // These data change only when the wallet gets new activities. The other pollings don't depend on the wallet content.\n    balanceAndDomainPolling.poll();\n    nftPolling.poll();\n    walletInitializationPolling.poll();\n  }\n\n  return () => {\n    balanceAndDomainPolling.stop();\n    stopActivityPolling();\n    nftPolling.stop();\n    stopWalletVersionPolling();\n    stopTonDnsPolling();\n    stopStakingPolling();\n    stopVestingPolling();\n  };\n}\n\nfunction setupBalanceAndDomainPolling(\n  accountId: string,\n  onUpdate: OnApiUpdate,\n  onUpdatingStatusChange?: (isUpdating: boolean) => void,\n) {\n  const balanceUpdater = makeBalanceAndDomainUpdater(accountId, onUpdate, onUpdatingStatusChange);\n\n  const polling = pollingLoop({\n    period: BALANCE_INTERVAL,\n    minDelay: POLL_MIN_INTERVAL,\n    poll: balanceUpdater.update,\n  });\n\n  return {\n    ...polling,\n    getBalances: balanceUpdater.get,\n  };\n}\n\nfunction makeBalanceAndDomainUpdater(\n  accountId: string,\n  onUpdate: OnApiUpdate,\n  onUpdatingStatusChange?: (isUpdating: boolean) => void,\n) {\n  const { network } = parseAccountId(accountId);\n  let balances: ApiBalanceBySlug | undefined;\n  let balancesDeferred = new Deferred();\n  let lastDomain: string | false | undefined; // Undefined means unknown, false means no domain\n\n  async function get() {\n    await balancesDeferred.promise;\n    return balances!;\n  }\n\n  async function update() {\n    onUpdatingStatusChange?.(true);\n\n    try {\n      const wallet = await fetchStoredTonWallet(accountId);\n      const [tonBalance, tokenBalances] = await Promise.all([\n        getTonBalanceAndCheckDomain(wallet.address),\n        loadTokenBalances(network, wallet.address, onUpdate),\n      ]);\n\n      const newBalances = {\n        [TONCOIN.slug]: tonBalance,\n        ...tokenBalances,\n      };\n      const hasChanged = !areDeepEqual(balances, newBalances);\n      balances = newBalances;\n\n      if (hasChanged) {\n        onUpdate({\n          type: 'updateBalances',\n          accountId,\n          chain: 'ton',\n          balances,\n        });\n      }\n\n      balancesDeferred.resolve();\n    } catch (err) {\n      logDebugError('setupBalanceAndDomainPolling update', err);\n\n      // It's important to reject the deferred instead of keeping it unsettled, because otherwise the main polling cycle\n      // will stuck and never retry. Creating a new deferred gives the `getBalances` callers another chance on retry.\n      balancesDeferred.reject(err);\n      balancesDeferred = new Deferred();\n    } finally {\n      onUpdatingStatusChange?.(false);\n    }\n  }\n\n  async function getTonBalanceAndCheckDomain(address: string) {\n    // Getting the balance and the domain go together, only because they arrive from the same endpoint\n    const { balance, domain = false } = await getWalletInfo(network, address);\n\n    if (domain !== lastDomain) {\n      onUpdate({\n        type: 'updateAccount',\n        accountId,\n        chain: 'ton',\n        domain,\n      });\n      lastDomain = domain;\n    }\n\n    return balance;\n  }\n\n  return { get, update };\n}\n\n// A good address for testing: UQD5mxRgCuRNLxKxeOjG6r14iSroLF5FtomPnet-sgP5xI-e\nfunction setupActivityPolling(\n  accountId: string,\n  address: string,\n  newestConfirmedActivityTimestamps: ApiActivityTimestamps,\n  onRawActivity: NoneToVoidFunction,\n  onUpdate: OnApiUpdate,\n  onUpdatingStatusChange: (isUpdating: boolean) => void,\n) {\n  let isStopped = false;\n  let rawActivityStream: ActivityStream | undefined;\n  let richActivityStream: RichActivityStream | undefined;\n\n  const newestTimestamps = compact(Object.values(newestConfirmedActivityTimestamps));\n  let newestConfirmedActivityTimestamp = newestTimestamps.length ? Math.max(...newestTimestamps) : undefined;\n\n  async function loadInitialActivities() {\n    try {\n      onUpdatingStatusChange(true);\n      return await loadInitialConfirmedActivities(accountId, onUpdate);\n    } catch (err) {\n      logDebugError('loadInitialConfirmedActivities', err);\n      return undefined;\n    } finally {\n      onUpdatingStatusChange(false);\n    }\n  }\n\n  function onRawActivities(confirmedActivities: ApiActivity[]) {\n    if (confirmedActivities.length) {\n      onRawActivity();\n    }\n  }\n\n  function onRichActivities(confirmedActivities: ApiActivity[], pendingActivities: readonly ApiActivity[]) {\n    confirmedActivities.slice().reverse().forEach((activity) => {\n      txCallbacks.runCallbacks(activity);\n    });\n\n    onUpdate({\n      type: 'newActivities',\n      chain: 'ton',\n      activities: confirmedActivities,\n      pendingActivities,\n      accountId,\n    });\n  }\n\n  void (async () => {\n    const doesNeedInitial = newestConfirmedActivityTimestamp === undefined;\n    if (doesNeedInitial) {\n      newestConfirmedActivityTimestamp = await loadInitialActivities();\n      onRawActivity(); // Just in case, because new activities may have arrived while loading the initial ones\n    }\n\n    if (isStopped) return;\n\n    rawActivityStream = new ActivityStream(\n      parseAccountId(accountId).network,\n      address,\n      newestConfirmedActivityTimestamp,\n      // If the initial activities are loaded, the polling on start is excessive\n      !doesNeedInitial,\n    );\n\n    richActivityStream = new RichActivityStream(accountId, rawActivityStream);\n\n    rawActivityStream.onUpdate(onRawActivities);\n    richActivityStream.onUpdate(onRichActivities);\n    richActivityStream.onLoadingChange(onUpdatingStatusChange);\n  })();\n\n  return () => {\n    isStopped = true;\n    richActivityStream?.destroy();\n    rawActivityStream?.destroy();\n  };\n}\n\nfunction setupNftPolling(accountId: string, onUpdate: OnApiUpdate) {\n  let nftFromSec = Math.round(Date.now() / 1000);\n\n  // The NFT updates may not become available immediately after the socket message.\n  // So we check again in a few seconds.\n  const updatePartial = withDoubleCheck(\n    [DOUBLE_CHECK_NFT_PAUSE],\n    async () => {\n      try {\n        const nftResult = await getNftUpdates(accountId, nftFromSec).catch(logAndRescue);\n\n        if (nftResult) {\n          let nftUpdates: ApiNftUpdate[];\n          [nftFromSec, nftUpdates] = nftResult;\n          nftUpdates\n            .filter((update) => !(update.type === 'nftReceived' && update.nft.isHidden))\n            .forEach(onUpdate);\n        }\n      } catch (err) {\n        logDebugError('setupNftPolling updatePartial', err);\n      }\n    },\n  );\n\n  const fullPolling = pollingLoop({\n    period: NFT_FULL_INTERVAL,\n    async poll() {\n      updatePartial.cancel();\n\n      try {\n        const nfts = await getAccountNfts(accountId).catch(logAndRescue);\n\n        if (nfts) {\n          nftFromSec = Math.round(Date.now() / 1000);\n          onUpdate({\n            type: 'updateNfts',\n            accountId,\n            nfts,\n          });\n        }\n      } catch (err) {\n        logDebugError('setupNftPolling updateFull', err);\n      }\n    },\n  });\n\n  return {\n    poll: throttle(\n      updatePartial.run,\n      () => focusAwareDelay(...periodToMs(POLL_MIN_INTERVAL)),\n    ),\n    stop() {\n      updatePartial.cancel();\n      fullPolling.stop();\n    },\n  };\n}\n\nfunction setupStakingPolling(accountId: string, getBalances: () => Promise<ApiBalanceBySlug>, onUpdate: OnApiUpdate) {\n  if (IS_STAKING_DISABLED || parseAccountId(accountId).network !== 'mainnet') {\n    return () => {};\n  }\n\n  let lastStates: ApiStakingState[] | undefined;\n\n  return pollingLoop({\n    period: STAKING_INTERVAL,\n    async poll() {\n      try {\n        const [common, balances, backendState] = await Promise.all([\n          getStakingCommonCache(),\n          getBalances(),\n          getBackendStakingState(accountId),\n        ]);\n        const states = await getStakingStates(accountId, common, backendState, balances);\n\n        const { shouldUseNominators, totalProfit } = backendState;\n\n        if (!areDeepEqual(states, lastStates)) {\n          lastStates = states;\n          onUpdate({\n            type: 'updateStaking',\n            accountId,\n            states,\n            totalProfit,\n            shouldUseNominators,\n          });\n        }\n      } catch (err) {\n        logDebugError('setupStakingPolling', err);\n      }\n    },\n  }).stop;\n}\n\nasync function loadInitialConfirmedActivities(accountId: string, onUpdate: OnApiUpdate) {\n  let mainActivities = await fetchActivitySlice(accountId, undefined, undefined, undefined, FIRST_TRANSACTIONS_LIMIT);\n  mainActivities = await enrichActivities(accountId, mainActivities, undefined, true);\n\n  const bySlug = {\n    // Loading the TON history is a side effect of loading the main history.\n    // Because there is no way to load TON activities without loading activities of other tokens.\n    [TONCOIN.slug]: mainActivities.filter((activity) => getActivityTokenSlugs(activity).includes(TONCOIN.slug)),\n  };\n\n  const newestActivityTimestamp = mainActivities[0]?.timestamp;\n\n  onUpdate({\n    type: 'initialActivities',\n    chain: 'ton',\n    accountId,\n    mainActivities,\n    bySlug,\n  });\n\n  return newestActivityTimestamp;\n}\n\nfunction logAndRescue(err: Error) {\n  logDebugError('Polling error', err);\n\n  return undefined;\n}\n\nfunction setupWalletVersionsPolling(accountId: string, onUpdate: OnApiUpdate) {\n  const { network } = parseAccountId(accountId);\n  let lastResult: ApiWalletInfo[] | undefined;\n\n  return pollingLoop({\n    period: VERSIONS_INTERVAL,\n    async poll() {\n      try {\n        const { type: accountType, ton: tonWallet } = await fetchStoredAccount(accountId);\n        if (accountType === 'bip39' || !tonWallet) return 'stop';\n\n        const { publicKey, version, isInitialized } = tonWallet;\n\n        if (!publicKey) {\n          if (!isInitialized) {\n            // Keep polling because `publicKey` may arrive later (for example, when the view wallet becomes initialized)\n            return undefined;\n          }\n\n          // This happens when this address is not a wallet address (for example, a contract address)\n          onUpdate({\n            type: 'updateWalletVersions',\n            accountId,\n            currentVersion: version,\n            versions: [],\n          });\n          return 'stop';\n        }\n\n        const publicKeyBytes = hexToBytes(publicKey);\n        const versions = (accountType === 'ledger' ? LEDGER_WALLET_VERSIONS : POPULAR_WALLET_VERSIONS)\n          .filter((value) => value !== version);\n        const versionInfos = (await getWalletVersionInfos(\n          network, publicKeyBytes, versions,\n        ));\n\n        const filteredVersions = versionInfos.map(({ wallet, ...rest }) => rest);\n\n        if (!areDeepEqual(versionInfos, lastResult)) {\n          lastResult = versionInfos;\n          onUpdate({\n            type: 'updateWalletVersions',\n            accountId,\n            currentVersion: version,\n            versions: filteredVersions,\n          });\n        }\n      } catch (err) {\n        logDebugError('setupWalletVersionsPolling', err);\n      }\n\n      return undefined;\n    },\n  }).stop;\n}\n\nfunction setupTonDnsPolling(accountId: string, onUpdate: OnApiUpdate) {\n  let lastResult: Awaited<ReturnType<typeof fetchDomains>> | undefined;\n\n  return pollingLoop({\n    period: TON_DNS_INTERVAL,\n    async poll() {\n      try {\n        const result = await fetchDomains(accountId);\n\n        if (!areDeepEqual(result, lastResult)) {\n          lastResult = result;\n\n          onUpdate({\n            type: 'updateAccountDomainData',\n            accountId,\n            ...pick(result, [\n              'expirationByAddress',\n              'linkedAddressByAddress',\n              'nfts',\n            ]),\n          });\n        }\n      } catch (err) {\n        logDebugError('setupTonDnsPolling', err);\n      }\n    },\n  }).stop;\n}\n\nfunction setupVestingPolling(accountId: string, onUpdate: OnApiUpdate) {\n  if (IS_CORE_WALLET) {\n    return () => {};\n  }\n\n  let lastVestingInfo: ApiVestingInfo[] | undefined;\n\n  return pollingLoop({\n    period: VESTING_INTERVAL,\n    async prepare() {\n      const { isVestingEnabled } = await getBackendConfigCache();\n      return isVestingEnabled;\n    },\n    async poll(isEnabled) {\n      if (!isEnabled) {\n        return 'stop';\n      }\n\n      try {\n        const vestingInfo = await fetchVestings(accountId);\n\n        if (!areDeepEqual(lastVestingInfo, vestingInfo)) {\n          lastVestingInfo = vestingInfo;\n          onUpdate({\n            type: 'updateVesting',\n            accountId,\n            vestingInfo,\n          });\n        }\n      } catch (err) {\n        logDebugError('setupVestingPolling', err);\n      }\n\n      return undefined;\n    },\n  }).stop;\n}\n\nexport function setupInactivePolling(\n  accountId: string,\n  account: ApiAccountAny,\n  onUpdate: OnApiUpdate,\n): NoneToVoidFunction {\n  if (!('ton' in account) || !account.ton) {\n    return () => {};\n  }\n\n  const balanceUpdater = makeBalanceAndDomainUpdater(accountId, onUpdate);\n\n  const walletPolling = new WalletPolling({\n    ...inactiveWalletTiming,\n    chain: 'ton',\n    network: parseAccountId(accountId).network,\n    address: account.ton.address,\n    onUpdate: inactiveUpdateConcurrencyLimiter.wrap(async () => {\n      await balanceUpdater.update();\n    }),\n  });\n\n  return () => {\n    walletPolling.destroy();\n  };\n}\n\nfunction setupWalletInitializationPolling(accountId: string) {\n  return pollingLoop({\n    period: INITIALIZATION_INTERVAL,\n    minDelay: POLL_MIN_INTERVAL,\n    async poll() {\n      try {\n        const wallet = await fetchStoredTonWallet(accountId);\n\n        if (wallet.isInitialized) {\n          return 'stop';\n        }\n\n        const { network } = parseAccountId(accountId);\n        const doesNeedPublicKey = !wallet.publicKey;\n        let walletUpdate: Partial<ApiTonWallet> | undefined;\n\n        if (doesNeedPublicKey) {\n          // This branch isn't used always, because it makes more network requests than the other\n          const updatedWallet = await getWalletFromAddress(network, wallet.address);\n          if (!('error' in updatedWallet) && updatedWallet.wallet.isInitialized) {\n            // It's important to load and save `version` along with `publicKey` because the app couldn't get the proper\n            // wallet version without knowing the `publicKey`.\n            walletUpdate = pick(updatedWallet.wallet, ['isInitialized', 'publicKey', 'version']);\n          }\n        } else {\n          const isInitialized = await isAddressInitialized(network, wallet.address);\n          if (isInitialized) {\n            walletUpdate = { isInitialized };\n          }\n        }\n\n        if (walletUpdate) {\n          await updateStoredTonWallet(accountId, walletUpdate);\n        }\n      } catch (err) {\n        logDebugError('checkWalletInitialization', err);\n      }\n    },\n  });\n}\n","import type { ApiVestingInfo } from '../../types';\n\nimport { parseAccountId } from '../../../util/account';\nimport { fetchStoredTonWallet } from '../../common/accounts';\nimport { callBackendGet } from '../../common/backend';\n\nexport async function fetchVestings(accountId: string) {\n  const { network } = parseAccountId(accountId);\n  const isTestnet = network === 'testnet';\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  return callBackendGet<ApiVestingInfo[]>(`/vesting/${address}`, { isTestnet });\n}\n","import { TronWeb } from 'tronweb';\n\nimport type { ApiNetwork } from '../../../types';\n\nimport { getChainConfig } from '../../../../util/chain';\n\nlet clientByNetwork: Record<ApiNetwork, TronWeb> | undefined;\n\nconst parametersByNetwork: Partial<Record<ApiNetwork, {\n  energyUnitFee: number;\n  bandwidthUnitFee: number;\n}>> = {};\n\nconst chainConfig = getChainConfig('tron');\n\nexport function getTronClient(network: ApiNetwork = 'mainnet') {\n  if (!clientByNetwork) {\n    clientByNetwork = {\n      mainnet: new TronWeb({\n        fullHost: chainConfig.mainnet.apiUrl,\n      }),\n      testnet: new TronWeb({\n        fullHost: chainConfig.testnet.apiUrl,\n      }),\n    };\n  }\n\n  return clientByNetwork[network];\n}\n\nexport async function getChainParameters(network: ApiNetwork) {\n  if (!(network in parametersByNetwork)) {\n    const chainParameters = await getTronClient(network).trx.getChainParameters();\n    const energyUnitFee = chainParameters.find((param) => param.key === 'getEnergyFee')!.value;\n    const bandwidthUnitFee = chainParameters.find((param) => param.key === 'getTransactionFee')!.value;\n    parametersByNetwork[network] = { energyUnitFee, bandwidthUnitFee };\n  }\n\n  return parametersByNetwork[network]!;\n}\n","import type { ApiNetwork } from '../../../types';\n\nimport { TRX } from '../../../../config';\nimport { getChainConfig } from '../../../../util/chain';\nimport { buildTokenSlug } from '../../../common/tokens';\n\nexport function getTokenSlugs(network: ApiNetwork) {\n  const { usdtAddress } = getChainConfig('tron')[network];\n  const usdtSlug = buildTokenSlug('tron', usdtAddress);\n  return [TRX.slug, usdtSlug];\n}\n","import { TronWeb } from 'tronweb';\n\nimport type { ApiActivity, ApiNetwork, ApiTransactionActivity } from '../../types';\n\nimport { TRX } from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { getChainConfig } from '../../../util/chain';\nimport { compareActivities } from '../../../util/compareActivities';\nimport { fetchJson } from '../../../util/fetch';\nimport { buildCollectionByKey } from '../../../util/iteratees';\nimport { getTokenSlugs } from './util/tokens';\nimport { fetchStoredTronWallet } from '../../common/accounts';\nimport { buildTokenSlug, getTokenBySlug } from '../../common/tokens';\n\nexport async function getTokenTransactionSlice(\n  accountId: string,\n  slug: string,\n  toTimestamp?: number,\n  fromTimestamp?: number,\n  limit?: number,\n) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTronWallet(accountId);\n\n  if (slug === TRX.slug) {\n    const rawTransactions = await getTrxTransactions(network, address, {\n      min_timestamp: fromTimestamp ? fromTimestamp + 1000 : undefined,\n      max_timestamp: toTimestamp ? toTimestamp - 1000 : undefined,\n      limit,\n      search_internal: false, // The parsing is not supported and not needed currently\n    });\n    return rawTransactions.map((rawTx) => parseRawTrxTransaction(address, rawTx)).filter(Boolean);\n  } else {\n    const { tokenAddress } = getTokenBySlug(slug);\n    const rawTransactions = await getTrc20Transactions(network, address, {\n      contract_address: tokenAddress,\n      min_timestamp: fromTimestamp ? fromTimestamp + 1000 : undefined,\n      max_timestamp: toTimestamp ? toTimestamp - 1000 : undefined,\n      limit,\n    });\n    return rawTransactions.map((rawTx) => parseRawTrc20Transaction(address, rawTx));\n  }\n}\n\nexport async function getAllTransactionSlice(accountId: string, toTimestamp: number | undefined, limit: number) {\n  const { network } = parseAccountId(accountId);\n  const tokenSlugs = getTokenSlugs(network);\n\n  const chunks = (await Promise.all([\n    getTokenTransactionSlice(accountId, TRX.slug, toTimestamp, undefined, limit),\n    ...tokenSlugs.map((slug) => getTokenTransactionSlice(\n      accountId, slug, toTimestamp, undefined, limit,\n    )),\n  ])).filter((chunk) => chunk.length);\n\n  if (!chunks.length) {\n    return [];\n  }\n\n  // TODO ,     \" \",          .\n  //         .\n  const mainChunk = chunks.reduce((prevChunk, chunk) => {\n    if (prevChunk.length > chunk.length) return prevChunk;\n    if (prevChunk.length < chunk.length) return chunk;\n    if (prevChunk[prevChunk.length - 1].timestamp < chunk[chunk.length - 1].timestamp) return chunk;\n    return prevChunk;\n  }, [] as ApiTransactionActivity[]);\n\n  const fromTimestamp = mainChunk[mainChunk.length - 1].timestamp;\n\n  const [trxChunk, ...tokenChunks] = chunks;\n\n  return mergeActivities(trxChunk, ...tokenChunks)\n    .filter(({ timestamp }) => timestamp >= fromTimestamp);\n}\n\nasync function getTrxTransactions(\n  network: ApiNetwork,\n  address: string,\n  queryParams: {\n    only_confirmed?: boolean;\n    only_unconfirmed?: boolean;\n    only_to?: boolean;\n    only_from?: boolean;\n    limit?: number;\n    fingerprint?: string;\n    order_by?: 'block_timestamp,asc' | 'block_timestamp,desc';\n    min_timestamp?: number;\n    max_timestamp?: number;\n    search_internal?: boolean;\n  } = {},\n): Promise<any[]> {\n  const baseUrl = getChainConfig('tron')[network].apiUrl;\n  const url = new URL(`${baseUrl}/v1/accounts/${address}/transactions`);\n\n  const result = await fetchJson(url.toString(), queryParams);\n\n  return result.data;\n}\n\nfunction parseRawTrxTransaction(address: string, rawTx: any): ApiTransactionActivity | undefined {\n  const {\n    raw_data: rawData,\n    txID: txId,\n    energy_fee: energyFee,\n    net_fee: netFee,\n    block_timestamp: timestamp,\n  } = rawTx;\n\n  const parameters = rawData.contract[0].parameter.value;\n  const amount = BigInt(parameters.amount ?? 0);\n  const fromAddress = TronWeb.address.fromHex(parameters.owner_address);\n  const toAddress = TronWeb.address.fromHex(\n    parameters.to_address || parameters.receiver_address || parameters.contract_address,\n  );\n\n  const slug = TRX.slug;\n  const isIncoming = toAddress === address;\n  const normalizedAddress = isIncoming ? fromAddress : toAddress;\n  const fee = BigInt(energyFee + netFee);\n  const type = rawData.contract[0].type === 'TriggerSmartContract' ? 'callContract' : undefined;\n  const shouldHide = rawData.contract[0].type === 'TransferAssetContract';\n\n  return {\n    id: txId,\n    kind: 'transaction',\n    txId,\n    timestamp,\n    fromAddress,\n    toAddress,\n    amount: isIncoming ? amount : -amount,\n    slug,\n    isIncoming,\n    normalizedAddress,\n    fee,\n    type,\n    shouldHide,\n    status: 'completed',\n  };\n}\n\nasync function getTrc20Transactions(\n  network: ApiNetwork,\n  address: string,\n  queryParams: {\n    only_confirmed?: boolean;\n    only_unconfirmed?: boolean;\n    limit?: number;\n    fingerprint?: string;\n    order_by?: 'block_timestamp,asc' | 'block_timestamp,desc';\n    min_timestamp?: number;\n    max_timestamp?: number;\n    contract_address?: string;\n    only_to?: boolean;\n    only_from?: boolean;\n  } = {},\n): Promise<any[]> {\n  const baseUrl = getChainConfig('tron')[network].apiUrl;\n  const url = new URL(`${baseUrl}/v1/accounts/${address}/transactions/trc20`);\n\n  const result = await fetchJson(url.toString(), queryParams);\n\n  return result.data;\n}\n\nfunction parseRawTrc20Transaction(address: string, rawTx: any): ApiTransactionActivity {\n  const {\n    transaction_id: txId,\n    block_timestamp: timestamp,\n    from: fromAddress,\n    to: toAddress,\n    value,\n    token_info: tokenInfo,\n  } = rawTx;\n\n  const amount = BigInt(value);\n  const slug = buildTokenSlug(TRX.chain, tokenInfo.address);\n  const isIncoming = toAddress === address;\n  const normalizedAddress = isIncoming ? fromAddress : toAddress;\n  const fee = 0n;\n\n  return {\n    id: txId,\n    kind: 'transaction',\n    txId,\n    timestamp,\n    fromAddress,\n    toAddress,\n    amount: isIncoming ? amount : -amount,\n    slug,\n    isIncoming,\n    normalizedAddress,\n    fee,\n    status: 'completed',\n  };\n}\n\nexport function mergeActivities(trxTxs: ApiActivity[], ...tokenTxs: ApiActivity[][]): ApiActivity[] {\n  const result: ApiActivity[] = [];\n  const uniqueTxIds = new Set<string>();\n  const trxTxById = buildCollectionByKey(trxTxs, 'id');\n\n  for (const tokenTxList of tokenTxs) {\n    for (const tokenTx of tokenTxList) {\n      // Different tokens have the same transaction id if they share the same backend swap.\n      // The duplicates need to removed.\n      if (uniqueTxIds.has(tokenTx.id)) {\n        continue;\n      }\n\n      uniqueTxIds.add(tokenTx.id);\n      result.push(tokenTx);\n\n      const trxTx = trxTxById[tokenTx.id];\n      if (tokenTx.kind === 'transaction' && trxTx?.kind === 'transaction') {\n        tokenTx.fee = trxTx.fee;\n      }\n    }\n  }\n\n  for (const trxTx of trxTxs) {\n    if (uniqueTxIds.has(trxTx.id)) {\n      continue;\n    }\n\n    if (trxTx.kind !== 'transaction' || trxTx.toAddress) {\n      uniqueTxIds.add(trxTx.id);\n      result.push(trxTx);\n    }\n  }\n\n  return result.sort(compareActivities);\n}\n","import type { TronWeb } from 'tronweb';\n\nimport type { ApiNetwork } from '../../types';\n\nimport { logDebugError } from '../../../util/logs';\nimport { getTronClient } from './util/tronweb';\n\n/*\n* We display unconfirmed balance and transactions to user.\n* /wallet/* - endpoints with unconfirmed data\n* /walletsolidity/* - endpoints with confirmed data\n*/\n\nexport async function getWalletBalance(network: ApiNetwork, address: string) {\n  const tronWeb = getTronClient(network);\n  return BigInt(await tronWeb.trx.getUnconfirmedBalance(address));\n}\n\nexport async function getTrc20Balance(network: ApiNetwork, tokenAddress: string, address: string) {\n  const result = await callContract(getTronClient(network), tokenAddress, 'balanceOf(address)', [\n    { type: 'address', value: address },\n  ], address);\n\n  if (!result.length) {\n    return 0n;\n  }\n\n  return BigInt(`0x${result[0]}`);\n}\n\nexport async function callContract(\n  tronWeb: TronWeb,\n  address: string,\n  functions: string,\n  parameters: any[] = [],\n  issuerAddress: string,\n) {\n  try {\n    const result = await tronWeb.transactionBuilder.triggerSmartContract(\n      address,\n      functions,\n      { _isConstant: true },\n      parameters,\n      issuerAddress,\n    );\n    return result && result.result ? result.constant_result : [];\n  } catch (err: any) {\n    logDebugError('callContract', err);\n    return [];\n  }\n}\n","import type {\n  ApiAccountAny,\n  ApiActivity,\n  ApiActivityTimestamps,\n  ApiBalanceBySlug,\n  ApiUpdatingStatus,\n  OnApiUpdate,\n} from '../../types';\n\nimport { TRX } from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { areDeepEqual } from '../../../util/areDeepEqual';\nimport { getChainConfig } from '../../../util/chain';\nimport isEmptyObject from '../../../util/isEmptyObject';\nimport { logDebugError } from '../../../util/logs';\nimport { createTaskQueue } from '../../../util/schedulers';\nimport { getTokenSlugs } from './util/tokens';\nimport { enrichActivities } from '../../common/activities';\nimport { activeWalletTiming, inactiveWalletTiming } from '../../common/polling/utils';\nimport { WalletPolling } from '../../common/polling/walletPolling';\nimport { buildTokenSlug } from '../../common/tokens';\nimport { txCallbacks } from '../../common/txCallbacks';\nimport { FIRST_TRANSACTIONS_LIMIT } from '../../constants';\nimport { getTokenTransactionSlice, mergeActivities } from './transactions';\nimport { getTrc20Balance, getWalletBalance } from './wallet';\n\ntype OnUpdatingStatusChange = (kind: ApiUpdatingStatus['kind'], isUpdating: boolean) => void;\n\nconst inactiveUpdateConcurrencyLimiter = createTaskQueue();\n\nexport function setupActivePolling(\n  accountId: string,\n  account: ApiAccountAny,\n  onUpdate: OnApiUpdate,\n  onUpdatingStatusChange: OnUpdatingStatusChange,\n  newestActivityTimestamps: ApiActivityTimestamps,\n): NoneToVoidFunction {\n  if (!('tron' in account) || !account.tron) {\n    return () => {};\n  }\n\n  const { address } = account.tron;\n\n  const balancePolling = setupBalancePolling(\n    accountId,\n    address,\n    onUpdate,\n    onUpdatingStatusChange.bind(undefined, 'balance'),\n  );\n  const activityPolling = setupActivityPolling(\n    accountId,\n    newestActivityTimestamps,\n    onUpdate,\n    onUpdatingStatusChange.bind(undefined, 'activities'),\n  );\n\n  let isFirstUpdate = true;\n\n  async function handleUpdate(isConfident: boolean) {\n    if (isConfident || isFirstUpdate) {\n      await Promise.all([\n        balancePolling.update(),\n        activityPolling.update(),\n      ]);\n    } else {\n      // Legacy (timer) polling mode.\n      // The balance is checked before the activities, because the backend throttling for balance is much looser.\n      const hasBalanceChanged = await balancePolling.update();\n      if (hasBalanceChanged) {\n        await activityPolling.update();\n      }\n    }\n\n    isFirstUpdate = false;\n  }\n\n  const walletPolling = new WalletPolling({\n    ...activeWalletTiming,\n    chain: 'tron',\n    network: parseAccountId(accountId).network,\n    address,\n    onUpdate: handleUpdate,\n  });\n\n  return () => {\n    walletPolling.destroy();\n  };\n}\n\nfunction setupBalancePolling(\n  accountId: string,\n  address: string,\n  onUpdate: OnApiUpdate,\n  onUpdatingStatusChange?: (isUpdating: boolean) => void,\n) {\n  const { network } = parseAccountId(accountId);\n  const { usdtAddress } = getChainConfig('tron')[network];\n  const usdtSlug = buildTokenSlug('tron', usdtAddress);\n\n  let balances: ApiBalanceBySlug | undefined;\n\n  /** Returns `true` if the balances have changed since the last update */\n  async function update() {\n    onUpdatingStatusChange?.(true);\n\n    try {\n      const [trxBalance, usdtBalance] = await Promise.all([\n        getWalletBalance(network, address),\n        getTrc20Balance(network, usdtAddress, address),\n      ]);\n      const newBalances = {\n        [TRX.slug]: trxBalance,\n        [usdtSlug]: usdtBalance,\n      };\n      const hasChanged = !areDeepEqual(balances, newBalances);\n      balances = newBalances;\n\n      if (hasChanged) {\n        onUpdate({\n          type: 'updateBalances',\n          accountId,\n          chain: 'tron',\n          balances,\n        });\n      }\n\n      return hasChanged;\n    } catch (err) {\n      logDebugError('setupBalancePolling update', err);\n    } finally {\n      onUpdatingStatusChange?.(false);\n    }\n\n    return false;\n  }\n\n  return { update };\n}\n\nfunction setupActivityPolling(\n  accountId: string,\n  newestActivityTimestamps: ApiActivityTimestamps,\n  onUpdate: OnApiUpdate,\n  onUpdatingStatusChange: (isUpdating: boolean) => void,\n) {\n  const { network } = parseAccountId(accountId);\n  const slugs = getTokenSlugs(network);\n\n  async function update() {\n    onUpdatingStatusChange(true);\n\n    try {\n      if (isEmptyObject(newestActivityTimestamps)) {\n        newestActivityTimestamps = await loadInitialActivities(accountId, slugs, onUpdate);\n      } else {\n        newestActivityTimestamps = await loadNewActivities(accountId, newestActivityTimestamps, slugs, onUpdate);\n      }\n    } catch (err) {\n      logDebugError('setupActivityPolling update', err);\n    } finally {\n      onUpdatingStatusChange(false);\n    }\n  }\n\n  return { update };\n}\n\nexport function setupInactivePolling(\n  accountId: string,\n  account: ApiAccountAny,\n  onUpdate: OnApiUpdate,\n): NoneToVoidFunction {\n  if (!('tron' in account) || !account.tron) {\n    return () => {};\n  }\n\n  const { address } = account.tron;\n\n  const balancePolling = setupBalancePolling(accountId, address, onUpdate);\n\n  const walletPolling = new WalletPolling({\n    ...inactiveWalletTiming,\n    chain: 'tron',\n    network: parseAccountId(accountId).network,\n    address,\n    onUpdate: inactiveUpdateConcurrencyLimiter.wrap(async () => {\n      await balancePolling.update();\n    }),\n  });\n\n  return () => {\n    walletPolling.destroy();\n  };\n}\n\nasync function loadInitialActivities(\n  accountId: string,\n  tokenSlugs: string[],\n  onUpdate: OnApiUpdate,\n) {\n  const result: ApiActivityTimestamps = {};\n  const bySlug: Record<string, ApiActivity[]> = {};\n\n  const chunks = await Promise.all(tokenSlugs.map(async (slug) => {\n    let activities: ApiActivity[] = await getTokenTransactionSlice(\n      accountId, slug, undefined, undefined, FIRST_TRANSACTIONS_LIMIT,\n    );\n\n    activities = await enrichActivities(accountId, activities, slug, true);\n\n    result[slug] = activities[0]?.timestamp;\n    bySlug[slug] = activities;\n\n    return activities;\n  }));\n\n  const [trxChunk, ...tokenChunks] = chunks;\n  const mainActivities = mergeActivities(trxChunk, ...tokenChunks);\n\n  mainActivities.slice().reverse().forEach((transaction) => {\n    txCallbacks.runCallbacks(transaction);\n  });\n\n  onUpdate({\n    type: 'initialActivities',\n    chain: 'tron',\n    accountId,\n    mainActivities,\n    bySlug,\n  });\n\n  return result;\n}\n\nasync function loadNewActivities(\n  accountId: string,\n  newestActivityTimestamps: ApiActivityTimestamps,\n  tokenSlugs: string[],\n  onUpdate: OnApiUpdate,\n) {\n  const result: ApiActivityTimestamps = {};\n\n  const chunks = await Promise.all(tokenSlugs.map(async (slug) => {\n    let newestActivityTimestamp = newestActivityTimestamps[slug];\n    const activities: ApiActivity[] = await getTokenTransactionSlice(\n      accountId, slug, undefined, newestActivityTimestamp, FIRST_TRANSACTIONS_LIMIT,\n    );\n\n    newestActivityTimestamp = activities[0]?.timestamp ?? newestActivityTimestamp;\n    result[slug] = newestActivityTimestamp;\n    return activities;\n  }));\n\n  const [trxChunk, ...tokenChunks] = chunks;\n  let activities = mergeActivities(trxChunk, ...tokenChunks);\n\n  activities = await enrichActivities(accountId, activities, undefined, true);\n\n  activities.slice().reverse().forEach((activity) => {\n    txCallbacks.runCallbacks(activity);\n  });\n\n  if (activities.length > 0) {\n    onUpdate({\n      type: 'newActivities',\n      chain: 'tron',\n      activities,\n      pendingActivities: [],\n      accountId,\n    });\n  }\n\n  return result;\n}\n","export const TRON_GAS = {\n  transferTrc20Estimated: 28_214_970n,\n};\n\nexport const ONE_TRX = 1_000_000n;\n","// Importing from `tronweb/lib/commonjs/types` breaks eslint (eslint doesn't like any of import placement options)\n// eslint-disable-next-line simple-import-sort/imports\nimport type { TronWeb } from 'tronweb';\n\nimport type { ApiSubmitTransferOptions, CheckTransactionDraftOptions } from '../../methods/types';\nimport type { ApiCheckTransactionDraftResult } from '../ton/types';\nimport { ApiTransactionDraftError, ApiTransactionError } from '../../types';\nimport type { ApiAccountWithMnemonic, ApiBip39Account, ApiNetwork } from '../../types';\n\nimport { parseAccountId } from '../../../util/account';\nimport { logDebugError } from '../../../util/logs';\nimport { getChainParameters, getTronClient } from './util/tronweb';\nimport { fetchStoredAccount, fetchStoredTronWallet } from '../../common/accounts';\nimport { getMnemonic } from '../../common/mnemonic';\nimport { handleServerError } from '../../errors';\nimport { getTrc20Balance, getWalletBalance } from './wallet';\nimport type { ApiSubmitTransferTronResult } from './types';\nimport { hexToString } from '../../../util/stringFormat';\nimport { ONE_TRX, TRON_GAS } from './constants';\n\nconst SIGNATURE_SIZE = 65;\n\nexport async function checkTransactionDraft(\n  options: CheckTransactionDraftOptions,\n): Promise<ApiCheckTransactionDraftResult> {\n  const {\n    accountId, amount, toAddress, tokenAddress,\n  } = options;\n  const { network } = parseAccountId(accountId);\n\n  const tronWeb = getTronClient(network);\n  const result: ApiCheckTransactionDraftResult = {};\n\n  try {\n    if (!tronWeb.isAddress(toAddress)) {\n      return { error: ApiTransactionDraftError.InvalidToAddress };\n    }\n\n    result.resolvedAddress = toAddress;\n\n    const { address } = await fetchStoredTronWallet(accountId);\n    const [trxBalance, bandwidth, { energyUnitFee, bandwidthUnitFee }] = await Promise.all([\n      getWalletBalance(network, address),\n      tronWeb.trx.getBandwidth(address),\n      getChainParameters(network),\n    ]);\n\n    let fee: bigint;\n\n    if (tokenAddress) {\n      fee = await estimateTrc20TransferFee(tronWeb, {\n        network,\n        toAddress,\n        tokenAddress,\n        amount,\n        energyUnitFee,\n        fromAddress: address,\n      });\n    } else {\n      // This call throws \"Error: Invalid amount provided\" when the amount is 0.\n      // It doesn't throw when the amount is > than the balance.\n      const [transaction, account] = await Promise.all([\n        tronWeb.transactionBuilder.sendTrx(toAddress, Number(amount ?? 1), address),\n        tronWeb.trx.getAccount(toAddress),\n      ]);\n\n      const size = 9 + 60 + Buffer.from(transaction.raw_data_hex, 'hex').byteLength + SIGNATURE_SIZE;\n      fee = bandwidth > size ? 0n : BigInt(size) * BigInt(bandwidthUnitFee);\n\n      // If the account is not activated, we pay an extra 1 TRX for activation\n      if (account.balance === undefined) {\n        fee += ONE_TRX;\n      }\n    }\n\n    result.fee = fee;\n    result.realFee = fee;\n\n    const trxAmount = tokenAddress ? fee : (amount ?? 0n) + fee;\n    const isEnoughTrx = trxBalance >= trxAmount;\n\n    if (!isEnoughTrx) {\n      result.error = ApiTransactionDraftError.InsufficientBalance;\n    }\n\n    // todo: Check that the amount  the token balance (in case of a token transfer)\n\n    return result;\n  } catch (err) {\n    logDebugError('tron:checkTransactionDraft', err);\n    return {\n      ...handleServerError(err),\n      ...result,\n    };\n  }\n}\n\nexport async function submitTransfer(options: ApiSubmitTransferOptions): Promise<ApiSubmitTransferTronResult> {\n  const {\n    accountId, password, toAddress, amount, fee = 0n, tokenAddress,\n  } = options;\n\n  const { network } = parseAccountId(accountId);\n\n  try {\n    const tronWeb = getTronClient(network);\n\n    const account = await fetchStoredAccount<ApiAccountWithMnemonic>(accountId);\n    const { address } = (account as ApiBip39Account).tron;\n    const trxBalance = await getWalletBalance(network, address);\n\n    const trxAmount = tokenAddress ? fee : fee + amount;\n    const isEnoughTrx = trxBalance >= trxAmount;\n\n    if (!isEnoughTrx) {\n      return { error: ApiTransactionError.InsufficientBalance };\n    }\n\n    // todo: Check that the amount  the token balance (in case of a token transfer)\n\n    const mnemonic = await getMnemonic(accountId, password, account);\n    const privateKey = tronWeb.fromMnemonic(mnemonic!.join(' ')).privateKey.slice(2);\n\n    if (tokenAddress) {\n      const { transaction } = await buildTrc20Transfer(tronWeb, {\n        toAddress, tokenAddress, amount, feeLimit: fee, fromAddress: address,\n      });\n\n      const signedTx = await tronWeb.trx.sign(transaction, privateKey);\n      const result = await tronWeb.trx.sendRawTransaction(signedTx);\n\n      return { amount, toAddress, txId: result.transaction.txID };\n    } else {\n      const result = await tronWeb.trx.sendTransaction(toAddress, Number(amount), {\n        privateKey,\n      });\n\n      if ('code' in result && !('result' in result && result.result)) {\n        const error = 'message' in result && result.message\n          ? hexToString(result.message)\n          : result.code.toString();\n\n        logDebugError('submitTransfer', { error, result });\n\n        return { error };\n      }\n\n      return { amount, toAddress, txId: result.transaction.txID };\n    }\n  } catch (err: any) {\n    logDebugError('submitTransfer', err);\n    return { error: ApiTransactionError.UnsuccesfulTransfer };\n  }\n}\n\nasync function estimateTrc20TransferFee(tronWeb: TronWeb, options: {\n  network: ApiNetwork;\n  tokenAddress: string;\n  toAddress: string;\n  amount?: bigint;\n  energyUnitFee: number;\n  fromAddress: string;\n}) {\n  const {\n    network, tokenAddress, toAddress, energyUnitFee, fromAddress,\n  } = options;\n\n  let { amount } = options;\n  const tokenBalance = await getTrc20Balance(network, tokenAddress, fromAddress);\n\n  if (!tokenBalance) {\n    return TRON_GAS.transferTrc20Estimated;\n  }\n\n  if (amount === undefined || amount > tokenBalance) {\n    amount = 1n;\n  }\n\n  // This call throws \"Error: REVERT opcode executed\" when the given amount is more than the token balance.\n  // It doesn't throw when the amount is 0.\n  const { energy_required: energyRequired } = await tronWeb.transactionBuilder.estimateEnergy(\n    tokenAddress,\n    'transfer(address,uint256)',\n    {},\n    [\n      { type: 'address', value: toAddress },\n      { type: 'uint256', value: Number(amount) },\n    ],\n    fromAddress,\n  );\n\n  return BigInt(energyUnitFee * energyRequired);\n}\n\nasync function buildTrc20Transfer(tronWeb: TronWeb, options: {\n  tokenAddress: string;\n  toAddress: string;\n  amount: bigint;\n  feeLimit: bigint;\n  fromAddress: string;\n}) {\n  const {\n    amount, tokenAddress, toAddress, feeLimit, fromAddress,\n  } = options;\n\n  const { transaction } = await tronWeb.transactionBuilder.triggerSmartContract(\n    tokenAddress,\n    'transfer(address,uint256)',\n    { feeLimit: Number(feeLimit) },\n    [\n      { type: 'address', value: toAddress },\n      { type: 'uint256', value: Number(amount) },\n    ],\n    fromAddress,\n  );\n\n  return { transaction };\n}\n","export function isAscii(str: string) {\n  for (let i = 0; i < str.length; i++) {\n    if (str.charCodeAt(i) > 127) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function insertSubstring(str: string, start: number, newSubStr: string) {\n  if (start < 0) {\n    start = str.length - start;\n  }\n  return str.slice(0, start) + newSubStr + str.slice(start);\n}\n\nexport function hexToString(hex: string): string {\n  let result = '';\n  for (let i = 0; i < hex.length; i += 2) {\n    result += String.fromCharCode(parseInt(hex.slice(i, i + 2), 16));\n  }\n\n  return result;\n}\n","import type { ApiNetwork, ApiTronWallet } from '../../types';\n\nimport { getTronClient } from './util/tronweb';\n\nexport { setupActivePolling, setupInactivePolling } from './polling';\nexport { checkTransactionDraft, submitTransfer } from './transfer';\nexport { getWalletBalance } from './wallet';\nexport { getAllTransactionSlice, getTokenTransactionSlice } from './transactions';\n\nexport function getWalletFromBip39Mnemonic(network: ApiNetwork, mnemonic: string[]): ApiTronWallet {\n  const { address, publicKey } = getTronClient(network).fromMnemonic(mnemonic.join(' '));\n  return {\n    type: 'tron',\n    address,\n    publicKey,\n    index: 0,\n  };\n}\n\nexport function checkApiAvailability(network: ApiNetwork) {\n  const isConnected = getTronClient(network).isConnected();\n  return Boolean(isConnected);\n}\n","import * as ton from './ton';\nimport * as tron from './tron';\n\nexport default {\n  ton,\n  tron,\n};\n","import { logDebugError } from '../util/logs';\n\ninterface Hooks {\n  onFirstLogin: AnyFunction;\n  onFullLogout: AnyFunction;\n  onWindowNeeded: AnyFunction;\n  onDappDisconnected: (accountId: string, url: string) => any;\n  onDappsChanged: AnyFunction;\n  onSwapCreated: (accountId: string, fromTimestamp: number) => any;\n}\n\nconst hooks: Partial<{\n  [K in keyof Hooks]: Hooks[K][];\n}> = {};\n\nexport function addHooks(partial: Partial<Hooks>) {\n  for (const [name, hook] of Object.entries(partial) as Entries<Hooks>) {\n    hooks[name] = (hooks[name] ?? []).concat([hook]);\n  }\n}\n\nexport async function callHook<T extends keyof Hooks>(name: T, ...args: Parameters<Hooks[T]>) {\n  for (const hook of hooks[name] ?? []) {\n    try {\n      // @ts-ignore\n      await hook(...args);\n    } catch (err) {\n      logDebugError(`callHooks:${name}`, err);\n    }\n  }\n}\n","import type { ApiBaseCurrency } from '../types';\n\nimport { DEFAULT_PRICE_CURRENCY } from '../../config';\nimport { storage } from '../storages';\n\nexport async function getBaseCurrency() {\n  return (await storage.getItem('baseCurrency')) ?? DEFAULT_PRICE_CURRENCY;\n}\n\nexport function setBaseCurrency(currency: ApiBaseCurrency) {\n  return storage.setItem('baseCurrency', currency);\n}\n","let resolvePromise: NoneToVoidFunction;\nconst preloadPromise = new Promise<void>((resolve) => {\n  resolvePromise = resolve;\n});\n\nexport function resolveDataPreloadPromise() {\n  resolvePromise();\n}\n\nexport async function waitDataPreload() {\n  await preloadPromise;\n}\n","import type { ApiNetwork } from '../types';\n\nimport { parseAccountId } from '../../util/account';\nimport chains from '../chains';\nimport { getTokenByAddress } from '../common/tokens';\n\nconst { ton } = chains;\n\nexport { getTokenBySlug, buildTokenSlug } from '../common/tokens';\n\nexport function fetchToken(accountId: string, address: string) {\n  const { network } = parseAccountId(accountId);\n  return ton.fetchToken(network, address);\n}\n\nexport function resolveTokenWalletAddress(network: ApiNetwork, address: string, tokenAddress: string) {\n  const chain = chains.ton;\n\n  return chain.resolveTokenWalletAddress(network, address, tokenAddress);\n}\n\nexport function resolveTokenAddress(network: ApiNetwork, tokenWalletAddress: string) {\n  const chain = chains.ton;\n\n  return chain.resolveTokenAddress(network, tokenWalletAddress);\n}\n\nexport function getAmountForTokenTransfer(tokenAddress: string, willClaimMintless: boolean) {\n  const chain = chains.ton;\n  const token = getTokenByAddress(tokenAddress);\n\n  return chain.getToncoinAmountForTransfer(token, willClaimMintless);\n}\n","import { Cell } from '@ton/core';\n\nimport type { ApiSubmitTransferWithDieselResult } from '../chains/ton/types';\nimport type {\n  ApiActivity,\n  ApiChain,\n  ApiLocalTransactionParams,\n  ApiSignedTransfer,\n  ApiTransactionActivity,\n  OnApiUpdate,\n} from '../types';\nimport type { ApiSubmitTransferOptions, ApiSubmitTransferResult, CheckTransactionDraftOptions } from './types';\n\nimport { parseAccountId } from '../../util/account';\nimport { buildLocalTxId, mergeActivitiesToMaxTime } from '../../util/activities';\nimport { getChainConfig } from '../../util/chain';\nimport { logDebugError } from '../../util/logs';\nimport { getChainBySlug } from '../../util/tokens';\nimport chains from '../chains';\nimport { fetchStoredAccount, fetchStoredAddress, fetchStoredTonWallet } from '../common/accounts';\nimport { enrichActivities } from '../common/activities';\nimport { buildLocalTransaction } from '../common/helpers';\nimport { getPendingTransfer, waitAndCreatePendingTransfer } from '../common/pendingTransfers';\nimport { FAKE_TX_ID } from '../constants';\nimport { buildTokenSlug } from './tokens';\n\nlet onUpdate: OnApiUpdate;\n\nconst { ton, tron } = chains;\n\nexport function initTransactions(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport async function fetchPastActivities(\n  accountId: string,\n  limit: number,\n  tokenSlug?: string,\n  toTimestamp?: number,\n): Promise<ApiActivity[] | undefined> {\n  try {\n    let activities = tokenSlug\n      ? await fetchTokenActivitySlice(accountId, limit, tokenSlug, toTimestamp)\n      : await fetchAllActivitySlice(accountId, limit, toTimestamp);\n\n    activities = await enrichActivities(accountId, activities, tokenSlug);\n\n    return activities;\n  } catch (err) {\n    logDebugError('fetchPastActivities', tokenSlug, err);\n    return undefined;\n  }\n}\n\nfunction fetchTokenActivitySlice(\n  accountId: string,\n  limit: number,\n  slug: string,\n  toTimestamp?: number,\n) {\n  return getChainBySlug(slug) === 'ton'\n    ? ton.fetchActivitySlice(accountId, slug, toTimestamp, undefined, limit)\n    : tron.getTokenTransactionSlice(accountId, slug, toTimestamp, undefined, limit);\n}\n\nasync function fetchAllActivitySlice(\n  accountId: string,\n  limit: number,\n  toTimestamp?: number,\n): Promise<ApiActivity[]> {\n  const account = await fetchStoredAccount(accountId);\n\n  const [tonActivities, tronActivities] = await Promise.all([\n    'ton' in account ? ton.fetchActivitySlice(accountId, undefined, toTimestamp, undefined, limit) : [],\n    'tron' in account ? tron.getAllTransactionSlice(accountId, toTimestamp, limit) : [],\n  ]);\n\n  return mergeActivitiesToMaxTime(tonActivities, tronActivities);\n}\n\nexport function checkTransactionDraft(chain: ApiChain, options: CheckTransactionDraftOptions) {\n  return chains[chain].checkTransactionDraft(options);\n}\n\nexport async function submitTransfer(\n  chain: ApiChain,\n  options: ApiSubmitTransferOptions,\n  shouldCreateLocalActivity = true,\n): Promise<(ApiSubmitTransferResult | ApiSubmitTransferWithDieselResult) & { txId?: string }> {\n  const {\n    accountId,\n    password,\n    toAddress,\n    amount,\n    tokenAddress,\n    comment,\n    fee,\n    realFee,\n    shouldEncrypt,\n    isBase64Data,\n    withDiesel,\n    dieselAmount,\n    isGaslessWithStars,\n    noFeeCheck,\n  } = options;\n  const stateInit = typeof options.stateInit === 'string' ? Cell.fromBase64(options.stateInit) : options.stateInit;\n\n  const fromAddress = await fetchStoredAddress(accountId, chain);\n\n  let result: ApiSubmitTransferResult | ApiSubmitTransferWithDieselResult;\n\n  if (withDiesel && chain === 'ton') {\n    result = await ton.submitTransferWithDiesel({\n      accountId,\n      password,\n      toAddress,\n      amount,\n      tokenAddress: tokenAddress!,\n      data: comment,\n      shouldEncrypt,\n      dieselAmount: dieselAmount!,\n      isGaslessWithStars,\n    });\n  } else {\n    result = await chains[chain].submitTransfer({\n      accountId,\n      password,\n      toAddress,\n      amount,\n      tokenAddress,\n      data: comment,\n      shouldEncrypt,\n      isBase64Data,\n      stateInit,\n      fee,\n      noFeeCheck,\n    });\n  }\n\n  if ('error' in result) {\n    return result;\n  }\n\n  if (!shouldCreateLocalActivity) {\n    return result;\n  }\n\n  const slug = tokenAddress\n    ? buildTokenSlug(chain, tokenAddress)\n    : getChainConfig(chain).nativeToken.slug;\n\n  let localActivity: ApiTransactionActivity;\n\n  if ('msgHash' in result) {\n    const { encryptedComment, msgHashNormalized } = result;\n    [localActivity] = createLocalTransactions(accountId, chain, [{\n      txId: msgHashNormalized,\n      amount,\n      fromAddress,\n      toAddress,\n      comment: shouldEncrypt ? undefined : comment,\n      encryptedComment,\n      fee: realFee ?? 0n,\n      slug,\n      externalMsgHashNorm: msgHashNormalized,\n      extra: {\n        ...('withW5Gasless' in result && { withW5Gasless: result.withW5Gasless }),\n      },\n    }]);\n    if ('paymentLink' in result && result.paymentLink) {\n      onUpdate({ type: 'openUrl', url: result.paymentLink, isExternal: true });\n    }\n  } else {\n    const { txId } = result;\n    [localActivity] = createLocalTransactions(accountId, chain, [{\n      txId,\n      amount,\n      fromAddress,\n      toAddress,\n      comment,\n      fee: realFee ?? 0n,\n      slug,\n    }]);\n  }\n\n  return {\n    ...result,\n    txId: localActivity.txId,\n  };\n}\n\nexport async function waitAndCreateTonPendingTransfer(accountId: string) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  return (await waitAndCreatePendingTransfer(network, address)).id;\n}\n\nexport async function sendSignedTransferMessage(\n  accountId: string,\n  message: ApiSignedTransfer,\n  pendingTransferId: string,\n) {\n  const { msgHashNormalized } = await ton.sendSignedMessage(accountId, message, pendingTransferId);\n\n  const [localActivity] = createLocalTransactions(accountId, 'ton', [{\n    ...message.localActivity,\n    txId: msgHashNormalized,\n    externalMsgHashNorm: msgHashNormalized,\n  }]);\n\n  return localActivity.txId;\n}\n\nexport function cancelPendingTransfer(id: string) {\n  getPendingTransfer(id)?.resolve();\n}\n\nexport function decryptComment(accountId: string, encryptedComment: string, fromAddress: string, password: string) {\n  const chain = chains.ton;\n\n  return chain.decryptComment(accountId, encryptedComment, fromAddress, password);\n}\n\nexport function createLocalTransactions(\n  accountId: string,\n  chain: ApiChain,\n  params: ApiLocalTransactionParams[],\n) {\n  const { network } = parseAccountId(accountId);\n\n  const localTransactions = params.map((subParams, index) => {\n    const { toAddress } = subParams;\n\n    let normalizedAddress: string;\n    if (subParams.normalizedAddress) {\n      normalizedAddress = subParams.normalizedAddress;\n    } else if (chain === 'ton') {\n      normalizedAddress = ton.normalizeAddress(toAddress, network);\n    } else {\n      normalizedAddress = toAddress;\n    }\n\n    return buildLocalTransaction(subParams, normalizedAddress, index);\n  });\n\n  if (localTransactions.length) {\n    onUpdate({\n      type: 'newLocalActivities',\n      activities: localTransactions,\n      accountId,\n    });\n  }\n\n  return localTransactions;\n}\n\nexport function fetchEstimateDiesel(accountId: string, tokenAddress: string) {\n  const chain = chains.ton;\n\n  return chain.fetchEstimateDiesel(accountId, tokenAddress);\n}\n\nexport async function fetchTonActivityDetails(accountId: string, activity: ApiActivity) {\n  const result = await chains.ton.fetchActivityDetails(accountId, activity);\n  return result?.activity ?? activity;\n}\n\n/**\n * Creates local activities from emulation results instead of basic transaction parameters.\n * This provides richer, parsed transaction details like \"liquidity withdrawal\" instead of \"send TON\".\n */\nexport function createLocalActivitiesFromEmulation(\n  accountId: string,\n  chain: ApiChain,\n  msgHashNormalized: string,\n  emulationActivities: ApiActivity[],\n): ApiActivity[] {\n  const localActivities: ApiActivity[] = [];\n  let localActivityIndex = 0;\n\n  emulationActivities.forEach((activity) => {\n    if (activity.shouldHide || activity.id === FAKE_TX_ID) {\n      return;\n    }\n\n    const localActivity = convertEmulationActivityToLocal(\n      activity,\n      msgHashNormalized,\n      localActivityIndex,\n      chain,\n      accountId,\n    );\n\n    localActivities.push(localActivity);\n\n    localActivityIndex++; // Increment only for visible activities\n  });\n\n  if (localActivities.length) {\n    onUpdate({\n      type: 'newLocalActivities',\n      activities: localActivities,\n      accountId,\n    });\n  }\n\n  return localActivities;\n}\n\n/**\n * Converts an emulation activity to a local activity with proper ID and timestamp\n */\nfunction convertEmulationActivityToLocal(\n  activity: ApiActivity,\n  msgHashNormalized: string,\n  index: number,\n  chain: ApiChain,\n  accountId?: string,\n): ApiActivity {\n  const localTxId = buildLocalTxId(msgHashNormalized, index);\n  const commonFields = {\n    id: localTxId,\n    timestamp: Date.now(),\n    externalMsgHashNorm: msgHashNormalized,\n    status: 'pending',\n  } satisfies Partial<ApiActivity>;\n\n  if (activity.kind === 'transaction') {\n    let normalizedAddress = activity.normalizedAddress;\n    if (!normalizedAddress && chain === 'ton' && accountId) {\n      const { network } = parseAccountId(accountId);\n      normalizedAddress = chains.ton.normalizeAddress(activity.toAddress, network);\n    }\n\n    return {\n      ...activity,\n      ...commonFields,\n      txId: localTxId,\n      normalizedAddress: normalizedAddress || activity.normalizedAddress,\n    };\n  } else {\n    return {\n      ...activity,\n      ...commonFields,\n    };\n  }\n}\n","import { Address } from '@ton/core';\n\nimport type { ApiSubmitTransferTonResult } from '../chains/ton/types';\nimport type {\n  ApiEthenaStakingState,\n  ApiJettonStakingState,\n  ApiStakingCommonData,\n  ApiStakingCommonResponse,\n  ApiStakingHistory,\n  ApiStakingState,\n  ApiTransactionActivity,\n} from '../types';\n\nimport { TONCOIN } from '../../config';\nimport { fromDecimal } from '../../util/decimals';\nimport { logDebugError } from '../../util/logs';\nimport chains from '../chains';\nimport { getTonClient } from '../chains/ton/util/tonCore';\nimport { fetchStoredAccount, fetchStoredTonWallet } from '../common/accounts';\nimport { callBackendGet } from '../common/backend';\nimport { setStakingCommonCache } from '../common/cache';\nimport { createLocalTransactions } from './transactions';\n\nimport { StakingPool } from '../chains/ton/contracts/JettonStaking/StakingPool';\n\nconst { ton } = chains;\n\nexport function initStaking() {\n}\n\nexport function checkStakeDraft(accountId: string, amount: bigint, state: ApiStakingState) {\n  return ton.checkStakeDraft(accountId, amount, state);\n}\n\nexport function checkUnstakeDraft(accountId: string, amount: bigint, state: ApiStakingState) {\n  return ton.checkUnstakeDraft(accountId, amount, state);\n}\n\nexport async function submitStake(\n  accountId: string,\n  password: string,\n  amount: bigint,\n  state: ApiStakingState,\n  realFee?: bigint,\n) {\n  const { address: fromAddress } = await fetchStoredTonWallet(accountId);\n\n  const result = await ton.submitStake(\n    accountId, password, amount, state,\n  );\n\n  if ('error' in result) {\n    return false;\n  }\n\n  let localActivity: ApiTransactionActivity;\n\n  if (state.tokenSlug === TONCOIN.slug) {\n    [localActivity] = createLocalTransactions(accountId, 'ton', [{\n      txId: result.msgHashNormalized,\n      amount,\n      fromAddress,\n      toAddress: result.toAddress,\n      fee: realFee ?? 0n,\n      type: 'stake',\n      slug: state.tokenSlug,\n      externalMsgHashNorm: result.msgHashNormalized,\n    }]);\n  } else {\n    [localActivity] = createLocalTransactions(accountId, 'ton', [{\n      txId: result.msgHashNormalized,\n      amount,\n      fromAddress,\n      toAddress: result.toAddress,\n      fee: realFee ?? 0n,\n      type: 'stake',\n      slug: state.tokenSlug,\n      externalMsgHashNorm: result.msgHashNormalized,\n    }]);\n  }\n\n  return {\n    ...result,\n    txId: localActivity.txId,\n  };\n}\n\nexport async function submitUnstake(\n  accountId: string,\n  password: string,\n  amount: bigint,\n  state: ApiStakingState,\n  realFee?: bigint,\n) {\n  const { address: fromAddress } = await fetchStoredTonWallet(accountId);\n\n  const result = await ton.submitUnstake(accountId, password, amount, state);\n  if ('error' in result) {\n    return false;\n  }\n\n  const [localActivity] = createLocalTransactions(accountId, 'ton', [{\n    txId: result.msgHashNormalized,\n    amount: result.toncoinAmount,\n    fromAddress,\n    toAddress: result.toAddress,\n    fee: realFee ?? 0n,\n    type: 'unstakeRequest',\n    slug: TONCOIN.slug,\n    externalMsgHashNorm: result.msgHashNormalized,\n    ...result.localActivityParams,\n  }]);\n\n  return {\n    ...result,\n    txId: localActivity.txId,\n  };\n}\n\nexport async function getStakingHistory(accountId: string): Promise<ApiStakingHistory> {\n  const { ton: tonWallet } = await fetchStoredAccount(accountId);\n  if (!tonWallet) return [];\n  return callBackendGet(`/staking/profits/${tonWallet.address}`);\n}\n\nexport async function tryUpdateStakingCommonData() {\n  try {\n    const tonClient = getTonClient('mainnet');\n    const response = await callBackendGet<ApiStakingCommonResponse>('/staking/common');\n\n    const data: ApiStakingCommonData = {\n      ...response,\n      liquid: {\n        ...response.liquid,\n        available: fromDecimal(response.liquid.available),\n      },\n      jettonPools: await Promise.all(response.jettonPools.map(async (pool) => {\n        const poolContract = tonClient.open(StakingPool.createFromAddress(Address.parse(pool.pool)));\n        const poolConfig = await poolContract.getStorageData();\n        return {\n          ...pool,\n          poolConfig,\n        };\n      })),\n    };\n    data.round.start *= 1000;\n    data.round.end *= 1000;\n    data.round.unlock *= 1000;\n    data.prevRound.start *= 1000;\n    data.prevRound.end *= 1000;\n    data.prevRound.unlock *= 1000;\n\n    setStakingCommonCache(data);\n  } catch (err) {\n    logDebugError('tryUpdateLiquidStakingState', err);\n  }\n}\n\nexport async function submitStakingClaimOrUnlock(\n  accountId: string,\n  password: string,\n  state: ApiJettonStakingState | ApiEthenaStakingState,\n  realFee?: bigint,\n) {\n  const { address: walletAddress } = await fetchStoredTonWallet(accountId);\n\n  let result: ApiSubmitTransferTonResult;\n\n  switch (state.type) {\n    case 'jetton': {\n      result = await ton.submitTokenStakingClaim(accountId, password, state);\n      break;\n    }\n    case 'ethena': {\n      result = await ton.submitUnstakeEthenaLocked(accountId, password, state);\n      break;\n    }\n  }\n\n  if ('error' in result) {\n    return result;\n  }\n\n  const [localActivity] = createLocalTransactions(accountId, 'ton', [{\n    txId: result.msgHashNormalized,\n    amount: result.amount,\n    fromAddress: walletAddress,\n    toAddress: result.toAddress,\n    fee: realFee ?? 0n,\n    slug: TONCOIN.slug,\n    externalMsgHashNorm: result.msgHashNormalized,\n    ...result.localActivityParams,\n  }]);\n\n  return {\n    ...result,\n    txId: localActivity.txId,\n  };\n}\n","import nacl from 'tweetnacl';\n\nimport type { Theme } from '../../global/types';\nimport type { AccountCache } from '../common/cache';\nimport type { StorageKey } from '../storages/types';\nimport type { ApiChain, ApiNetwork } from '../types';\n\nimport { setIsAppFocused } from '../../util/focusAwareDelay';\nimport { getLogs, logDebugError } from '../../util/logs';\nimport chains from '../chains';\nimport { fetchStoredAccounts, fetchStoredTonWallet, updateStoredAccount } from '../common/accounts';\nimport { callBackendGet } from '../common/backend';\nimport { updateAccountCache } from '../common/cache';\nimport { handleServerError } from '../errors';\nimport { storage } from '../storages';\n\nconst SIGN_MESSAGE = Buffer.from('MyTonWallet_AuthToken_n6i0k4w8pb');\n\nexport function checkApiAvailability(chain: ApiChain, network: ApiNetwork) {\n  return chains[chain].checkApiAvailability(network);\n}\n\nexport async function getBackendAuthToken(accountId: string, password: string) {\n  const accountWallet = await fetchStoredTonWallet(accountId);\n  let { authToken } = accountWallet;\n  const { publicKey, isInitialized } = accountWallet;\n\n  if (!authToken) {\n    const privateKey = await chains.ton.fetchPrivateKey(accountId, password);\n    const signature = nacl.sign.detached(SIGN_MESSAGE, privateKey!);\n    authToken = Buffer.from(signature).toString('base64');\n\n    await updateStoredAccount(accountId, {\n      ton: {\n        ...accountWallet,\n        authToken,\n      },\n    });\n  }\n\n  if (!isInitialized) {\n    authToken += `:${publicKey}`;\n  }\n\n  return authToken;\n}\n\nexport async function fetchAccountConfigForDebugPurposesOnly() {\n  try {\n    const [accounts, stateVersion, mnemonicsEncrypted] = await Promise.all([\n      fetchStoredAccounts(),\n      storage.getItem('stateVersion'),\n      storage.getItem('mnemonicsEncrypted' as StorageKey),\n    ]);\n\n    return JSON.stringify({ accounts, stateVersion, mnemonicsEncrypted });\n  } catch (err) {\n    logDebugError('fetchAccountConfigForDebugPurposesOnly', err);\n\n    return undefined;\n  }\n}\n\nexport function ping() {\n  return true;\n}\n\nexport function updateAccountMemoryCache(accountId: string, address: string, partial: Partial<AccountCache>) {\n  updateAccountCache(accountId, address, partial);\n}\n\nexport { setIsAppFocused, getLogs };\n\nexport async function getMoonpayOnrampUrl(chain: ApiChain, address: string, theme: Theme) {\n  try {\n    return await callBackendGet<{ url: string }>('/onramp-url', {\n      chain,\n      address,\n      theme,\n    });\n  } catch (err) {\n    logDebugError('getMoonpayOnrampUrl', err);\n\n    return handleServerError(err);\n  }\n}\n","import type { TonTransferParams } from '../chains/ton/types';\nimport type {\n  ApiChain,\n  ApiSwapActivity,\n  ApiSwapAsset,\n  ApiSwapBuildRequest,\n  ApiSwapBuildResponse,\n  ApiSwapCexCreateTransactionRequest,\n  ApiSwapCexCreateTransactionResponse,\n  ApiSwapCexEstimateRequest,\n  ApiSwapCexEstimateResponse,\n  ApiSwapEstimateRequest,\n  ApiSwapEstimateResponse,\n  ApiSwapHistoryItem,\n  ApiSwapPairAsset,\n  ApiSwapTransfer,\n  OnApiUpdate,\n} from '../types';\nimport type { ApiSubmitTransferOptions } from './types';\n\nimport { SWAP_API_VERSION, TONCOIN } from '../../config';\nimport { parseAccountId } from '../../util/account';\nimport { buildLocalTxId } from '../../util/activities';\nimport { omitUndefined } from '../../util/iteratees';\nimport chains from '../chains';\nimport { fetchStoredTonWallet } from '../common/accounts';\nimport { callBackendGet, callBackendPost } from '../common/backend';\nimport {\n  getSwapItemSlug, patchSwapItem, swapGetHistoryItem, swapItemToActivity,\n} from '../common/swap';\nimport { ApiServerError } from '../errors';\nimport { callHook } from '../hooks';\nimport { getBackendAuthToken } from './other';\nimport { submitTransfer } from './transactions';\n\nconst ton = chains.ton;\n\nlet onUpdate: OnApiUpdate;\n\nexport function initSwap(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport async function swapBuildTransfer(\n  accountId: string,\n  password: string,\n  request: ApiSwapBuildRequest,\n) {\n  const { network } = parseAccountId(accountId);\n  const authToken = await getBackendAuthToken(accountId, password);\n\n  const { address, version } = await fetchStoredTonWallet(accountId);\n  request.walletVersion = version;\n\n  const { id, transfers } = await swapBuild(authToken, request);\n\n  const transferList = transfers.map((transfer) => ({\n    ...transfer,\n    amount: BigInt(transfer.amount),\n    isBase64Payload: true,\n  }));\n\n  try {\n    await ton.validateDexSwapTransfers(network, address, request, transferList);\n\n    const result = await ton.checkMultiTransactionDraft(accountId, transferList, request.shouldTryDiesel);\n\n    if ('error' in result) {\n      await patchSwapItem({\n        address, swapId: id, authToken, error: result.error,\n      });\n      return result;\n    }\n\n    return { ...result, id, transfers };\n  } catch (err: any) {\n    await patchSwapItem({\n      address, swapId: id, authToken, error: errorToString(err),\n    });\n    throw err;\n  }\n}\n\nexport async function swapSubmit(\n  accountId: string,\n  password: string,\n  transfers: ApiSwapTransfer[],\n  historyItem: ApiSwapHistoryItem,\n  isGasless?: boolean,\n) {\n  const swapId = historyItem.id;\n  const tonWallet = await fetchStoredTonWallet(accountId);\n\n  const { address } = tonWallet;\n  const authToken = tonWallet.authToken ?? await getBackendAuthToken(accountId, password);\n\n  try {\n    const transferList: TonTransferParams[] = transfers.map((transfer) => ({\n      ...transfer,\n      amount: BigInt(transfer.amount),\n      isBase64Payload: true,\n    }));\n\n    if (historyItem.from !== TONCOIN.symbol) {\n      transferList[0] = await ton.insertMintlessPayload('mainnet', address, historyItem.from, transferList[0]);\n    }\n\n    const result = await ton.submitMultiTransfer({\n      accountId,\n      password,\n      messages: transferList,\n      isGasless,\n    });\n\n    if ('error' in result) {\n      await patchSwapItem({\n        address, swapId, authToken, error: result.error,\n      });\n      return result;\n    }\n\n    delete result.messages[0].stateInit;\n\n    const from = getSwapItemSlug(historyItem, historyItem.from);\n    const to = getSwapItemSlug(historyItem, historyItem.to);\n\n    const swap: ApiSwapActivity = {\n      ...historyItem,\n      id: buildLocalTxId(result.msgHashNormalized),\n      from,\n      to,\n      kind: 'swap',\n      externalMsgHashNorm: result.msgHashNormalized,\n      extra: omitUndefined({\n        withW5Gasless: result.withW5Gasless,\n      }),\n    };\n\n    onUpdate({\n      type: 'newLocalActivities',\n      accountId,\n      activities: [swap],\n    });\n\n    await patchSwapItem({\n      address, swapId, authToken, msgHash: result.msgHash,\n    });\n\n    void callHook('onSwapCreated', accountId, swap.timestamp - 1);\n\n    return { activityId: swap.id };\n  } catch (err: any) {\n    await patchSwapItem({\n      address, swapId, authToken, error: errorToString(err),\n    });\n    throw err;\n  }\n}\n\nfunction errorToString(err: Error | string) {\n  return typeof err === 'string' ? err : err.stack;\n}\n\nexport async function fetchSwaps(accountId: string, ids: string[]) {\n  const { address } = await fetchStoredTonWallet(accountId);\n  const results = await Promise.allSettled(\n    ids.map((id) => swapGetHistoryItem(address, id.replace('swap:', ''))),\n  );\n\n  const nonExistentIds: string[] = [];\n\n  const swaps = results\n    .map((result, i) => {\n      if (result.status === 'rejected') {\n        if (result.reason instanceof ApiServerError && result.reason.statusCode === 404) {\n          nonExistentIds.push(ids[i]);\n        }\n        return undefined;\n      }\n\n      return swapItemToActivity(result.value);\n    })\n    .filter(Boolean);\n\n  return { nonExistentIds, swaps };\n}\n\nexport async function swapEstimate(\n  accountId: string,\n  request: ApiSwapEstimateRequest,\n): Promise<ApiSwapEstimateResponse | { error: string }> {\n  const walletVersion = (await fetchStoredTonWallet(accountId)).version;\n\n  return callBackendPost('/swap/ton/estimate', {\n    ...request,\n    swapVersion: SWAP_API_VERSION,\n    walletVersion,\n  }, {\n    isAllowBadRequest: true,\n  });\n}\n\nexport function swapBuild(authToken: string, request: ApiSwapBuildRequest): Promise<ApiSwapBuildResponse> {\n  return callBackendPost('/swap/ton/build', {\n    ...request,\n    swapVersion: SWAP_API_VERSION,\n    isMsgHashMode: true,\n  }, {\n    authToken,\n  });\n}\n\nexport function swapGetAssets(): Promise<ApiSwapAsset[]> {\n  return callBackendGet('/swap/assets');\n}\n\nexport function swapGetPairs(symbolOrTokenAddress: string): Promise<ApiSwapPairAsset[]> {\n  return callBackendGet('/swap/pairs', { asset: symbolOrTokenAddress });\n}\n\nexport function swapCexEstimate(\n  request: ApiSwapCexEstimateRequest,\n): Promise<ApiSwapCexEstimateResponse | { error: string }> {\n  return callBackendPost<ApiSwapCexEstimateResponse | { error: string }>(\n    '/swap/cex/estimate',\n    request,\n    { isAllowBadRequest: true },\n  );\n}\n\nexport function swapCexValidateAddress(params: { slug: string; address: string }): Promise<{\n  result: boolean;\n  message?: string;\n}> {\n  return callBackendGet('/swap/cex/validate-address', params);\n}\n\nexport async function swapCexCreateTransaction(\n  accountId: string,\n  password: string,\n  request: ApiSwapCexCreateTransactionRequest,\n): Promise<{\n    swap: ApiSwapHistoryItem;\n    activity: ApiSwapActivity;\n  }> {\n  const authToken = await getBackendAuthToken(accountId, password);\n\n  const { swap } = await callBackendPost<ApiSwapCexCreateTransactionResponse>('/swap/cex/createTransaction', {\n    ...request,\n    swapVersion: SWAP_API_VERSION,\n  }, {\n    authToken,\n  });\n\n  const activity = swapItemToActivity(swap);\n\n  onUpdate({\n    type: 'newActivities',\n    accountId,\n    activities: [activity],\n  });\n\n  void callHook('onSwapCreated', accountId, swap.timestamp - 1);\n\n  return { swap, activity };\n}\n\nexport async function swapCexSubmit(chain: ApiChain, transferOptions: ApiSubmitTransferOptions, swapId: string) {\n  const result = await submitTransfer(chain, transferOptions, false);\n\n  if (chain === 'ton' && 'msgHash' in result) {\n    const { accountId, password } = transferOptions;\n    const { address } = await fetchStoredTonWallet(accountId);\n    const authToken = await getBackendAuthToken(accountId, password);\n    await patchSwapItem({ address, authToken, msgHash: result.msgHash, swapId });\n  }\n\n  return result;\n}\n","import type {\n  ApiAccountAny,\n  ApiAccountConfig,\n  ApiAccountWithMnemonic,\n  ApiActivityTimestamps,\n  ApiBackendConfig,\n  ApiChain,\n  ApiNetwork,\n  ApiSwapAsset,\n  ApiTokenDetails,\n  ApiTokenWithPrice,\n  ApiUpdatingStatus,\n  OnApiUpdate,\n} from '../types';\n\nimport { IS_AIR_APP, IS_CORE_WALLET, IS_STAKING_DISABLED, TONCOIN } from '../../config';\nimport { parseAccountId } from '../../util/account';\nimport { areDeepEqual } from '../../util/areDeepEqual';\nimport { getChainConfig } from '../../util/chain';\nimport { omit } from '../../util/iteratees';\nimport { logDebugError } from '../../util/logs';\nimport { OrGate } from '../../util/orGate';\nimport { forbidConcurrency } from '../../util/schedulers';\nimport chains from '../chains';\nimport { fetchMaybeStoredAccount, fetchStoredAccount, fetchStoredAccounts } from '../common/accounts';\nimport { tryUpdateKnownAddresses } from '../common/addresses';\nimport { callBackendGet, callBackendPost } from '../common/backend';\nimport { setBackendConfigCache } from '../common/cache';\nimport { pollingLoop } from '../common/polling/utils';\nimport { getBaseCurrency } from '../common/prices';\nimport { getTokensCache, loadTokensCache, tokensPreload, updateTokens } from '../common/tokens';\nimport { MINUTE, SEC } from '../constants';\nimport { resolveDataPreloadPromise } from './preload';\nimport { tryUpdateStakingCommonData } from './staking';\nimport { swapGetAssets } from './swap';\n\nconst BACKEND_INTERVAL = 30 * SEC;\nconst LONG_BACKEND_INTERVAL = MINUTE;\nconst INCORRECT_TIME_DIFF = 30 * SEC;\n\nconst ACCOUNT_CONFIG_INTERVAL = { focused: MINUTE, notFocused: 10 * MINUTE };\n\nconst MAX_POST_TOKENS = 1000;\n\nlet onUpdate: OnApiUpdate;\nlet stopCommonBackendPolling: NoneToVoidFunction | undefined;\nlet stopActiveAccountPolling: NoneToVoidFunction | undefined;\nconst inactiveAccountPolling = IS_AIR_APP ? createInactiveAccountsPollingManager() : undefined;\nconst setUpdatingStatus = createUpdatingStatusManager();\n\nexport function initPolling(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n\n  void loadTokensCache();\n\n  void Promise.allSettled([\n    tryUpdateKnownAddresses(),\n    tryUpdateTokens(),\n    !IS_STAKING_DISABLED && tryUpdateSwapTokens(),\n    tryUpdateStakingCommonData(),\n  ]).then(() => resolveDataPreloadPromise());\n\n  void tryUpdateConfig();\n\n  stopCommonBackendPolling?.();\n  stopCommonBackendPolling = setupCommonBackendPolling();\n}\n\nexport async function destroyPolling() {\n  stopCommonBackendPolling?.();\n  stopCommonBackendPolling = undefined;\n  removeAllPollingAccounts();\n  await setActivePollingAccount(undefined, {});\n}\n\nfunction setupCommonBackendPolling() {\n  const stopFns = [\n    pollingLoop({\n      period: BACKEND_INTERVAL,\n      skipInitialPoll: true,\n      poll: tryUpdateTokens,\n    }).stop,\n    pollingLoop({\n      period: LONG_BACKEND_INTERVAL,\n      skipInitialPoll: true,\n      async poll() {\n        await Promise.all([\n          tryUpdateKnownAddresses(),\n          !IS_STAKING_DISABLED && tryUpdateStakingCommonData(),\n          tryUpdateConfig(),\n          tryUpdateSwapTokens(),\n        ]);\n      },\n    }).stop,\n  ];\n\n  return () => {\n    for (const stopFn of stopFns) {\n      stopFn();\n    }\n  };\n}\n\nexport async function tryUpdateTokens() {\n  try {\n    const baseCurrency = await getBaseCurrency();\n\n    const tokens = await callBackendGet<ApiTokenWithPrice[]>('/assets', { base: baseCurrency });\n    for (const token of tokens) {\n      token.isFromBackend = true;\n    }\n\n    await tokensPreload.promise;\n    const tokensCache = getTokensCache();\n\n    const nonBackendTokenAddresses = Object.values(tokensCache.bySlug).reduce((result, token) => {\n      if (!token.isFromBackend && token.tokenAddress) {\n        result.push(token.tokenAddress);\n      }\n      return result;\n    }, [] as string[]);\n\n    // POST is used to retrieve data due to the potentially large number of addresses\n    const nonBackendTokenDetails = nonBackendTokenAddresses.length\n      ? await callBackendPost<ApiTokenDetails[]>(`/assets?base=${baseCurrency}`, {\n        assets: nonBackendTokenAddresses.slice(0, MAX_POST_TOKENS),\n      }) : undefined;\n\n    await updateTokens(tokens, onUpdate, nonBackendTokenDetails, baseCurrency, true);\n  } catch (err) {\n    logDebugError('tryUpdateTokens', err);\n  }\n}\n\nexport async function tryUpdateSwapTokens() {\n  try {\n    const assets = await swapGetAssets();\n\n    await tokensPreload.promise;\n    const tokensCache = getTokensCache();\n\n    const tokens = assets.reduce((acc: Record<string, ApiSwapAsset>, asset) => {\n      acc[asset.slug] = {\n        // Fix legacy variable names\n        ...omit(asset as any, ['blockchain']) as ApiSwapAsset,\n        chain: 'blockchain' in asset ? asset.blockchain as string : asset.chain,\n        tokenAddress: 'contract' in asset && asset.contract !== TONCOIN.symbol\n          ? asset.contract as string\n          : asset.tokenAddress,\n        price: tokensCache.bySlug[asset.slug]?.price ?? 0,\n      };\n      return acc;\n    }, {});\n\n    onUpdate({\n      type: 'updateSwapTokens',\n      tokens,\n    });\n  } catch (err) {\n    logDebugError('tryUpdateSwapTokens', err);\n  }\n}\n\nexport async function tryUpdateConfig() {\n  try {\n    const config = await callBackendGet<ApiBackendConfig>('/utils/get-config');\n    setBackendConfigCache(config);\n\n    const {\n      isLimited,\n      isCopyStorageEnabled = false,\n      supportAccountsCount = 1,\n      now: serverUtc,\n      country: countryCode,\n      isUpdateRequired: isAppUpdateRequired,\n    } = config;\n\n    onUpdate({\n      type: 'updateConfig',\n      isLimited,\n      isCopyStorageEnabled,\n      supportAccountsCount,\n      countryCode,\n      isAppUpdateRequired,\n    });\n\n    const localUtc = (new Date()).getTime();\n    if (Math.abs(serverUtc - localUtc) > INCORRECT_TIME_DIFF) {\n      onUpdate({\n        type: 'incorrectTime',\n      });\n    }\n  } catch (err) {\n    logDebugError('tryUpdateRegion', err);\n  }\n}\n\n/** Call it every time the active account changes */\nexport async function setActivePollingAccount(\n  accountId: string | undefined,\n  newestActivityTimestamps: ApiActivityTimestamps,\n) {\n  stopActiveAccountPolling?.();\n  stopActiveAccountPolling = undefined;\n\n  inactiveAccountPolling?.setActiveAccount(accountId);\n\n  if (accountId) {\n    const account = await fetchStoredAccount(accountId);\n\n    const stopPollingFns = [\n      !IS_CORE_WALLET && setupAccountConfigPolling(accountId, account).stop,\n\n      ...(Object.keys(chains) as (keyof typeof chains)[]).map((chain) => (\n        chains[chain].setupActivePolling(\n          accountId,\n          account,\n          onUpdate,\n          setUpdatingStatus.bind(undefined, accountId, chain),\n          pickChainTimestamps(newestActivityTimestamps, chain),\n        )\n      )),\n    ];\n\n    stopActiveAccountPolling = () => {\n      for (const stopFn of stopPollingFns) {\n        if (stopFn) {\n          stopFn();\n        }\n      }\n    };\n  }\n}\n\n/** Call it every time a new account is created */\nexport function addPollingAccount(accountId: string, account: ApiAccountAny) {\n  inactiveAccountPolling?.addAccount(accountId, account);\n}\n\n/** Call it every time an account is removed (except for cases in the other remove...account functions) */\nexport function removePollingAccount(accountId: string) {\n  inactiveAccountPolling?.removeAccount(accountId);\n}\n\n/** Call it every time all accounts of a network are removed */\nexport function removeNetworkPollingAccounts(network: ApiNetwork) {\n  inactiveAccountPolling?.removeNetworkAccounts(network);\n}\n\n/** Call it every time all accounts are removed */\nexport function removeAllPollingAccounts() {\n  inactiveAccountPolling?.removeAllAccounts();\n}\n\nfunction setupAccountConfigPolling(accountId: string, account: ApiAccountAny) {\n  let lastResult: ApiAccountConfig | undefined;\n\n  const partialAccount = omit(account as ApiAccountWithMnemonic, ['mnemonicEncrypted']);\n\n  return pollingLoop({\n    period: ACCOUNT_CONFIG_INTERVAL,\n    async poll() {\n      try {\n        const accountConfig = await callBackendPost<ApiAccountConfig>('/account-config', partialAccount);\n\n        if (!areDeepEqual(accountConfig, lastResult)) {\n          lastResult = accountConfig;\n          onUpdate({\n            type: 'updateAccountConfig',\n            accountId,\n            accountConfig,\n          });\n        }\n      } catch (err) {\n        logDebugError('setupBackendAccountPolling', err);\n      }\n    },\n  });\n}\n\n/**\n * Returns a stateful function that receives updating statuses from multiple chains and merges them together into a\n * single set of consistent 'updatingStatus' events for the UI.\n */\nfunction createUpdatingStatusManager() {\n  const updatingStatuses = new Map<string, OrGate<ApiChain>>();\n\n  return (accountId: string, chain: ApiChain, kind: ApiUpdatingStatus['kind'], isUpdating: boolean) => {\n    const key = `${accountId} ${kind}`;\n    let chainsBeingUpdated = updatingStatuses.get(key);\n    if (!chainsBeingUpdated) {\n      chainsBeingUpdated = new OrGate<ApiChain>((isUpdating) => {\n        onUpdate({ type: 'updatingStatus', kind, accountId, isUpdating });\n      });\n      updatingStatuses.set(key, chainsBeingUpdated);\n    }\n\n    chainsBeingUpdated.toggle(chain, isUpdating);\n  };\n}\n\n/**\n * Manages polling for the inactive accounts.\n * The goal is polling the accounts from the network of the current active account, but not the active account itself.\n *\n * @todo: Deduplicate polling the same addresses, if multiple accounts have it\n */\nfunction createInactiveAccountsPollingManager() {\n  const stopByAccount: Record<string, NoneToVoidFunction> = {};\n  let activeAccountId: string | undefined;\n\n  async function setActiveAccount(accountId: string | undefined) {\n    if (accountId === activeAccountId) {\n      return;\n    }\n\n    if (accountId === undefined) {\n      stopAllPollings();\n      return;\n    }\n\n    if (!activeAccountId || parseAccountId(accountId).network !== parseAccountId(activeAccountId).network) {\n      await switchNetwork(accountId);\n      return;\n    }\n\n    const previousActiveAccountId = activeAccountId;\n    activeAccountId = accountId;\n\n    // Stop polling the now active account\n    stopByAccount[activeAccountId]?.();\n    delete stopByAccount[activeAccountId];\n\n    // Start polling the previous active account\n    const previousActiveAccount = await fetchMaybeStoredAccount(previousActiveAccountId);\n    if (previousActiveAccount) { // The previously active account may get removed at this moment\n      startAccountPolling(previousActiveAccountId, previousActiveAccount);\n    }\n  }\n\n  function addAccount(accountId: string, account: ApiAccountAny) {\n    const isActiveAccount = accountId === activeAccountId;\n    const isCurrentNetwork = activeAccountId\n      && parseAccountId(accountId).network === parseAccountId(activeAccountId).network;\n\n    if (!isActiveAccount && isCurrentNetwork) {\n      startAccountPolling(accountId, account);\n    }\n  }\n\n  function removeAccount(accountId: string) {\n    stopByAccount[accountId]?.();\n    delete stopByAccount[accountId];\n  }\n\n  function removeNetworkAccounts(network: ApiNetwork) {\n    if (activeAccountId && parseAccountId(activeAccountId).network === network) {\n      // Inactive account polling must poll only the network of the active account, so removing the network means removing all account\n      stopAllPollings();\n    }\n  }\n\n  function removeAllAccounts() {\n    stopAllPollings();\n  }\n\n  async function switchNetwork(newActiveAccountId: string) {\n    stopAllPollings();\n    activeAccountId = newActiveAccountId;\n    const { network } = parseAccountId(activeAccountId);\n    const accounts = await fetchStoredAccounts();\n    const otherAccountIds = Object.keys(accounts).filter((accountId) => (\n      accountId !== activeAccountId\n      && parseAccountId(accountId).network === network\n    ));\n    otherAccountIds.map((accountId) => startAccountPolling(accountId, accounts[accountId]));\n  }\n\n  function startAccountPolling(accountId: string, account: ApiAccountAny) {\n    if (stopByAccount[accountId]) return;\n\n    const stopFns = Object.values(chains).map((chain) => chain.setupInactivePolling(accountId, account, onUpdate));\n    stopByAccount[accountId] = () => {\n      for (const stopChain of stopFns) {\n        stopChain();\n      }\n    };\n  }\n\n  function stopAllPollings() {\n    for (const [accountId, stopAccountPolling] of Object.entries(stopByAccount)) {\n      stopAccountPolling();\n      delete stopByAccount[accountId];\n    }\n  }\n\n  const preventRaceCondition = forbidConcurrency as\n    <Args extends unknown[]>(task: (...args: Args) => unknown) => (...args: Args) => void;\n\n  return {\n    setActiveAccount: preventRaceCondition(setActiveAccount),\n    addAccount: preventRaceCondition(addAccount),\n    removeAccount: preventRaceCondition(removeAccount),\n    removeNetworkAccounts: preventRaceCondition(removeNetworkAccounts),\n    removeAllAccounts: preventRaceCondition(removeAllAccounts),\n  };\n}\n\nfunction pickChainTimestamps(bySlug: ApiActivityTimestamps, chain: ApiChain) {\n  const { slug: nativeSlug } = getChainConfig(chain).nativeToken;\n  return Object.entries(bySlug).reduce((newBySlug, [slug, timestamp]) => {\n    if (slug === nativeSlug || slug.startsWith(`${chain}-`)) {\n      newBySlug[slug] = timestamp;\n    }\n    return newBySlug;\n  }, {} as ApiActivityTimestamps);\n}\n","import type { ApiActivityTimestamps, ApiLedgerAccount, ApiTonWallet, OnApiUpdate } from '../types';\n\nimport { IS_EXTENSION } from '../../config';\nimport { fetchStoredAccount, fetchStoredTonWallet, getCurrentAccountId, loginResolve } from '../common/accounts';\nimport { waitStorageMigration } from '../common/helpers';\nimport { sendUpdateTokens } from '../common/tokens';\nimport { callHook } from '../hooks';\nimport { storage } from '../storages';\nimport { setActivePollingAccount } from './polling';\n\nlet onUpdate: OnApiUpdate;\n\nexport function initAccounts(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport async function activateAccount(accountId: string, newestActivityTimestamps: ApiActivityTimestamps = {}) {\n  await waitStorageMigration();\n\n  const prevAccountId = await getCurrentAccountId();\n  const isFirstLogin = !prevAccountId;\n\n  await storage.setItem('currentAccountId', accountId);\n  loginResolve();\n\n  if (IS_EXTENSION) {\n    void callHook('onFirstLogin');\n  }\n\n  if (isFirstLogin) {\n    sendUpdateTokens(onUpdate);\n  }\n\n  void setActivePollingAccount(accountId, newestActivityTimestamps);\n}\n\nexport async function deactivateAllAccounts() {\n  void setActivePollingAccount(undefined, {});\n  await storage.removeItem('currentAccountId');\n\n  if (IS_EXTENSION) {\n    void callHook('onFullLogout');\n  }\n}\n\nexport function fetchTonWallet(accountId: string): Promise<ApiTonWallet> {\n  return fetchStoredTonWallet(accountId);\n}\n\nexport function fetchLedgerAccount(accountId: string) {\n  return fetchStoredAccount<ApiLedgerAccount>(accountId);\n}\n","import type {\n  ApiDapp, ApiDappsByUrl, ApiDappsState, ApiNetwork, ApiSite, ApiSiteCategory, OnApiUpdate,\n} from '../types';\n\nimport { parseAccountId } from '../../util/account';\nimport isEmptyObject from '../../util/isEmptyObject';\nimport {\n  getAccountValue,\n  removeAccountValue,\n  removeNetworkAccountsValue,\n  setAccountValue,\n} from '../common/accounts';\nimport { callBackendGet } from '../common/backend';\nimport { isUpdaterAlive } from '../common/helpers';\nimport { callHook } from '../hooks';\nimport { storage } from '../storages';\n\nlet onUpdate: OnApiUpdate;\n\nexport function initDapps(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport async function updateDapp(\n  accountId: string,\n  url: string,\n  uniqueId: string,\n  update: Partial<ApiDapp>,\n) {\n  const dapp = await getDapp(accountId, url, uniqueId);\n  if (!dapp) return;\n  await addDapp(accountId, { ...dapp, ...update }, uniqueId);\n}\n\nexport async function getDapp(\n  accountId: string,\n  url: string,\n  uniqueId: string,\n): Promise<ApiDapp | undefined> {\n  const byUrl = (\n    await getAccountValue(accountId, 'dapps') as ApiDappsByUrl | undefined\n  )?.[url];\n  if (!byUrl) return undefined;\n\n  return byUrl[uniqueId];\n}\n\nexport async function addDapp(accountId: string, dapp: ApiDapp, uniqueId: string) {\n  const dapps = await getDappsByUrl(accountId);\n\n  if (!dapps[dapp.url]) {\n    dapps[dapp.url] = {};\n  }\n\n  dapps[dapp.url][uniqueId] = dapp;\n  await setAccountValue(accountId, 'dapps', dapps);\n}\n\nexport async function deleteDapp(\n  accountId: string,\n  url: string,\n  uniqueId: string,\n  dontNotifyDapp?: boolean,\n) {\n  const dapps = await getDappsByUrl(accountId);\n  if (!(url in dapps)) {\n    return false;\n  }\n\n  delete dapps[url][uniqueId];\n  if (isEmptyObject(dapps[url])) {\n    delete dapps[url];\n  }\n\n  await setAccountValue(accountId, 'dapps', dapps);\n\n  if (onUpdate && isUpdaterAlive(onUpdate)) {\n    onUpdate({\n      type: 'dappDisconnect',\n      accountId,\n      url,\n    });\n  }\n\n  if (!dontNotifyDapp) {\n    await callHook('onDappDisconnected', accountId, url);\n  }\n\n  await callHook('onDappsChanged');\n\n  return true;\n}\n\nexport async function deleteAllDapps(accountId: string) {\n  const urls = Object.keys(await getDappsByUrl(accountId));\n  await setAccountValue(accountId, 'dapps', {});\n\n  urls.forEach((url) => {\n    onUpdate({\n      type: 'dappDisconnect',\n      accountId,\n      url,\n    });\n    void callHook('onDappDisconnected', accountId, url);\n  });\n\n  await callHook('onDappsChanged');\n}\n\nexport async function getDapps(accountId: string): Promise<ApiDapp[]> {\n  const byUrl = await getDappsByUrl(accountId);\n  return Object.values(byUrl).flatMap((byId) => Object.values(byId));\n}\n\nexport async function getDappsByUrl(accountId: string): Promise<ApiDappsByUrl> {\n  return (await getAccountValue(accountId, 'dapps')) || {};\n}\n\nexport async function findLastConnectedAccount(network: ApiNetwork, url: string) {\n  const dapps = await getDappsState() || {};\n\n  let connectedAt = 0;\n  let lastConnectedAccountId: string | undefined;\n\n  Object.entries(dapps).forEach(([accountId, byUrl]) => {\n    const connections = byUrl[url];\n    if (!connections) return;\n    if (parseAccountId(accountId).network !== network) return;\n\n    Object.values(connections).forEach((conn) => {\n      if (conn.connectedAt > connectedAt) {\n        connectedAt = conn.connectedAt;\n        lastConnectedAccountId = accountId;\n      }\n    });\n  });\n\n  return lastConnectedAccountId;\n}\n\nexport function getDappsState(): Promise<ApiDappsState | undefined> {\n  return storage.getItem('dapps');\n}\n\nexport async function removeAccountDapps(accountId: string) {\n  await removeAccountValue(accountId, 'dapps');\n\n  void callHook('onDappsChanged');\n}\n\nexport async function removeAllDapps() {\n  await storage.removeItem('dapps');\n\n  await callHook('onDappsChanged');\n}\n\nexport function removeNetworkDapps(network: ApiNetwork) {\n  return removeNetworkAccountsValue(network, 'dapps');\n}\n\nexport function getSseLastEventId(): Promise<string | undefined> {\n  return storage.getItem('sseLastEventId');\n}\n\nexport function setSseLastEventId(lastEventId: string) {\n  return storage.setItem('sseLastEventId', lastEventId);\n}\n\nexport function loadExploreSites(\n  { isLandscape }: { isLandscape: boolean },\n): Promise<{ categories: ApiSiteCategory[]; sites: ApiSite[] }> {\n  return callBackendGet('/v2/dapp/catalog', { isLandscape });\n}\n","import type { GlobalState } from '../../global/types';\nimport type { LedgerWalletInfo } from '../../util/ledger/types';\nimport type { ApiTonWalletVersion } from '../chains/ton/types';\nimport type {\n  ApiAccountAny,\n  ApiAccountWithMnemonic,\n  ApiActivityTimestamps,\n  ApiImportAddressByChain,\n  ApiLedgerDriver,\n  ApiNetwork,\n  ApiTonAccount,\n  ApiTonWallet,\n  ApiViewAccount,\n} from '../types';\nimport { ApiCommonError } from '../types';\n\nimport { DEFAULT_WALLET_VERSION, IS_BIP39_MNEMONIC_ENABLED, IS_CORE_WALLET } from '../../config';\nimport { parseAccountId } from '../../util/account';\nimport isMnemonicPrivateKey from '../../util/isMnemonicPrivateKey';\nimport { createTaskQueue } from '../../util/schedulers';\nimport chains from '../chains';\nimport { toBase64Address } from '../chains/ton/util/tonCore';\nimport {\n  fetchStoredAccounts,\n  fetchStoredTonAccount,\n  getAddressesFromAccount,\n  getNewAccountId,\n  removeAccountValue,\n  removeNetworkAccountsValue,\n  setAccountValue,\n  updateStoredAccount,\n} from '../common/accounts';\nimport {\n  decryptMnemonic,\n  encryptMnemonic,\n  generateBip39Mnemonic,\n  validateBip39Mnemonic,\n} from '../common/mnemonic';\nimport { tokenRepository } from '../db';\nimport { getEnvironment } from '../environment';\nimport { handleServerError } from '../errors';\nimport { storage } from '../storages';\nimport { activateAccount, deactivateAllAccounts } from './accounts';\nimport { removeAccountDapps, removeAllDapps, removeNetworkDapps } from './dapps';\nimport {\n  addPollingAccount,\n  removeAllPollingAccounts,\n  removeNetworkPollingAccounts,\n  removePollingAccount,\n} from './polling';\n\nconst { ton, tron } = chains;\n\nexport function generateMnemonic(isBip39: boolean) {\n  if (isBip39) return generateBip39Mnemonic();\n  return ton.generateMnemonic();\n}\n\nexport function createWallet(\n  network: ApiNetwork,\n  mnemonic: string[],\n  password: string,\n  version?: ApiTonWalletVersion,\n) {\n  if (!version) version = DEFAULT_WALLET_VERSION;\n\n  return importMnemonic(network, mnemonic, password, version);\n}\n\nexport function validateMnemonic(mnemonic: string[]) {\n  return (validateBip39Mnemonic(mnemonic) && IS_BIP39_MNEMONIC_ENABLED) || chains.ton.validateMnemonic(mnemonic);\n}\n\nexport async function importMnemonic(\n  network: ApiNetwork,\n  mnemonic: string[],\n  password: string,\n  version?: ApiTonWalletVersion,\n) {\n  const isPrivateKey = isMnemonicPrivateKey(mnemonic);\n  let isBip39Mnemonic = validateBip39Mnemonic(mnemonic);\n  const isTonMnemonic = await ton.validateMnemonic(mnemonic);\n\n  if (!isPrivateKey && !isTonMnemonic && (!isBip39Mnemonic || !IS_BIP39_MNEMONIC_ENABLED)) {\n    throw new Error('Invalid mnemonic');\n  }\n\n  const mnemonicEncrypted = await encryptMnemonic(mnemonic, password);\n\n  // This is a defensive approach against potential corrupted encryption reported by some users\n  const decryptedMnemonic = await decryptMnemonic(mnemonicEncrypted, password)\n    .catch(() => undefined);\n\n  if (!password || !decryptedMnemonic) {\n    return { error: ApiCommonError.DebugError };\n  }\n\n  let account: ApiAccountAny;\n  let tonWallet: ApiTonWallet & { lastTxId?: string } | undefined;\n\n  try {\n    if (isBip39Mnemonic && isTonMnemonic) {\n      tonWallet = await ton.getWalletFromMnemonic(mnemonic, network, version);\n      if (tonWallet.lastTxId) {\n        isBip39Mnemonic = false;\n      }\n    }\n\n    if (isBip39Mnemonic) {\n      const tronWallet = tron.getWalletFromBip39Mnemonic(network, mnemonic);\n      tonWallet = await ton.getWalletFromBip39Mnemonic(network, mnemonic);\n\n      account = {\n        type: 'bip39',\n        mnemonicEncrypted,\n        tron: tronWallet,\n        ton: tonWallet,\n      };\n    } else {\n      if (!tonWallet) {\n        tonWallet = isPrivateKey\n          ? await ton.getWalletFromPrivateKey(mnemonic[0], network, version)\n          : await ton.getWalletFromMnemonic(mnemonic, network, version);\n      }\n      account = {\n        type: 'ton',\n        mnemonicEncrypted,\n        ton: tonWallet,\n      };\n    }\n\n    const accountId = await addAccount(network, account);\n    const secondNetworkAccount = IS_CORE_WALLET ? await createAccountWithSecondNetwork({\n      accountId, network, mnemonic, mnemonicEncrypted, version,\n    }) : undefined;\n    void activateAccount(accountId);\n\n    return {\n      accountId,\n      addressByChain: getAddressesFromAccount(account),\n      secondNetworkAccount,\n    };\n  } catch (err) {\n    return handleServerError(err);\n  }\n}\n\nexport async function createAccountWithSecondNetwork(options: {\n  accountId: string;\n  network: ApiNetwork;\n  mnemonic: string[];\n  mnemonicEncrypted: string;\n  version?: ApiTonWalletVersion;\n}): Promise<GlobalState['auth']['secondNetworkAccount']> {\n  const {\n    mnemonic, version, mnemonicEncrypted,\n  } = options;\n  const { network, accountId } = options;\n  const tonWallet = await ton.getWalletFromMnemonic(mnemonic, network, version);\n\n  const secondNetwork = network === 'testnet' ? 'mainnet' : 'testnet';\n  tonWallet.address = toBase64Address(tonWallet.address, false, secondNetwork);\n  const account: ApiTonAccount = {\n    type: 'ton',\n    mnemonicEncrypted,\n    ton: tonWallet,\n  };\n  const secondAccountId = await addAccount(secondNetwork, account, parseAccountId(accountId).id);\n\n  return {\n    accountId: secondAccountId,\n    addressByChain: { ton: tonWallet.address },\n    network: secondNetwork,\n  };\n}\n\nexport async function importLedgerWallet(network: ApiNetwork, walletInfo: LedgerWalletInfo) {\n  const {\n    publicKey, address, index, driver, deviceId, deviceName, version,\n  } = walletInfo;\n\n  const accountId = await addAccount(network, {\n    type: 'ledger',\n    ton: {\n      type: 'ton',\n      address,\n      publicKey,\n      version,\n      index,\n    },\n    driver,\n    deviceId,\n    deviceName,\n  });\n\n  return { accountId, address, walletInfo };\n}\n\n// When multiple Ledger accounts are imported, they all are created simultaneously. This causes a race condition causing\n// multiple accounts having the same id. `createTaskQueue(1)` forces the accounts to be imported sequentially.\nconst addAccountMutex = createTaskQueue(1);\n\nasync function addAccount(network: ApiNetwork, account: ApiAccountAny, preferredId?: number) {\n  const accountId = await addAccountMutex.run(async () => {\n    const accountId = await getNewAccountId(network, preferredId);\n    await setAccountValue(accountId, 'accounts', account);\n    return accountId;\n  });\n\n  addPollingAccount(accountId, account);\n\n  return accountId;\n}\n\nexport async function removeNetworkAccounts(network: ApiNetwork) {\n  removeNetworkPollingAccounts(network);\n\n  await Promise.all([\n    deactivateAllAccounts(),\n    removeNetworkAccountsValue(network, 'accounts'),\n    getEnvironment().isDappSupported && removeNetworkDapps(network),\n  ]);\n}\n\nexport async function resetAccounts() {\n  removeAllPollingAccounts();\n\n  await Promise.all([\n    deactivateAllAccounts(),\n    storage.removeItem('accounts'),\n    getEnvironment().isDappSupported && removeAllDapps(),\n    tokenRepository.clear(),\n  ]);\n}\n\nexport async function removeAccount(\n  accountId: string,\n  nextAccountId: string,\n  newestActivityTimestamps?: ApiActivityTimestamps,\n) {\n  removePollingAccount(accountId);\n\n  await Promise.all([\n    removeAccountValue(accountId, 'accounts'),\n    getEnvironment().isDappSupported && removeAccountDapps(accountId),\n  ]);\n\n  await activateAccount(nextAccountId, newestActivityTimestamps);\n}\n\nexport async function changePassword(oldPassword: string, password: string) {\n  for (const [accountId, account] of Object.entries(await fetchStoredAccounts())) {\n    if (!('mnemonicEncrypted' in account)) continue;\n\n    const mnemonic = await decryptMnemonic(account.mnemonicEncrypted, oldPassword);\n    const encryptedMnemonic = await encryptMnemonic(mnemonic, password);\n\n    await updateStoredAccount<ApiAccountWithMnemonic>(accountId, {\n      mnemonicEncrypted: encryptedMnemonic,\n    });\n  }\n}\n\nexport async function importViewAccount(network: ApiNetwork, addressByChain: ApiImportAddressByChain) {\n  try {\n    const account: ApiViewAccount = {\n      type: 'view',\n    };\n    let title: string | undefined;\n\n    if (addressByChain.ton) {\n      const wallet = await ton.getWalletFromAddress(network, addressByChain.ton);\n      if ('error' in wallet) return { ...wallet, chain: 'ton' };\n      account.ton = wallet.wallet;\n      title = wallet.title;\n    }\n\n    if (addressByChain.tron) {\n      account.tron = {\n        type: 'tron',\n        address: addressByChain.tron,\n        index: 0,\n      };\n    }\n\n    const accountId = await addAccount(network, account);\n    void activateAccount(accountId);\n\n    return {\n      accountId,\n      title,\n      resolvedAddresses: getAddressesFromAccount(account),\n    };\n  } catch (err) {\n    return handleServerError(err);\n  }\n}\n\nexport async function importNewWalletVersion(accountId: string, version: ApiTonWalletVersion): Promise<{\n  isNew: true;\n  accountId: string;\n  address: string;\n  ledger?: { index: number; driver: ApiLedgerDriver };\n} | {\n  isNew: false;\n  accountId: string;\n}> {\n  const { network } = parseAccountId(accountId);\n  const account = await fetchStoredTonAccount(accountId);\n  const newAccount = {\n    ...account,\n    ton: ton.getOtherVersionWallet(network, account.ton, version),\n  };\n\n  const accounts = await fetchStoredAccounts();\n  const existingAccount = Object.entries(accounts).find(([, account]) => {\n    return account.ton?.address === newAccount.ton.address && account.type === newAccount.type;\n  });\n\n  if (existingAccount) {\n    return {\n      isNew: false,\n      accountId: existingAccount[0],\n    };\n  }\n\n  const ledger = account.type === 'ledger'\n    ? { index: account.ton.index, driver: account.driver }\n    : undefined;\n\n  const newAccountId = await addAccount(network, newAccount);\n\n  return {\n    isNew: true,\n    accountId: newAccountId,\n    address: newAccount.ton.address,\n    ledger,\n  };\n}\n","import generateUniqueId from '../../util/generateUniqueId';\nimport { ApiUserRejectsError } from '../errors';\n\nconst deferreds = new Map<string, Deferred>();\n\nclass Deferred<T = any> {\n  resolve!: AnyToVoidFunction;\n\n  reject!: AnyToVoidFunction;\n\n  promise = new Promise<T>((resolve, reject) => {\n    this.resolve = resolve;\n    this.reject = reject;\n  });\n}\n\nexport function createDappPromise(promiseId = generateUniqueId()) {\n  const deferred = new Deferred();\n\n  deferreds.set(promiseId, deferred);\n\n  const { promise } = deferred;\n\n  return { promiseId, promise };\n}\n\nexport function resolveDappPromise(promiseId: string, value?: any) {\n  const deferred = deferreds.get(promiseId);\n  if (!deferred) {\n    return;\n  }\n\n  deferred.resolve(value);\n  deferreds.delete(promiseId);\n}\n\nexport function rejectDappPromise(promiseId: string, reason: string = 'Unknown rejection reason') {\n  const deferred = deferreds.get(promiseId);\n  if (!deferred) {\n    return;\n  }\n\n  deferred.reject(new ApiUserRejectsError(reason));\n  deferreds.delete(promiseId);\n}\n\nexport function rejectAllDappPromises(message: string) {\n  Array.from(deferreds.keys()).forEach((id) => {\n    rejectDappPromise(id, message);\n  });\n}\n","import * as tonWebMnemonic from 'tonweb-mnemonic';\n\nimport type { ApiAccountWithMnemonic, ApiChain, ApiNetwork } from '../types';\n\nimport { parseAccountId } from '../../util/account';\nimport chains from '../chains';\nimport { fetchPrivateKey as fetchTonPrivateKey } from '../chains/ton';\nimport { checkToAddress } from '../chains/ton/transfer';\nimport {\n  fetchStoredAccount,\n  fetchStoredAccounts,\n  fetchStoredAddress,\n  fetchStoredTonWallet,\n  getAccountWithMnemonic,\n} from '../common/accounts';\nimport * as dappPromises from '../common/dappPromises';\nimport { getMnemonic } from '../common/mnemonic';\nimport { handleServerError } from '../errors';\n\nconst ton = chains.ton;\n\nexport async function fetchPrivateKey(accountId: string, password: string) {\n  const account = await fetchStoredAccount<ApiAccountWithMnemonic>(accountId);\n  const privateKey = await fetchTonPrivateKey(accountId, password, account);\n\n  return Buffer.from(privateKey!).toString('hex');\n}\n\nexport async function fetchMnemonic(accountId: string, password: string) {\n  const account = await fetchStoredAccount<ApiAccountWithMnemonic>(accountId);\n  return getMnemonic(accountId, password, account);\n}\n\nexport function getMnemonicWordList() {\n  return tonWebMnemonic.wordlists.default;\n}\n\nexport async function checkWorkerStorageIntegrity(): Promise<boolean> {\n  /*\n    This method is intended to check if the worker storage is corrupted due to known\n    behavior of browsers (at least Chromium-based ones).\n    Several users reported that their storage was corrupted on Android too.\n  */\n  try {\n    const accounts = await fetchStoredAccounts();\n    return !!accounts && typeof accounts === 'object' && Object.keys(accounts).length > 0;\n  } catch {\n    return false;\n  }\n}\n\nexport async function verifyPassword(password: string): Promise<boolean> {\n  try {\n    const [accountId, account] = (await getAccountWithMnemonic()) ?? [];\n    if (!accountId || !account) {\n      return false;\n    }\n\n    const mnemonic = await getMnemonic(accountId, password, account);\n    return Boolean(mnemonic);\n  } catch {\n    return false;\n  }\n}\n\nexport function confirmDappRequest(promiseId: string, data: any) {\n  dappPromises.resolveDappPromise(promiseId, data);\n}\n\nexport function confirmDappRequestConnect(promiseId: string, data: {\n  password?: string;\n  accountId?: string;\n  signature?: string;\n}) {\n  dappPromises.resolveDappPromise(promiseId, data);\n}\n\nexport function cancelDappRequest(promiseId: string, reason?: string) {\n  dappPromises.rejectDappPromise(promiseId, reason);\n}\n\nexport async function getWalletSeqno(accountId: string, address?: string) {\n  const { network } = parseAccountId(accountId);\n  if (!address) {\n    ({ address } = await fetchStoredTonWallet(accountId));\n  }\n  return ton.getWalletSeqno(network, address);\n}\n\nexport function fetchAddress(accountId: string, chain: ApiChain) {\n  return fetchStoredAddress(accountId, chain);\n}\n\nexport function isWalletInitialized(network: ApiNetwork, address: string) {\n  const chain = chains.ton;\n\n  return chain.isAddressInitialized(network, address);\n}\n\nexport function getWalletBalance(chain: ApiChain, network: ApiNetwork, address: string) {\n  return chains[chain].getWalletBalance(network, address);\n}\n\nexport function getContractInfo(network: ApiNetwork, address: string) {\n  const chain = chains.ton;\n\n  return chain.getContractInfo(network, address);\n}\n\nexport function getWalletInfo(network: ApiNetwork, address: string) {\n  const chain = chains.ton;\n\n  return chain.getWalletInfo(network, address);\n}\n\nexport async function getAddressInfo(network: ApiNetwork, toAddress: string): Promise<{\n  addressName?: string;\n  isScam?: boolean;\n  resolvedAddress?: string;\n  isToAddressNew?: boolean;\n  isBounceable?: boolean;\n  isMemoRequired?: boolean;\n} | { error: string }> {\n  try {\n    return await checkToAddress(network, toAddress);\n  } catch (err: any) {\n    return handleServerError(err);\n  }\n}\n","import type { ApiNft, OnApiUpdate } from '../types';\n\nimport { TONCOIN } from '../../config';\nimport { bigintDivideToNumber } from '../../util/bigint';\nimport chains from '../chains';\nimport { fetchStoredAccount, fetchStoredTonWallet } from '../common/accounts';\nimport { createLocalTransactions } from './transactions';\n\nconst { ton } = chains;\n\nlet onUpdate: OnApiUpdate;\n\nexport function initNfts(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport async function fetchNftsFromCollection(accountId: string, collectionAddress: string) {\n  const account = await fetchStoredAccount(accountId);\n  if (!account.ton) return;\n\n  const nfts = await ton.getAccountNfts(accountId, { collectionAddress });\n\n  onUpdate({ type: 'updateNfts', accountId, nfts, shouldAppend: true });\n}\n\nexport function checkNftTransferDraft(options: {\n  accountId: string;\n  nfts: ApiNft[];\n  toAddress: string;\n  comment?: string;\n}) {\n  return ton.checkNftTransferDraft(options);\n}\n\nexport async function submitNftTransfers(\n  accountId: string,\n  password: string,\n  nfts: ApiNft[],\n  toAddress: string,\n  comment?: string,\n  totalRealFee = 0n,\n) {\n  const { address: fromAddress } = await fetchStoredTonWallet(accountId);\n\n  const result = await ton.submitNftTransfers({\n    accountId, password, nfts, toAddress, comment,\n  });\n\n  if ('error' in result) {\n    return result;\n  }\n\n  const realFeePerNft = bigintDivideToNumber(totalRealFee, Object.keys(result.messages).length);\n\n  createLocalTransactions(accountId, 'ton', result.messages.map((message, index) => ({\n    txId: result.msgHashNormalized,\n    amount: 0n, // Regular NFT transfers should have no amount in the activity list\n    fromAddress,\n    toAddress,\n    comment,\n    fee: realFeePerNft,\n    normalizedAddress: message.toAddress,\n    slug: TONCOIN.slug,\n    externalMsgHashNorm: result.msgHashNormalized,\n    nft: nfts?.[index],\n  })));\n\n  return result;\n}\n\nexport async function checkNftOwnership(accountId: string, nftAddress: string) {\n  const account = await fetchStoredAccount(accountId);\n  return 'ton' in account && ton.checkNftOwnership(accountId, nftAddress);\n}\n","import type { ApiNft } from '../types';\n\nimport { TONCOIN } from '../../config';\nimport { buildCollectionByKey, extractKey } from '../../util/iteratees';\nimport chains from '../chains';\nimport { fetchStoredTonWallet } from '../common/accounts';\nimport { createLocalTransactions } from './transactions';\n\nconst { ton } = chains;\n\nexport function checkDnsRenewalDraft(accountId: string, nfts: ApiNft[]) {\n  const nftAddresses = extractKey(nfts, 'address');\n  return ton.checkDnsRenewalDraft(accountId, nftAddresses);\n}\n\nexport async function submitDnsRenewal(accountId: string, password: string, nfts: ApiNft[], realFee = 0n) {\n  const { address: fromAddress } = await fetchStoredTonWallet(accountId);\n\n  const nftByAddress = buildCollectionByKey(nfts, 'address');\n  const results: ({ activityIds: string[] } | { error: string })[] = [];\n\n  for await (const { addresses, result } of ton.submitDnsRenewal(accountId, password, Object.keys(nftByAddress))) {\n    if ('error' in result) {\n      results.push(result);\n      continue;\n    }\n\n    const localActivities = createLocalTransactions(accountId, 'ton', addresses.map((address) => {\n      const nft = nftByAddress[address];\n      return {\n        txId: result.msgHashNormalized,\n        amount: 0n,\n        fromAddress,\n        toAddress: nft.address,\n        fee: realFee / BigInt(nfts.length),\n        normalizedAddress: nft.address,\n        slug: TONCOIN.slug,\n        externalMsgHashNorm: result.msgHashNormalized,\n        nft,\n        type: 'dnsRenew',\n      };\n    }));\n\n    results.push({\n      activityIds: extractKey(localActivities, 'id'),\n    });\n  }\n\n  return results;\n}\n\nexport function checkDnsChangeWalletDraft(accountId: string, nft: ApiNft, address: string) {\n  return ton.checkDnsChangeWalletDraft(accountId, nft.address, address);\n}\n\nexport async function submitDnsChangeWallet(\n  accountId: string,\n  password: string,\n  nft: ApiNft,\n  address: string,\n  realFee = 0n,\n) {\n  const { address: walletAddress } = await fetchStoredTonWallet(accountId);\n  const result = await ton.submitDnsChangeWallet(accountId, password, nft.address, address);\n\n  if ('error' in result) {\n    return result;\n  }\n\n  const [activity] = createLocalTransactions(accountId, 'ton', [{\n    txId: result.msgHashNormalized,\n    amount: 0n,\n    fromAddress: walletAddress,\n    toAddress: nft.address,\n    fee: realFee,\n    normalizedAddress: nft.address,\n    slug: TONCOIN.slug,\n    externalMsgHashNorm: result.msgHashNormalized,\n    nft,\n    type: 'dnsChangeAddress',\n  }]);\n\n  return { activityId: activity.id };\n}\n","import type { ConnectEventError, ConnectEventSuccess } from '@tonconnect/protocol';\n\nexport interface TransactionPayload {\n  valid_until?: number;\n  network?: CHAIN;\n  from?: string; // https://github.com/ton-blockchain/ton-connect/blob/main/wallet-guidelines.md#multi-accounts\n  messages: TransactionPayloadMessage[];\n}\n\nexport interface TransactionPayloadMessage {\n  address: string;\n  amount: string;\n  payload?: string;\n  stateInit?: string;\n}\n\n// This and the other enums can be imported from @tonconnect/protocol. We copy the enums instead of importing because\n// importing that module increases the compiled code size significantly.\n\nexport enum CONNECT_EVENT_ERROR_CODES {\n  UNKNOWN_ERROR = 0,\n  BAD_REQUEST_ERROR = 1,\n  MANIFEST_NOT_FOUND_ERROR = 2,\n  MANIFEST_CONTENT_ERROR = 3,\n  UNKNOWN_APP_ERROR = 100,\n  USER_REJECTS_ERROR = 300,\n  METHOD_NOT_SUPPORTED = 400,\n}\n\nexport enum SEND_TRANSACTION_ERROR_CODES {\n  UNKNOWN_ERROR = 0,\n  BAD_REQUEST_ERROR = 1,\n  UNKNOWN_APP_ERROR = 100,\n  USER_REJECTS_ERROR = 300,\n  METHOD_NOT_SUPPORTED = 400,\n}\n\nexport type AllErrorCodes = CONNECT_EVENT_ERROR_CODES | SEND_TRANSACTION_ERROR_CODES;\nexport type ConnectEvent = ConnectEventSuccess | ConnectEventError;\n\nexport interface ApiTonConnectProof {\n  timestamp: number;\n  domain: string;\n  payload: string;\n}\n\nexport enum CHAIN {\n  MAINNET = '-239',\n  TESTNET = '-3',\n}\n","import type { DeviceInfo, Feature } from '@tonconnect/protocol';\n\nimport type { ApiAccountWithTon } from '../api/types';\n\nimport {\n  APP_NAME, IS_EXTENSION, IS_TELEGRAM_APP, TONCONNECT_PROTOCOL_VERSION,\n} from '../config';\nimport packageJson from '../../package.json';\nimport { DEFAULT_MAX_MESSAGES, W5_MAX_MESSAGES } from '../api/chains/ton/constants';\nimport { getMaxMessagesInTransaction } from './ton/transfer';\n\ntype DevicePlatform = DeviceInfo['platform'];\n\n/*\n This function is called in TonConnect `connect` method (where we know the wallet version)\n and in JS Bridge (where no account is selected, so we show maximum number of messages).\n*/\nexport function tonConnectGetDeviceInfo(account?: ApiAccountWithTon): DeviceInfo {\n  const features: Feature[] = [\n    'SendTransaction', // TODO DEPRECATED\n    {\n      name: 'SendTransaction',\n      maxMessages: account ? getTonConnectMaxMessages(account) : W5_MAX_MESSAGES,\n    },\n  ];\n\n  if (!account || account.type !== 'ledger') {\n    features.push({\n      name: 'SignData',\n      types: ['text', 'binary', 'cell'],\n    });\n  }\n\n  return {\n    platform: getPlatform(),\n    appName: APP_NAME,\n    appVersion: packageJson.version,\n    maxProtocolVersion: TONCONNECT_PROTOCOL_VERSION,\n    features,\n  };\n}\n\n/** How many messages can be sent in a single TON Connect transaction sending */\nexport function getTonConnectMaxMessages(account: ApiAccountWithTon) {\n  const { type } = account;\n\n  if (type === 'ledger') {\n    return DEFAULT_MAX_MESSAGES; // TODO Remove after DEXs support the 1 message limit\n  } else {\n    return getMaxMessagesInTransaction(account);\n  }\n}\n\nfunction getPlatform(): DevicePlatform {\n  const { userAgent } = navigator;\n  const platform = navigator.platform || navigator?.userAgentData?.platform || '';\n\n  const macosPlatforms = ['macOS', 'Macintosh', 'MacIntel', 'MacPPC', 'Mac68K'];\n  const windowsPlatforms = ['Win32', 'Win64', 'Windows', 'WinCE'];\n  const iphonePlatforms = ['iPhone'];\n  const ipadPlatforms = ['iPad', 'iPod'];\n\n  let devicePlatform: DevicePlatform | undefined;\n\n  if (IS_EXTENSION || IS_TELEGRAM_APP) {\n    devicePlatform = 'browser';\n  } else if (/Android/.test(userAgent)) {\n    devicePlatform = 'android';\n  } else if (iphonePlatforms.indexOf(platform) !== -1) {\n    devicePlatform = 'iphone';\n  } else if (ipadPlatforms.indexOf(platform) !== -1) {\n    devicePlatform = 'ipad';\n  } else if (macosPlatforms.indexOf(platform) !== -1) {\n    devicePlatform = 'mac';\n  } else if (windowsPlatforms.indexOf(platform) !== -1) {\n    devicePlatform = 'windows';\n  } else if (/Linux/.test(platform)) {\n    devicePlatform = 'linux';\n  } else {\n    devicePlatform = 'browser';\n  }\n\n  return devicePlatform;\n}\n","import type { ApiAnyDisplayError } from '../types';\nimport type { AllErrorCodes } from './types';\nimport { ApiTransactionError } from '../types';\nimport { CONNECT_EVENT_ERROR_CODES, SEND_TRANSACTION_ERROR_CODES } from './types';\n\nimport { ApiBaseError } from '../errors';\n\nexport class TonConnectError extends ApiBaseError {\n  code: number;\n\n  constructor(message: string, code: AllErrorCodes = 0, displayError?: ApiAnyDisplayError) {\n    super(message);\n    this.code = code;\n    this.displayError = displayError;\n  }\n}\n\nexport class ManifestContentError extends TonConnectError {\n  constructor(message = 'Manifest content error') {\n    super(message, CONNECT_EVENT_ERROR_CODES.MANIFEST_CONTENT_ERROR);\n  }\n}\n\nexport class UnknownError extends TonConnectError {\n  constructor(message = 'Unknown error.') {\n    super(message, SEND_TRANSACTION_ERROR_CODES.UNKNOWN_ERROR);\n  }\n}\n\nexport class BadRequestError extends TonConnectError {\n  constructor(message = 'Bad request', displayError?: ApiAnyDisplayError) {\n    super(message, SEND_TRANSACTION_ERROR_CODES.BAD_REQUEST_ERROR, displayError);\n  }\n}\n\nexport class UnknownAppError extends TonConnectError {\n  constructor(message = 'Unknown app error') {\n    super(message, SEND_TRANSACTION_ERROR_CODES.UNKNOWN_APP_ERROR);\n  }\n}\n\nexport class UserRejectsError extends TonConnectError {\n  constructor(message = 'The user rejected the action') {\n    super(message, SEND_TRANSACTION_ERROR_CODES.USER_REJECTS_ERROR);\n  }\n}\n\nexport class MethodNotSupportedError extends TonConnectError {\n  constructor(message = 'The method is not supported') {\n    super(message, SEND_TRANSACTION_ERROR_CODES.METHOD_NOT_SUPPORTED);\n  }\n}\n\nexport class InsufficientBalance extends BadRequestError {\n  constructor(message = 'Insufficient balance') {\n    super(message, ApiTransactionError.InsufficientBalance);\n  }\n}\n","export function crc32(data: string): number {\n  return crc32FromBytes(Buffer.from(data));\n}\n\nexport function crc32FromBytes(bytes: Uint8Array): number {\n  // The implementation is based on https://stackoverflow.com/a/18639999/1118709\n  const crc32Table = makeCrc32Table();\n  let crc = 0 ^ -1;\n\n  for (let i = 0; i < bytes.length; i++) {\n    crc = (crc >>> 8) ^ crc32Table[(crc ^ bytes[i]) & 0xFF];\n  }\n\n  return (crc ^ -1) >>> 0;\n}\n\nlet crc32Table: Uint32Array;\n\nfunction makeCrc32Table() {\n  if (!crc32Table) {\n    let c: number;\n    crc32Table = new Uint32Array(256);\n    for (let n = 0; n < 256; n++) {\n      c = n;\n      for (let k = 0; k < 8; k++) {\n        c = c & 1 ? 0xEDB88320 ^ (c >>> 1) : c >>> 1;\n      }\n      crc32Table[n] = c;\n    }\n  }\n\n  return crc32Table;\n}\n","import { Address, beginCell, Cell } from '@ton/core';\nimport type { SignDataPayload, SignDataPayloadCell } from '@tonconnect/protocol';\nimport nacl from 'tweetnacl';\n\nimport type { ApiTonConnectProof } from './types';\n\nimport { crc32 } from '../../util/crcHash';\nimport { encodeDomain } from '../chains/ton/util/dns';\nimport { sha256 } from '../common/utils';\n\nexport async function signTonProofWithPrivateKey(\n  walletAddress: string | Address,\n  privateKey: Uint8Array,\n  proof: ApiTonConnectProof,\n): Promise<Uint8Array> {\n  const { timestamp, domain, payload } = proof;\n  const address = walletAddress instanceof Address ? walletAddress : Address.parse(walletAddress);\n\n  const messageBuffer = Buffer.concat([\n    Buffer.from('ton-proof-item-v2/'),\n    makeAddressBuffer(address),\n    makeBytesWithLengthBuffer(Buffer.from(domain), false),\n    makeTimestampBuffer(timestamp, false),\n    Buffer.from(payload),\n  ]);\n\n  const bufferToSign = Buffer.concat([\n    Buffer.from([0xff, 0xff]),\n    Buffer.from('ton-connect'),\n    Buffer.from(await sha256(messageBuffer)),\n  ]);\n\n  return nacl.sign.detached(\n    new Uint8Array(await sha256(bufferToSign)),\n    privateKey,\n  );\n}\n\n/**\n * See https://docs.tonconsole.com/academy/sign-data#how-the-signature-is-built for more details\n */\nexport async function signDataWithPrivateKey(\n  walletAddress: string | Address,\n  timestamp: number, // Unix seconds, should be the current time\n  domain: string,\n  payload: SignDataPayload,\n  privateKey: Uint8Array,\n): Promise<Uint8Array> {\n  const address = walletAddress instanceof Address ? walletAddress : Address.parse(walletAddress);\n\n  const hash = await (payload.type === 'cell'\n    ? createCellDataHash(address, timestamp, domain, payload)\n    : createTextDataHash(address, timestamp, domain, payload));\n\n  return nacl.sign.detached(hash, privateKey);\n}\n\n// https://docs.tonconsole.com/academy/sign-data#for-cell\nfunction createCellDataHash(\n  walletAddress: Address,\n  timestamp: number,\n  domain: string,\n  payload: SignDataPayloadCell,\n) {\n  const message = beginCell()\n    .storeUint(0x75569022, 32)\n    .storeUint(crc32(payload.schema), 32)\n    .storeUint(timestamp, 64)\n    .storeAddress(walletAddress)\n    .storeStringRefTail(encodeDomain(domain))\n    .storeRef(Cell.fromBase64(payload.cell))\n    .endCell();\n\n  const hashBuffer = message.hash();\n  return new Uint8Array(hashBuffer.buffer, hashBuffer.byteOffset, hashBuffer.byteLength);\n}\n\n// https://docs.tonconsole.com/academy/sign-data#for-text-and-binary\nasync function createTextDataHash(\n  walletAddress: Address,\n  timestamp: number,\n  domain: string,\n  payload: Exclude<SignDataPayload, SignDataPayloadCell>,\n) {\n  const message = Buffer.concat([\n    Buffer.from([0xff, 0xff]),\n    Buffer.from('ton-connect/sign-data/'),\n    makeAddressBuffer(walletAddress),\n    makeBytesWithLengthBuffer(Buffer.from(domain), true),\n    makeTimestampBuffer(timestamp, true),\n    Buffer.from(payload.type === 'text' ? 'txt' : 'bin'),\n    makeBytesWithLengthBuffer(\n      payload.type === 'text'\n        ? Buffer.from(payload.text, 'utf8')\n        : Buffer.from(payload.bytes, 'base64'),\n      true,\n    ),\n  ]);\n\n  return new Uint8Array(await sha256(message));\n}\n\nfunction makeAddressBuffer(address: Address) {\n  const workChainLength = 4;\n  const addressBuffer = Buffer.allocUnsafe(workChainLength + address.hash.length);\n  addressBuffer.writeInt32BE(address.workChain);\n  address.hash.copy(addressBuffer, workChainLength);\n  return addressBuffer;\n}\n\nfunction makeBytesWithLengthBuffer(bytes: Buffer, isBigEndian: boolean) {\n  const lengthLength = 4;\n  const buffer = Buffer.allocUnsafe(lengthLength + bytes.length);\n  if (isBigEndian) {\n    buffer.writeInt32BE(bytes.length);\n  } else {\n    buffer.writeInt32LE(bytes.length);\n  }\n  bytes.copy(buffer, lengthLength);\n  return buffer;\n}\n\nfunction makeTimestampBuffer(unixSeconds: number, isBigEndian: boolean) {\n  const timestampBuffer = Buffer.allocUnsafe(8);\n  const timestamp = BigInt(unixSeconds);\n  if (isBigEndian) {\n    timestampBuffer.writeBigInt64BE(timestamp);\n  } else {\n    timestampBuffer.writeBigInt64LE(timestamp);\n  }\n  return timestampBuffer;\n}\n","import type { ApiParsedPayload } from '../types';\n\nimport { isNftTransferPayload, isTokenTransferPayload } from '../../util/ton/transfer';\n\n// https://stackoverflow.com/a/417184\nconst URL_MAX_LENGTH = 2000;\n\nexport function isValidString(value: any, maxLength = 100) {\n  return typeof value === 'string' && value.length <= maxLength;\n}\n\nexport function isValidUrl(url: string) {\n  const isString = isValidString(url, URL_MAX_LENGTH);\n  if (!isString) return false;\n\n  try {\n    new URL(url);\n    return true;\n  } catch (err) {\n    return false;\n  }\n}\n\nexport function getTransferActualToAddress(toAddress: string, payload: ApiParsedPayload | undefined) {\n  // This function implementation is not complete. That is, other transfer types may have another actual \"to\" address.\n  if (isNftTransferPayload(payload)) {\n    return payload.newOwner;\n  }\n  if (isTokenTransferPayload(payload)) {\n    return payload.destination;\n  }\n  return toAddress;\n}\n\nexport function isTransferPayloadDangerous(payload: ApiParsedPayload | undefined) {\n  return payload?.type === 'unknown';\n}\n","/* TonConnect specification https://github.com/ton-blockchain/ton-connect */\n\nimport { Cell } from '@ton/core';\nimport type {\n  ConnectEventError,\n  ConnectItemReply,\n  ConnectRequest,\n  DisconnectRpcRequest,\n  DisconnectRpcResponse,\n  SendTransactionRpcRequest,\n  SendTransactionRpcResponse,\n  SignDataPayload,\n  SignDataRpcRequest,\n  SignDataRpcResponse,\n  SignDataRpcResponseSuccess,\n  TonProofItem,\n  TonProofItemReplySuccess,\n  WalletResponseTemplateError,\n} from '@tonconnect/protocol';\n\nimport type {\n  ApiCheckMultiTransactionDraftResult,\n  ApiEmulationWithFallbackResult,\n  TonTransferParams,\n} from '../chains/ton/types';\nimport type {\n  ApiAccountWithMnemonic,\n  ApiAnyDisplayError,\n  ApiDapp,\n  ApiDappConnectionType,\n  ApiDappMetadata,\n  ApiDappRequest,\n  ApiDappTransfer,\n  ApiNetwork,\n  ApiParsedPayload,\n  ApiSignedTransfer,\n  ApiTonWallet,\n  OnApiUpdate,\n} from '../types';\nimport type { ApiTonConnectProof, ConnectEvent, TransactionPayload, TransactionPayloadMessage } from './types';\nimport { ApiCommonError, ApiTransactionDraftError, ApiTransactionError } from '../types';\nimport { CHAIN, CONNECT_EVENT_ERROR_CODES, SEND_TRANSACTION_ERROR_CODES } from './types';\n\nimport { IS_EXTENSION, TONCOIN } from '../../config';\nimport { parseAccountId } from '../../util/account';\nimport { areDeepEqual } from '../../util/areDeepEqual';\nimport { bigintDivideToNumber } from '../../util/bigint';\nimport { fetchJsonWithProxy } from '../../util/fetch';\nimport { getDappConnectionUniqueId } from '../../util/getDappConnectionUniqueId';\nimport { pick } from '../../util/iteratees';\nimport { logDebugError } from '../../util/logs';\nimport safeExec from '../../util/safeExec';\nimport { getTonConnectMaxMessages, tonConnectGetDeviceInfo } from '../../util/tonConnectEnvironment';\nimport chains from '../chains';\nimport { getContractInfo, parsePayloadBase64 } from '../chains/ton';\nimport { fetchKeyPair } from '../chains/ton/auth';\nimport { getIsRawAddress, getWalletPublicKey, toBase64Address, toRawAddress } from '../chains/ton/util/tonCore';\nimport { fetchStoredTonAccount, getCurrentAccountId, getCurrentAccountIdOrFail } from '../common/accounts';\nimport { getKnownAddressInfo } from '../common/addresses';\nimport { createDappPromise } from '../common/dappPromises';\nimport { isUpdaterAlive } from '../common/helpers';\nimport { bytesToBase64, hexToBytes } from '../common/utils';\nimport * as apiErrors from '../errors';\nimport { ApiServerError } from '../errors';\nimport { callHook } from '../hooks';\nimport {\n  addDapp,\n  deleteDapp,\n  findLastConnectedAccount,\n  getDapp,\n  updateDapp,\n} from '../methods/dapps';\nimport { createLocalActivitiesFromEmulation, createLocalTransactions } from '../methods/transactions';\nimport * as errors from './errors';\nimport { UnknownAppError } from './errors';\nimport { signDataWithPrivateKey, signTonProofWithPrivateKey } from './signing';\nimport { getTransferActualToAddress, isTransferPayloadDangerous, isValidString, isValidUrl } from './utils';\n\nconst BLANK_GIF_DATA_URL = 'data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==';\n\nconst ton = chains.ton;\n\nlet resolveInit: AnyFunction;\nconst initPromise = new Promise((resolve) => {\n  resolveInit = resolve;\n});\n\nlet onUpdate: OnApiUpdate;\n\nexport function initTonConnect(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n  resolveInit();\n}\n\nexport async function connect(request: ApiDappRequest, message: ConnectRequest, id: number): Promise<ConnectEvent> {\n  try {\n    await openExtensionPopup(true);\n\n    onUpdate({\n      type: 'dappLoading',\n      connectionType: 'connect',\n      isSse: request && 'sseOptions' in request,\n    });\n\n    const dappMetadata = await fetchDappMetadata(message.manifestUrl);\n    const url = request.url || dappMetadata.url;\n    const addressItem = message.items.find(({ name }) => name === 'ton_addr');\n    const proofItem = message.items.find(({ name }) => name === 'ton_proof') as TonProofItem | undefined;\n    const proof = proofItem ? {\n      timestamp: Math.round(Date.now() / 1000),\n      domain: new URL(url).host,\n      payload: proofItem.payload,\n    } : undefined;\n\n    if (!addressItem) {\n      throw new errors.BadRequestError('Missing \\'ton_addr\\'');\n    }\n\n    if (proof && !proof.domain.includes('.')) {\n      throw new errors.BadRequestError('Invalid domain');\n    }\n\n    let accountId = await getCurrentAccountOrFail();\n\n    const { promiseId, promise } = createDappPromise();\n\n    const dapp: ApiDapp = {\n      ...dappMetadata,\n      url,\n      connectedAt: Date.now(),\n      ...(request.isUrlEnsured && { isUrlEnsured: true }),\n      ...('sseOptions' in request && {\n        sse: request.sseOptions,\n      }),\n    };\n\n    const uniqueId = getDappConnectionUniqueId(request);\n\n    onUpdate({\n      type: 'dappConnect',\n      identifier: 'identifier' in request ? request.identifier : undefined,\n      promiseId,\n      accountId,\n      dapp,\n      permissions: {\n        address: true,\n        proof: !!proof,\n      },\n      proof,\n    });\n\n    const promiseResult: {\n      accountId?: string;\n      password?: string;\n      signature?: string;\n    } | undefined = await promise;\n\n    accountId = promiseResult!.accountId!;\n    request.accountId = accountId;\n    await addDapp(accountId, dapp, uniqueId);\n\n    const account = await fetchStoredTonAccount(accountId);\n    const { address } = account.ton;\n\n    const deviceInfo = tonConnectGetDeviceInfo(account);\n    const items: ConnectItemReply[] = [\n      await buildTonAddressReplyItem(accountId, account.ton),\n    ];\n\n    if (proof) {\n      const { password, signature } = promiseResult!;\n\n      let proofReplyItem: TonProofItemReplySuccess;\n      if (password) {\n        proofReplyItem = await signTonProof(accountId, account as ApiAccountWithMnemonic, password, address, proof);\n      } else {\n        proofReplyItem = buildTonProofReplyItem(proof, signature!);\n      }\n\n      items.push(proofReplyItem);\n    }\n\n    onUpdate({ type: 'updateDapps' });\n    onUpdate({ type: 'dappConnectComplete' });\n\n    return {\n      event: 'connect',\n      id,\n      payload: {\n        items,\n        device: deviceInfo,\n      },\n    };\n  } catch (err) {\n    logDebugError('tonConnect:connect', err);\n\n    safeExec(() => {\n      onUpdate({\n        type: 'dappCloseLoading',\n        connectionType: 'connect',\n      });\n    });\n\n    return formatConnectError(id, err as Error);\n  }\n}\n\nexport async function reconnect(request: ApiDappRequest, id: number): Promise<ConnectEvent> {\n  try {\n    const { url, accountId } = await ensureRequestParams(request);\n\n    const uniqueId = getDappConnectionUniqueId(request);\n    const currentDapp = await getDapp(accountId, url, uniqueId);\n    if (!currentDapp) {\n      throw new UnknownAppError();\n    }\n\n    await updateDapp(accountId, url, uniqueId, { connectedAt: Date.now() });\n\n    const account = await fetchStoredTonAccount(accountId);\n\n    const deviceInfo = tonConnectGetDeviceInfo(account);\n    const items: ConnectItemReply[] = [\n      await buildTonAddressReplyItem(accountId, account.ton),\n    ];\n\n    return {\n      event: 'connect',\n      id,\n      payload: {\n        items,\n        device: deviceInfo,\n      },\n    };\n  } catch (e) {\n    logDebugError('tonConnect:reconnect', e);\n    return formatConnectError(id, e as Error);\n  }\n}\n\nexport async function disconnect(\n  request: ApiDappRequest,\n  message: DisconnectRpcRequest,\n): Promise<DisconnectRpcResponse> {\n  try {\n    const { url, accountId } = await ensureRequestParams(request);\n\n    const uniqueId = getDappConnectionUniqueId(request);\n    await deleteDapp(accountId, url, uniqueId, true);\n    onUpdate({ type: 'updateDapps' });\n  } catch (err) {\n    logDebugError('tonConnect:disconnect', err);\n  }\n  return {\n    id: message.id,\n    result: {},\n  };\n}\n\nexport async function sendTransaction(\n  request: ApiDappRequest,\n  message: SendTransactionRpcRequest,\n): Promise<SendTransactionRpcResponse> {\n  try {\n    const { url, accountId } = await ensureRequestParams(request);\n    const { network } = parseAccountId(accountId);\n\n    const txPayload = JSON.parse(message.params[0]) as TransactionPayload;\n    const { messages, network: dappNetworkRaw } = txPayload;\n\n    const account = await fetchStoredTonAccount(accountId);\n    const {\n      type, ton: {\n        address,\n        publicKey: publicKeyHex,\n      },\n    } = account;\n\n    const maxMessages = getTonConnectMaxMessages(account);\n\n    if (messages.length > maxMessages) {\n      throw new errors.BadRequestError(`Payload contains more than ${maxMessages} messages, which exceeds limit`);\n    }\n\n    const dappNetwork = dappNetworkRaw\n      ? (dappNetworkRaw === CHAIN.MAINNET ? 'mainnet' : 'testnet')\n      : undefined;\n    let validUntil = txPayload.valid_until;\n    if (validUntil && validUntil > 10 ** 10) {\n      // If milliseconds were passed instead of seconds\n      validUntil = Math.round(validUntil / 1000);\n    }\n\n    const isLedger = type === 'ledger';\n\n    let vestingAddress: string | undefined;\n\n    if (txPayload.from && toBase64Address(txPayload.from) !== toBase64Address(address)) {\n      const publicKey = hexToBytes(publicKeyHex!);\n      if (isLedger && await checkIsHisVestingWallet(network, publicKey, txPayload.from)) {\n        vestingAddress = txPayload.from;\n      } else {\n        throw new errors.BadRequestError(undefined, ApiTransactionError.WrongAddress);\n      }\n    }\n\n    if (dappNetwork && network !== dappNetwork) {\n      throw new errors.BadRequestError(undefined, ApiTransactionError.WrongNetwork);\n    }\n\n    await openExtensionPopup(true);\n\n    onUpdate({\n      type: 'dappLoading',\n      connectionType: 'sendTransaction',\n      accountId,\n      isSse: Boolean('sseOptions' in request && request.sseOptions),\n    });\n\n    const {\n      preparedMessages,\n      checkResult,\n    } = await checkTransactionMessages(accountId, messages, network);\n\n    if ('error' in checkResult) {\n      throw new errors.BadRequestError(checkResult.error, checkResult.error);\n    }\n\n    const uniqueId = getDappConnectionUniqueId(request);\n    const dapp = (await getDapp(accountId, url, uniqueId))!;\n    const transactionsForRequest = await prepareTransactionForRequest(\n      network,\n      messages,\n      checkResult.emulation,\n      checkResult.parsedPayloads,\n    );\n\n    const { promiseId, promise } = createDappPromise();\n\n    onUpdate({\n      type: 'dappSendTransactions',\n      promiseId,\n      accountId,\n      dapp,\n      transactions: transactionsForRequest,\n      emulation: checkResult.emulation.isFallback ? undefined : pick(checkResult.emulation, ['activities', 'realFee']),\n      vestingAddress,\n    });\n\n    const response: string | ApiSignedTransfer[] = await promise;\n\n    if (validUntil && validUntil < (Date.now() / 1000)) {\n      throw new errors.BadRequestError('The confirmation timeout has expired');\n    }\n\n    let boc: string | undefined;\n    let error: string | undefined;\n    let msgHashNormalized: string | undefined;\n\n    if (isLedger) {\n      const signedTransfers = response as ApiSignedTransfer[];\n      const submitResult = await ton.sendSignedMessages(accountId, signedTransfers);\n      boc = submitResult.firstBoc;\n      msgHashNormalized = submitResult.msgHashesNormalized[0];\n\n      if (submitResult.successNumber > 0) {\n        if (submitResult.successNumber < messages.length) {\n          onUpdate({\n            type: 'showError',\n            error: ApiTransactionError.PartialTransactionFailure,\n          });\n        }\n      } else {\n        error = 'Failed transfers';\n      }\n    } else {\n      const password = response as string;\n      const submitResult = await ton.submitMultiTransfer({\n        accountId, password, messages: preparedMessages, expireAt: validUntil,\n      });\n      if ('error' in submitResult) {\n        error = submitResult.error;\n      } else {\n        ({ boc, msgHashNormalized } = submitResult);\n      }\n    }\n\n    if (error) {\n      throw new errors.UnknownError(error);\n    }\n\n    if (!checkResult.emulation.isFallback && checkResult.emulation.activities?.length > 0) {\n      // Use rich emulation activities for optimistic UI\n      createLocalActivitiesFromEmulation(\n        accountId,\n        'ton',\n        msgHashNormalized!,\n        checkResult.emulation.activities,\n      );\n    } else {\n      // Fallback to basic local transactions when emulation is not available\n      createLocalTransactions(accountId, 'ton', transactionsForRequest.map((transaction) => {\n        const { amount, normalizedAddress, payload, networkFee } = transaction;\n        const comment = payload?.type === 'comment' ? payload.comment : undefined;\n        return {\n          txId: msgHashNormalized!,\n          amount,\n          fromAddress: address,\n          toAddress: normalizedAddress,\n          comment,\n          fee: networkFee,\n          slug: TONCOIN.slug,\n          externalMsgHashNorm: msgHashNormalized,\n        };\n      }));\n    }\n\n    // Notify that dapp transfer is complete after successful blockchain submission\n    onUpdate({\n      type: 'dappTransferComplete',\n      accountId,\n    });\n\n    return {\n      result: boc!,\n      id: message.id,\n    };\n  } catch (err) {\n    logDebugError('tonConnect:sendTransaction', err);\n    return handleMethodError(err, message.id, 'sendTransaction');\n  }\n}\n\nfunction handleMethodError(\n  err: unknown,\n  messageId: string,\n  connectionType: ApiDappConnectionType,\n): WalletResponseTemplateError {\n  safeExec(() => {\n    onUpdate({\n      type: 'dappCloseLoading',\n      connectionType,\n    });\n  });\n\n  let code = SEND_TRANSACTION_ERROR_CODES.UNKNOWN_ERROR;\n  let errorMessage = 'Unhandled error';\n  let displayError: ApiAnyDisplayError | undefined;\n\n  if (err instanceof apiErrors.ApiUserRejectsError) {\n    code = SEND_TRANSACTION_ERROR_CODES.USER_REJECTS_ERROR;\n    errorMessage = err.message;\n  } else if (err instanceof errors.TonConnectError) {\n    code = err.code;\n    errorMessage = err.message;\n    displayError = err.displayError;\n  } else if (err instanceof ApiServerError) {\n    displayError = err.displayError;\n  } else {\n    displayError = ApiCommonError.Unexpected;\n  }\n\n  if (onUpdate && isUpdaterAlive(onUpdate) && displayError) {\n    onUpdate({\n      type: 'showError',\n      error: displayError,\n    });\n  }\n  return {\n    error: {\n      code,\n      message: errorMessage,\n    },\n    id: messageId,\n  };\n}\n\nasync function checkIsHisVestingWallet(network: ApiNetwork, ownerPublicKey: Uint8Array, address: string) {\n  const [info, publicKey] = await Promise.all([\n    getContractInfo(network, address),\n    getWalletPublicKey(network, address),\n  ]);\n\n  return info.contractInfo?.name === 'vesting' && areDeepEqual(ownerPublicKey, publicKey);\n}\n\n/**\n * See https://docs.tonconsole.com/academy/sign-data for more details\n */\nexport async function signData(\n  request: ApiDappRequest,\n  message: SignDataRpcRequest,\n): Promise<SignDataRpcResponse> {\n  try {\n    const { url, accountId } = await ensureRequestParams(request);\n    const account = await fetchStoredTonAccount(accountId);\n\n    if (account.type === 'view') throw new errors.MethodNotSupportedError('Not supported by view-only accounts');\n    if (account.type === 'ledger') throw new errors.MethodNotSupportedError('Not supported by Ledger');\n\n    await openExtensionPopup(true);\n\n    onUpdate({\n      type: 'dappLoading',\n      connectionType: 'signData',\n      accountId,\n      isSse: Boolean('sseOptions' in request && request.sseOptions),\n    });\n\n    const { promiseId, promise } = createDappPromise();\n    const uniqueId = getDappConnectionUniqueId(request);\n    const dapp = (await getDapp(accountId, url, uniqueId))!;\n    const payloadToSign = JSON.parse(message.params[0]) as SignDataPayload;\n\n    onUpdate({\n      type: 'dappSignData',\n      promiseId,\n      accountId,\n      dapp,\n      payloadToSign,\n    });\n\n    const password: string = await promise;\n\n    const result = await performSignData(\n      accountId,\n      account,\n      dapp,\n      payloadToSign,\n      password,\n    );\n\n    onUpdate({\n      type: 'dappSignDataComplete',\n      accountId,\n    });\n\n    return {\n      result,\n      id: message.id,\n    };\n  } catch (err) {\n    logDebugError('tonConnect:signData', err);\n    return handleMethodError(err, message.id, 'signData');\n  }\n}\n\nasync function checkTransactionMessages(\n  accountId: string,\n  messages: TransactionPayloadMessage[],\n  network: ApiNetwork,\n) {\n  const preparedMessages: TonTransferParams[] = messages.map((msg) => {\n    const {\n      address: toAddress,\n      amount,\n      payload,\n      stateInit,\n    } = msg;\n\n    return {\n      toAddress: getIsRawAddress(toAddress)\n        ? toBase64Address(toAddress, true, network)\n        : toAddress,\n      amount: BigInt(amount),\n      payload: payload ? Cell.fromBase64(payload) : undefined,\n      stateInit: stateInit ? Cell.fromBase64(stateInit) : undefined,\n    };\n  });\n\n  const checkResult = await ton.checkMultiTransactionDraft(accountId, preparedMessages);\n\n  // Handle insufficient balance error specifically for TON Connect by converting to fallback emulation\n  if ('error' in checkResult\n    && checkResult.error === ApiTransactionDraftError.InsufficientBalance\n    && checkResult.emulation) {\n    const fallbackCheckResult: ApiCheckMultiTransactionDraftResult = {\n      emulation: {\n        isFallback: true,\n        networkFee: checkResult.emulation.networkFee,\n      },\n      parsedPayloads: checkResult.parsedPayloads,\n    };\n    return {\n      preparedMessages,\n      checkResult: fallbackCheckResult,\n    };\n  }\n\n  return {\n    preparedMessages,\n    checkResult,\n  };\n}\n\nfunction prepareTransactionForRequest(\n  network: ApiNetwork,\n  messages: TransactionPayloadMessage[],\n  emulation: ApiEmulationWithFallbackResult,\n  parsedPayloads?: (ApiParsedPayload | undefined)[],\n) {\n  return Promise.all(messages.map(\n    async ({\n      address,\n      amount: rawAmount,\n      payload: rawPayload,\n      stateInit,\n    }, index): Promise<ApiDappTransfer> => {\n      const amount = BigInt(rawAmount);\n      const toAddress = getIsRawAddress(address) ? toBase64Address(address, true, network) : address;\n      // Fix address format for `waitTxComplete` to work properly\n      const normalizedAddress = toBase64Address(address, undefined, network);\n      const payload = parsedPayloads?.[index]\n        ?? (rawPayload ? await parsePayloadBase64(network, toAddress, rawPayload) : undefined);\n      const { isScam } = getKnownAddressInfo(normalizedAddress) || {};\n\n      return {\n        toAddress,\n        amount,\n        rawPayload,\n        payload,\n        stateInit,\n        normalizedAddress,\n        isScam,\n        isDangerous: isTransferPayloadDangerous(payload),\n        displayedToAddress: getTransferActualToAddress(toAddress, payload),\n        networkFee: emulation.isFallback\n          ? bigintDivideToNumber(emulation.networkFee, messages.length)\n          : emulation.byTransactionIndex[index]?.networkFee ?? 0n,\n      };\n    },\n  ));\n}\n\nfunction formatConnectError(id: number, error: Error): ConnectEventError {\n  let code = CONNECT_EVENT_ERROR_CODES.UNKNOWN_ERROR;\n  let message = 'Unhandled error';\n\n  if (error instanceof apiErrors.ApiUserRejectsError) {\n    code = CONNECT_EVENT_ERROR_CODES.USER_REJECTS_ERROR;\n    message = error.message;\n  } else if (error instanceof errors.TonConnectError) {\n    code = error.code;\n    message = error.message;\n  }\n\n  return {\n    id,\n    event: 'connect_error',\n    payload: {\n      code,\n      message,\n    },\n  };\n}\n\nasync function buildTonAddressReplyItem(accountId: string, wallet: ApiTonWallet): Promise<ConnectItemReply> {\n  const { network } = parseAccountId(accountId);\n  const { publicKey, address } = wallet;\n\n  const stateInit = await ton.getWalletStateInit(accountId, wallet);\n\n  return {\n    name: 'ton_addr',\n    address: toRawAddress(address),\n    network: network === 'mainnet' ? CHAIN.MAINNET : CHAIN.TESTNET,\n    publicKey: publicKey!,\n    walletStateInit: stateInit\n      .toBoc({ idx: true, crc32: true })\n      .toString('base64'),\n  };\n}\n\nasync function signTonProof(\n  accountId: string,\n  account: ApiAccountWithMnemonic,\n  password: string,\n  walletAddress: string,\n  proof: ApiTonConnectProof,\n): Promise<TonProofItemReplySuccess> {\n  const keyPair = await fetchKeyPair(accountId, password, account);\n  const signature = await signTonProofWithPrivateKey(walletAddress, keyPair!.secretKey, proof);\n  return buildTonProofReplyItem(proof, bytesToBase64(signature));\n}\n\nfunction buildTonProofReplyItem(proof: ApiTonConnectProof, signature: string): TonProofItemReplySuccess {\n  const { timestamp, domain, payload } = proof;\n  const domainBuffer = Buffer.from(domain);\n\n  return {\n    name: 'ton_proof',\n    proof: {\n      timestamp,\n      domain: {\n        lengthBytes: domainBuffer.byteLength,\n        value: domainBuffer.toString('utf8'),\n      },\n      signature,\n      payload,\n    },\n  };\n}\n\nasync function performSignData(\n  accountId: string,\n  account: ApiAccountWithMnemonic,\n  dapp: ApiDapp,\n  payloadToSign: SignDataPayload,\n  password: string,\n): Promise<SignDataRpcResponseSuccess['result']> {\n  const { address } = account.ton;\n  const timestamp = Math.floor(Date.now() / 1000);\n  const domain = new URL(dapp.url).host;\n  const keyPair = (await fetchKeyPair(accountId, password, account))!;\n  const signature = await signDataWithPrivateKey(\n    address,\n    timestamp,\n    domain,\n    payloadToSign,\n    keyPair.secretKey,\n  );\n\n  return {\n    signature: bytesToBase64(signature),\n    address,\n    timestamp,\n    domain,\n    payload: payloadToSign,\n  };\n}\n\nexport async function fetchDappMetadata(manifestUrl: string): Promise<ApiDappMetadata> {\n  try {\n    const { url, name, iconUrl } = await fetchJsonWithProxy(manifestUrl);\n    const safeIconUrl = (iconUrl.startsWith('data:') || iconUrl === '') ? BLANK_GIF_DATA_URL : iconUrl;\n    if (!isValidUrl(url) || !isValidString(name) || !isValidUrl(safeIconUrl)) {\n      throw new Error('Invalid data');\n    }\n\n    return {\n      url,\n      name,\n      iconUrl: safeIconUrl,\n      manifestUrl,\n    };\n  } catch (err) {\n    logDebugError('fetchDapp', err);\n    throw new errors.ManifestContentError();\n  }\n}\n\nasync function ensureRequestParams(\n  request: ApiDappRequest,\n): Promise<ApiDappRequest & { url: string; accountId: string }> {\n  if (!request.url) {\n    throw new errors.BadRequestError('Missing `url` in request');\n  }\n\n  if (request.accountId) {\n    return request as ApiDappRequest & { url: string; accountId: string };\n  }\n\n  const { network } = parseAccountId(await getCurrentAccountIdOrFail());\n  const lastAccountId = await findLastConnectedAccount(network, request.url);\n  if (!lastAccountId) {\n    throw new errors.BadRequestError('The connection is outdated, try relogin');\n  }\n\n  return {\n    ...request,\n    accountId: lastAccountId,\n  } as ApiDappRequest & { url: string; accountId: string };\n}\n\nasync function openExtensionPopup(force?: boolean) {\n  if (!IS_EXTENSION || (!force && onUpdate && isUpdaterAlive(onUpdate))) {\n    return false;\n  }\n\n  await callHook('onWindowNeeded');\n  await initPromise;\n\n  return true;\n}\n\nasync function getCurrentAccountOrFail() {\n  const accountId = await getCurrentAccountId();\n  if (!accountId) {\n    throw new errors.BadRequestError('The user is not authorized in the wallet');\n  }\n  return accountId;\n}\n","import type {\n  AppRequest,\n  ConnectRequest,\n  DisconnectEvent,\n  RpcRequests,\n} from '@tonconnect/protocol';\nimport nacl, { randomBytes } from 'tweetnacl';\n\nimport type { ApiDappRequest, ApiSseOptions, OnApiUpdate } from '../types';\nimport { CONNECT_EVENT_ERROR_CODES } from './types';\n\nimport { SSE_BRIDGE_URL } from '../../config';\nimport { parseAccountId } from '../../util/account';\nimport { handleFetchErrors } from '../../util/fetch';\nimport { extractKey } from '../../util/iteratees';\nimport { logDebug, logDebugError } from '../../util/logs';\nimport safeExec from '../../util/safeExec';\nimport { getCurrentNetwork, waitLogin } from '../common/accounts';\nimport { bytesToHex } from '../common/utils';\nimport { getDappsState, getSseLastEventId, setSseLastEventId } from '../methods/dapps';\nimport * as tonConnect from './index';\n\ntype SseDapp = {\n  accountId: string;\n  url: string;\n} & ApiSseOptions;\n\ntype ReturnStrategy = 'back' | 'none' | (string & {});\n\nconst TTL_SEC = 300;\nconst NONCE_SIZE = 24;\nconst MAX_CONFIRM_DURATION = 60 * 1000;\n\nlet sseEventSource: EventSource | undefined;\nlet sseDapps: SseDapp[] = [];\nlet delayedReturnParams: {\n  validUntil: number;\n  url: string;\n  isFromInAppBrowser?: boolean;\n} | undefined;\n\nlet onUpdate: OnApiUpdate;\n\nexport function initSse(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport async function startSseConnection({\n  url, isFromInAppBrowser, identifier,\n}: {\n  url: string;\n  isFromInAppBrowser?: boolean;\n  identifier?: string;\n}): Promise<ReturnStrategy | undefined> {\n  const { searchParams: params, origin: connectionOrigin } = new URL(url);\n\n  const ret: ReturnStrategy = params.get('ret') || 'back';\n  const version = Number(params.get('v') as string);\n  const appClientId = params.get('id') as string;\n  // `back` strategy cannot be implemented\n  const shouldOpenUrl = ret !== 'back' && ret !== 'none';\n  const r = params.get('r');\n\n  if (!r) {\n    if (shouldOpenUrl) {\n      delayedReturnParams = {\n        validUntil: Date.now() + MAX_CONFIRM_DURATION,\n        url: ret,\n        isFromInAppBrowser,\n      };\n    }\n    return undefined;\n  }\n\n  const connectRequest: ConnectRequest | null = safeExec(() => JSON.parse(r)) || JSON.parse(decodeURIComponent(r));\n\n  logDebug('SSE Start connection:', {\n    version, appClientId, connectRequest, ret, connectionOrigin, identifier,\n  });\n\n  const { secretKey: secretKeyArray, publicKey: publicKeyArray } = nacl.box.keyPair();\n  const secretKey = bytesToHex(secretKeyArray);\n  const clientId = bytesToHex(publicKeyArray);\n\n  const lastOutputId = 0;\n  const request: ApiDappRequest = {\n    url: undefined,\n    identifier,\n    sseOptions: {\n      clientId,\n      appClientId,\n      secretKey,\n      lastOutputId,\n    },\n  };\n\n  await waitLogin();\n\n  if (!connectRequest) {\n    onUpdate({\n      type: 'showError',\n      error: 'Invalid TON Connect link',\n    });\n\n    return undefined;\n  }\n\n  const result = await tonConnect.connect(request, connectRequest, lastOutputId);\n\n  if (result.event === 'connect_error') {\n    const { code } = result.payload;\n\n    if ([\n      CONNECT_EVENT_ERROR_CODES.MANIFEST_CONTENT_ERROR,\n      CONNECT_EVENT_ERROR_CODES.MANIFEST_NOT_FOUND_ERROR,\n      CONNECT_EVENT_ERROR_CODES.BAD_REQUEST_ERROR,\n      CONNECT_EVENT_ERROR_CODES.UNKNOWN_APP_ERROR,\n      CONNECT_EVENT_ERROR_CODES.METHOD_NOT_SUPPORTED,\n    ].includes(code)) {\n      onUpdate({\n        type: 'showError',\n        error: result.payload.message,\n      });\n    }\n  }\n\n  await sendMessage(result, secretKey, clientId, appClientId);\n\n  if (result.event !== 'connect_error') {\n    await resetupSseConnection();\n  }\n\n  if (!shouldOpenUrl) {\n    return undefined;\n  }\n\n  return ret;\n}\n\nexport async function resetupSseConnection() {\n  const [lastEventId, dappsState, network] = await Promise.all([\n    getSseLastEventId(),\n    getDappsState(),\n    getCurrentNetwork(),\n  ]);\n\n  if (!dappsState || !network) {\n    return;\n  }\n\n  sseDapps = Object.entries(dappsState).reduce((result, [accountId, dappsByUrl]) => {\n    if (parseAccountId(accountId).network !== network) {\n      return result;\n    }\n\n    for (const byUniqueId of Object.values(dappsByUrl)) {\n      for (const dapp of Object.values(byUniqueId)) {\n        if (dapp.sse?.clientId) {\n          result.push({\n            ...dapp.sse,\n            accountId,\n            url: dapp.url,\n          });\n        }\n      }\n    }\n\n    return result;\n  }, [] as SseDapp[]);\n\n  const clientIds = extractKey(sseDapps, 'clientId').filter(Boolean);\n  if (!clientIds.length) {\n    return;\n  }\n\n  closeEventSource();\n  sseEventSource = openEventSource(clientIds, lastEventId);\n\n  sseEventSource.onopen = () => {\n    logDebug('EventSource opened');\n  };\n\n  sseEventSource.onerror = (e) => {\n    logDebugError('EventSource', e.type);\n  };\n\n  sseEventSource.onmessage = async (event) => {\n    const { from, message: encryptedMessage } = JSON.parse(event.data);\n\n    const sseDapp = sseDapps.find(({ appClientId }) => appClientId === from);\n    if (!sseDapp) {\n      logDebug(`Dapp with clientId ${from} not found`);\n      return;\n    }\n\n    const {\n      accountId, clientId, appClientId, secretKey, url, lastOutputId,\n    } = sseDapp;\n    const message = decryptMessage(encryptedMessage, appClientId, secretKey) as AppRequest<keyof RpcRequests>;\n\n    logDebug('SSE Event:', message);\n\n    await setSseLastEventId(event.lastEventId);\n    const sseOptions = {\n      clientId,\n      appClientId,\n      secretKey,\n      lastOutputId,\n    };\n\n    // @ts-ignore\n    const result = await tonConnect[message.method]({ url, accountId, sseOptions }, message);\n\n    await sendMessage(result, secretKey, clientId, appClientId);\n\n    if (delayedReturnParams) {\n      const { validUntil, url, isFromInAppBrowser } = delayedReturnParams;\n      if (validUntil > Date.now()) {\n        onUpdate({ type: 'openUrl', url, isExternal: !isFromInAppBrowser });\n      }\n      delayedReturnParams = undefined;\n    }\n  };\n}\n\nexport async function sendSseDisconnect(accountId: string, url: string) {\n  const sseDapp = sseDapps.find((d) => d.url === url && d.accountId === accountId);\n  if (!sseDapp) return;\n\n  const { secretKey, clientId, appClientId } = sseDapp;\n  const lastOutputId = sseDapp.lastOutputId + 1;\n\n  const response: DisconnectEvent = {\n    event: 'disconnect',\n    id: lastOutputId,\n    payload: {},\n  };\n\n  await sendMessage(response, secretKey, clientId, appClientId);\n}\n\nfunction sendMessage(\n  message: AnyLiteral, secretKey: string, clientId: string, toId: string, topic?: 'signTransaction' | 'signData',\n) {\n  const buffer = Buffer.from(JSON.stringify(message));\n  const encryptedMessage = encryptMessage(buffer, toId, secretKey);\n  return sendRawMessage(encryptedMessage, clientId, toId, topic);\n}\n\nasync function sendRawMessage(body: string, clientId: string, toId: string, topic?: 'signTransaction' | 'signData') {\n  const url = new URL(`${SSE_BRIDGE_URL}message`);\n  url.searchParams.set('client_id', clientId);\n  url.searchParams.set('to', toId);\n  url.searchParams.set('ttl', TTL_SEC.toString());\n  if (topic) {\n    url.searchParams.set('topic', topic);\n  }\n\n  const response = await fetch(url, { method: 'POST', body });\n  await handleFetchErrors(response);\n}\n\nfunction closeEventSource() {\n  if (!sseEventSource) return;\n\n  safeExec(() => {\n    sseEventSource!.close();\n  });\n  sseEventSource = undefined;\n}\n\nfunction openEventSource(clientIds: string[], lastEventId?: string) {\n  const url = new URL(`${SSE_BRIDGE_URL}events`);\n  url.searchParams.set('client_id', clientIds.join(','));\n  if (lastEventId) {\n    url.searchParams.set('last_event_id', lastEventId);\n  }\n  return new EventSource(url);\n}\n\nfunction encryptMessage(message: Uint8Array, publicKey: string, secretKey: string) {\n  const nonce = randomBytes(NONCE_SIZE);\n  const encrypted = nacl.box(\n    message, nonce, Buffer.from(publicKey, 'hex'), Buffer.from(secretKey, 'hex'),\n  );\n  return Buffer.concat([nonce, encrypted]).toString('base64');\n}\n\nfunction decryptMessage(message: string, publicKey: string, secretKey: string) {\n  const fullBuffer = Buffer.from(message, 'base64');\n  const nonce = fullBuffer.subarray(0, NONCE_SIZE);\n  const encrypted = fullBuffer.subarray(NONCE_SIZE);\n  const decrypted = nacl.box.open(\n    encrypted,\n    nonce,\n    Buffer.from(publicKey, 'hex'),\n    Buffer.from(secretKey, 'hex'),\n  );\n  const jsonText = new TextDecoder('utf-8').decode(decrypted!);\n  return JSON.parse(jsonText);\n}\n","import type { ApiBaseCurrency, ApiHistoryList, ApiPriceHistoryPeriod } from '../types';\n\nimport { DEFAULT_PRICE_CURRENCY, TONCOIN } from '../../config';\nimport { callBackendGet } from '../common/backend';\nimport { tokensPreload } from '../common/tokens';\nimport { getTokenBySlug } from './tokens';\n\nexport { setBaseCurrency, getBaseCurrency } from '../common/prices';\n\nexport async function fetchPriceHistory(\n  slug: string,\n  period: ApiPriceHistoryPeriod,\n  baseCurrency: ApiBaseCurrency = DEFAULT_PRICE_CURRENCY,\n): Promise<ApiHistoryList | undefined> {\n  await tokensPreload.promise;\n  const token = getTokenBySlug(slug);\n\n  if (!token) {\n    return [];\n  }\n\n  const assetId = token.chain === TONCOIN.chain && token.tokenAddress ? token.tokenAddress : token.symbol;\n\n  return callBackendGet(`/prices/chart/${assetId}`, {\n    base: baseCurrency,\n    period,\n  });\n}\n","import type {\n  ApiSubscribeNotificationsProps, ApiSubscribeNotificationsResult, ApiUnsubscribeNotificationsProps,\n} from '../types';\n\nimport { logDebugError } from '../../util/logs';\nimport { callBackendPost } from '../common/backend';\nimport { handleServerError } from '../errors';\n\nexport async function subscribeNotifications(props: ApiSubscribeNotificationsProps) {\n  try {\n    return await callBackendPost<ApiSubscribeNotificationsResult>(\n      '/notifications/subscribe', props, { shouldRetry: true },\n    );\n  } catch (err) {\n    logDebugError('subscribeNotifications', err);\n    return handleServerError(err);\n  }\n}\n\nexport async function unsubscribeNotifications(props: ApiUnsubscribeNotificationsProps) {\n  try {\n    return await callBackendPost<{ ok: true }>(\n      '/notifications/unsubscribe', props, { shouldRetry: true },\n    );\n  } catch (err) {\n    logDebugError('unsubscribeNotifications', err);\n    return handleServerError(err);\n  }\n}\n","import type { ApiInitArgs, OnApiUpdate } from '../types';\n\nimport { initWindowConnector } from '../../util/windowProvider/connector';\nimport chains from '../chains';\nimport { callBackendGet } from '../common/backend';\nimport { connectUpdater, disconnectUpdater, startStorageMigration } from '../common/helpers';\nimport { setEnvironment } from '../environment';\nimport { addHooks } from '../hooks';\nimport { storage } from '../storages';\nimport * as tonConnect from '../tonConnect';\nimport * as tonConnectSse from '../tonConnect/sse';\nimport { destroyPolling } from './polling';\nimport * as methods from '.';\n\naddHooks({\n  onDappDisconnected: tonConnectSse.sendSseDisconnect,\n  onDappsChanged: tonConnectSse.resetupSseConnection,\n});\n\nexport default async function init(onUpdate: OnApiUpdate, args: ApiInitArgs) {\n  connectUpdater(onUpdate);\n  const environment = setEnvironment(args);\n\n  initWindowConnector();\n\n  methods.initAccounts(onUpdate);\n  methods.initPolling(onUpdate);\n  methods.initTransactions(onUpdate);\n  methods.initStaking();\n  methods.initSwap(onUpdate);\n  methods.initNfts(onUpdate);\n\n  if (environment.isDappSupported) {\n    methods.initDapps(onUpdate);\n    tonConnect.initTonConnect(onUpdate);\n  }\n\n  if (environment.isSseSupported) {\n    tonConnectSse.initSse(onUpdate);\n  }\n\n  await startStorageMigration(onUpdate, chains.ton, args.accountIds);\n\n  if (environment.isSseSupported) {\n    void tonConnectSse.resetupSseConnection();\n  }\n\n  void saveReferrer(args);\n}\n\nexport function destroy() {\n  void destroyPolling();\n  disconnectUpdater();\n}\n\nasync function saveReferrer(args: ApiInitArgs) {\n  let referrer = await storage.getItem('referrer');\n\n  if (referrer !== undefined) return;\n\n  if (args.referrer) {\n    referrer = args.referrer;\n  } else {\n    ({ referrer } = await callBackendGet<{ referrer?: string }>('/referrer/get'));\n  }\n\n  // An empty string means no referrer\n  await storage.setItem('referrer', referrer ?? '');\n}\n","import type { StorageKey } from '../storages/types';\n\nimport { storage } from '../storages';\n\ntype OldAccount = {\n  address: string;\n  publicKey: string;\n  version: string;\n  ledger?: {\n    index: number;\n    driver: string;\n    deviceId?: string;\n    deviceName?: string;\n  };\n  authToken?: string;\n  isInitialized?: boolean;\n};\n\nexport async function start() {\n  const oldAccountById: Record<string, OldAccount> | undefined = await storage.getItem('accounts');\n\n  if (!oldAccountById) return;\n\n  const mnemonicById: Record<string, string> = await storage.getItem('mnemonicsEncrypted' as StorageKey);\n  const newAccountById: Record<string, any> = {};\n\n  for (const [accountId, oldAccount] of Object.entries(oldAccountById)) {\n    const {\n      address, version, publicKey, authToken, ledger, isInitialized,\n    } = oldAccount;\n\n    const tonWallet = {\n      type: 'ton',\n      address,\n      version,\n      publicKey,\n      authToken,\n      isInitialized,\n      index: ledger?.index ?? 0,\n    };\n\n    newAccountById[accountId] = ledger ? {\n      type: 'ledger',\n      ton: tonWallet,\n      driver: ledger.driver,\n      deviceId: ledger.deviceId,\n      deviceName: ledger.deviceName,\n    } : {\n      type: 'ton',\n      mnemonicEncrypted: mnemonicById[accountId],\n      ton: tonWallet,\n    };\n  }\n\n  await storage.setItem('accounts', newAccountById);\n}\n","import type { ApiDapp } from '../types';\n\nimport { getDappConnectionUniqueId } from '../../util/getDappConnectionUniqueId';\nimport { storage } from '../storages';\n\nexport async function start() {\n  // Previous schema: Record<accountId, Record<url, ApiDapp>>\n  // New schema:     Record<accountId, Record<url, Record<uniqueId, ApiDapp>>>\n  const oldState: Record<string, Record<string, ApiDapp>> | undefined = await storage.getItem('dapps');\n\n  if (!oldState) return;\n\n  const newState: Record<string, Record<string, Record<string, ApiDapp>>> = {};\n\n  for (const [accountId, byUrl] of Object.entries(oldState)) {\n    newState[accountId] = {};\n\n    for (const [url, dapp] of Object.entries(byUrl)) {\n      const uniqueId = getDappConnectionUniqueId(dapp);\n      newState[accountId][url] = { [uniqueId]: dapp };\n    }\n  }\n\n  await storage.setItem('dapps', newState);\n}\n","import { pick } from '../../util/iteratees';\nimport { storage } from '../storages';\n\nexport async function start(activeAccountIds?: string[]) {\n  if (!activeAccountIds || activeAccountIds.length === 0) {\n    return;\n  }\n\n  const accounts: Record<string, any> | undefined = await storage.getItem('accounts');\n\n  if (!accounts) {\n    return;\n  }\n\n  await storage.setItem('accounts', pick(accounts, activeAccountIds));\n}\n","import type {\n  MethodArgs, Methods,\n} from '../../methods/types';\nimport type { TonConnectMethodArgs, TonConnectMethods } from '../../tonConnect/types/misc';\nimport type {\n  ApiInitArgs, OnApiUpdate,\n} from '../../types';\n\nimport { createPostMessageInterface } from '../../../util/createPostMessageInterface';\nimport * as methods from '../../methods';\nimport init from '../../methods/init';\nimport * as tonConnectApi from '../../tonConnect';\n\ncreatePostMessageInterface((name: string, origin?: string, ...args: any[]) => {\n  if (name === 'init') {\n    return init(args[0] as OnApiUpdate, args[1] as ApiInitArgs);\n  } else {\n    if (name.startsWith('tonConnect_')) {\n      name = name.replace('tonConnect_', '');\n      const method = tonConnectApi[name as keyof TonConnectMethods];\n      // @ts-ignore\n      return method(...args as TonConnectMethodArgs<keyof TonConnectMethods>);\n    }\n\n    const method = methods[name as keyof Methods];\n\n    // @ts-ignore\n    return method(...args as MethodArgs<keyof Methods>);\n  }\n});\n","// Version 3.1.2\n/*! MIT License. Copyright 2015-2018 Richard Moore <me@ricmoo.com>. See LICENSE.txt. */\n(function(root) {\n  \"use strict\";\n\n  function checkInt(value) {\n    return (parseInt(value) === value);\n  }\n\n  function checkInts(arrayish) {\n    if (!checkInt(arrayish.length)) { return false; }\n\n    for (var i = 0; i < arrayish.length; i++) {\n      if (!checkInt(arrayish[i]) || arrayish[i] < 0 || arrayish[i] > 255) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  function coerceArray(arg, copy) {\n\n    // ArrayBuffer view\n    if (arg.buffer && arg.name === 'Uint8Array') {\n\n      if (copy) {\n        if (arg.slice) {\n          arg = arg.slice();\n        } else {\n          arg = Array.prototype.slice.call(arg);\n        }\n      }\n\n      return arg;\n    }\n\n    // It's an array; check it is a valid representation of a byte\n    if (Array.isArray(arg)) {\n      if (!checkInts(arg)) {\n        throw new Error('Array contains invalid value: ' + arg);\n      }\n\n      return new Uint8Array(arg);\n    }\n\n    // Something else, but behaves like an array (maybe a Buffer? Arguments?)\n    if (checkInt(arg.length) && checkInts(arg)) {\n      return new Uint8Array(arg);\n    }\n\n    throw new Error('unsupported array-like object');\n  }\n\n  function createArray(length) {\n    return new Uint8Array(length);\n  }\n\n  function copyArray(sourceArray, targetArray, targetStart, sourceStart, sourceEnd) {\n    if (sourceStart != null || sourceEnd != null) {\n      if (sourceArray.slice) {\n        sourceArray = sourceArray.slice(sourceStart, sourceEnd);\n      } else {\n        sourceArray = Array.prototype.slice.call(sourceArray, sourceStart, sourceEnd);\n      }\n    }\n    targetArray.set(sourceArray, targetStart);\n  }\n\n\n\n  var convertUtf8 = (function() {\n    function toBytes(text) {\n      var result = [], i = 0;\n      text = encodeURI(text);\n      while (i < text.length) {\n        var c = text.charCodeAt(i++);\n\n        // if it is a % sign, encode the following 2 bytes as a hex value\n        if (c === 37) {\n          result.push(parseInt(text.substr(i, 2), 16))\n          i += 2;\n\n          // otherwise, just the actual byte\n        } else {\n          result.push(c)\n        }\n      }\n\n      return coerceArray(result);\n    }\n\n    function fromBytes(bytes) {\n      var result = [], i = 0;\n\n      while (i < bytes.length) {\n        var c = bytes[i];\n\n        if (c < 128) {\n          result.push(String.fromCharCode(c));\n          i++;\n        } else if (c > 191 && c < 224) {\n          result.push(String.fromCharCode(((c & 0x1f) << 6) | (bytes[i + 1] & 0x3f)));\n          i += 2;\n        } else {\n          result.push(String.fromCharCode(((c & 0x0f) << 12) | ((bytes[i + 1] & 0x3f) << 6) | (bytes[i + 2] & 0x3f)));\n          i += 3;\n        }\n      }\n\n      return result.join('');\n    }\n\n    return {\n      toBytes: toBytes,\n      fromBytes: fromBytes,\n    }\n  })();\n\n  var convertHex = (function() {\n    function toBytes(text) {\n      var result = [];\n      for (var i = 0; i < text.length; i += 2) {\n        result.push(parseInt(text.substr(i, 2), 16));\n      }\n\n      return result;\n    }\n\n    // http://ixti.net/development/javascript/2011/11/11/base64-encodedecode-of-utf8-in-browser-with-js.html\n    var Hex = '0123456789abcdef';\n\n    function fromBytes(bytes) {\n      var result = [];\n      for (var i = 0; i < bytes.length; i++) {\n        var v = bytes[i];\n        result.push(Hex[(v & 0xf0) >> 4] + Hex[v & 0x0f]);\n      }\n      return result.join('');\n    }\n\n    return {\n      toBytes: toBytes,\n      fromBytes: fromBytes,\n    }\n  })();\n\n\n  // Number of rounds by keysize\n  var numberOfRounds = {16: 10, 24: 12, 32: 14}\n\n  // Round constant words\n  var rcon = [0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0x1b, 0x36, 0x6c, 0xd8, 0xab, 0x4d, 0x9a, 0x2f, 0x5e, 0xbc, 0x63, 0xc6, 0x97, 0x35, 0x6a, 0xd4, 0xb3, 0x7d, 0xfa, 0xef, 0xc5, 0x91];\n\n  // S-box and Inverse S-box (S is for Substitution)\n  var S = [0x63, 0x7c, 0x77, 0x7b, 0xf2, 0x6b, 0x6f, 0xc5, 0x30, 0x01, 0x67, 0x2b, 0xfe, 0xd7, 0xab, 0x76, 0xca, 0x82, 0xc9, 0x7d, 0xfa, 0x59, 0x47, 0xf0, 0xad, 0xd4, 0xa2, 0xaf, 0x9c, 0xa4, 0x72, 0xc0, 0xb7, 0xfd, 0x93, 0x26, 0x36, 0x3f, 0xf7, 0xcc, 0x34, 0xa5, 0xe5, 0xf1, 0x71, 0xd8, 0x31, 0x15, 0x04, 0xc7, 0x23, 0xc3, 0x18, 0x96, 0x05, 0x9a, 0x07, 0x12, 0x80, 0xe2, 0xeb, 0x27, 0xb2, 0x75, 0x09, 0x83, 0x2c, 0x1a, 0x1b, 0x6e, 0x5a, 0xa0, 0x52, 0x3b, 0xd6, 0xb3, 0x29, 0xe3, 0x2f, 0x84, 0x53, 0xd1, 0x00, 0xed, 0x20, 0xfc, 0xb1, 0x5b, 0x6a, 0xcb, 0xbe, 0x39, 0x4a, 0x4c, 0x58, 0xcf, 0xd0, 0xef, 0xaa, 0xfb, 0x43, 0x4d, 0x33, 0x85, 0x45, 0xf9, 0x02, 0x7f, 0x50, 0x3c, 0x9f, 0xa8, 0x51, 0xa3, 0x40, 0x8f, 0x92, 0x9d, 0x38, 0xf5, 0xbc, 0xb6, 0xda, 0x21, 0x10, 0xff, 0xf3, 0xd2, 0xcd, 0x0c, 0x13, 0xec, 0x5f, 0x97, 0x44, 0x17, 0xc4, 0xa7, 0x7e, 0x3d, 0x64, 0x5d, 0x19, 0x73, 0x60, 0x81, 0x4f, 0xdc, 0x22, 0x2a, 0x90, 0x88, 0x46, 0xee, 0xb8, 0x14, 0xde, 0x5e, 0x0b, 0xdb, 0xe0, 0x32, 0x3a, 0x0a, 0x49, 0x06, 0x24, 0x5c, 0xc2, 0xd3, 0xac, 0x62, 0x91, 0x95, 0xe4, 0x79, 0xe7, 0xc8, 0x37, 0x6d, 0x8d, 0xd5, 0x4e, 0xa9, 0x6c, 0x56, 0xf4, 0xea, 0x65, 0x7a, 0xae, 0x08, 0xba, 0x78, 0x25, 0x2e, 0x1c, 0xa6, 0xb4, 0xc6, 0xe8, 0xdd, 0x74, 0x1f, 0x4b, 0xbd, 0x8b, 0x8a, 0x70, 0x3e, 0xb5, 0x66, 0x48, 0x03, 0xf6, 0x0e, 0x61, 0x35, 0x57, 0xb9, 0x86, 0xc1, 0x1d, 0x9e, 0xe1, 0xf8, 0x98, 0x11, 0x69, 0xd9, 0x8e, 0x94, 0x9b, 0x1e, 0x87, 0xe9, 0xce, 0x55, 0x28, 0xdf, 0x8c, 0xa1, 0x89, 0x0d, 0xbf, 0xe6, 0x42, 0x68, 0x41, 0x99, 0x2d, 0x0f, 0xb0, 0x54, 0xbb, 0x16];\n  var Si =[0x52, 0x09, 0x6a, 0xd5, 0x30, 0x36, 0xa5, 0x38, 0xbf, 0x40, 0xa3, 0x9e, 0x81, 0xf3, 0xd7, 0xfb, 0x7c, 0xe3, 0x39, 0x82, 0x9b, 0x2f, 0xff, 0x87, 0x34, 0x8e, 0x43, 0x44, 0xc4, 0xde, 0xe9, 0xcb, 0x54, 0x7b, 0x94, 0x32, 0xa6, 0xc2, 0x23, 0x3d, 0xee, 0x4c, 0x95, 0x0b, 0x42, 0xfa, 0xc3, 0x4e, 0x08, 0x2e, 0xa1, 0x66, 0x28, 0xd9, 0x24, 0xb2, 0x76, 0x5b, 0xa2, 0x49, 0x6d, 0x8b, 0xd1, 0x25, 0x72, 0xf8, 0xf6, 0x64, 0x86, 0x68, 0x98, 0x16, 0xd4, 0xa4, 0x5c, 0xcc, 0x5d, 0x65, 0xb6, 0x92, 0x6c, 0x70, 0x48, 0x50, 0xfd, 0xed, 0xb9, 0xda, 0x5e, 0x15, 0x46, 0x57, 0xa7, 0x8d, 0x9d, 0x84, 0x90, 0xd8, 0xab, 0x00, 0x8c, 0xbc, 0xd3, 0x0a, 0xf7, 0xe4, 0x58, 0x05, 0xb8, 0xb3, 0x45, 0x06, 0xd0, 0x2c, 0x1e, 0x8f, 0xca, 0x3f, 0x0f, 0x02, 0xc1, 0xaf, 0xbd, 0x03, 0x01, 0x13, 0x8a, 0x6b, 0x3a, 0x91, 0x11, 0x41, 0x4f, 0x67, 0xdc, 0xea, 0x97, 0xf2, 0xcf, 0xce, 0xf0, 0xb4, 0xe6, 0x73, 0x96, 0xac, 0x74, 0x22, 0xe7, 0xad, 0x35, 0x85, 0xe2, 0xf9, 0x37, 0xe8, 0x1c, 0x75, 0xdf, 0x6e, 0x47, 0xf1, 0x1a, 0x71, 0x1d, 0x29, 0xc5, 0x89, 0x6f, 0xb7, 0x62, 0x0e, 0xaa, 0x18, 0xbe, 0x1b, 0xfc, 0x56, 0x3e, 0x4b, 0xc6, 0xd2, 0x79, 0x20, 0x9a, 0xdb, 0xc0, 0xfe, 0x78, 0xcd, 0x5a, 0xf4, 0x1f, 0xdd, 0xa8, 0x33, 0x88, 0x07, 0xc7, 0x31, 0xb1, 0x12, 0x10, 0x59, 0x27, 0x80, 0xec, 0x5f, 0x60, 0x51, 0x7f, 0xa9, 0x19, 0xb5, 0x4a, 0x0d, 0x2d, 0xe5, 0x7a, 0x9f, 0x93, 0xc9, 0x9c, 0xef, 0xa0, 0xe0, 0x3b, 0x4d, 0xae, 0x2a, 0xf5, 0xb0, 0xc8, 0xeb, 0xbb, 0x3c, 0x83, 0x53, 0x99, 0x61, 0x17, 0x2b, 0x04, 0x7e, 0xba, 0x77, 0xd6, 0x26, 0xe1, 0x69, 0x14, 0x63, 0x55, 0x21, 0x0c, 0x7d];\n\n  // Transformations for encryption\n  var T1 = [0xc66363a5, 0xf87c7c84, 0xee777799, 0xf67b7b8d, 0xfff2f20d, 0xd66b6bbd, 0xde6f6fb1, 0x91c5c554, 0x60303050, 0x02010103, 0xce6767a9, 0x562b2b7d, 0xe7fefe19, 0xb5d7d762, 0x4dababe6, 0xec76769a, 0x8fcaca45, 0x1f82829d, 0x89c9c940, 0xfa7d7d87, 0xeffafa15, 0xb25959eb, 0x8e4747c9, 0xfbf0f00b, 0x41adadec, 0xb3d4d467, 0x5fa2a2fd, 0x45afafea, 0x239c9cbf, 0x53a4a4f7, 0xe4727296, 0x9bc0c05b, 0x75b7b7c2, 0xe1fdfd1c, 0x3d9393ae, 0x4c26266a, 0x6c36365a, 0x7e3f3f41, 0xf5f7f702, 0x83cccc4f, 0x6834345c, 0x51a5a5f4, 0xd1e5e534, 0xf9f1f108, 0xe2717193, 0xabd8d873, 0x62313153, 0x2a15153f, 0x0804040c, 0x95c7c752, 0x46232365, 0x9dc3c35e, 0x30181828, 0x379696a1, 0x0a05050f, 0x2f9a9ab5, 0x0e070709, 0x24121236, 0x1b80809b, 0xdfe2e23d, 0xcdebeb26, 0x4e272769, 0x7fb2b2cd, 0xea75759f, 0x1209091b, 0x1d83839e, 0x582c2c74, 0x341a1a2e, 0x361b1b2d, 0xdc6e6eb2, 0xb45a5aee, 0x5ba0a0fb, 0xa45252f6, 0x763b3b4d, 0xb7d6d661, 0x7db3b3ce, 0x5229297b, 0xdde3e33e, 0x5e2f2f71, 0x13848497, 0xa65353f5, 0xb9d1d168, 0x00000000, 0xc1eded2c, 0x40202060, 0xe3fcfc1f, 0x79b1b1c8, 0xb65b5bed, 0xd46a6abe, 0x8dcbcb46, 0x67bebed9, 0x7239394b, 0x944a4ade, 0x984c4cd4, 0xb05858e8, 0x85cfcf4a, 0xbbd0d06b, 0xc5efef2a, 0x4faaaae5, 0xedfbfb16, 0x864343c5, 0x9a4d4dd7, 0x66333355, 0x11858594, 0x8a4545cf, 0xe9f9f910, 0x04020206, 0xfe7f7f81, 0xa05050f0, 0x783c3c44, 0x259f9fba, 0x4ba8a8e3, 0xa25151f3, 0x5da3a3fe, 0x804040c0, 0x058f8f8a, 0x3f9292ad, 0x219d9dbc, 0x70383848, 0xf1f5f504, 0x63bcbcdf, 0x77b6b6c1, 0xafdada75, 0x42212163, 0x20101030, 0xe5ffff1a, 0xfdf3f30e, 0xbfd2d26d, 0x81cdcd4c, 0x180c0c14, 0x26131335, 0xc3ecec2f, 0xbe5f5fe1, 0x359797a2, 0x884444cc, 0x2e171739, 0x93c4c457, 0x55a7a7f2, 0xfc7e7e82, 0x7a3d3d47, 0xc86464ac, 0xba5d5de7, 0x3219192b, 0xe6737395, 0xc06060a0, 0x19818198, 0x9e4f4fd1, 0xa3dcdc7f, 0x44222266, 0x542a2a7e, 0x3b9090ab, 0x0b888883, 0x8c4646ca, 0xc7eeee29, 0x6bb8b8d3, 0x2814143c, 0xa7dede79, 0xbc5e5ee2, 0x160b0b1d, 0xaddbdb76, 0xdbe0e03b, 0x64323256, 0x743a3a4e, 0x140a0a1e, 0x924949db, 0x0c06060a, 0x4824246c, 0xb85c5ce4, 0x9fc2c25d, 0xbdd3d36e, 0x43acacef, 0xc46262a6, 0x399191a8, 0x319595a4, 0xd3e4e437, 0xf279798b, 0xd5e7e732, 0x8bc8c843, 0x6e373759, 0xda6d6db7, 0x018d8d8c, 0xb1d5d564, 0x9c4e4ed2, 0x49a9a9e0, 0xd86c6cb4, 0xac5656fa, 0xf3f4f407, 0xcfeaea25, 0xca6565af, 0xf47a7a8e, 0x47aeaee9, 0x10080818, 0x6fbabad5, 0xf0787888, 0x4a25256f, 0x5c2e2e72, 0x381c1c24, 0x57a6a6f1, 0x73b4b4c7, 0x97c6c651, 0xcbe8e823, 0xa1dddd7c, 0xe874749c, 0x3e1f1f21, 0x964b4bdd, 0x61bdbddc, 0x0d8b8b86, 0x0f8a8a85, 0xe0707090, 0x7c3e3e42, 0x71b5b5c4, 0xcc6666aa, 0x904848d8, 0x06030305, 0xf7f6f601, 0x1c0e0e12, 0xc26161a3, 0x6a35355f, 0xae5757f9, 0x69b9b9d0, 0x17868691, 0x99c1c158, 0x3a1d1d27, 0x279e9eb9, 0xd9e1e138, 0xebf8f813, 0x2b9898b3, 0x22111133, 0xd26969bb, 0xa9d9d970, 0x078e8e89, 0x339494a7, 0x2d9b9bb6, 0x3c1e1e22, 0x15878792, 0xc9e9e920, 0x87cece49, 0xaa5555ff, 0x50282878, 0xa5dfdf7a, 0x038c8c8f, 0x59a1a1f8, 0x09898980, 0x1a0d0d17, 0x65bfbfda, 0xd7e6e631, 0x844242c6, 0xd06868b8, 0x824141c3, 0x299999b0, 0x5a2d2d77, 0x1e0f0f11, 0x7bb0b0cb, 0xa85454fc, 0x6dbbbbd6, 0x2c16163a];\n  var T2 = [0xa5c66363, 0x84f87c7c, 0x99ee7777, 0x8df67b7b, 0x0dfff2f2, 0xbdd66b6b, 0xb1de6f6f, 0x5491c5c5, 0x50603030, 0x03020101, 0xa9ce6767, 0x7d562b2b, 0x19e7fefe, 0x62b5d7d7, 0xe64dabab, 0x9aec7676, 0x458fcaca, 0x9d1f8282, 0x4089c9c9, 0x87fa7d7d, 0x15effafa, 0xebb25959, 0xc98e4747, 0x0bfbf0f0, 0xec41adad, 0x67b3d4d4, 0xfd5fa2a2, 0xea45afaf, 0xbf239c9c, 0xf753a4a4, 0x96e47272, 0x5b9bc0c0, 0xc275b7b7, 0x1ce1fdfd, 0xae3d9393, 0x6a4c2626, 0x5a6c3636, 0x417e3f3f, 0x02f5f7f7, 0x4f83cccc, 0x5c683434, 0xf451a5a5, 0x34d1e5e5, 0x08f9f1f1, 0x93e27171, 0x73abd8d8, 0x53623131, 0x3f2a1515, 0x0c080404, 0x5295c7c7, 0x65462323, 0x5e9dc3c3, 0x28301818, 0xa1379696, 0x0f0a0505, 0xb52f9a9a, 0x090e0707, 0x36241212, 0x9b1b8080, 0x3ddfe2e2, 0x26cdebeb, 0x694e2727, 0xcd7fb2b2, 0x9fea7575, 0x1b120909, 0x9e1d8383, 0x74582c2c, 0x2e341a1a, 0x2d361b1b, 0xb2dc6e6e, 0xeeb45a5a, 0xfb5ba0a0, 0xf6a45252, 0x4d763b3b, 0x61b7d6d6, 0xce7db3b3, 0x7b522929, 0x3edde3e3, 0x715e2f2f, 0x97138484, 0xf5a65353, 0x68b9d1d1, 0x00000000, 0x2cc1eded, 0x60402020, 0x1fe3fcfc, 0xc879b1b1, 0xedb65b5b, 0xbed46a6a, 0x468dcbcb, 0xd967bebe, 0x4b723939, 0xde944a4a, 0xd4984c4c, 0xe8b05858, 0x4a85cfcf, 0x6bbbd0d0, 0x2ac5efef, 0xe54faaaa, 0x16edfbfb, 0xc5864343, 0xd79a4d4d, 0x55663333, 0x94118585, 0xcf8a4545, 0x10e9f9f9, 0x06040202, 0x81fe7f7f, 0xf0a05050, 0x44783c3c, 0xba259f9f, 0xe34ba8a8, 0xf3a25151, 0xfe5da3a3, 0xc0804040, 0x8a058f8f, 0xad3f9292, 0xbc219d9d, 0x48703838, 0x04f1f5f5, 0xdf63bcbc, 0xc177b6b6, 0x75afdada, 0x63422121, 0x30201010, 0x1ae5ffff, 0x0efdf3f3, 0x6dbfd2d2, 0x4c81cdcd, 0x14180c0c, 0x35261313, 0x2fc3ecec, 0xe1be5f5f, 0xa2359797, 0xcc884444, 0x392e1717, 0x5793c4c4, 0xf255a7a7, 0x82fc7e7e, 0x477a3d3d, 0xacc86464, 0xe7ba5d5d, 0x2b321919, 0x95e67373, 0xa0c06060, 0x98198181, 0xd19e4f4f, 0x7fa3dcdc, 0x66442222, 0x7e542a2a, 0xab3b9090, 0x830b8888, 0xca8c4646, 0x29c7eeee, 0xd36bb8b8, 0x3c281414, 0x79a7dede, 0xe2bc5e5e, 0x1d160b0b, 0x76addbdb, 0x3bdbe0e0, 0x56643232, 0x4e743a3a, 0x1e140a0a, 0xdb924949, 0x0a0c0606, 0x6c482424, 0xe4b85c5c, 0x5d9fc2c2, 0x6ebdd3d3, 0xef43acac, 0xa6c46262, 0xa8399191, 0xa4319595, 0x37d3e4e4, 0x8bf27979, 0x32d5e7e7, 0x438bc8c8, 0x596e3737, 0xb7da6d6d, 0x8c018d8d, 0x64b1d5d5, 0xd29c4e4e, 0xe049a9a9, 0xb4d86c6c, 0xfaac5656, 0x07f3f4f4, 0x25cfeaea, 0xafca6565, 0x8ef47a7a, 0xe947aeae, 0x18100808, 0xd56fbaba, 0x88f07878, 0x6f4a2525, 0x725c2e2e, 0x24381c1c, 0xf157a6a6, 0xc773b4b4, 0x5197c6c6, 0x23cbe8e8, 0x7ca1dddd, 0x9ce87474, 0x213e1f1f, 0xdd964b4b, 0xdc61bdbd, 0x860d8b8b, 0x850f8a8a, 0x90e07070, 0x427c3e3e, 0xc471b5b5, 0xaacc6666, 0xd8904848, 0x05060303, 0x01f7f6f6, 0x121c0e0e, 0xa3c26161, 0x5f6a3535, 0xf9ae5757, 0xd069b9b9, 0x91178686, 0x5899c1c1, 0x273a1d1d, 0xb9279e9e, 0x38d9e1e1, 0x13ebf8f8, 0xb32b9898, 0x33221111, 0xbbd26969, 0x70a9d9d9, 0x89078e8e, 0xa7339494, 0xb62d9b9b, 0x223c1e1e, 0x92158787, 0x20c9e9e9, 0x4987cece, 0xffaa5555, 0x78502828, 0x7aa5dfdf, 0x8f038c8c, 0xf859a1a1, 0x80098989, 0x171a0d0d, 0xda65bfbf, 0x31d7e6e6, 0xc6844242, 0xb8d06868, 0xc3824141, 0xb0299999, 0x775a2d2d, 0x111e0f0f, 0xcb7bb0b0, 0xfca85454, 0xd66dbbbb, 0x3a2c1616];\n  var T3 = [0x63a5c663, 0x7c84f87c, 0x7799ee77, 0x7b8df67b, 0xf20dfff2, 0x6bbdd66b, 0x6fb1de6f, 0xc55491c5, 0x30506030, 0x01030201, 0x67a9ce67, 0x2b7d562b, 0xfe19e7fe, 0xd762b5d7, 0xabe64dab, 0x769aec76, 0xca458fca, 0x829d1f82, 0xc94089c9, 0x7d87fa7d, 0xfa15effa, 0x59ebb259, 0x47c98e47, 0xf00bfbf0, 0xadec41ad, 0xd467b3d4, 0xa2fd5fa2, 0xafea45af, 0x9cbf239c, 0xa4f753a4, 0x7296e472, 0xc05b9bc0, 0xb7c275b7, 0xfd1ce1fd, 0x93ae3d93, 0x266a4c26, 0x365a6c36, 0x3f417e3f, 0xf702f5f7, 0xcc4f83cc, 0x345c6834, 0xa5f451a5, 0xe534d1e5, 0xf108f9f1, 0x7193e271, 0xd873abd8, 0x31536231, 0x153f2a15, 0x040c0804, 0xc75295c7, 0x23654623, 0xc35e9dc3, 0x18283018, 0x96a13796, 0x050f0a05, 0x9ab52f9a, 0x07090e07, 0x12362412, 0x809b1b80, 0xe23ddfe2, 0xeb26cdeb, 0x27694e27, 0xb2cd7fb2, 0x759fea75, 0x091b1209, 0x839e1d83, 0x2c74582c, 0x1a2e341a, 0x1b2d361b, 0x6eb2dc6e, 0x5aeeb45a, 0xa0fb5ba0, 0x52f6a452, 0x3b4d763b, 0xd661b7d6, 0xb3ce7db3, 0x297b5229, 0xe33edde3, 0x2f715e2f, 0x84971384, 0x53f5a653, 0xd168b9d1, 0x00000000, 0xed2cc1ed, 0x20604020, 0xfc1fe3fc, 0xb1c879b1, 0x5bedb65b, 0x6abed46a, 0xcb468dcb, 0xbed967be, 0x394b7239, 0x4ade944a, 0x4cd4984c, 0x58e8b058, 0xcf4a85cf, 0xd06bbbd0, 0xef2ac5ef, 0xaae54faa, 0xfb16edfb, 0x43c58643, 0x4dd79a4d, 0x33556633, 0x85941185, 0x45cf8a45, 0xf910e9f9, 0x02060402, 0x7f81fe7f, 0x50f0a050, 0x3c44783c, 0x9fba259f, 0xa8e34ba8, 0x51f3a251, 0xa3fe5da3, 0x40c08040, 0x8f8a058f, 0x92ad3f92, 0x9dbc219d, 0x38487038, 0xf504f1f5, 0xbcdf63bc, 0xb6c177b6, 0xda75afda, 0x21634221, 0x10302010, 0xff1ae5ff, 0xf30efdf3, 0xd26dbfd2, 0xcd4c81cd, 0x0c14180c, 0x13352613, 0xec2fc3ec, 0x5fe1be5f, 0x97a23597, 0x44cc8844, 0x17392e17, 0xc45793c4, 0xa7f255a7, 0x7e82fc7e, 0x3d477a3d, 0x64acc864, 0x5de7ba5d, 0x192b3219, 0x7395e673, 0x60a0c060, 0x81981981, 0x4fd19e4f, 0xdc7fa3dc, 0x22664422, 0x2a7e542a, 0x90ab3b90, 0x88830b88, 0x46ca8c46, 0xee29c7ee, 0xb8d36bb8, 0x143c2814, 0xde79a7de, 0x5ee2bc5e, 0x0b1d160b, 0xdb76addb, 0xe03bdbe0, 0x32566432, 0x3a4e743a, 0x0a1e140a, 0x49db9249, 0x060a0c06, 0x246c4824, 0x5ce4b85c, 0xc25d9fc2, 0xd36ebdd3, 0xacef43ac, 0x62a6c462, 0x91a83991, 0x95a43195, 0xe437d3e4, 0x798bf279, 0xe732d5e7, 0xc8438bc8, 0x37596e37, 0x6db7da6d, 0x8d8c018d, 0xd564b1d5, 0x4ed29c4e, 0xa9e049a9, 0x6cb4d86c, 0x56faac56, 0xf407f3f4, 0xea25cfea, 0x65afca65, 0x7a8ef47a, 0xaee947ae, 0x08181008, 0xbad56fba, 0x7888f078, 0x256f4a25, 0x2e725c2e, 0x1c24381c, 0xa6f157a6, 0xb4c773b4, 0xc65197c6, 0xe823cbe8, 0xdd7ca1dd, 0x749ce874, 0x1f213e1f, 0x4bdd964b, 0xbddc61bd, 0x8b860d8b, 0x8a850f8a, 0x7090e070, 0x3e427c3e, 0xb5c471b5, 0x66aacc66, 0x48d89048, 0x03050603, 0xf601f7f6, 0x0e121c0e, 0x61a3c261, 0x355f6a35, 0x57f9ae57, 0xb9d069b9, 0x86911786, 0xc15899c1, 0x1d273a1d, 0x9eb9279e, 0xe138d9e1, 0xf813ebf8, 0x98b32b98, 0x11332211, 0x69bbd269, 0xd970a9d9, 0x8e89078e, 0x94a73394, 0x9bb62d9b, 0x1e223c1e, 0x87921587, 0xe920c9e9, 0xce4987ce, 0x55ffaa55, 0x28785028, 0xdf7aa5df, 0x8c8f038c, 0xa1f859a1, 0x89800989, 0x0d171a0d, 0xbfda65bf, 0xe631d7e6, 0x42c68442, 0x68b8d068, 0x41c38241, 0x99b02999, 0x2d775a2d, 0x0f111e0f, 0xb0cb7bb0, 0x54fca854, 0xbbd66dbb, 0x163a2c16];\n  var T4 = [0x6363a5c6, 0x7c7c84f8, 0x777799ee, 0x7b7b8df6, 0xf2f20dff, 0x6b6bbdd6, 0x6f6fb1de, 0xc5c55491, 0x30305060, 0x01010302, 0x6767a9ce, 0x2b2b7d56, 0xfefe19e7, 0xd7d762b5, 0xababe64d, 0x76769aec, 0xcaca458f, 0x82829d1f, 0xc9c94089, 0x7d7d87fa, 0xfafa15ef, 0x5959ebb2, 0x4747c98e, 0xf0f00bfb, 0xadadec41, 0xd4d467b3, 0xa2a2fd5f, 0xafafea45, 0x9c9cbf23, 0xa4a4f753, 0x727296e4, 0xc0c05b9b, 0xb7b7c275, 0xfdfd1ce1, 0x9393ae3d, 0x26266a4c, 0x36365a6c, 0x3f3f417e, 0xf7f702f5, 0xcccc4f83, 0x34345c68, 0xa5a5f451, 0xe5e534d1, 0xf1f108f9, 0x717193e2, 0xd8d873ab, 0x31315362, 0x15153f2a, 0x04040c08, 0xc7c75295, 0x23236546, 0xc3c35e9d, 0x18182830, 0x9696a137, 0x05050f0a, 0x9a9ab52f, 0x0707090e, 0x12123624, 0x80809b1b, 0xe2e23ddf, 0xebeb26cd, 0x2727694e, 0xb2b2cd7f, 0x75759fea, 0x09091b12, 0x83839e1d, 0x2c2c7458, 0x1a1a2e34, 0x1b1b2d36, 0x6e6eb2dc, 0x5a5aeeb4, 0xa0a0fb5b, 0x5252f6a4, 0x3b3b4d76, 0xd6d661b7, 0xb3b3ce7d, 0x29297b52, 0xe3e33edd, 0x2f2f715e, 0x84849713, 0x5353f5a6, 0xd1d168b9, 0x00000000, 0xeded2cc1, 0x20206040, 0xfcfc1fe3, 0xb1b1c879, 0x5b5bedb6, 0x6a6abed4, 0xcbcb468d, 0xbebed967, 0x39394b72, 0x4a4ade94, 0x4c4cd498, 0x5858e8b0, 0xcfcf4a85, 0xd0d06bbb, 0xefef2ac5, 0xaaaae54f, 0xfbfb16ed, 0x4343c586, 0x4d4dd79a, 0x33335566, 0x85859411, 0x4545cf8a, 0xf9f910e9, 0x02020604, 0x7f7f81fe, 0x5050f0a0, 0x3c3c4478, 0x9f9fba25, 0xa8a8e34b, 0x5151f3a2, 0xa3a3fe5d, 0x4040c080, 0x8f8f8a05, 0x9292ad3f, 0x9d9dbc21, 0x38384870, 0xf5f504f1, 0xbcbcdf63, 0xb6b6c177, 0xdada75af, 0x21216342, 0x10103020, 0xffff1ae5, 0xf3f30efd, 0xd2d26dbf, 0xcdcd4c81, 0x0c0c1418, 0x13133526, 0xecec2fc3, 0x5f5fe1be, 0x9797a235, 0x4444cc88, 0x1717392e, 0xc4c45793, 0xa7a7f255, 0x7e7e82fc, 0x3d3d477a, 0x6464acc8, 0x5d5de7ba, 0x19192b32, 0x737395e6, 0x6060a0c0, 0x81819819, 0x4f4fd19e, 0xdcdc7fa3, 0x22226644, 0x2a2a7e54, 0x9090ab3b, 0x8888830b, 0x4646ca8c, 0xeeee29c7, 0xb8b8d36b, 0x14143c28, 0xdede79a7, 0x5e5ee2bc, 0x0b0b1d16, 0xdbdb76ad, 0xe0e03bdb, 0x32325664, 0x3a3a4e74, 0x0a0a1e14, 0x4949db92, 0x06060a0c, 0x24246c48, 0x5c5ce4b8, 0xc2c25d9f, 0xd3d36ebd, 0xacacef43, 0x6262a6c4, 0x9191a839, 0x9595a431, 0xe4e437d3, 0x79798bf2, 0xe7e732d5, 0xc8c8438b, 0x3737596e, 0x6d6db7da, 0x8d8d8c01, 0xd5d564b1, 0x4e4ed29c, 0xa9a9e049, 0x6c6cb4d8, 0x5656faac, 0xf4f407f3, 0xeaea25cf, 0x6565afca, 0x7a7a8ef4, 0xaeaee947, 0x08081810, 0xbabad56f, 0x787888f0, 0x25256f4a, 0x2e2e725c, 0x1c1c2438, 0xa6a6f157, 0xb4b4c773, 0xc6c65197, 0xe8e823cb, 0xdddd7ca1, 0x74749ce8, 0x1f1f213e, 0x4b4bdd96, 0xbdbddc61, 0x8b8b860d, 0x8a8a850f, 0x707090e0, 0x3e3e427c, 0xb5b5c471, 0x6666aacc, 0x4848d890, 0x03030506, 0xf6f601f7, 0x0e0e121c, 0x6161a3c2, 0x35355f6a, 0x5757f9ae, 0xb9b9d069, 0x86869117, 0xc1c15899, 0x1d1d273a, 0x9e9eb927, 0xe1e138d9, 0xf8f813eb, 0x9898b32b, 0x11113322, 0x6969bbd2, 0xd9d970a9, 0x8e8e8907, 0x9494a733, 0x9b9bb62d, 0x1e1e223c, 0x87879215, 0xe9e920c9, 0xcece4987, 0x5555ffaa, 0x28287850, 0xdfdf7aa5, 0x8c8c8f03, 0xa1a1f859, 0x89898009, 0x0d0d171a, 0xbfbfda65, 0xe6e631d7, 0x4242c684, 0x6868b8d0, 0x4141c382, 0x9999b029, 0x2d2d775a, 0x0f0f111e, 0xb0b0cb7b, 0x5454fca8, 0xbbbbd66d, 0x16163a2c];\n\n  // Transformations for decryption\n  var T5 = [0x51f4a750, 0x7e416553, 0x1a17a4c3, 0x3a275e96, 0x3bab6bcb, 0x1f9d45f1, 0xacfa58ab, 0x4be30393, 0x2030fa55, 0xad766df6, 0x88cc7691, 0xf5024c25, 0x4fe5d7fc, 0xc52acbd7, 0x26354480, 0xb562a38f, 0xdeb15a49, 0x25ba1b67, 0x45ea0e98, 0x5dfec0e1, 0xc32f7502, 0x814cf012, 0x8d4697a3, 0x6bd3f9c6, 0x038f5fe7, 0x15929c95, 0xbf6d7aeb, 0x955259da, 0xd4be832d, 0x587421d3, 0x49e06929, 0x8ec9c844, 0x75c2896a, 0xf48e7978, 0x99583e6b, 0x27b971dd, 0xbee14fb6, 0xf088ad17, 0xc920ac66, 0x7dce3ab4, 0x63df4a18, 0xe51a3182, 0x97513360, 0x62537f45, 0xb16477e0, 0xbb6bae84, 0xfe81a01c, 0xf9082b94, 0x70486858, 0x8f45fd19, 0x94de6c87, 0x527bf8b7, 0xab73d323, 0x724b02e2, 0xe31f8f57, 0x6655ab2a, 0xb2eb2807, 0x2fb5c203, 0x86c57b9a, 0xd33708a5, 0x302887f2, 0x23bfa5b2, 0x02036aba, 0xed16825c, 0x8acf1c2b, 0xa779b492, 0xf307f2f0, 0x4e69e2a1, 0x65daf4cd, 0x0605bed5, 0xd134621f, 0xc4a6fe8a, 0x342e539d, 0xa2f355a0, 0x058ae132, 0xa4f6eb75, 0x0b83ec39, 0x4060efaa, 0x5e719f06, 0xbd6e1051, 0x3e218af9, 0x96dd063d, 0xdd3e05ae, 0x4de6bd46, 0x91548db5, 0x71c45d05, 0x0406d46f, 0x605015ff, 0x1998fb24, 0xd6bde997, 0x894043cc, 0x67d99e77, 0xb0e842bd, 0x07898b88, 0xe7195b38, 0x79c8eedb, 0xa17c0a47, 0x7c420fe9, 0xf8841ec9, 0x00000000, 0x09808683, 0x322bed48, 0x1e1170ac, 0x6c5a724e, 0xfd0efffb, 0x0f853856, 0x3daed51e, 0x362d3927, 0x0a0fd964, 0x685ca621, 0x9b5b54d1, 0x24362e3a, 0x0c0a67b1, 0x9357e70f, 0xb4ee96d2, 0x1b9b919e, 0x80c0c54f, 0x61dc20a2, 0x5a774b69, 0x1c121a16, 0xe293ba0a, 0xc0a02ae5, 0x3c22e043, 0x121b171d, 0x0e090d0b, 0xf28bc7ad, 0x2db6a8b9, 0x141ea9c8, 0x57f11985, 0xaf75074c, 0xee99ddbb, 0xa37f60fd, 0xf701269f, 0x5c72f5bc, 0x44663bc5, 0x5bfb7e34, 0x8b432976, 0xcb23c6dc, 0xb6edfc68, 0xb8e4f163, 0xd731dcca, 0x42638510, 0x13972240, 0x84c61120, 0x854a247d, 0xd2bb3df8, 0xaef93211, 0xc729a16d, 0x1d9e2f4b, 0xdcb230f3, 0x0d8652ec, 0x77c1e3d0, 0x2bb3166c, 0xa970b999, 0x119448fa, 0x47e96422, 0xa8fc8cc4, 0xa0f03f1a, 0x567d2cd8, 0x223390ef, 0x87494ec7, 0xd938d1c1, 0x8ccaa2fe, 0x98d40b36, 0xa6f581cf, 0xa57ade28, 0xdab78e26, 0x3fadbfa4, 0x2c3a9de4, 0x5078920d, 0x6a5fcc9b, 0x547e4662, 0xf68d13c2, 0x90d8b8e8, 0x2e39f75e, 0x82c3aff5, 0x9f5d80be, 0x69d0937c, 0x6fd52da9, 0xcf2512b3, 0xc8ac993b, 0x10187da7, 0xe89c636e, 0xdb3bbb7b, 0xcd267809, 0x6e5918f4, 0xec9ab701, 0x834f9aa8, 0xe6956e65, 0xaaffe67e, 0x21bccf08, 0xef15e8e6, 0xbae79bd9, 0x4a6f36ce, 0xea9f09d4, 0x29b07cd6, 0x31a4b2af, 0x2a3f2331, 0xc6a59430, 0x35a266c0, 0x744ebc37, 0xfc82caa6, 0xe090d0b0, 0x33a7d815, 0xf104984a, 0x41ecdaf7, 0x7fcd500e, 0x1791f62f, 0x764dd68d, 0x43efb04d, 0xccaa4d54, 0xe49604df, 0x9ed1b5e3, 0x4c6a881b, 0xc12c1fb8, 0x4665517f, 0x9d5eea04, 0x018c355d, 0xfa877473, 0xfb0b412e, 0xb3671d5a, 0x92dbd252, 0xe9105633, 0x6dd64713, 0x9ad7618c, 0x37a10c7a, 0x59f8148e, 0xeb133c89, 0xcea927ee, 0xb761c935, 0xe11ce5ed, 0x7a47b13c, 0x9cd2df59, 0x55f2733f, 0x1814ce79, 0x73c737bf, 0x53f7cdea, 0x5ffdaa5b, 0xdf3d6f14, 0x7844db86, 0xcaaff381, 0xb968c43e, 0x3824342c, 0xc2a3405f, 0x161dc372, 0xbce2250c, 0x283c498b, 0xff0d9541, 0x39a80171, 0x080cb3de, 0xd8b4e49c, 0x6456c190, 0x7bcb8461, 0xd532b670, 0x486c5c74, 0xd0b85742];\n  var T6 = [0x5051f4a7, 0x537e4165, 0xc31a17a4, 0x963a275e, 0xcb3bab6b, 0xf11f9d45, 0xabacfa58, 0x934be303, 0x552030fa, 0xf6ad766d, 0x9188cc76, 0x25f5024c, 0xfc4fe5d7, 0xd7c52acb, 0x80263544, 0x8fb562a3, 0x49deb15a, 0x6725ba1b, 0x9845ea0e, 0xe15dfec0, 0x02c32f75, 0x12814cf0, 0xa38d4697, 0xc66bd3f9, 0xe7038f5f, 0x9515929c, 0xebbf6d7a, 0xda955259, 0x2dd4be83, 0xd3587421, 0x2949e069, 0x448ec9c8, 0x6a75c289, 0x78f48e79, 0x6b99583e, 0xdd27b971, 0xb6bee14f, 0x17f088ad, 0x66c920ac, 0xb47dce3a, 0x1863df4a, 0x82e51a31, 0x60975133, 0x4562537f, 0xe0b16477, 0x84bb6bae, 0x1cfe81a0, 0x94f9082b, 0x58704868, 0x198f45fd, 0x8794de6c, 0xb7527bf8, 0x23ab73d3, 0xe2724b02, 0x57e31f8f, 0x2a6655ab, 0x07b2eb28, 0x032fb5c2, 0x9a86c57b, 0xa5d33708, 0xf2302887, 0xb223bfa5, 0xba02036a, 0x5ced1682, 0x2b8acf1c, 0x92a779b4, 0xf0f307f2, 0xa14e69e2, 0xcd65daf4, 0xd50605be, 0x1fd13462, 0x8ac4a6fe, 0x9d342e53, 0xa0a2f355, 0x32058ae1, 0x75a4f6eb, 0x390b83ec, 0xaa4060ef, 0x065e719f, 0x51bd6e10, 0xf93e218a, 0x3d96dd06, 0xaedd3e05, 0x464de6bd, 0xb591548d, 0x0571c45d, 0x6f0406d4, 0xff605015, 0x241998fb, 0x97d6bde9, 0xcc894043, 0x7767d99e, 0xbdb0e842, 0x8807898b, 0x38e7195b, 0xdb79c8ee, 0x47a17c0a, 0xe97c420f, 0xc9f8841e, 0x00000000, 0x83098086, 0x48322bed, 0xac1e1170, 0x4e6c5a72, 0xfbfd0eff, 0x560f8538, 0x1e3daed5, 0x27362d39, 0x640a0fd9, 0x21685ca6, 0xd19b5b54, 0x3a24362e, 0xb10c0a67, 0x0f9357e7, 0xd2b4ee96, 0x9e1b9b91, 0x4f80c0c5, 0xa261dc20, 0x695a774b, 0x161c121a, 0x0ae293ba, 0xe5c0a02a, 0x433c22e0, 0x1d121b17, 0x0b0e090d, 0xadf28bc7, 0xb92db6a8, 0xc8141ea9, 0x8557f119, 0x4caf7507, 0xbbee99dd, 0xfda37f60, 0x9ff70126, 0xbc5c72f5, 0xc544663b, 0x345bfb7e, 0x768b4329, 0xdccb23c6, 0x68b6edfc, 0x63b8e4f1, 0xcad731dc, 0x10426385, 0x40139722, 0x2084c611, 0x7d854a24, 0xf8d2bb3d, 0x11aef932, 0x6dc729a1, 0x4b1d9e2f, 0xf3dcb230, 0xec0d8652, 0xd077c1e3, 0x6c2bb316, 0x99a970b9, 0xfa119448, 0x2247e964, 0xc4a8fc8c, 0x1aa0f03f, 0xd8567d2c, 0xef223390, 0xc787494e, 0xc1d938d1, 0xfe8ccaa2, 0x3698d40b, 0xcfa6f581, 0x28a57ade, 0x26dab78e, 0xa43fadbf, 0xe42c3a9d, 0x0d507892, 0x9b6a5fcc, 0x62547e46, 0xc2f68d13, 0xe890d8b8, 0x5e2e39f7, 0xf582c3af, 0xbe9f5d80, 0x7c69d093, 0xa96fd52d, 0xb3cf2512, 0x3bc8ac99, 0xa710187d, 0x6ee89c63, 0x7bdb3bbb, 0x09cd2678, 0xf46e5918, 0x01ec9ab7, 0xa8834f9a, 0x65e6956e, 0x7eaaffe6, 0x0821bccf, 0xe6ef15e8, 0xd9bae79b, 0xce4a6f36, 0xd4ea9f09, 0xd629b07c, 0xaf31a4b2, 0x312a3f23, 0x30c6a594, 0xc035a266, 0x37744ebc, 0xa6fc82ca, 0xb0e090d0, 0x1533a7d8, 0x4af10498, 0xf741ecda, 0x0e7fcd50, 0x2f1791f6, 0x8d764dd6, 0x4d43efb0, 0x54ccaa4d, 0xdfe49604, 0xe39ed1b5, 0x1b4c6a88, 0xb8c12c1f, 0x7f466551, 0x049d5eea, 0x5d018c35, 0x73fa8774, 0x2efb0b41, 0x5ab3671d, 0x5292dbd2, 0x33e91056, 0x136dd647, 0x8c9ad761, 0x7a37a10c, 0x8e59f814, 0x89eb133c, 0xeecea927, 0x35b761c9, 0xede11ce5, 0x3c7a47b1, 0x599cd2df, 0x3f55f273, 0x791814ce, 0xbf73c737, 0xea53f7cd, 0x5b5ffdaa, 0x14df3d6f, 0x867844db, 0x81caaff3, 0x3eb968c4, 0x2c382434, 0x5fc2a340, 0x72161dc3, 0x0cbce225, 0x8b283c49, 0x41ff0d95, 0x7139a801, 0xde080cb3, 0x9cd8b4e4, 0x906456c1, 0x617bcb84, 0x70d532b6, 0x74486c5c, 0x42d0b857];\n  var T7 = [0xa75051f4, 0x65537e41, 0xa4c31a17, 0x5e963a27, 0x6bcb3bab, 0x45f11f9d, 0x58abacfa, 0x03934be3, 0xfa552030, 0x6df6ad76, 0x769188cc, 0x4c25f502, 0xd7fc4fe5, 0xcbd7c52a, 0x44802635, 0xa38fb562, 0x5a49deb1, 0x1b6725ba, 0x0e9845ea, 0xc0e15dfe, 0x7502c32f, 0xf012814c, 0x97a38d46, 0xf9c66bd3, 0x5fe7038f, 0x9c951592, 0x7aebbf6d, 0x59da9552, 0x832dd4be, 0x21d35874, 0x692949e0, 0xc8448ec9, 0x896a75c2, 0x7978f48e, 0x3e6b9958, 0x71dd27b9, 0x4fb6bee1, 0xad17f088, 0xac66c920, 0x3ab47dce, 0x4a1863df, 0x3182e51a, 0x33609751, 0x7f456253, 0x77e0b164, 0xae84bb6b, 0xa01cfe81, 0x2b94f908, 0x68587048, 0xfd198f45, 0x6c8794de, 0xf8b7527b, 0xd323ab73, 0x02e2724b, 0x8f57e31f, 0xab2a6655, 0x2807b2eb, 0xc2032fb5, 0x7b9a86c5, 0x08a5d337, 0x87f23028, 0xa5b223bf, 0x6aba0203, 0x825ced16, 0x1c2b8acf, 0xb492a779, 0xf2f0f307, 0xe2a14e69, 0xf4cd65da, 0xbed50605, 0x621fd134, 0xfe8ac4a6, 0x539d342e, 0x55a0a2f3, 0xe132058a, 0xeb75a4f6, 0xec390b83, 0xefaa4060, 0x9f065e71, 0x1051bd6e, 0x8af93e21, 0x063d96dd, 0x05aedd3e, 0xbd464de6, 0x8db59154, 0x5d0571c4, 0xd46f0406, 0x15ff6050, 0xfb241998, 0xe997d6bd, 0x43cc8940, 0x9e7767d9, 0x42bdb0e8, 0x8b880789, 0x5b38e719, 0xeedb79c8, 0x0a47a17c, 0x0fe97c42, 0x1ec9f884, 0x00000000, 0x86830980, 0xed48322b, 0x70ac1e11, 0x724e6c5a, 0xfffbfd0e, 0x38560f85, 0xd51e3dae, 0x3927362d, 0xd9640a0f, 0xa621685c, 0x54d19b5b, 0x2e3a2436, 0x67b10c0a, 0xe70f9357, 0x96d2b4ee, 0x919e1b9b, 0xc54f80c0, 0x20a261dc, 0x4b695a77, 0x1a161c12, 0xba0ae293, 0x2ae5c0a0, 0xe0433c22, 0x171d121b, 0x0d0b0e09, 0xc7adf28b, 0xa8b92db6, 0xa9c8141e, 0x198557f1, 0x074caf75, 0xddbbee99, 0x60fda37f, 0x269ff701, 0xf5bc5c72, 0x3bc54466, 0x7e345bfb, 0x29768b43, 0xc6dccb23, 0xfc68b6ed, 0xf163b8e4, 0xdccad731, 0x85104263, 0x22401397, 0x112084c6, 0x247d854a, 0x3df8d2bb, 0x3211aef9, 0xa16dc729, 0x2f4b1d9e, 0x30f3dcb2, 0x52ec0d86, 0xe3d077c1, 0x166c2bb3, 0xb999a970, 0x48fa1194, 0x642247e9, 0x8cc4a8fc, 0x3f1aa0f0, 0x2cd8567d, 0x90ef2233, 0x4ec78749, 0xd1c1d938, 0xa2fe8cca, 0x0b3698d4, 0x81cfa6f5, 0xde28a57a, 0x8e26dab7, 0xbfa43fad, 0x9de42c3a, 0x920d5078, 0xcc9b6a5f, 0x4662547e, 0x13c2f68d, 0xb8e890d8, 0xf75e2e39, 0xaff582c3, 0x80be9f5d, 0x937c69d0, 0x2da96fd5, 0x12b3cf25, 0x993bc8ac, 0x7da71018, 0x636ee89c, 0xbb7bdb3b, 0x7809cd26, 0x18f46e59, 0xb701ec9a, 0x9aa8834f, 0x6e65e695, 0xe67eaaff, 0xcf0821bc, 0xe8e6ef15, 0x9bd9bae7, 0x36ce4a6f, 0x09d4ea9f, 0x7cd629b0, 0xb2af31a4, 0x23312a3f, 0x9430c6a5, 0x66c035a2, 0xbc37744e, 0xcaa6fc82, 0xd0b0e090, 0xd81533a7, 0x984af104, 0xdaf741ec, 0x500e7fcd, 0xf62f1791, 0xd68d764d, 0xb04d43ef, 0x4d54ccaa, 0x04dfe496, 0xb5e39ed1, 0x881b4c6a, 0x1fb8c12c, 0x517f4665, 0xea049d5e, 0x355d018c, 0x7473fa87, 0x412efb0b, 0x1d5ab367, 0xd25292db, 0x5633e910, 0x47136dd6, 0x618c9ad7, 0x0c7a37a1, 0x148e59f8, 0x3c89eb13, 0x27eecea9, 0xc935b761, 0xe5ede11c, 0xb13c7a47, 0xdf599cd2, 0x733f55f2, 0xce791814, 0x37bf73c7, 0xcdea53f7, 0xaa5b5ffd, 0x6f14df3d, 0xdb867844, 0xf381caaf, 0xc43eb968, 0x342c3824, 0x405fc2a3, 0xc372161d, 0x250cbce2, 0x498b283c, 0x9541ff0d, 0x017139a8, 0xb3de080c, 0xe49cd8b4, 0xc1906456, 0x84617bcb, 0xb670d532, 0x5c74486c, 0x5742d0b8];\n  var T8 = [0xf4a75051, 0x4165537e, 0x17a4c31a, 0x275e963a, 0xab6bcb3b, 0x9d45f11f, 0xfa58abac, 0xe303934b, 0x30fa5520, 0x766df6ad, 0xcc769188, 0x024c25f5, 0xe5d7fc4f, 0x2acbd7c5, 0x35448026, 0x62a38fb5, 0xb15a49de, 0xba1b6725, 0xea0e9845, 0xfec0e15d, 0x2f7502c3, 0x4cf01281, 0x4697a38d, 0xd3f9c66b, 0x8f5fe703, 0x929c9515, 0x6d7aebbf, 0x5259da95, 0xbe832dd4, 0x7421d358, 0xe0692949, 0xc9c8448e, 0xc2896a75, 0x8e7978f4, 0x583e6b99, 0xb971dd27, 0xe14fb6be, 0x88ad17f0, 0x20ac66c9, 0xce3ab47d, 0xdf4a1863, 0x1a3182e5, 0x51336097, 0x537f4562, 0x6477e0b1, 0x6bae84bb, 0x81a01cfe, 0x082b94f9, 0x48685870, 0x45fd198f, 0xde6c8794, 0x7bf8b752, 0x73d323ab, 0x4b02e272, 0x1f8f57e3, 0x55ab2a66, 0xeb2807b2, 0xb5c2032f, 0xc57b9a86, 0x3708a5d3, 0x2887f230, 0xbfa5b223, 0x036aba02, 0x16825ced, 0xcf1c2b8a, 0x79b492a7, 0x07f2f0f3, 0x69e2a14e, 0xdaf4cd65, 0x05bed506, 0x34621fd1, 0xa6fe8ac4, 0x2e539d34, 0xf355a0a2, 0x8ae13205, 0xf6eb75a4, 0x83ec390b, 0x60efaa40, 0x719f065e, 0x6e1051bd, 0x218af93e, 0xdd063d96, 0x3e05aedd, 0xe6bd464d, 0x548db591, 0xc45d0571, 0x06d46f04, 0x5015ff60, 0x98fb2419, 0xbde997d6, 0x4043cc89, 0xd99e7767, 0xe842bdb0, 0x898b8807, 0x195b38e7, 0xc8eedb79, 0x7c0a47a1, 0x420fe97c, 0x841ec9f8, 0x00000000, 0x80868309, 0x2bed4832, 0x1170ac1e, 0x5a724e6c, 0x0efffbfd, 0x8538560f, 0xaed51e3d, 0x2d392736, 0x0fd9640a, 0x5ca62168, 0x5b54d19b, 0x362e3a24, 0x0a67b10c, 0x57e70f93, 0xee96d2b4, 0x9b919e1b, 0xc0c54f80, 0xdc20a261, 0x774b695a, 0x121a161c, 0x93ba0ae2, 0xa02ae5c0, 0x22e0433c, 0x1b171d12, 0x090d0b0e, 0x8bc7adf2, 0xb6a8b92d, 0x1ea9c814, 0xf1198557, 0x75074caf, 0x99ddbbee, 0x7f60fda3, 0x01269ff7, 0x72f5bc5c, 0x663bc544, 0xfb7e345b, 0x4329768b, 0x23c6dccb, 0xedfc68b6, 0xe4f163b8, 0x31dccad7, 0x63851042, 0x97224013, 0xc6112084, 0x4a247d85, 0xbb3df8d2, 0xf93211ae, 0x29a16dc7, 0x9e2f4b1d, 0xb230f3dc, 0x8652ec0d, 0xc1e3d077, 0xb3166c2b, 0x70b999a9, 0x9448fa11, 0xe9642247, 0xfc8cc4a8, 0xf03f1aa0, 0x7d2cd856, 0x3390ef22, 0x494ec787, 0x38d1c1d9, 0xcaa2fe8c, 0xd40b3698, 0xf581cfa6, 0x7ade28a5, 0xb78e26da, 0xadbfa43f, 0x3a9de42c, 0x78920d50, 0x5fcc9b6a, 0x7e466254, 0x8d13c2f6, 0xd8b8e890, 0x39f75e2e, 0xc3aff582, 0x5d80be9f, 0xd0937c69, 0xd52da96f, 0x2512b3cf, 0xac993bc8, 0x187da710, 0x9c636ee8, 0x3bbb7bdb, 0x267809cd, 0x5918f46e, 0x9ab701ec, 0x4f9aa883, 0x956e65e6, 0xffe67eaa, 0xbccf0821, 0x15e8e6ef, 0xe79bd9ba, 0x6f36ce4a, 0x9f09d4ea, 0xb07cd629, 0xa4b2af31, 0x3f23312a, 0xa59430c6, 0xa266c035, 0x4ebc3774, 0x82caa6fc, 0x90d0b0e0, 0xa7d81533, 0x04984af1, 0xecdaf741, 0xcd500e7f, 0x91f62f17, 0x4dd68d76, 0xefb04d43, 0xaa4d54cc, 0x9604dfe4, 0xd1b5e39e, 0x6a881b4c, 0x2c1fb8c1, 0x65517f46, 0x5eea049d, 0x8c355d01, 0x877473fa, 0x0b412efb, 0x671d5ab3, 0xdbd25292, 0x105633e9, 0xd647136d, 0xd7618c9a, 0xa10c7a37, 0xf8148e59, 0x133c89eb, 0xa927eece, 0x61c935b7, 0x1ce5ede1, 0x47b13c7a, 0xd2df599c, 0xf2733f55, 0x14ce7918, 0xc737bf73, 0xf7cdea53, 0xfdaa5b5f, 0x3d6f14df, 0x44db8678, 0xaff381ca, 0x68c43eb9, 0x24342c38, 0xa3405fc2, 0x1dc37216, 0xe2250cbc, 0x3c498b28, 0x0d9541ff, 0xa8017139, 0x0cb3de08, 0xb4e49cd8, 0x56c19064, 0xcb84617b, 0x32b670d5, 0x6c5c7448, 0xb85742d0];\n\n  // Transformations for decryption key expansion\n  var U1 = [0x00000000, 0x0e090d0b, 0x1c121a16, 0x121b171d, 0x3824342c, 0x362d3927, 0x24362e3a, 0x2a3f2331, 0x70486858, 0x7e416553, 0x6c5a724e, 0x62537f45, 0x486c5c74, 0x4665517f, 0x547e4662, 0x5a774b69, 0xe090d0b0, 0xee99ddbb, 0xfc82caa6, 0xf28bc7ad, 0xd8b4e49c, 0xd6bde997, 0xc4a6fe8a, 0xcaaff381, 0x90d8b8e8, 0x9ed1b5e3, 0x8ccaa2fe, 0x82c3aff5, 0xa8fc8cc4, 0xa6f581cf, 0xb4ee96d2, 0xbae79bd9, 0xdb3bbb7b, 0xd532b670, 0xc729a16d, 0xc920ac66, 0xe31f8f57, 0xed16825c, 0xff0d9541, 0xf104984a, 0xab73d323, 0xa57ade28, 0xb761c935, 0xb968c43e, 0x9357e70f, 0x9d5eea04, 0x8f45fd19, 0x814cf012, 0x3bab6bcb, 0x35a266c0, 0x27b971dd, 0x29b07cd6, 0x038f5fe7, 0x0d8652ec, 0x1f9d45f1, 0x119448fa, 0x4be30393, 0x45ea0e98, 0x57f11985, 0x59f8148e, 0x73c737bf, 0x7dce3ab4, 0x6fd52da9, 0x61dc20a2, 0xad766df6, 0xa37f60fd, 0xb16477e0, 0xbf6d7aeb, 0x955259da, 0x9b5b54d1, 0x894043cc, 0x87494ec7, 0xdd3e05ae, 0xd33708a5, 0xc12c1fb8, 0xcf2512b3, 0xe51a3182, 0xeb133c89, 0xf9082b94, 0xf701269f, 0x4de6bd46, 0x43efb04d, 0x51f4a750, 0x5ffdaa5b, 0x75c2896a, 0x7bcb8461, 0x69d0937c, 0x67d99e77, 0x3daed51e, 0x33a7d815, 0x21bccf08, 0x2fb5c203, 0x058ae132, 0x0b83ec39, 0x1998fb24, 0x1791f62f, 0x764dd68d, 0x7844db86, 0x6a5fcc9b, 0x6456c190, 0x4e69e2a1, 0x4060efaa, 0x527bf8b7, 0x5c72f5bc, 0x0605bed5, 0x080cb3de, 0x1a17a4c3, 0x141ea9c8, 0x3e218af9, 0x302887f2, 0x223390ef, 0x2c3a9de4, 0x96dd063d, 0x98d40b36, 0x8acf1c2b, 0x84c61120, 0xaef93211, 0xa0f03f1a, 0xb2eb2807, 0xbce2250c, 0xe6956e65, 0xe89c636e, 0xfa877473, 0xf48e7978, 0xdeb15a49, 0xd0b85742, 0xc2a3405f, 0xccaa4d54, 0x41ecdaf7, 0x4fe5d7fc, 0x5dfec0e1, 0x53f7cdea, 0x79c8eedb, 0x77c1e3d0, 0x65daf4cd, 0x6bd3f9c6, 0x31a4b2af, 0x3fadbfa4, 0x2db6a8b9, 0x23bfa5b2, 0x09808683, 0x07898b88, 0x15929c95, 0x1b9b919e, 0xa17c0a47, 0xaf75074c, 0xbd6e1051, 0xb3671d5a, 0x99583e6b, 0x97513360, 0x854a247d, 0x8b432976, 0xd134621f, 0xdf3d6f14, 0xcd267809, 0xc32f7502, 0xe9105633, 0xe7195b38, 0xf5024c25, 0xfb0b412e, 0x9ad7618c, 0x94de6c87, 0x86c57b9a, 0x88cc7691, 0xa2f355a0, 0xacfa58ab, 0xbee14fb6, 0xb0e842bd, 0xea9f09d4, 0xe49604df, 0xf68d13c2, 0xf8841ec9, 0xd2bb3df8, 0xdcb230f3, 0xcea927ee, 0xc0a02ae5, 0x7a47b13c, 0x744ebc37, 0x6655ab2a, 0x685ca621, 0x42638510, 0x4c6a881b, 0x5e719f06, 0x5078920d, 0x0a0fd964, 0x0406d46f, 0x161dc372, 0x1814ce79, 0x322bed48, 0x3c22e043, 0x2e39f75e, 0x2030fa55, 0xec9ab701, 0xe293ba0a, 0xf088ad17, 0xfe81a01c, 0xd4be832d, 0xdab78e26, 0xc8ac993b, 0xc6a59430, 0x9cd2df59, 0x92dbd252, 0x80c0c54f, 0x8ec9c844, 0xa4f6eb75, 0xaaffe67e, 0xb8e4f163, 0xb6edfc68, 0x0c0a67b1, 0x02036aba, 0x10187da7, 0x1e1170ac, 0x342e539d, 0x3a275e96, 0x283c498b, 0x26354480, 0x7c420fe9, 0x724b02e2, 0x605015ff, 0x6e5918f4, 0x44663bc5, 0x4a6f36ce, 0x587421d3, 0x567d2cd8, 0x37a10c7a, 0x39a80171, 0x2bb3166c, 0x25ba1b67, 0x0f853856, 0x018c355d, 0x13972240, 0x1d9e2f4b, 0x47e96422, 0x49e06929, 0x5bfb7e34, 0x55f2733f, 0x7fcd500e, 0x71c45d05, 0x63df4a18, 0x6dd64713, 0xd731dcca, 0xd938d1c1, 0xcb23c6dc, 0xc52acbd7, 0xef15e8e6, 0xe11ce5ed, 0xf307f2f0, 0xfd0efffb, 0xa779b492, 0xa970b999, 0xbb6bae84, 0xb562a38f, 0x9f5d80be, 0x91548db5, 0x834f9aa8, 0x8d4697a3];\n  var U2 = [0x00000000, 0x0b0e090d, 0x161c121a, 0x1d121b17, 0x2c382434, 0x27362d39, 0x3a24362e, 0x312a3f23, 0x58704868, 0x537e4165, 0x4e6c5a72, 0x4562537f, 0x74486c5c, 0x7f466551, 0x62547e46, 0x695a774b, 0xb0e090d0, 0xbbee99dd, 0xa6fc82ca, 0xadf28bc7, 0x9cd8b4e4, 0x97d6bde9, 0x8ac4a6fe, 0x81caaff3, 0xe890d8b8, 0xe39ed1b5, 0xfe8ccaa2, 0xf582c3af, 0xc4a8fc8c, 0xcfa6f581, 0xd2b4ee96, 0xd9bae79b, 0x7bdb3bbb, 0x70d532b6, 0x6dc729a1, 0x66c920ac, 0x57e31f8f, 0x5ced1682, 0x41ff0d95, 0x4af10498, 0x23ab73d3, 0x28a57ade, 0x35b761c9, 0x3eb968c4, 0x0f9357e7, 0x049d5eea, 0x198f45fd, 0x12814cf0, 0xcb3bab6b, 0xc035a266, 0xdd27b971, 0xd629b07c, 0xe7038f5f, 0xec0d8652, 0xf11f9d45, 0xfa119448, 0x934be303, 0x9845ea0e, 0x8557f119, 0x8e59f814, 0xbf73c737, 0xb47dce3a, 0xa96fd52d, 0xa261dc20, 0xf6ad766d, 0xfda37f60, 0xe0b16477, 0xebbf6d7a, 0xda955259, 0xd19b5b54, 0xcc894043, 0xc787494e, 0xaedd3e05, 0xa5d33708, 0xb8c12c1f, 0xb3cf2512, 0x82e51a31, 0x89eb133c, 0x94f9082b, 0x9ff70126, 0x464de6bd, 0x4d43efb0, 0x5051f4a7, 0x5b5ffdaa, 0x6a75c289, 0x617bcb84, 0x7c69d093, 0x7767d99e, 0x1e3daed5, 0x1533a7d8, 0x0821bccf, 0x032fb5c2, 0x32058ae1, 0x390b83ec, 0x241998fb, 0x2f1791f6, 0x8d764dd6, 0x867844db, 0x9b6a5fcc, 0x906456c1, 0xa14e69e2, 0xaa4060ef, 0xb7527bf8, 0xbc5c72f5, 0xd50605be, 0xde080cb3, 0xc31a17a4, 0xc8141ea9, 0xf93e218a, 0xf2302887, 0xef223390, 0xe42c3a9d, 0x3d96dd06, 0x3698d40b, 0x2b8acf1c, 0x2084c611, 0x11aef932, 0x1aa0f03f, 0x07b2eb28, 0x0cbce225, 0x65e6956e, 0x6ee89c63, 0x73fa8774, 0x78f48e79, 0x49deb15a, 0x42d0b857, 0x5fc2a340, 0x54ccaa4d, 0xf741ecda, 0xfc4fe5d7, 0xe15dfec0, 0xea53f7cd, 0xdb79c8ee, 0xd077c1e3, 0xcd65daf4, 0xc66bd3f9, 0xaf31a4b2, 0xa43fadbf, 0xb92db6a8, 0xb223bfa5, 0x83098086, 0x8807898b, 0x9515929c, 0x9e1b9b91, 0x47a17c0a, 0x4caf7507, 0x51bd6e10, 0x5ab3671d, 0x6b99583e, 0x60975133, 0x7d854a24, 0x768b4329, 0x1fd13462, 0x14df3d6f, 0x09cd2678, 0x02c32f75, 0x33e91056, 0x38e7195b, 0x25f5024c, 0x2efb0b41, 0x8c9ad761, 0x8794de6c, 0x9a86c57b, 0x9188cc76, 0xa0a2f355, 0xabacfa58, 0xb6bee14f, 0xbdb0e842, 0xd4ea9f09, 0xdfe49604, 0xc2f68d13, 0xc9f8841e, 0xf8d2bb3d, 0xf3dcb230, 0xeecea927, 0xe5c0a02a, 0x3c7a47b1, 0x37744ebc, 0x2a6655ab, 0x21685ca6, 0x10426385, 0x1b4c6a88, 0x065e719f, 0x0d507892, 0x640a0fd9, 0x6f0406d4, 0x72161dc3, 0x791814ce, 0x48322bed, 0x433c22e0, 0x5e2e39f7, 0x552030fa, 0x01ec9ab7, 0x0ae293ba, 0x17f088ad, 0x1cfe81a0, 0x2dd4be83, 0x26dab78e, 0x3bc8ac99, 0x30c6a594, 0x599cd2df, 0x5292dbd2, 0x4f80c0c5, 0x448ec9c8, 0x75a4f6eb, 0x7eaaffe6, 0x63b8e4f1, 0x68b6edfc, 0xb10c0a67, 0xba02036a, 0xa710187d, 0xac1e1170, 0x9d342e53, 0x963a275e, 0x8b283c49, 0x80263544, 0xe97c420f, 0xe2724b02, 0xff605015, 0xf46e5918, 0xc544663b, 0xce4a6f36, 0xd3587421, 0xd8567d2c, 0x7a37a10c, 0x7139a801, 0x6c2bb316, 0x6725ba1b, 0x560f8538, 0x5d018c35, 0x40139722, 0x4b1d9e2f, 0x2247e964, 0x2949e069, 0x345bfb7e, 0x3f55f273, 0x0e7fcd50, 0x0571c45d, 0x1863df4a, 0x136dd647, 0xcad731dc, 0xc1d938d1, 0xdccb23c6, 0xd7c52acb, 0xe6ef15e8, 0xede11ce5, 0xf0f307f2, 0xfbfd0eff, 0x92a779b4, 0x99a970b9, 0x84bb6bae, 0x8fb562a3, 0xbe9f5d80, 0xb591548d, 0xa8834f9a, 0xa38d4697];\n  var U3 = [0x00000000, 0x0d0b0e09, 0x1a161c12, 0x171d121b, 0x342c3824, 0x3927362d, 0x2e3a2436, 0x23312a3f, 0x68587048, 0x65537e41, 0x724e6c5a, 0x7f456253, 0x5c74486c, 0x517f4665, 0x4662547e, 0x4b695a77, 0xd0b0e090, 0xddbbee99, 0xcaa6fc82, 0xc7adf28b, 0xe49cd8b4, 0xe997d6bd, 0xfe8ac4a6, 0xf381caaf, 0xb8e890d8, 0xb5e39ed1, 0xa2fe8cca, 0xaff582c3, 0x8cc4a8fc, 0x81cfa6f5, 0x96d2b4ee, 0x9bd9bae7, 0xbb7bdb3b, 0xb670d532, 0xa16dc729, 0xac66c920, 0x8f57e31f, 0x825ced16, 0x9541ff0d, 0x984af104, 0xd323ab73, 0xde28a57a, 0xc935b761, 0xc43eb968, 0xe70f9357, 0xea049d5e, 0xfd198f45, 0xf012814c, 0x6bcb3bab, 0x66c035a2, 0x71dd27b9, 0x7cd629b0, 0x5fe7038f, 0x52ec0d86, 0x45f11f9d, 0x48fa1194, 0x03934be3, 0x0e9845ea, 0x198557f1, 0x148e59f8, 0x37bf73c7, 0x3ab47dce, 0x2da96fd5, 0x20a261dc, 0x6df6ad76, 0x60fda37f, 0x77e0b164, 0x7aebbf6d, 0x59da9552, 0x54d19b5b, 0x43cc8940, 0x4ec78749, 0x05aedd3e, 0x08a5d337, 0x1fb8c12c, 0x12b3cf25, 0x3182e51a, 0x3c89eb13, 0x2b94f908, 0x269ff701, 0xbd464de6, 0xb04d43ef, 0xa75051f4, 0xaa5b5ffd, 0x896a75c2, 0x84617bcb, 0x937c69d0, 0x9e7767d9, 0xd51e3dae, 0xd81533a7, 0xcf0821bc, 0xc2032fb5, 0xe132058a, 0xec390b83, 0xfb241998, 0xf62f1791, 0xd68d764d, 0xdb867844, 0xcc9b6a5f, 0xc1906456, 0xe2a14e69, 0xefaa4060, 0xf8b7527b, 0xf5bc5c72, 0xbed50605, 0xb3de080c, 0xa4c31a17, 0xa9c8141e, 0x8af93e21, 0x87f23028, 0x90ef2233, 0x9de42c3a, 0x063d96dd, 0x0b3698d4, 0x1c2b8acf, 0x112084c6, 0x3211aef9, 0x3f1aa0f0, 0x2807b2eb, 0x250cbce2, 0x6e65e695, 0x636ee89c, 0x7473fa87, 0x7978f48e, 0x5a49deb1, 0x5742d0b8, 0x405fc2a3, 0x4d54ccaa, 0xdaf741ec, 0xd7fc4fe5, 0xc0e15dfe, 0xcdea53f7, 0xeedb79c8, 0xe3d077c1, 0xf4cd65da, 0xf9c66bd3, 0xb2af31a4, 0xbfa43fad, 0xa8b92db6, 0xa5b223bf, 0x86830980, 0x8b880789, 0x9c951592, 0x919e1b9b, 0x0a47a17c, 0x074caf75, 0x1051bd6e, 0x1d5ab367, 0x3e6b9958, 0x33609751, 0x247d854a, 0x29768b43, 0x621fd134, 0x6f14df3d, 0x7809cd26, 0x7502c32f, 0x5633e910, 0x5b38e719, 0x4c25f502, 0x412efb0b, 0x618c9ad7, 0x6c8794de, 0x7b9a86c5, 0x769188cc, 0x55a0a2f3, 0x58abacfa, 0x4fb6bee1, 0x42bdb0e8, 0x09d4ea9f, 0x04dfe496, 0x13c2f68d, 0x1ec9f884, 0x3df8d2bb, 0x30f3dcb2, 0x27eecea9, 0x2ae5c0a0, 0xb13c7a47, 0xbc37744e, 0xab2a6655, 0xa621685c, 0x85104263, 0x881b4c6a, 0x9f065e71, 0x920d5078, 0xd9640a0f, 0xd46f0406, 0xc372161d, 0xce791814, 0xed48322b, 0xe0433c22, 0xf75e2e39, 0xfa552030, 0xb701ec9a, 0xba0ae293, 0xad17f088, 0xa01cfe81, 0x832dd4be, 0x8e26dab7, 0x993bc8ac, 0x9430c6a5, 0xdf599cd2, 0xd25292db, 0xc54f80c0, 0xc8448ec9, 0xeb75a4f6, 0xe67eaaff, 0xf163b8e4, 0xfc68b6ed, 0x67b10c0a, 0x6aba0203, 0x7da71018, 0x70ac1e11, 0x539d342e, 0x5e963a27, 0x498b283c, 0x44802635, 0x0fe97c42, 0x02e2724b, 0x15ff6050, 0x18f46e59, 0x3bc54466, 0x36ce4a6f, 0x21d35874, 0x2cd8567d, 0x0c7a37a1, 0x017139a8, 0x166c2bb3, 0x1b6725ba, 0x38560f85, 0x355d018c, 0x22401397, 0x2f4b1d9e, 0x642247e9, 0x692949e0, 0x7e345bfb, 0x733f55f2, 0x500e7fcd, 0x5d0571c4, 0x4a1863df, 0x47136dd6, 0xdccad731, 0xd1c1d938, 0xc6dccb23, 0xcbd7c52a, 0xe8e6ef15, 0xe5ede11c, 0xf2f0f307, 0xfffbfd0e, 0xb492a779, 0xb999a970, 0xae84bb6b, 0xa38fb562, 0x80be9f5d, 0x8db59154, 0x9aa8834f, 0x97a38d46];\n  var U4 = [0x00000000, 0x090d0b0e, 0x121a161c, 0x1b171d12, 0x24342c38, 0x2d392736, 0x362e3a24, 0x3f23312a, 0x48685870, 0x4165537e, 0x5a724e6c, 0x537f4562, 0x6c5c7448, 0x65517f46, 0x7e466254, 0x774b695a, 0x90d0b0e0, 0x99ddbbee, 0x82caa6fc, 0x8bc7adf2, 0xb4e49cd8, 0xbde997d6, 0xa6fe8ac4, 0xaff381ca, 0xd8b8e890, 0xd1b5e39e, 0xcaa2fe8c, 0xc3aff582, 0xfc8cc4a8, 0xf581cfa6, 0xee96d2b4, 0xe79bd9ba, 0x3bbb7bdb, 0x32b670d5, 0x29a16dc7, 0x20ac66c9, 0x1f8f57e3, 0x16825ced, 0x0d9541ff, 0x04984af1, 0x73d323ab, 0x7ade28a5, 0x61c935b7, 0x68c43eb9, 0x57e70f93, 0x5eea049d, 0x45fd198f, 0x4cf01281, 0xab6bcb3b, 0xa266c035, 0xb971dd27, 0xb07cd629, 0x8f5fe703, 0x8652ec0d, 0x9d45f11f, 0x9448fa11, 0xe303934b, 0xea0e9845, 0xf1198557, 0xf8148e59, 0xc737bf73, 0xce3ab47d, 0xd52da96f, 0xdc20a261, 0x766df6ad, 0x7f60fda3, 0x6477e0b1, 0x6d7aebbf, 0x5259da95, 0x5b54d19b, 0x4043cc89, 0x494ec787, 0x3e05aedd, 0x3708a5d3, 0x2c1fb8c1, 0x2512b3cf, 0x1a3182e5, 0x133c89eb, 0x082b94f9, 0x01269ff7, 0xe6bd464d, 0xefb04d43, 0xf4a75051, 0xfdaa5b5f, 0xc2896a75, 0xcb84617b, 0xd0937c69, 0xd99e7767, 0xaed51e3d, 0xa7d81533, 0xbccf0821, 0xb5c2032f, 0x8ae13205, 0x83ec390b, 0x98fb2419, 0x91f62f17, 0x4dd68d76, 0x44db8678, 0x5fcc9b6a, 0x56c19064, 0x69e2a14e, 0x60efaa40, 0x7bf8b752, 0x72f5bc5c, 0x05bed506, 0x0cb3de08, 0x17a4c31a, 0x1ea9c814, 0x218af93e, 0x2887f230, 0x3390ef22, 0x3a9de42c, 0xdd063d96, 0xd40b3698, 0xcf1c2b8a, 0xc6112084, 0xf93211ae, 0xf03f1aa0, 0xeb2807b2, 0xe2250cbc, 0x956e65e6, 0x9c636ee8, 0x877473fa, 0x8e7978f4, 0xb15a49de, 0xb85742d0, 0xa3405fc2, 0xaa4d54cc, 0xecdaf741, 0xe5d7fc4f, 0xfec0e15d, 0xf7cdea53, 0xc8eedb79, 0xc1e3d077, 0xdaf4cd65, 0xd3f9c66b, 0xa4b2af31, 0xadbfa43f, 0xb6a8b92d, 0xbfa5b223, 0x80868309, 0x898b8807, 0x929c9515, 0x9b919e1b, 0x7c0a47a1, 0x75074caf, 0x6e1051bd, 0x671d5ab3, 0x583e6b99, 0x51336097, 0x4a247d85, 0x4329768b, 0x34621fd1, 0x3d6f14df, 0x267809cd, 0x2f7502c3, 0x105633e9, 0x195b38e7, 0x024c25f5, 0x0b412efb, 0xd7618c9a, 0xde6c8794, 0xc57b9a86, 0xcc769188, 0xf355a0a2, 0xfa58abac, 0xe14fb6be, 0xe842bdb0, 0x9f09d4ea, 0x9604dfe4, 0x8d13c2f6, 0x841ec9f8, 0xbb3df8d2, 0xb230f3dc, 0xa927eece, 0xa02ae5c0, 0x47b13c7a, 0x4ebc3774, 0x55ab2a66, 0x5ca62168, 0x63851042, 0x6a881b4c, 0x719f065e, 0x78920d50, 0x0fd9640a, 0x06d46f04, 0x1dc37216, 0x14ce7918, 0x2bed4832, 0x22e0433c, 0x39f75e2e, 0x30fa5520, 0x9ab701ec, 0x93ba0ae2, 0x88ad17f0, 0x81a01cfe, 0xbe832dd4, 0xb78e26da, 0xac993bc8, 0xa59430c6, 0xd2df599c, 0xdbd25292, 0xc0c54f80, 0xc9c8448e, 0xf6eb75a4, 0xffe67eaa, 0xe4f163b8, 0xedfc68b6, 0x0a67b10c, 0x036aba02, 0x187da710, 0x1170ac1e, 0x2e539d34, 0x275e963a, 0x3c498b28, 0x35448026, 0x420fe97c, 0x4b02e272, 0x5015ff60, 0x5918f46e, 0x663bc544, 0x6f36ce4a, 0x7421d358, 0x7d2cd856, 0xa10c7a37, 0xa8017139, 0xb3166c2b, 0xba1b6725, 0x8538560f, 0x8c355d01, 0x97224013, 0x9e2f4b1d, 0xe9642247, 0xe0692949, 0xfb7e345b, 0xf2733f55, 0xcd500e7f, 0xc45d0571, 0xdf4a1863, 0xd647136d, 0x31dccad7, 0x38d1c1d9, 0x23c6dccb, 0x2acbd7c5, 0x15e8e6ef, 0x1ce5ede1, 0x07f2f0f3, 0x0efffbfd, 0x79b492a7, 0x70b999a9, 0x6bae84bb, 0x62a38fb5, 0x5d80be9f, 0x548db591, 0x4f9aa883, 0x4697a38d];\n\n  function convertToInt32(bytes) {\n    var result = [];\n    for (var i = 0; i < bytes.length; i += 4) {\n      result.push(\n        (bytes[i    ] << 24) |\n        (bytes[i + 1] << 16) |\n        (bytes[i + 2] <<  8) |\n        bytes[i + 3]\n      );\n    }\n    return result;\n  }\n\n  var AES = function(key) {\n    if (!(this instanceof AES)) {\n      throw Error('AES must be instanitated with `new`');\n    }\n\n    Object.defineProperty(this, 'key', {\n      value: coerceArray(key, true)\n    });\n\n    this._prepare();\n  }\n\n\n  AES.prototype._prepare = function() {\n\n    var rounds = numberOfRounds[this.key.length];\n    if (rounds == null) {\n      throw new Error('invalid key size (must be 16, 24 or 32 bytes)');\n    }\n\n    // encryption round keys\n    this._Ke = [];\n\n    // decryption round keys\n    this._Kd = [];\n\n    for (var i = 0; i <= rounds; i++) {\n      this._Ke.push([0, 0, 0, 0]);\n      this._Kd.push([0, 0, 0, 0]);\n    }\n\n    var roundKeyCount = (rounds + 1) * 4;\n    var KC = this.key.length / 4;\n\n    // convert the key into ints\n    var tk = convertToInt32(this.key);\n\n    // copy values into round key arrays\n    var index;\n    for (var i = 0; i < KC; i++) {\n      index = i >> 2;\n      this._Ke[index][i % 4] = tk[i];\n      this._Kd[rounds - index][i % 4] = tk[i];\n    }\n\n    // key expansion (fips-197 section 5.2)\n    var rconpointer = 0;\n    var t = KC, tt;\n    while (t < roundKeyCount) {\n      tt = tk[KC - 1];\n      tk[0] ^= ((S[(tt >> 16) & 0xFF] << 24) ^\n        (S[(tt >>  8) & 0xFF] << 16) ^\n        (S[ tt        & 0xFF] <<  8) ^\n        S[(tt >> 24) & 0xFF]        ^\n        (rcon[rconpointer] << 24));\n      rconpointer += 1;\n\n      // key expansion (for non-256 bit)\n      if (KC != 8) {\n        for (var i = 1; i < KC; i++) {\n          tk[i] ^= tk[i - 1];\n        }\n\n        // key expansion for 256-bit keys is \"slightly different\" (fips-197)\n      } else {\n        for (var i = 1; i < (KC / 2); i++) {\n          tk[i] ^= tk[i - 1];\n        }\n        tt = tk[(KC / 2) - 1];\n\n        tk[KC / 2] ^= (S[ tt        & 0xFF]        ^\n          (S[(tt >>  8) & 0xFF] <<  8) ^\n          (S[(tt >> 16) & 0xFF] << 16) ^\n          (S[(tt >> 24) & 0xFF] << 24));\n\n        for (var i = (KC / 2) + 1; i < KC; i++) {\n          tk[i] ^= tk[i - 1];\n        }\n      }\n\n      // copy values into round key arrays\n      var i = 0, r, c;\n      while (i < KC && t < roundKeyCount) {\n        r = t >> 2;\n        c = t % 4;\n        this._Ke[r][c] = tk[i];\n        this._Kd[rounds - r][c] = tk[i++];\n        t++;\n      }\n    }\n\n    // inverse-cipher-ify the decryption round key (fips-197 section 5.3)\n    for (var r = 1; r < rounds; r++) {\n      for (var c = 0; c < 4; c++) {\n        tt = this._Kd[r][c];\n        this._Kd[r][c] = (U1[(tt >> 24) & 0xFF] ^\n          U2[(tt >> 16) & 0xFF] ^\n          U3[(tt >>  8) & 0xFF] ^\n          U4[ tt        & 0xFF]);\n      }\n    }\n  }\n\n  AES.prototype.encrypt = function(plaintext) {\n    if (plaintext.length != 16) {\n      throw new Error('invalid plaintext size (must be 16 bytes)');\n    }\n\n    var rounds = this._Ke.length - 1;\n    var a = [0, 0, 0, 0];\n\n    // convert plaintext to (ints ^ key)\n    var t = convertToInt32(plaintext);\n    for (var i = 0; i < 4; i++) {\n      t[i] ^= this._Ke[0][i];\n    }\n\n    // apply round transforms\n    for (var r = 1; r < rounds; r++) {\n      for (var i = 0; i < 4; i++) {\n        a[i] = (T1[(t[ i         ] >> 24) & 0xff] ^\n          T2[(t[(i + 1) % 4] >> 16) & 0xff] ^\n          T3[(t[(i + 2) % 4] >>  8) & 0xff] ^\n          T4[ t[(i + 3) % 4]        & 0xff] ^\n          this._Ke[r][i]);\n      }\n      t = a.slice();\n    }\n\n    // the last round is special\n    var result = createArray(16), tt;\n    for (var i = 0; i < 4; i++) {\n      tt = this._Ke[rounds][i];\n      result[4 * i    ] = (S[(t[ i         ] >> 24) & 0xff] ^ (tt >> 24)) & 0xff;\n      result[4 * i + 1] = (S[(t[(i + 1) % 4] >> 16) & 0xff] ^ (tt >> 16)) & 0xff;\n      result[4 * i + 2] = (S[(t[(i + 2) % 4] >>  8) & 0xff] ^ (tt >>  8)) & 0xff;\n      result[4 * i + 3] = (S[ t[(i + 3) % 4]        & 0xff] ^  tt       ) & 0xff;\n    }\n\n    return result;\n  }\n\n  AES.prototype.decrypt = function(ciphertext) {\n    if (ciphertext.length != 16) {\n      throw new Error('invalid ciphertext size (must be 16 bytes)');\n    }\n\n    var rounds = this._Kd.length - 1;\n    var a = [0, 0, 0, 0];\n\n    // convert plaintext to (ints ^ key)\n    var t = convertToInt32(ciphertext);\n    for (var i = 0; i < 4; i++) {\n      t[i] ^= this._Kd[0][i];\n    }\n\n    // apply round transforms\n    for (var r = 1; r < rounds; r++) {\n      for (var i = 0; i < 4; i++) {\n        a[i] = (T5[(t[ i          ] >> 24) & 0xff] ^\n          T6[(t[(i + 3) % 4] >> 16) & 0xff] ^\n          T7[(t[(i + 2) % 4] >>  8) & 0xff] ^\n          T8[ t[(i + 1) % 4]        & 0xff] ^\n          this._Kd[r][i]);\n      }\n      t = a.slice();\n    }\n\n    // the last round is special\n    var result = createArray(16), tt;\n    for (var i = 0; i < 4; i++) {\n      tt = this._Kd[rounds][i];\n      result[4 * i    ] = (Si[(t[ i         ] >> 24) & 0xff] ^ (tt >> 24)) & 0xff;\n      result[4 * i + 1] = (Si[(t[(i + 3) % 4] >> 16) & 0xff] ^ (tt >> 16)) & 0xff;\n      result[4 * i + 2] = (Si[(t[(i + 2) % 4] >>  8) & 0xff] ^ (tt >>  8)) & 0xff;\n      result[4 * i + 3] = (Si[ t[(i + 1) % 4]        & 0xff] ^  tt       ) & 0xff;\n    }\n\n    return result;\n  }\n\n\n  /**\n   *  Mode Of Operation - Electonic Codebook (ECB)\n   */\n  var ModeOfOperationECB = function(key) {\n    if (!(this instanceof ModeOfOperationECB)) {\n      throw Error('AES must be instanitated with `new`');\n    }\n\n    this.description = \"Electronic Code Block\";\n    this.name = \"ecb\";\n\n    this._aes = new AES(key);\n  }\n\n  ModeOfOperationECB.prototype.encrypt = function(plaintext) {\n    plaintext = coerceArray(plaintext);\n\n    if ((plaintext.length % 16) !== 0) {\n      throw new Error('invalid plaintext size (must be multiple of 16 bytes)');\n    }\n\n    var ciphertext = createArray(plaintext.length);\n    var block = createArray(16);\n\n    for (var i = 0; i < plaintext.length; i += 16) {\n      copyArray(plaintext, block, 0, i, i + 16);\n      block = this._aes.encrypt(block);\n      copyArray(block, ciphertext, i);\n    }\n\n    return ciphertext;\n  }\n\n  ModeOfOperationECB.prototype.decrypt = function(ciphertext) {\n    ciphertext = coerceArray(ciphertext);\n\n    if ((ciphertext.length % 16) !== 0) {\n      throw new Error('invalid ciphertext size (must be multiple of 16 bytes)');\n    }\n\n    var plaintext = createArray(ciphertext.length);\n    var block = createArray(16);\n\n    for (var i = 0; i < ciphertext.length; i += 16) {\n      copyArray(ciphertext, block, 0, i, i + 16);\n      block = this._aes.decrypt(block);\n      copyArray(block, plaintext, i);\n    }\n\n    return plaintext;\n  }\n\n\n  /**\n   *  Mode Of Operation - Cipher Block Chaining (CBC)\n   */\n  var ModeOfOperationCBC = function(key, iv) {\n    if (!(this instanceof ModeOfOperationCBC)) {\n      throw Error('AES must be instanitated with `new`');\n    }\n\n    this.description = \"Cipher Block Chaining\";\n    this.name = \"cbc\";\n\n    if (!iv) {\n      iv = createArray(16);\n\n    } else if (iv.length != 16) {\n      throw new Error('invalid initialation vector size (must be 16 bytes)');\n    }\n\n    this._lastCipherblock = coerceArray(iv, true);\n\n    this._aes = new AES(key);\n  }\n\n  ModeOfOperationCBC.prototype.encrypt = function(plaintext) {\n    plaintext = coerceArray(plaintext);\n\n    if ((plaintext.length % 16) !== 0) {\n      throw new Error('invalid plaintext size (must be multiple of 16 bytes)');\n    }\n\n    var ciphertext = createArray(plaintext.length);\n    var block = createArray(16);\n\n    for (var i = 0; i < plaintext.length; i += 16) {\n      copyArray(plaintext, block, 0, i, i + 16);\n\n      for (var j = 0; j < 16; j++) {\n        block[j] ^= this._lastCipherblock[j];\n      }\n\n      this._lastCipherblock = this._aes.encrypt(block);\n      copyArray(this._lastCipherblock, ciphertext, i);\n    }\n\n    return ciphertext;\n  }\n\n  ModeOfOperationCBC.prototype.decrypt = function(ciphertext) {\n    ciphertext = coerceArray(ciphertext);\n\n    if ((ciphertext.length % 16) !== 0) {\n      throw new Error('invalid ciphertext size (must be multiple of 16 bytes)');\n    }\n\n    var plaintext = createArray(ciphertext.length);\n    var block = createArray(16);\n\n    for (var i = 0; i < ciphertext.length; i += 16) {\n      copyArray(ciphertext, block, 0, i, i + 16);\n      block = this._aes.decrypt(block);\n\n      for (var j = 0; j < 16; j++) {\n        plaintext[i + j] = block[j] ^ this._lastCipherblock[j];\n      }\n\n      copyArray(ciphertext, this._lastCipherblock, 0, i, i + 16);\n    }\n\n    return plaintext;\n  }\n\n\n  /**\n   *  Mode Of Operation - Cipher Feedback (CFB)\n   */\n  var ModeOfOperationCFB = function(key, iv, segmentSize) {\n    if (!(this instanceof ModeOfOperationCFB)) {\n      throw Error('AES must be instanitated with `new`');\n    }\n\n    this.description = \"Cipher Feedback\";\n    this.name = \"cfb\";\n\n    if (!iv) {\n      iv = createArray(16);\n\n    } else if (iv.length != 16) {\n      throw new Error('invalid initialation vector size (must be 16 size)');\n    }\n\n    if (!segmentSize) { segmentSize = 1; }\n\n    this.segmentSize = segmentSize;\n\n    this._shiftRegister = coerceArray(iv, true);\n\n    this._aes = new AES(key);\n  }\n\n  ModeOfOperationCFB.prototype.encrypt = function(plaintext) {\n    if ((plaintext.length % this.segmentSize) != 0) {\n      throw new Error('invalid plaintext size (must be segmentSize bytes)');\n    }\n\n    var encrypted = coerceArray(plaintext, true);\n\n    var xorSegment;\n    for (var i = 0; i < encrypted.length; i += this.segmentSize) {\n      xorSegment = this._aes.encrypt(this._shiftRegister);\n      for (var j = 0; j < this.segmentSize; j++) {\n        encrypted[i + j] ^= xorSegment[j];\n      }\n\n      // Shift the register\n      copyArray(this._shiftRegister, this._shiftRegister, 0, this.segmentSize);\n      copyArray(encrypted, this._shiftRegister, 16 - this.segmentSize, i, i + this.segmentSize);\n    }\n\n    return encrypted;\n  }\n\n  ModeOfOperationCFB.prototype.decrypt = function(ciphertext) {\n    if ((ciphertext.length % this.segmentSize) != 0) {\n      throw new Error('invalid ciphertext size (must be segmentSize bytes)');\n    }\n\n    var plaintext = coerceArray(ciphertext, true);\n\n    var xorSegment;\n    for (var i = 0; i < plaintext.length; i += this.segmentSize) {\n      xorSegment = this._aes.encrypt(this._shiftRegister);\n\n      for (var j = 0; j < this.segmentSize; j++) {\n        plaintext[i + j] ^= xorSegment[j];\n      }\n\n      // Shift the register\n      copyArray(this._shiftRegister, this._shiftRegister, 0, this.segmentSize);\n      copyArray(ciphertext, this._shiftRegister, 16 - this.segmentSize, i, i + this.segmentSize);\n    }\n\n    return plaintext;\n  }\n\n  /**\n   *  Mode Of Operation - Output Feedback (OFB)\n   */\n  var ModeOfOperationOFB = function(key, iv) {\n    if (!(this instanceof ModeOfOperationOFB)) {\n      throw Error('AES must be instanitated with `new`');\n    }\n\n    this.description = \"Output Feedback\";\n    this.name = \"ofb\";\n\n    if (!iv) {\n      iv = createArray(16);\n\n    } else if (iv.length != 16) {\n      throw new Error('invalid initialation vector size (must be 16 bytes)');\n    }\n\n    this._lastPrecipher = coerceArray(iv, true);\n    this._lastPrecipherIndex = 16;\n\n    this._aes = new AES(key);\n  }\n\n  ModeOfOperationOFB.prototype.encrypt = function(plaintext) {\n    var encrypted = coerceArray(plaintext, true);\n\n    for (var i = 0; i < encrypted.length; i++) {\n      if (this._lastPrecipherIndex === 16) {\n        this._lastPrecipher = this._aes.encrypt(this._lastPrecipher);\n        this._lastPrecipherIndex = 0;\n      }\n      encrypted[i] ^= this._lastPrecipher[this._lastPrecipherIndex++];\n    }\n\n    return encrypted;\n  }\n\n  // Decryption is symetric\n  ModeOfOperationOFB.prototype.decrypt = ModeOfOperationOFB.prototype.encrypt;\n\n\n  /**\n   *  Counter object for CTR common mode of operation\n   */\n  var Counter = function(initialValue) {\n    if (!(this instanceof Counter)) {\n      throw Error('Counter must be instanitated with `new`');\n    }\n\n    // We allow 0, but anything false-ish uses the default 1\n    if (initialValue !== 0 && !initialValue) { initialValue = 1; }\n\n    if (typeof(initialValue) === 'number') {\n      this._counter = createArray(16);\n      this.setValue(initialValue);\n\n    } else {\n      this.setBytes(initialValue);\n    }\n  }\n\n  Counter.prototype.setValue = function(value) {\n    if (typeof(value) !== 'number' || parseInt(value) != value) {\n      throw new Error('invalid counter value (must be an integer)');\n    }\n\n    // We cannot safely handle numbers beyond the safe range for integers\n    if (value > Number.MAX_SAFE_INTEGER) {\n      throw new Error('integer value out of safe range');\n    }\n\n    for (var index = 15; index >= 0; --index) {\n      this._counter[index] = value % 256;\n      value = parseInt(value / 256);\n    }\n  }\n\n  Counter.prototype.setBytes = function(bytes) {\n    bytes = coerceArray(bytes, true);\n\n    if (bytes.length != 16) {\n      throw new Error('invalid counter bytes size (must be 16 bytes)');\n    }\n\n    this._counter = bytes;\n  };\n\n  Counter.prototype.increment = function() {\n    for (var i = 15; i >= 0; i--) {\n      if (this._counter[i] === 255) {\n        this._counter[i] = 0;\n      } else {\n        this._counter[i]++;\n        break;\n      }\n    }\n  }\n\n\n  /**\n   *  Mode Of Operation - Counter (CTR)\n   */\n  var ModeOfOperationCTR = function(key, counter) {\n    if (!(this instanceof ModeOfOperationCTR)) {\n      throw Error('AES must be instanitated with `new`');\n    }\n\n    this.description = \"Counter\";\n    this.name = \"ctr\";\n\n    if (!(counter instanceof Counter)) {\n      counter = new Counter(counter)\n    }\n\n    this._counter = counter;\n\n    this._remainingCounter = null;\n    this._remainingCounterIndex = 16;\n\n    this._aes = new AES(key);\n  }\n\n  ModeOfOperationCTR.prototype.encrypt = function(plaintext) {\n    var encrypted = coerceArray(plaintext, true);\n\n    for (var i = 0; i < encrypted.length; i++) {\n      if (this._remainingCounterIndex === 16) {\n        this._remainingCounter = this._aes.encrypt(this._counter._counter);\n        this._remainingCounterIndex = 0;\n        this._counter.increment();\n      }\n      encrypted[i] ^= this._remainingCounter[this._remainingCounterIndex++];\n    }\n\n    return encrypted;\n  }\n\n  // Decryption is symetric\n  ModeOfOperationCTR.prototype.decrypt = ModeOfOperationCTR.prototype.encrypt;\n\n\n  ///////////////////////\n  // Padding\n\n  // See:https://tools.ietf.org/html/rfc2315\n  function pkcs7pad(data) {\n    data = coerceArray(data, true);\n    var padder = 16 - (data.length % 16);\n    var result = createArray(data.length + padder);\n    copyArray(data, result);\n    for (var i = data.length; i < result.length; i++) {\n      result[i] = padder;\n    }\n    return result;\n  }\n\n  function pkcs7strip(data) {\n    data = coerceArray(data, true);\n    if (data.length < 16) { throw new Error('PKCS#7 invalid length'); }\n\n    var padder = data[data.length - 1];\n    if (padder > 16) { throw new Error('PKCS#7 padding byte out of range'); }\n\n    var length = data.length - padder;\n    for (var i = 0; i < padder; i++) {\n      if (data[length + i] !== padder) {\n        throw new Error('PKCS#7 invalid padding byte');\n      }\n    }\n\n    var result = createArray(length);\n    copyArray(data, result, 0, 0, length);\n    return result;\n  }\n\n  ///////////////////////\n  // Exporting\n\n\n  // The block cipher\n  var aesjs = {\n    AES: AES,\n    Counter: Counter,\n\n    ModeOfOperation: {\n      ecb: ModeOfOperationECB,\n      cbc: ModeOfOperationCBC,\n      cfb: ModeOfOperationCFB,\n      ofb: ModeOfOperationOFB,\n      ctr: ModeOfOperationCTR\n    },\n\n    utils: {\n      hex: convertHex,\n      utf8: convertUtf8\n    },\n\n    padding: {\n      pkcs7: {\n        pad: pkcs7pad,\n        strip: pkcs7strip\n      }\n    },\n\n    _arrayTest: {\n      coerceArray: coerceArray,\n      createArray: createArray,\n      copyArray: copyArray,\n    }\n  };\n\n\n  // node.js\n  if (typeof exports !== 'undefined') {\n    module.exports = aesjs\n\n    // RequireJS/AMD\n    // http://www.requirejs.org/docs/api.html\n    // https://github.com/amdjs/amdjs-api/wiki/AMD\n  } else if (typeof(define) === 'function' && define.amd) {\n    define([], function() { return aesjs; });\n\n    // Web Browsers\n  } else {\n\n    // If there was an existing library at \"aesjs\" make sure it's still available\n    if (root.aesjs) {\n      aesjs._aesjs = root.aesjs;\n    }\n\n    root.aesjs = aesjs;\n  }\n\n\n})(this);\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n// the startup function\n__webpack_require__.x = () => {\n\t// Load entry module and return exports\n\t// This entry module depends on other loaded chunks and execution need to be delayed\n\tvar __webpack_exports__ = __webpack_require__.O(undefined, [973,508,115], () => (__webpack_require__(79421)))\n\t__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n\treturn __webpack_exports__;\n};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + chunkId + \".\" + {\"115\":\"b1e9d00fb880ad222fab\",\"508\":\"0e2a432f09617cb8831c\",\"973\":\"8069d508cb08d6a3b5f3\"}[chunkId] + \".js\";\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.miniCssF = (chunkId) => {\n\t// return url for filenames based on template\n\treturn undefined;\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT')\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && (!scriptUrl || !/^http(s?):/.test(scriptUrl))) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/^blob:/, \"\").replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","// no baseURI\n\n// object to store loaded chunks\n// \"1\" means \"already loaded\"\nvar installedChunks = {\n\t941: 1\n};\n\n// importScripts chunk loading\nvar installChunk = (data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\tfor(var moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\twhile(chunkIds.length)\n\t\tinstalledChunks[chunkIds.pop()] = 1;\n\tparentChunkLoadingFunction(data);\n};\n__webpack_require__.f.i = (chunkId, promises) => {\n\t// \"1\" is the signal for \"already loaded\"\n\tif(!installedChunks[chunkId]) {\n\t\tif(true) { // all chunks have JS\n\t\t\timportScripts(__webpack_require__.p + __webpack_require__.u(chunkId));\n\t\t}\n\t}\n};\n\nvar chunkLoadingGlobal = self[\"webpackChunkmytonwallet\"] = self[\"webpackChunkmytonwallet\"] || [];\nvar parentChunkLoadingFunction = chunkLoadingGlobal.push.bind(chunkLoadingGlobal);\nchunkLoadingGlobal.push = installChunk;\n\n// no HMR\n\n// no HMR manifest","// run startup\nvar __webpack_exports__ = __webpack_require__.x();\n"],"names":["deferred","next","IS_EXTENSION_PAGE_SCRIPT","IS_EXTENSION","includes","self","location","protocol","dnsCategoryToBigInt","category","sha256BigInt","parseSmartContractAddressImpl","cell","prefix0","prefix1","slice","asSlice","byte0","loadUint","byte1","Error","n","loadUintBig","hashPart","toString","s","padStart","Address","parse","parseAddress","parseNextResolverRecord","parseStorageBagIdRecord","loadBuffer","async","dnsResolveImpl","client","dnsAddress","rawDomainBytes","oneStep","len","length","domainCell","Builder","storeBuffer","asCell","categoryBigInt","stack","callGetMethod","type","value","resultLen","readNumber","readCell","err","DnsCategory","DnsNextResolver","undefined","Wallet","parseSmartContractAddressRecord","Site","parseAdnlAddressRecord","parseSiteRecord","BagId","nextAddress","encodeDomain","domain","toLowerCase","i","charCodeAt","substring","c","String","fromCharCode","arr","split","forEach","part","reverse","join","dnsResolve","rootDnsAddress","rawDomain","Buffer","from","shouldShowAlert","APP_ENV","window","throttledAlert","throttle","message","alert","SECOND","handleErrorEvent","e","ErrorEvent","preventDefault","handleError","error","reason","logDebugError","endsWith","DEBUG_ALERT_MSG","addEventListener","TON_BIP39_PATH","ONE_TON","TOKEN_TRANSFER_AMOUNT","TINY_TOKEN_TRANSFER_AMOUNT","TOKEN_TRANSFER_REAL_AMOUNT","TINY_TOKEN_TRANSFER_REAL_AMOUNT","TINIEST_TOKEN_TRANSFER_REAL_AMOUNT","TOKEN_TRANSFER_FORWARD_AMOUNT","CLAIM_MINTLESS_AMOUNT","NFT_TRANSFER_AMOUNT","NFT_TRANSFER_REAL_AMOUNT","NFT_TRANSFER_FORWARD_AMOUNT","NFT_PAYLOAD_SAFE_MARGIN","TON_GAS","stakeNominators","unstakeNominators","stakeLiquid","unstakeLiquid","stakeJettonsForward","JettonStakingGas","STAKE_JETTONS","stakeJettons","unstakeJettons","UNSTAKE_JETTONS","claimJettons","JETTON_TRANSFER","SIMPLE_UPDATE_REQUEST","changeDns","stakeEthena","stakeEthenaForward","unstakeEthena","unstakeEthenaForward","unstakeEthenaLocked","unstakeEthenaLockedForward","STAKE_COMMENT","UNSTAKE_COMMENT","ATTEMPTS","DEFAULT_DECIMALS","DEFAULT_IS_BOUNCEABLE","FEE_FACTOR","ALL_WALLET_VERSIONS","OUR_FEE_PAYLOAD_BOC","Workchain","WORKCHAIN","BaseChain","TRANSFER_TIMEOUT_SEC","DEFAULT_MAX_MESSAGES","LEDGER_MAX_MESSAGES","W5_MAX_MESSAGES","OpCode","JettonOpCode","NftOpCode","LiquidStakingOpCode","JettonStakingOpCode","VestingV1OpCode","SingleNominatorOpCode","DnsOpCode","TeleitemOpCode","OtherOpCode","ContractType","EXCESS_OP_CODES","Excesses","Ok","DNS_CATEGORY_HASH_MAP","dns_next_resolver","wallet","site","storage","KnownContracts","simpleR1","name","hash","simpleR2","simpleR3","v2R1","v2R2","v3R1","v3R2","v4R1","v4R2","W5","highloadV2","nominatorPool","Staking","multisig","multisigV2","vesting","multisigNew","dedustPool","isSwapAllowed","dedustVaultNative","dedustVaultJetton","stonPtonWallet","stonRouter","stonRouterV2_1","stonPoolV2_1","stonRouterV2_2","stonRouterV2_2_alt","stonPoolV2_2","stonPtonWalletV2","Deferred","constructor","this","promise","Promise","resolve","reject","resolved","YEAR","withCache","langCode","dayStartAt","noYear","monthFormat","arguments","noDay","withTime","Date","toLocaleString","year","month","day","hour","minute","hourCycle","ApiLiquidUnstakeMode","cache","WeakMap","fn","fnCache","get","_len","args","Array","_key","cacheKey","map","cached","Map","set","newValue","process","IS_CORE_WALLET","APP_NAME","APP_VERSION","DEBUG","DEBUG_MORE","IS_CAPACITOR","env","IS_OPERA_EXTENSION","IS_AIR_APP","IS_TELEGRAM_APP","SWAP_FEE_ADDRESS","DIESEL_ADDRESS","IS_BIP39_MNEMONIC_ENABLED","PRIVATE_KEY_HEX_LENGTH","MAIN_ACCOUNT_ID","TONCENTER_MAINNET_URL","TONCENTER_MAINNET_KEY","ELECTRON_TONCENTER_MAINNET_KEY","TONAPIIO_MAINNET_URL","TONCENTER_TESTNET_URL","TONCENTER_TESTNET_KEY","ELECTRON_TONCENTER_TESTNET_KEY","TONAPIIO_TESTNET_URL","BRILLIANT_API_BASE_URL","PROXY_API_BASE_URL","IPFS_GATEWAY_BASE_URL","SSE_BRIDGE_URL","IS_STAKING_DISABLED","VALIDATION_PERIOD_MS","DEFAULT_FEE","UNSTAKE_TON_GRACE_PERIOD","STAKING_POOLS","LIQUID_POOL","LIQUID_JETTON","MIN_ACTIVE_STAKING_REWARDS","TONCONNECT_PROTOCOL_VERSION","NFT_FRAGMENT_COLLECTIONS","NFT_FRAGMENT_GIFT_IMAGE_TO_URL_REGEX","TELEGRAM_GIFTS_SUPER_COLLECTION","MTW_CARDS_COLLECTION","TONCOIN","symbol","slug","decimals","chain","cmcSlug","TRX","MYCOIN","minterAddress","CHAIN_CONFIG","ton","isMemoSupported","isDnsSupported","addressRegex","addressPrefixRegex","nativeToken","tron","mainnet","apiUrl","usdtAddress","testnet","TRC20_USDT_MAINNET_SLUG","TRC20_USDT_TESTNET_SLUG","TON_USDT_SLUG","MYCOIN_STAKING_POOL","ETHENA_STAKING_VAULT","SWAP_CROSSCHAIN_SLUGS","Set","STON_PTON_ADDRESS","DNS_IMAGE_GEN_URL","TRC20_USDT","TON_USDT","tokenAddress","TON_USDE","image","TON_TSUSDE","COMMON_TOKEN","isFromBackend","price","priceUsd","percentChange24h","TOKEN_INFO","toncoin","trx","INDEXED_DB_NAME","INDEXED_DB_STORE_NAME","WINDOW_PROVIDER_CHANNEL","DEFAULT_PRICE_CURRENCY","BURN_ADDRESS","DEFAULT_WALLET_VERSION","POPULAR_WALLET_VERSIONS","LEDGER_WALLET_VERSIONS","DEFAULT_TIMEOUT","DEFAULT_RETRIES","DEFAULT_ERROR_PAUSE","NFT_BATCH_SIZE","NOTCOIN_VOUCHERS_ADDRESS","NOTCOIN_FORWARD_TON_AMOUNT","NOTCOIN_EXCHANGERS","RE_LINK_TEMPLATE","RE_TG_BOT_MENTION","SWAP_API_VERSION","TONCENTER_ACTIONS_VERSION","ALL_TON_DNS_ZONES","suffixes","baseFormat","resolver","collectionName","isTelemint","isUnofficial","TON_DNS_ZONES","filter","_ref","pause","ms","setTimeout","shouldRunFirst","isRunning","scheduleFn","runFn","localArgs","_len2","_args","_key2","setCancellableTimeout","cb","timeoutId","clearTimeout","createTaskQueue","maxConcurrency","queue","concurrency","run","task","push","shift","runTasks","wrap","_len4","_key4","forbidConcurrency","action","ApiBaseError","displayError","super","ApiUserRejectsError","ApiServerError","statusCode","ApiCommonError","ServerError","handleServerError","MAX_TIMEOUT","fetchJsonWithProxy","url","data","init","fetchJson","encodeURIComponent","getProxiedJsonUrl","urlObject","URL","Object","entries","key","isArray","item","searchParams","append","fetchWithRetry","json","options","retries","timeouts","shouldSkipRetryFn","isNotTemporaryError","logDebug","timeout","Math","min","response","fetchWithTimeout","status","catch","controller","AbortController","id","abort","fetch","signal","handleFetchErrors","ignoreHttpCodes","ok","errors","_errors$","msg","getProxiedLottieUrl","fixIpfsUrl","replace","SAFE_EXEC_ENABLED","safeExec","rescue","always","shouldIgnoreError","exports","nodeCrypto","freeze","__proto__","_0n","BigInt","_1n","_2n","_8n","CU_O","CURVE","a","d","P","l","h","Gx","Gy","POW_2_256","SQRT_M1","SQRT_AD_MINUS_ONE","INVSQRT_A_MINUS_D","ONE_MINUS_D_SQ","D_MINUS_ONE_SQ","ExtendedPoint","x","y","z","t","fromAffine","p","Point","TypeError","equals","ZERO","mod","toAffineBatch","points","toInv","nums","tmp","inverted","invert","reduce","acc","num","reduceRight","invertBatch","toAffine","normalizeZ","other","assertExtPoint","X1","Y1","Z1","X2","Y2","Z2","X1Z2","X2Z1","Y1Z2","Y2Z1","negate","double","A","B","C","D","x1y1","E","G","F","H","X3","Y3","T3","Z3","add","T1","T2","subtract","precomputeWindow","W","windows","base","wNAF","affinePoint","BASE","_WINDOW_SIZE","precomputes","pointPrecomputes","f","windowSize","mask","maxNumber","shiftBy","offset","wbits","Number","offset1","offset2","abs","cond1","cond2","constTimeNegate","multiply","scalar","normalizeScalar","multiplyUnsafe","P0","isSmallOrder","isTorsionFree","invZ","is0","ax","ay","zz","fromRistrettoBytes","legacyRist","toRistrettoBytes","fromRistrettoHash","condition","neg","assertRstPoint","RistrettoPoint","ep","calcElligatorRistrettoMap","r0","r","Ns","isValid","Ns_D_is_sq","uvRatio","s_","edIsNegative","Nt","s2","W0","W1","W2","W3","hashToCurve","hex","r1","bytes255ToNumberLE","ensureBytes","R1","r2","R2","fromHex","emsg","b1","b2","equalBytes","numberTo32BytesLE","u1","u2","u1_2","u2_2","v","I","invertSqrt","Dx","Dy","toRawBytes","u2sq","invsqrt","D1","D2","zInv","_x","_y","toHex","bytesToHex","b","one","two","_setWindowSize","delete","strict","normed","bytesToNumberLE","y2","u","isXOdd","fromPrivateKey","privateKey","getExtendedPublicKey","point","bytes","toX25519","Signature","assertValidity","u8","Uint8Array","concatBytes","arrays","every","result","pad","hexes","uint8a","hexToBytes","array","j","hexByte","byte","parseInt","isNaN","numberTo32BytesBE","MAX_255B","res","number","modulo","m","pow2","power","pow_2_252_3","_5n","_10n","_20n","_40n","_80n","b4","b5","b10","b20","b40","b80","b160","b240","b250","pow_p_5_8","v3","v7","vx2","root1","root2","useRoot1","useRoot2","noRoot","modlLE","expectedLength","max","isSafeInteger","adjustBytes25519","checkPrivateKey","getKeyFromHash","hashed","head","prefix","pointBytes","_sha512Sync","sha512s","utils","sha512","getExtendedPublicKeySync","prepareVerification","sig","publicKey","SB","pub","finishVerification","k","kA","sync","getPublicKey","sign","R","verify","cswap","swap","x_2","x_3","dummy","curve25519","BASE_POINT_U","scalarMult","pu","pointU","a24","x_1","sw","z_2","z_3","k_t","AA","BB","DA","CB","dacb","da_cb","xp2","montgomeryLadder","uEnc","decodeUCoordinate","scalarMultBase","crypto","node","web","TORSION_SUBGROUP","hashToPrivateScalar","randomBytes","bytesLength","getRandomValues","buffer","randomPrivateKey","subtle","digest","createHash","update","precompute","sha512Sync","defineProperties","configurable","val","getSharedSecret","defineProperty","factory","MAX_LOG_LENGTH","logs","errorReplacer","_","metadata","AssertionError","addLog","log","arg","JSON","stringify","time","now","getLogs","level","console","ApiAuthError","ApiTransactionDraftError","ApiTransactionError","assert","JettonStakingOpCodes","GET_STATIC_DATA","REPORT_STATIC_DATA","GET_STORAGE_DATA","REPORT_STORAGE_DATA","EXCESSES","TRANSFER_JETTON","INTERNAL_TRANSFER","TRANSFER_NOTIFICATION","PROVIDE_WALLET_ADDRESS","TAKE_WALLET_ADDRESS","BURN_JETTON","ADD_REWARDS","SEND_CLAIMED_REWARDS","SEND_UNSTAKED_JETTONS","APPROVE_STAKE","CANCEL_STAKE","ADD_REWARD_JETTONS","CLAIM_COMMISSIONS","REQUEST_UPDATE_REWARDS","CLAIM_REWARDS","RECEIVE_JETTONS","UNSTAKE_REQUEST","CANCEL_UNSTAKE_REQUEST","UPDATE_REWARDS","CONFIRM_TRANSFER","DEPLOY_NEW_POOL","SEND_COMMISSIONS","SET_CODE","CHANGE_CREATION_FEE","CHANGE_CONTENT","UPDATE_CODES","MIN_RESERVE","DEPLOY_POOL","NOTIFICATION","BURN_JETTONS","CANCEL_UNSTAKE","APPROVE_TRANSFER","SAVE_UPDATED_REWARDS","MIN_EXCESS","SEND_STAKED_JETTONS","Dividers","COMMISSION_DIVIDER","REWARDS_DIVIDER","DISTRIBUTION_SPEED_DIVIDER","DISTRIBUTED_REWARDS_DIVIDER","MAX_DP","NAME","INVALID","INVALID_DP","INVALID_RM","DIV_BY_ZERO","UNDEFINED","NUMERIC","round","sd","rm","more","xc","RM","unshift","pop","doExponential","isNonzero","charAt","cmp","isneg","yc","div","Big","dp","DP","bl","bt","ri","bz","ai","al","rl","q","qc","qi","eq","gt","gte","lt","lte","minus","sub","xlty","plus","xe","ye","ygtx","times","pow","prec","sqrt","half","toExponential","indexOf","mul","toFixed","Symbol","for","toJSON","NE","PE","toNumber","toPrecision","valueOf","_Big_","nl","test","search","prototype","roundDown","roundHalfUp","roundHalfEven","roundUp","ten","fromDecimal","toDecimal","noFloor","toBig","size","BIGINT_PREFIX","bigintReviver","startsWith","bigintAbs","bigintDivideToNumber","bigintMultiplyToNumber","UNDEFINED_PREFIX","extensionMessageReplacer","extensionMessageReviver","callbackState","parseAccountId","accountId","parts","network","isMnemonicPrivateKey","mnemonic","address","fromRight","FILLER","pathRegex","replaceDerive","derivePath","path","seed","some","isValidPath","chainCode","createHmac","getMasterKeyFromSeed","el","parentKeys","segment","CKDPriv","index","indexBuffer","allocUnsafe","writeUInt32BE","concat","alloc","buildCollectionByKey","collection","byKey","member","pick","object","keys","omit","stringKeys","has","omitUndefined","stringKey","compact","Boolean","chunkSize","range","start","end","fromKeyValueArrays","values","extractKey","findDifference","array1","array2","set2","diff","element","getDnsDomainZone","zone","suffix","sha256","bytesToBase64","base64ToBytes","base64","environment","setEnvironment","_self","isDappSupported","isSseSupported","isElectron","isNativeBottomSheet","apiHeaders","origin","toncenterMainnetKey","toncenterTestnetKey","getEnvironment","generateQueryId","randomNumber","randomBigInt","bigintRandom","TON_MAX_COMMENT_BYTES","clientByNetwork","walletClassMap","WalletContractV1R1","WalletContractV1R2","WalletContractV1R3","WalletContractV2R1","WalletContractV2R2","WalletContractV3R1","WalletContractV3R2","WalletContractV4","WalletContractV5R1","getTonClient","TonClient","endpoint","apiKey","headers","resolveTokenWalletAddress","withCacheAsync","minter","open","JettonMinter","toBase64Address","getWalletAddress","resolveTokenAddress","tokenWalletAddress","tokenWallet","JettonWallet","getWalletData","getWalletPublicKey","runMethodWithError","exit_code","readBigNumber","getJettonPoolStakeWallet","poolAddress","period","tonClient","pool","StakingPool","createFromAddress","walletAddress","StakeWallet","oneCellFromBoc","Cell","fromBoc","isBounceable","urlSafe","bounceable","testOnly","toRawAddress","toRawString","buildTokenTransferBody","params","queryId","tokenAmount","toAddress","responseAddress","forwardAmount","customPayload","forwardPayload","builder","storeUint","Transfer","storeCoins","storeAddress","storeMaybeRef","packBytesAsSnake","availableBits","storeBit","storeRef","endCell","commentToBytes","comment","startBuffer","Comment","maxBytes","packBytesAsSnakeCell","bytesPerCell","headCell","ceil","cellOffset","cellLength","cellBuffer","byteOffset","nextHeadCell","EMPTY","packBytesAsSnakeForEncryptedData","subarray","buildLiquidStakingDepositBody","Deposit","isRaw","parseRaw","isFriendly","parseFriendly","isUserFriendly","getIsRawAddress","buildJettonUnstakePayload","jettonsToUnstake","forceUnstake","beginCell","buildJettonClaimPayload","poolWallets","rewardsToClaim","Dictionary","empty","Keys","Values","Bool","poolWallet","storeDict","unpackDicts","obj","isSimpleObject","callback","newByKey","getPrototypeOf","connector","StorageType","generateUniqueId","random","ConnectorClass","requestStates","requestStatesByCallback","target","onUpdate","channel","shouldUseJson","targetOrigin","destroy","postMessage","request","messageData","messageId","payload","requestState","assign","withCallback","finally","cancelCallback","progressCallback","isCanceled","onMessage","decodeExtensionMessage","_requestState$callbac","call","callbackArgs","_data$error","_data$error2","rawData","encodeExtensionMessage","callWindow","methodName","getItem","force","isAndroidApp","setItem","removeItem","clear","getKeys","chrome","local","_await$storage$get","remove","bind","getAll","setMany","getMany","store","idb","items","withPromise","localStorage","extensionStorage","capacitorStorage","MIN_ACCOUNT_NUMBER","IndexedDb","LocalStorage","ExtensionLocal","CapacitorStorage","loginResolve","loginPromise","fetchStoredAddress","fetchStoredAccount","fetchStoredTonWallet","fetchStoredTonAccount","fetchStoredTronWallet","account","fetchStoredTronAccount","fetchMaybeStoredAccount","getAccountValue","fetchStoredAccounts","updateStoredAccount","partial","setAccountValue","_await$storage$getIte","removeAccountValue","removedValue","restData","removeNetworkAccountsValue","getCurrentNetwork","getCurrentAccountId","getAddressesFromAccount","addressByChain","PBKDF2_IMPORT_KEY_ARGS","PBKDF2_DERIVE_KEY_ARGS","iterations","PBKDF2_DERIVE_KEY_TYPE","validateBip39Mnemonic","bip39","encryptMnemonic","password","plaintext","salt","keyMaterial","importKey","TextEncoder","encode","deriveKey","iv","ptUint8","ctBuffer","encrypt","ctArray","ctBase64","btoa","ivHex","decryptMnemonic","encrypted","pwUtf8","pwHash","match","alg","ctStr","atob","ctUint8","ch","plainBuffer","decrypt","TextDecoder","decode","decryptMnemonicLegacy","saltHex","encryptedData","getMnemonic","sensitiveData","mnemonicEncrypted","decryptedMnemonic","DebugError","removeSensitiveDataFromError","tryMigratingMnemonicEncryption","removeFromString","text","toRemove","replaceAll","_error$stack","RE_SYMBOL_WITH_COMBINING_MARKS","RE_LINEBREAK_COMBINING_MARKS","RE_SPACE_CHARS","RE_FAKE_DOTS","RE_EMPTY_CHARS","checkLNPRegex","characters","alphabetMap","confusablesMap","alts","char","cleanText","str","checkLNP","newStr","clean","BAD_REQUEST_CODE","callBackendPost","authToken","isAllowBadRequest","method","shouldRetry","getBackendHeaders","body","callBackendGet","addBackendHeadersToSocketUrl","exec","knownAddresses","scamMarkers","trustedSites","trustedCollections","tonNftSuperCollectionsByCollectionAddress","nftSuperCollectionsDeferred","tryUpdateKnownAddresses","RegExp","tonNftSuperCollections","superCollection","collections","rest","getKnownAddresses","getNftSuperCollectionsByCollectionAddress","getKnownAddressInfo","checkIsTrustedCollection","checkHasScamLink","matches","matchAll","_match$groups","host","groups","compareActivities","isAsc","getIsActivityPending","timestamp","parseTxId","txId","subId","buildLocalTxId","buildTxId","getActivityTokenSlugs","activity","kind","nft","to","toMilliseconds","seconds","toSeconds","floor","isEmptyObject","keyCount","hasOwnProperty","isKeyCountGreater","IGNORED_DEXIE_ERRORS","tryDbQuery","ApiDb","Dexie","version","stores","nfts","sseConnections","tokens","upgrade","tx","table","apiDb","tokenRepository","all","toArray","find","where","put","bulkPut","deleteWhere","tokensPreload","tokensCache","baseCurrency","bySlug","updateTokens","tokenDetails","shouldSendUpdate","tokensForDb","detailsBySlug","details","cachedToken","token","mergedToken","mergeTokenWithCache","sendUpdateTokens","getTokensCache","getTokenBySlug","getTokenByAddress","buildTokenSlug","ADDRESS_BOOK_CHUNK_SIZE","VERSION_MAP","fixAddressFormat","callToncenterV3","address_book","getWalletInfos","addresses","wallets","states","addressBook","walletInfoByRawAddress","fromEntries","state","buildWalletInfo","inputAddress","rawAddress","balance","isInitialized","seqno","user_friendly","wallet_type","lastTxId","last_transaction_hash","getToncenterHeaders","MAX_LIMIT","EVENTS_LIMIT","apiByNetwork","getApi","Api","HttpClient","baseUrl","baseApiParams","customFetch","fetchJettonBalances","accounts","getAccountJettonsBalances","supported_extensions","balances","fetchNftItems","getNftItemsByAddresses","account_ids","nft_items","OFFCHAIN_CONTENT_PREFIX","dictSnakeBufferValue","sliceToVal","isFirst","remainingBits","remainingRefs","loadRef","beginParse","serialize","jettonOnChainMetadataSpec","uri","description","custom_payload_api_uri","fetchJettonOffchainMetadata","parsePayloadBase64","Slice","BitReader","BitString","dataToSlice","shouldLoadItems","transactionDebug","opCode","readSnakeBytes","Encrypted","encryptedComment","_forwardPayload","amount","loadCoins","destination","loadAddress","responseDestination","loadMaybeAddress","loadMaybeRef","forwardPayloadOpCode","storeBits","loadBits","forwardPayloadSlice","toBoc","TransferOwnership","_nft","newOwner","readForwardPayloadCell","readComment","nftSuperCollectionsByCollectionAddress","rawNft","parseTonapiioNft","nftAddress","nftName","OwnershipAssigned","prevOwner","Burn","addressObj","isLiquidUnstakeRequest","DistributedAsset","Withdrawal","appId","AddWhitelist","Withdraw","ChangeValidator","Vote","votingAddress","expirationDate","vote","loadBit","needConfirmation","ChangeRecord","_Object$entries$find","contract","DnsItem","collectionAddress","getNftData","getTelemintDomain","getDomain","getDnsItemDomain","dataSlice","endParse","dataAddress","flags","record","Unknown","TokenBridgePaySwap","swapId","UnstakeRequest","isForce","loadBoolean","_opCode","debugTxString","opCodeHex","parsePayloadSlice","buildMtwCardsNftMetadata","attributes","mtwCardType","mtwCardTextType","_attributes$find","_attributes$find2","_attributes$find3","imageUrl","mtwCardId","attribute","trait_type","trim","mtwCardBorderShineType","rawMetadata","previews","sale","trust","owner","render_type","renderType","lottie","hasScamLink","isWhitelisted","isScam","isHidden","imageFromPreview","resolution","isFragmentGift","getIsFragmentGift","fragmentUrl","ownerAddress","thumbnail","isOnSale","isOnFragment","isTelegramGift","_nftSuperCollectionsB","areDeepEqual","value1","value2","type1","isArray1","member1","object1","object2","keys1","keys2","key1","key2","getDappConnectionUniqueId","_sseOptions","_sse","sseOptions","appClientId","sse","migrationEnsurePromise","currentOnUpdate","updateActivityMetadata","normalizedAddress","isIncoming","isNftTransfer","hasScamMarkers","sm","hasScamInComment","isUpdaterAlive","buildOldAccountId","iosBackupAndMigrateKeychainMode","backupKey","backupValue","shouldRewrite","RAW_LIQUID_POOL_ADDRESS","TME_RENEW_HASH_SUFFIX","RAW_NFT_COLLECTIONS_TO_RELOAD_METADATA","fetchActions","limit","toTimestamp","fromTimestamp","shouldIncludeFrom","shouldIncludeTo","includeTypes","excludeTypes","action_id","actionId","start_utime","end_utime","sort","action_type","exclude_action_type","actions","rawActions","parseActions","isPending","activities","parseAction","parseTonTransfer","parseCallContract","parseContractDeploy","parseNftTransfer","parseNftMint","parseJettonTransfer","parseJettonMint","parseJettonBurn","parseStakeDeposit","parseStakeWithdrawal","parseStakeWithdrawalRequest","parseJettonSwap","parseDns","parseAuctionBid","parseLiquidityDeposit","source","dex","partialExtended","parseCommonFields","shouldLoadDetails","extra","convertDexId","additionalId","buildActionActivityId","amount_1","getAssetSlug","asset_1","amount_2","asset_2","parseLiquidityWithdraw","_activity$nft","shouldHide","isEncrypted","common","opcode","OurFee","Bounced","ClaimRewards","fee","is_encrypted_comment","forward_payload","sender","receiver","fromAddress","asset","receiver_jetton_wallet","jettonWalletRaw","commonFields","end_lt","trace_end_lt","owner_jetton_wallet","jettonWallet","nft_item_index","nft_item","rawNftAddress","nft_collection","rawCollectionAddress","new_owner","old_owner","oldOwner","is_purchase","isPurchase","response_destination","marketplace","isMetadataMissing","parseToncenterNft","_metadata$rawCollecti","_collectionMetadata$n","collectionMetadata","token_info","isHiddenCollection","_addressBook$oldOwner","_addressBook$newOwner","oldOwnerAddress","newOwnerAddress","payloadBase64","fromBase64","isExotic","shouldReload","_addressBook$newOwner2","isBuying","stake_holder","holder","provider","payout_nft","_parseToncenterJetton","_parseToncenterJetton2","endUtime","success","isSuccess","dex_incoming_transfer","fromAmount","fromAsset","dex_outgoing_transfer","toAmount","toAsset","decimalsFrom","parseToncenterJetton","decimalsTo","fromTokenAddress","toTokenAddress","networkFee","swapFee","ourFee","hashes","externalMsgHashNorm","trace_external_hash_norm","trace_external_hash","sum_type","sumType","bidder","auction","destination_liquidity","destinationAddress","rawFromAddress","rawToAddress","amountString","metadataMap","nftMetadata","extractMetadata","domainZone","domainBase","_image_medium","isMtwCard","fixedImage","jettonMetadata","_data$token_info","is_indexed","tokenInfo","start_lt","trace_id","parseActionActivityId","traceId","startLt","toncenterDex","createCallbackManager","callbacks","removeCallback","runCallbacks","addCallback","hasCallbacks","focusListeners","isFocused","onFocusAwareDelay","forceMs","cleanup","callCb","unsubscribeFocus","cancelSecondTimeout","focusAwareDelay","msWhenNotFocused","setIsAppFocused","_isFocused","SEC","MINUTE","DAYS_IN_YEAR","FIRST_TRANSACTIONS_LIMIT","FAKE_TX_ID","activeWalletTiming","updateOnStart","minUpdateDelay","focused","notFocused","fallbackUpdateStartDelay","fallbackUpdatePeriod","forceUpdatePeriod","inactiveWalletTiming","pollingLoop","cancelPause","minDelay","skipInitialPoll","prepare","poll","isStopped","dependenciesDeferred","iteration","_cancelPause","dependencies","scheduleIteration","periodToMs","_cancelPause2","then","stop","_cancelPause3","withDoubleCheck","pauses","cancelDoubleCheck","makeAttempt","attemptNumber","_cancelDoubleCheck","_cancelDoubleCheck2","cancel","_cancelDoubleCheck3","FallbackPollingScheduler","isSocketConnected","pollOnStart","onSocketConnect","onSocketDisconnect","onSocketMessage","_this$cancelScheduled","minPollDelay","_this$cancelScheduled2","pollingStartDelay","pollingPeriod","handleTimeout","_this$cancelScheduled3","schedule","forcedPollingPeriod","ReconnectingWebSocket","send","isConnected","reconnect","close","onConnect","onDisconnect","WebSocket","binaryType","onerror","onopen","onclose","onmessage","_this$cancelTimeout","#handleSocketOpen","_this$cancelTimeout2","event","code","wasClean","reconnectDelay","ArrayBuffer","PING_INTERVAL","PONG_TIMEOUT","toncenterSockets","ToncenterSocket","watchWallets","onNewActivities","watcher","watcherId","findIndex","splice","_this$socket","pathname","getSocketUrl","socket","_this$cancelReconnect","#handleSocketConnect","_this$socket2","operation","include_address_book","include_metadata","supported_action_types","#handleSocketDisconnect","_this$stopPing","arePending","messageHashNormalized","activitiesByAddress","addressWhitelist","actionsByAddress","byAddress","_addressBook$rawAddre","groupActionsByAddress","parseSocketActions","addressesToNotify","isWatcherReadyForNewActivities","requestId","oldAddresses","newAddresses","deletedAddresses","addedAddresses","types","isOnlyReadyForNewActivities","watchedAddresses","_this$stopPing2","pingIntervalId","setInterval","_this$socket3","_this$cancelReconnect2","_this$socket4","clearInterval","newActionAddresses","areNewActionsPending","prevSavedAddresses","nextSavedAddresses","isActivityUpdateFinal","throttleToncenterSocketActions","delayMs","onUpdates","updatesByHash","scheduleReport","cancelReport","toReport","_updatesByHash$hash","_updatesByHash$hash$c","MIN_POLL_DELAY","POLLING_START_DELAY","POLLING_PERIOD","FORCED_POLLING_PERIOD","ActivityStream","pendingActivities","finishedHashes","rememberFinishedHashes","messageHashNorms","releaseFinishedHashesMemory","confirmedActivities","allPendingActivities","pendingUpdates","currentPendingActivities","socketUpdates","hashesToRemove","flatMap","mergePendingActivities","managePendingActivities","newestConfirmedActivityTimestamp","getToncenterSocket","onLoadingChange","updates","instantConfirmedActivities","stashedConfirmedActivities","newConfirmedActivities","loadPendingActivities","polledActivities","socketActivities","_polledActivities$","newestPolledActivityTimestamp","mergedActivities","margeConfirmedActivitiesOnSocketConnect","fetchPendingActions","fetchTransactions","transactions","rawTransactions","rawTx","parseRawTransaction","flat","total_fees","totalFees","compute_ph","exitCode","in_msg","out_msgs","inMsgHashNorm","hash_norm","msgs","oneMsgFee","fwd_fee","fwdFee","msgHash","bounced","resolveAddress","skipFormatSelection","resolvedAddress","zoneMatch","_err$message","resolveAddressByDomain","chunks","chunk","fetchAddressBook","normalizeAddress","known","isAddressInitialized","walletOrAddress","getWalletInfo","isActiveSmartContract","publicKeyToAddress","walletVersion","buildWallet","WalletClass","create","workchain","getContractInfo","getAddressInfo","codeHashOld","contractInfo","info","codeHash","isWallet","getAccountBalance","getWalletBalance","getWalletSeqno","pickBestWallet","allWallets","getWalletVersionInfos","defaultWallet","withBiggestBalance","best","current","withLastTx","predicate","cursor","findLast","_ref2","v4Wallet","_ref3","walletInfos","getWalletVersions","getWalletStateInit","storedWallet","getTonWallet","storeWritable","storeStateInit","pickWalletByAddress","w","tonWallet","generateMnemonic","tonWebMnemonic","validateMnemonic","privateKeyHexToKeyPair","privateKeyHex","nacl","keyPair","fromSeed","fetchPrivateKey","secretKey","fetchKeyPair","bip39MnemonicToKeyPair","rawSign","dataHex","detached","getWalletFromBip39Mnemonic","getWalletFromKeys","getWalletFromMnemonic","getWalletFromPrivateKey","hexSeed","HDKey","getOtherVersionWallet","otherVersion","getWalletFromAddress","addressOrDomain","DomainNotResolved","InvalidAddress","walletInfo","title","getChainConfig","chainByNativeSlug","getDieselTokenAmount","diesel","getAesCbcState","aesjs","cbc","combineSecrets","hmacAlgo","hmacKey","signature","hmacSha512","encryptMessageComment","myPublicKey","theirPublicKey","myPrivateKey","senderAddress","commentBytes","encryptedBytes","sharedSecret","dataLength","prefixLength","minPadding","getRandomPrefix","combined","msgKey","encryptDataWithPrefix","encryptDataImpl","prefixedEncrypted","encryptData","decryptMessageComment","decryptedBytes","cbcStateSecret","decryptedData","gotMsgKey","doDecrypt","decryptDataImpl","decryptData","DIESEL_URL","sendExternal","gaslessType","neededInit","isContractDeployed","ext","external","storeMessage","isW5Gasless","msgHashNormalized","dest","getExternalMsgHashNormalized","bodyMessageHash","boc","paymentLink","isAddition","dieselW5SendRequest","dieselSendBoc","sendFile","byId","waitAndCreatePendingTransfer","prevPending","pendingTransfer","getPendingTransfer","fetchAndParseTrace","isActionPending","trace","include_actions","traces","fetchTrace","parseTrace","traceDetail","byTransactionIndex","children","traceDetails","txHash","tx_hash","sent","received","parseFailedTransactions","byHash","groupKey","isWalletTransactionFound","processTrace","_traceDetail","_index","txs","_ref4","child","_ref5","in_msg_hash","parseCompletedTransactions","totalSent","total","totalReceived","totalNetworkFee","GET_TRANSACTIONS_LIMIT","TRACE_ATTEMPT_COUNT","TRACE_RETRY_DELAY","checkHasTransaction","fetchActivitySlice","tokenSlug","fetchActivityDetails","attempt","parsedTrace","calculateActivityDetails","actionHashes","tracePart","elem","intersection","sentForFee","excess","asset_in","asset_out","realFee","ourFeeAction","_action","tokenIn","setSwapDetails","activitiesPerAction","setTransactionDetails","activityStatus","getActivityRealFee","emulateTransaction","transaction","externalMessage","buildExternalBoc","emulation","ignore_chksig","include_code_data","with_actions","fetchEmulateTrace","allActivities","walletActivities","totalRealFee","totalExcess","excessActivity","addExcessActivity","parseEmulation","insertMintlessPayload","transfer","customPayloadApiUrl","parsedPayload","mintlessTokenBalance","isMintlessClaimed","stateInit","getMintlessParams","newPayload","isBase64Payload","buildTokenTransfer","shouldSkipMintless","isTokenWalletDeployed","toncoinAmount","realAmount","getToncoinAmountForTransfer","getTokenBalanceWithMintless","accountAddress","calculateTokenBalanceWithMintless","getJettonBalance","getTokenBalance","runMethod","readBoolean","checkMintlessTokenWalletIsClaimed","fetchMintlessTokenWalletData","isExpired","compressed_info","expired_at","getTime","custom_payload","state_init","fetchToken","buildTokenByMetadata","content","getJettonData","getJettonMinterData","contentUri","dict","loadDict","_dict$get","sha256Key","parseJettonOnchainMetadata","fetchJettonMetadata","image_data","imageData","willClaimMintless","isTiny","loadTokenBalances","tokenBalances","balanceRaw","jetton","wallet_address","parseTokenBalance","getTokenBalances","tokenSlugs","cachedTokens","tokensToFetch","option","toUpperCase","tokensByAddress","addressByRaw","getAccountStates","code_hash","updateTokenHashes","WAIT_TRANSFER_TIMEOUT","WAIT_PAUSE","MAX_BALANCE_WITH_CHECK_DIESEL","PENDING_DIESEL_TIMEOUT_SEC","DIESEL_NOT_AVAILABLE","nativeAmount","remainingFee","checkTransactionDraft","shouldEncrypt","isBase64Data","stateInitString","allowGasless","checkToAddress","InvalidStateInit","isToAddressNew","InactiveContract","InvalidAmount","WalletNotInitialized","isWalletInitialized","toncoinBalance","tokenTransfer","realToncoinAmount","isFullTonTransfer","signTransaction","isFullBalance","applyFeeFactorToEmulationResult","emulateTransactionWithFallback","isEnoughBalance","canTransferGasfully","getDiesel","tokenBalance","InsufficientBalance","InvalidToAddress","addressName","isMemoRequired","isTestOnly","isUrlSafe","InvalidAddressFormat","submitTransfer","noFeeCheck","stringToPayload","retrySendBoc","resolveTransactionError","submitTransferWithDiesel","dieselAmount","isGaslessWithStars","messages","submitMultiTransfer","isGasless","withW5Gasless","parseBase64","toPublicKey","IncorrectDeviceTime","UnsuccesfulTransfer","expireAt","loadStateInit","sendMode","SendMode","CARRY_ALL_REMAINING_BALANCE","PAY_GAS_SEPARATELY","IGNORE_ERRORS","transferParams","internal","bounce","createTransfer","getAccountNewestActionId","fetchNewestActionId","checkMultiTransactionDraft","withDiesel","totalAmount","isMainnet","hasInsufficientTokenBalance","parsedPayloads","payloadParsingResults","tokenResult","payloadAsString","getPayloadFromTransfer","tokenAmountsByAddress","hasUnknownToken","tokenAddresses","requiredAmount","isTokenBalanceInsufficient","signMultiTransaction","hasInsufficientTonBalance","clearedMessages","hasPayload","preparedMessages","authType","waitUntil","isFallback","source_fees","fees","estimateExternalMessageFee","initCode","initData","ignoreSignature","in_fwd_fee","storage_fee","gas_fee","sendSignedMessage","pendingTransferId","sendSignedMessages","attempts","firstBoc","msgHashesNormalized","_pendingTransfer","successNumber","decryptComment","fetchEstimateDiesel","_ref6","storedTonWallet","isGaslessEnabled","isStarsEnabled","isStars","getDieselToncoinFee","toncoinNeeded","rawDiesel","isW5","estimateDiesel","canPayDiesel","isAwaitingNotExpiredPrevious","pendingCreatedAt","estimation","_ref7","getAccountNfts","rawNfts","getAccountNftItems","indirect_ownership","fetchAccountNfts","checkNftOwnership","getNftItemByAddress","fetchNftByAddress","getNftUpdates","fromSec","_events$","events","getAccountEvents","start_date","fetchAccountEvents","NftPurchase","NftItemTransfer","recipient","buyer","checkNftTransferDraft","buildNftTransferMessage","checkResult","batchFee","calculateNftTransferFee","submitNftTransfers","buildNftTransferPayload","nftIndex","first4Bits","readUint8","buildNotcoinVoucherExchange","totalNftCount","estimatedBatchSize","estimatedBatchBlockchainFee","amountPerNft","remainingBatchSize","isTokenTransferPayload","getMaxMessagesInTransaction","checkDnsRenewalDraft","nftAddresses","maxMessages","transactionCount","makeRenewMessage","submitDnsRenewal","nftBatches","nftBatch","checkDnsChangeWalletDraft","makeChangeMessage","submitDnsChangeWallet","buildFillUpMessage","linkedAddress","buildChangeDnsWalletMessage","devSettings","NominatorPool","createFromConfig","config","contractAddress","getListNominators","readTuple","tupleItems","tuple","TupleReader","pendingDepositAmount","withdrawRequested","stakingCommonCache","stakingCommonCacheDeferred","accountCache","backendConfig","configDeferred","getAccountCache","updateAccountCache","getStakingCommonCache","getBackendConfigCache","clientId","getClientId","referrer","checkStakeDraft","stakePayload","checkUnstakeDraft","commonData","liquid","currentRate","buildLiquidStakingWithdraw","stakeWalletAddress","ethena","rate","submitStake","stakedAt","submitUnstake","mode","instantAvailable","Default","BestRate","localActivityParams","waitTillRoundEnd","fillOrKill","buildLiquidStakingWithdrawCustomPayload","buildLiquidStakingWithdrawBody","Instant","getStakingStates","backendState","loyaltyType","shouldUseNominators","backendType","promises","poolConfig","jettonPools","buildJettonState","_currentNominator","_currentNominator2","apy","nominatorsPool","isPrevRoundUnlocked","prevRound","unlock","currentNominator","nominators","addressObject","annualYield","yieldType","unstakeRequestAmount","buildNominatorsState","isDisabled","apyVerified","isVerified","tsUsdeWalletAddress","tsUsdeWallet","TsUSDeWallet","lockedUsdeBalance","unlockTime","getTimeLockData","annualYieldStandard","annualYieldVerified","unclaimedRewards","getIsActiveStakingState","buildEthenaState","buildLiquidState","_backendState$liquid","liquidAvailable","simulateLongUnstaking","available","currentRound","gracePeriod","getLiquidStakingTimeRange","liquidApy","loyaltyApy","tvl","rewardJettons","rewardsDeposits","dailyReward","startTime","endTime","distributionSpeed","apr","calcJettonStakingApr","periodConfig","periods","stakedTokenSlug","stakeWallet","walletData","getStorageData","poolWalletAddress","rewards","getAvailableRewards","jettonBalance","getBackendStakingState","isViewOnly","stakingState","isViewMode","totalProfit","poolPart","isKnownStakingPool","fetchBackendStakingState","submitTokenStakingClaim","submitUnstakeEthenaLocked","transferTimelockedMessage","jettonAmount","forwardTonAmount","packPayloadToBoc","storeStringTail","checkApiAvailability","getMasterchainInfo","FEE_ADDRESSES","MAX_NETWORK_FEE","validateDexSwapTransfers","transfers","originalAssert","mainTransfer","feeTransfer","maxAmount","dieselFee","maxTonAmount","feePayload","tokenFeeAmount","feeDestination","swapItemToActivity","backendId","getSwapItemSlug","cex","_getTokenByAddress","patchSwapItem","swapVersion","RELOAD_ACTIVITIES_ATTEMPTS","RELOAD_ACTIVITIES_PAUSE","FETCH_ACTIONS_BATCH_SIZE","enrichActivities","isToNow","actionIdsToReload","tryReloadIncompleteActivities","reloadIncompleteActivities","canHaveCexSwap","firstTimestamp","lastTimestamp","fromTime","toTime","swaps","swapGetHistory","isCex","allSwapHashes","swapReplaceCexActivities","actionIdBatches","reloadedActivities","actionIds","replaceById","reloadedActionIds","BackendSocket","onNewActivity","isWebSocketEnabled","messageAddresses","backendSockets","WalletPolling","#handleSocketNewActivity","#triggerBackupNotifications","isConfident","txCallbacks","OrGate","onSwitch","isOn","on","toggle","off","isItemOn","prevIsOn","nextIsOn","RichActivityStream","zombiePendingActivities","updateAfterRawUpdate","newPendingActivities","confirmedHashes","updateAfterEnrichment","rawConfirmedActivities","isLoading","lastPendingActivities","deduplicateActivityUpdates","rawActivityStream","unsubscribe","#handleRawActivitiesUpdate","richConfirmedActivities","POLL_DELAY_AFTER_SOCKET","POLL_MIN_INTERVAL","BALANCE_INTERVAL","INITIALIZATION_INTERVAL","STAKING_INTERVAL","VERSIONS_INTERVAL","VESTING_INTERVAL","TON_DNS_INTERVAL","NFT_FULL_INTERVAL","DOUBLE_CHECK_NFT_PAUSE","inactiveUpdateConcurrencyLimiter","setupActivePolling","onUpdatingStatusChange","newestActivityTimestamps","balanceAndDomainPolling","balanceUpdater","makeBalanceAndDomainUpdater","getBalances","setupBalanceAndDomainPolling","stopActivityPolling","newestConfirmedActivityTimestamps","onRawActivity","richActivityStream","newestTimestamps","onRawActivities","onRichActivities","doesNeedInitial","_mainActivities$","mainActivities","newestActivityTimestamp","loadInitialConfirmedActivities","loadInitialActivities","_richActivityStream","_rawActivityStream","setupActivityPolling","nftPolling","walletInitializationPolling","nftFromSec","updatePartial","nftResult","logAndRescue","nftUpdates","fullPolling","setupNftPolling","walletUpdate","updatedWallet","updateStoredTonWallet","setupWalletInitializationPolling","stopWalletVersionPolling","lastResult","accountType","currentVersion","versions","publicKeyBytes","versionInfos","filteredVersions","setupWalletVersionsPolling","stopTonDnsPolling","expirationByAddress","linkedAddressByAddress","lastFillUpTime","fetchDomains","setupTonDnsPolling","stopStakingPolling","lastStates","setupStakingPolling","stopVestingPolling","lastVestingInfo","isVestingEnabled","isEnabled","vestingInfo","isTestnet","fetchVestings","setupVestingPolling","lastDomain","balancesDeferred","getTonBalanceAndCheckDomain","tonBalance","newBalances","hasChanged","setupInactivePolling","walletPolling","parametersByNetwork","chainConfig","getTronClient","TronWeb","fullHost","getChainParameters","chainParameters","energyUnitFee","param","bandwidthUnitFee","getTokenSlugs","usdtSlug","getTokenTransactionSlice","queryParams","getTrxTransactions","min_timestamp","max_timestamp","search_internal","raw_data","txID","energy_fee","energyFee","net_fee","netFee","block_timestamp","parameters","parameter","owner_address","to_address","receiver_address","contract_address","parseRawTrxTransaction","getTrc20Transactions","transaction_id","parseRawTrc20Transaction","getAllTransactionSlice","mainChunk","prevChunk","trxChunk","tokenChunks","mergeActivities","trxTxs","uniqueTxIds","trxTxById","tokenTxs","tokenTxList","tokenTx","trxTx","tronWeb","getUnconfirmedBalance","getTrc20Balance","functions","issuerAddress","transactionBuilder","triggerSmartContract","_isConstant","constant_result","callContract","balancePolling","setupBalancePolling","activityPolling","slugs","_activities$","_activities$2","loadNewActivities","isFirstUpdate","trxBalance","usdtBalance","TRON_GAS","transferTrc20Estimated","ONE_TRX","SIGNATURE_SIZE","isAddress","bandwidth","getBandwidth","energy_required","energyRequired","estimateEnergy","estimateTrc20TransferFee","sendTrx","getAccount","raw_data_hex","byteLength","fromMnemonic","feeLimit","buildTrc20Transfer","signedTx","sendRawTransaction","sendTransaction","hexToString","hooks","callHook","hook","getBaseCurrency","setBaseCurrency","currency","resolvePromise","preloadPromise","resolveDataPreloadPromise","waitDataPreload","chains","getAmountForTokenTransfer","initTransactions","_onUpdate","fetchPastActivities","getChainBySlug","fetchTokenActivitySlice","tonActivities","tronActivities","mergeActivitiesToMaxTime","fetchAllActivitySlice","shouldCreateLocalActivity","localActivity","createLocalTransactions","isExternal","waitAndCreateTonPendingTransfer","sendSignedTransferMessage","cancelPendingTransfer","_getPendingTransfer","localTransactions","subParams","restParams","buildLocalTransaction","fetchTonActivityDetails","createLocalActivitiesFromEmulation","emulationActivities","localActivities","localActivityIndex","localTxId","convertEmulationActivityToLocal","initStaking","getStakingHistory","tryUpdateStakingCommonData","poolContract","setStakingCommonCache","submitStakingClaimOrUnlock","SIGN_MESSAGE","getBackendAuthToken","accountWallet","fetchAccountConfigForDebugPurposesOnly","stateVersion","mnemonicsEncrypted","ping","updateAccountMemoryCache","getMoonpayOnrampUrl","theme","initSwap","swapBuildTransfer","swapBuild","transferList","shouldTryDiesel","errorToString","swapSubmit","historyItem","activityId","fetchSwaps","ids","results","allSettled","swapGetHistoryItem","nonExistentIds","swapEstimate","isMsgHashMode","swapGetAssets","swapGetPairs","symbolOrTokenAddress","swapCexEstimate","swapCexValidateAddress","swapCexCreateTransaction","swapCexSubmit","transferOptions","BACKEND_INTERVAL","LONG_BACKEND_INTERVAL","INCORRECT_TIME_DIFF","ACCOUNT_CONFIG_INTERVAL","MAX_POST_TOKENS","stopCommonBackendPolling","stopActiveAccountPolling","inactiveAccountPolling","stopByAccount","activeAccountId","startAccountPolling","stopFns","stopChain","stopAllPollings","stopAccountPolling","preventRaceCondition","setActiveAccount","_stopByAccount$active","newActiveAccountId","otherAccountIds","switchNetwork","previousActiveAccountId","previousActiveAccount","addAccount","isActiveAccount","isCurrentNetwork","removeAccount","_stopByAccount$accoun","removeNetworkAccounts","removeAllAccounts","createInactiveAccountsPollingManager","setUpdatingStatus","updatingStatuses","isUpdating","chainsBeingUpdated","createUpdatingStatusManager","initPolling","_stopCommonBackendPol","loadTokensCache","tryUpdateTokens","tryUpdateSwapTokens","tryUpdateConfig","stopFn","setupCommonBackendPolling","nonBackendTokenAddresses","nonBackendTokenDetails","assets","_tokensCache$bySlug$a","blockchain","setBackendConfigCache","isLimited","isCopyStorageEnabled","supportAccountsCount","serverUtc","country","countryCode","isUpdateRequired","isAppUpdateRequired","localUtc","setActivePollingAccount","_stopActiveAccountPol","stopPollingFns","setupAccountConfigPolling","nativeSlug","newBySlug","pickChainTimestamps","partialAccount","accountConfig","initAccounts","activateAccount","isFirstLogin","deactivateAllAccounts","fetchTonWallet","fetchLedgerAccount","initDapps","getDapp","uniqueId","_await$getAccountValu","byUrl","addDapp","dapp","dapps","getDappsByUrl","deleteDapp","dontNotifyDapp","deleteAllDapps","urls","getDapps","getDappsState","removeAccountDapps","removeAllDapps","removeNetworkDapps","loadExploreSites","isLandscape","isBip39","createWallet","importMnemonic","isPrivateKey","isBip39Mnemonic","isTonMnemonic","tronWallet","secondNetworkAccount","createAccountWithSecondNetwork","secondNetwork","importLedgerWallet","driver","deviceId","deviceName","addAccountMutex","preferredId","getAccountIds","buildAccountId","getNewAccountId","addPollingAccount","removeNetworkPollingAccounts","resetAccounts","nextAccountId","removePollingAccount","changePassword","oldPassword","encryptedMnemonic","importViewAccount","resolvedAddresses","importNewWalletVersion","newAccount","existingAccount","_account$ton","isNew","ledger","deferreds","createDappPromise","promiseId","resolveDappPromise","fetchTonPrivateKey","fetchMnemonic","getMnemonicWordList","default","checkWorkerStorageIntegrity","verifyPassword","getAccountWithMnemonic","confirmDappRequest","dappPromises","confirmDappRequestConnect","cancelDappRequest","fetchAddress","initNfts","fetchNftsFromCollection","shouldAppend","realFeePerNft","nftByAddress","activityIds","CONNECT_EVENT_ERROR_CODES","SEND_TRANSACTION_ERROR_CODES","CHAIN","tonConnectGetDeviceInfo","features","getTonConnectMaxMessages","platform","getPlatform","appName","appVersion","packageJson","maxProtocolVersion","_navigator","userAgent","navigator","userAgentData","devicePlatform","TonConnectError","ManifestContentError","MANIFEST_CONTENT_ERROR","UnknownError","UNKNOWN_ERROR","BadRequestError","BAD_REQUEST_ERROR","UnknownAppError","UNKNOWN_APP_ERROR","MethodNotSupportedError","METHOD_NOT_SUPPORTED","crc32Table","makeCrc32Table","Uint32Array","signDataWithPrivateKey","schema","crc","crc32FromBytes","storeStringRefTail","hashBuffer","createCellDataHash","makeAddressBuffer","makeBytesWithLengthBuffer","makeTimestampBuffer","createTextDataHash","addressBuffer","writeInt32BE","workChain","copy","isBigEndian","writeInt32LE","unixSeconds","timestampBuffer","writeBigInt64BE","writeBigInt64LE","URL_MAX_LENGTH","isValidString","maxLength","isValidUrl","getTransferActualToAddress","isNftTransferPayload","isTransferPayloadDangerous","BLANK_GIF_DATA_URL","resolveInit","initPromise","initTonConnect","connect","openExtensionPopup","connectionType","isSse","dappMetadata","fetchDappMetadata","manifestUrl","addressItem","proofItem","proof","getCurrentAccountOrFail","connectedAt","isUrlEnsured","identifier","permissions","promiseResult","deviceInfo","buildTonAddressReplyItem","proofReplyItem","messageBuffer","bufferToSign","signTonProofWithPrivateKey","buildTonProofReplyItem","signTonProof","device","formatConnectError","ensureRequestParams","updateDapp","disconnect","_checkResult$emulatio","txPayload","dappNetworkRaw","publicKeyHex","dappNetwork","MAINNET","validUntil","valid_until","isLedger","vestingAddress","ownerPublicKey","_info$contractInfo","checkIsHisVestingWallet","WrongAddress","WrongNetwork","checkTransactionMessages","transactionsForRequest","_emulation$byTransact","rawAmount","rawPayload","isDangerous","displayedToAddress","prepareTransactionForRequest","signedTransfers","submitResult","PartialTransactionFailure","handleMethodError","errorMessage","apiErrors","USER_REJECTS_ERROR","Unexpected","signData","payloadToSign","performSignData","TESTNET","walletStateInit","idx","crc32","domainBuffer","lengthBytes","iconUrl","safeIconUrl","getCurrentAccountIdOrFail","lastAccountId","lastConnectedAccountId","connections","conn","findLastConnectedAccount","TTL_SEC","NONCE_SIZE","MAX_CONFIRM_DURATION","sseEventSource","delayedReturnParams","sseDapps","startSseConnection","isFromInAppBrowser","connectionOrigin","ret","shouldOpenUrl","connectRequest","decodeURIComponent","secretKeyArray","publicKeyArray","lastOutputId","tonConnect","MANIFEST_NOT_FOUND_ERROR","sendMessage","resetupSseConnection","lastEventId","dappsState","dappsByUrl","byUniqueId","_dapp$sse","clientIds","EventSource","openEventSource","encryptedMessage","sseDapp","fullBuffer","nonce","decrypted","jsonText","decryptMessage","setSseLastEventId","toId","topic","encryptMessage","sendRawMessage","fetchPriceHistory","subscribeNotifications","props","unsubscribeNotifications","connectUpdater","worker","createConnector","handleMessage","removeEventListener","methods","accountIds","currentStorage","words","isTonProxyEnabled","isTonMagicEnabled","settings","secondAccountId","secondAddress","newAccountById","migrateCoreWallet","idbVersion","idbStorage","idbData","field","raw","oldItem","newItem","prevValue","accountDapps","byAccountId","internalAccountId","accountData","parsed","mainnetAccountId","testnetAccountId","publicKeys","oldAddress","newAddress","_dapp$sse2","isIosKeychainModeMigrated","isIosApp","oldAccountById","mnemonicById","oldAccount","migrations","oldState","newState","activeAccountIds","migrateStorage","_currentOnUpdate","startStorageMigration","tonConnectSse","saveReferrer","addHooks","onDappDisconnected","onDappsChanged","api","sendToOrigin","transferables","_e$error","_e$error2","_e$reason","_e$reason2","handleErrors","_e$data","_api$init","lastArg","ImageBitmap","arrayBuffer","createPostMessageInterface","tonConnectApi","checkInt","checkInts","arrayish","coerceArray","createArray","copyArray","sourceArray","targetArray","targetStart","sourceStart","sourceEnd","Hex","convertUtf8","toBytes","encodeURI","substr","fromBytes","convertHex","numberOfRounds","rcon","S","Si","T4","T5","T6","T7","T8","U1","U2","U3","U4","convertToInt32","AES","_prepare","rounds","_Ke","_Kd","roundKeyCount","KC","tk","tt","rconpointer","ciphertext","ModeOfOperationECB","_aes","block","ModeOfOperationCBC","_lastCipherblock","ModeOfOperationCFB","segmentSize","_shiftRegister","xorSegment","ModeOfOperationOFB","_lastPrecipher","_lastPrecipherIndex","Counter","initialValue","_counter","setValue","setBytes","MAX_SAFE_INTEGER","increment","ModeOfOperationCTR","counter","_remainingCounter","_remainingCounterIndex","ModeOfOperation","ecb","cfb","ofb","ctr","utf8","padding","pkcs7","padder","strip","_arrayTest","module","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","__webpack_exports__","O","chunkIds","priority","notFulfilled","Infinity","fulfilled","getter","__esModule","definition","o","enumerable","chunkId","miniCssF","g","globalThis","Function","prop","toStringTag","scriptUrl","importScripts","document","currentScript","tagName","src","scripts","getElementsByTagName","installedChunks","chunkLoadingGlobal","parentChunkLoadingFunction","moreModules","runtime"],"sourceRoot":""}